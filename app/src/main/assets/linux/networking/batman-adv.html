
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>batman-adv &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SocketCAN - Controller Area Network" href="can.html" />
    <link rel="prev" title="Bare UDP Tunnelling Module Documentation" href="bareudp.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.5.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../subsystem-apis.html">Kernel subsystem documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../subsystem-apis.html#storage-interfaces">Storage interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cdrom/index.html">CD-ROM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scsi/index.html">SCSI Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../locking/index.html">Locking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpu-freq/index.html">CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fpga/index.html">FPGA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l3"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pcmcia/index.html">PCMCIA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../timers/index.html">Timers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../watchdog/index.html">Watchdog Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../virt/index.html">Virtualization Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hwmon/index.html">Hardware Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../accel/index.html">Compute Accelerators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crypto/index.html">Crypto API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mm/index.html">Memory Management Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../PCI/index.html">PCI Bus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peci/index.html">PECI Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wmi/index.html">WMI Subsystem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user's and administrator's guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  sbar.scrollTop = currents[currents.length - 1].offsetTop;
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/networking/batman-adv.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="batman-adv">
<h1>batman-adv<a class="headerlink" href="#batman-adv" title="Permalink to this heading">¶</a></h1>
<p>Batman advanced is a new approach to wireless networking which does no longer
operate on the IP basis. Unlike the batman daemon, which exchanges information
using UDP packets and sets routing tables, batman-advanced operates on ISO/OSI
Layer 2 only and uses and routes (or better: bridges) Ethernet Frames. It
emulates a virtual network switch of all nodes participating. Therefore all
nodes appear to be link local, thus all higher operating protocols won't be
affected by any changes within the network. You can run almost any protocol
above batman advanced, prominent examples are: IPv4, IPv6, DHCP, IPX.</p>
<p>Batman advanced was implemented as a Linux kernel driver to reduce the overhead
to a minimum. It does not depend on any (other) network driver, and can be used
on wifi as well as ethernet lan, vpn, etc ... (anything with ethernet-style
layer 2).</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h2>
<p>Load the batman-adv module into your kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ insmod batman-adv.ko
</pre></div>
</div>
<p>The module is now waiting for activation. You must add some interfaces on which
batman-adv can operate. The batman-adv soft-interface can be created using the
iproute2 tool <code class="docutils literal notranslate"><span class="pre">ip</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ip link add name bat0 type batadv
</pre></div>
</div>
<p>To activate a given interface simply attach it to the <code class="docutils literal notranslate"><span class="pre">bat0</span></code> interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ip link set dev eth0 master bat0
</pre></div>
</div>
<p>Repeat this step for all interfaces you wish to add. Now batman-adv starts
using/broadcasting on this/these interface(s).</p>
<p>To deactivate an interface you have to detach it from the &quot;bat0&quot; interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ip link set dev eth0 nomaster
</pre></div>
</div>
<p>The same can also be done using the batctl interface subcommand:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>batctl -m bat0 interface create
batctl -m bat0 interface add -M eth0
</pre></div>
</div>
<p>To detach eth0 and destroy bat0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>batctl -m bat0 interface del -M eth0
batctl -m bat0 interface destroy
</pre></div>
</div>
<p>There are additional settings for each batadv mesh interface, vlan and hardif
which can be modified using batctl. Detailed information about this can be found
in its manual.</p>
<p>For instance, you can check the current originator interval (value
in milliseconds which determines how often batman-adv sends its broadcast
packets):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ batctl -M bat0 orig_interval
1000
</pre></div>
</div>
<p>and also change its value:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ batctl -M bat0 orig_interval 3000
</pre></div>
</div>
<p>In very mobile scenarios, you might want to adjust the originator interval to a
lower value. This will make the mesh more responsive to topology changes, but
will also increase the overhead.</p>
<p>Information about the current state can be accessed via the batadv generic
netlink family. batctl provides a human readable version via its debug tables
subcommands.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p>To make use of your newly created mesh, batman advanced provides a new
interface &quot;bat0&quot; which you should use from this point on. All interfaces added
to batman advanced are not relevant any longer because batman handles them for
you. Basically, one &quot;hands over&quot; the data by using the batman interface and
batman will make sure it reaches its destination.</p>
<p>The &quot;bat0&quot; interface can be used like any other regular interface. It needs an
IP address which can be either statically configured or dynamically (by using
DHCP or similar services):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>NodeA: ip link set up dev bat0
NodeA: ip addr add 192.168.0.1/24 dev bat0

NodeB: ip link set up dev bat0
NodeB: ip addr add 192.168.0.2/24 dev bat0
NodeB: ping 192.168.0.1
</pre></div>
</div>
<p>Note: In order to avoid problems remove all IP addresses previously assigned to
interfaces now used by batman advanced, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ip addr flush dev eth0
</pre></div>
</div>
</section>
<section id="logging-debugging">
<h2>Logging/Debugging<a class="headerlink" href="#logging-debugging" title="Permalink to this heading">¶</a></h2>
<p>All error messages, warnings and information messages are sent to the kernel
log. Depending on your operating system distribution this can be read in one of
a number of ways. Try using the commands: <code class="docutils literal notranslate"><span class="pre">dmesg</span></code>, <code class="docutils literal notranslate"><span class="pre">logread</span></code>, or looking in
the files <code class="docutils literal notranslate"><span class="pre">/var/log/kern.log</span></code> or <code class="docutils literal notranslate"><span class="pre">/var/log/syslog</span></code>. All batman-adv messages
are prefixed with &quot;batman-adv:&quot; So to see just these messages try:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ dmesg | grep batman-adv
</pre></div>
</div>
<p>When investigating problems with your mesh network, it is sometimes necessary to
see more detailed debug messages. This must be enabled when compiling the
batman-adv module. When building batman-adv as part of the kernel, use &quot;make
menuconfig&quot; and enable the option <code class="docutils literal notranslate"><span class="pre">B.A.T.M.A.N.</span> <span class="pre">debugging</span></code>
(<code class="docutils literal notranslate"><span class="pre">CONFIG_BATMAN_ADV_DEBUG=y</span></code>).</p>
<p>Those additional debug messages can be accessed using the perf infrastructure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ trace-cmd stream -e batadv:batadv_dbg
</pre></div>
</div>
<p>The additional debug output is by default disabled. It can be enabled during
run time:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ batctl -m bat0 loglevel routes tt
</pre></div>
</div>
<p>will enable debug messages for when routes and translation table entries change.</p>
<p>Counters for different types of packets entering and leaving the batman-adv
module are available through ethtool:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ethtool --statistics bat0
</pre></div>
</div>
</section>
<section id="batctl">
<h2>batctl<a class="headerlink" href="#batctl" title="Permalink to this heading">¶</a></h2>
<p>As batman advanced operates on layer 2, all hosts participating in the virtual
switch are completely transparent for all protocols above layer 2. Therefore
the common diagnosis tools do not work as expected. To overcome these problems,
batctl was created. At the moment the batctl contains ping, traceroute, tcpdump
and interfaces to the kernel module settings.</p>
<p>For more information, please see the manpage (<code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">batctl</span></code>).</p>
<p>batctl is available on <a class="reference external" href="https://www.open-mesh.org/">https://www.open-mesh.org/</a></p>
</section>
<section id="contact">
<h2>Contact<a class="headerlink" href="#contact" title="Permalink to this heading">¶</a></h2>
<p>Please send us comments, experiences, questions, anything :)</p>
<dl class="simple">
<dt>IRC:</dt><dd><p>#batadv on ircs://irc.hackint.org/</p>
</dd>
<dt>Mailing-list:</dt><dd><p><a class="reference external" href="mailto:b&#46;a&#46;t&#46;m&#46;a&#46;n&#37;&#52;&#48;lists&#46;open-mesh&#46;org">b<span>&#46;</span>a<span>&#46;</span>t<span>&#46;</span>m<span>&#46;</span>a<span>&#46;</span>n<span>&#64;</span>lists<span>&#46;</span>open-mesh<span>&#46;</span>org</a> (optional subscription at
<a class="reference external" href="https://lists.open-mesh.org/mailman3/postorius/lists/b.a.t.m.a.n.lists.open-mesh.org/">https://lists.open-mesh.org/mailman3/postorius/lists/b.a.t.m.a.n.lists.open-mesh.org/</a>)</p>
</dd>
</dl>
<p>You can also contact the Authors:</p>
<ul class="simple">
<li><p>Marek Lindner &lt;<a class="reference external" href="mailto:mareklindner&#37;&#52;&#48;neomailbox&#46;ch">mareklindner<span>&#64;</span>neomailbox<span>&#46;</span>ch</a>&gt;</p></li>
<li><p>Simon Wunderlich &lt;<a class="reference external" href="mailto:sw&#37;&#52;&#48;simonwunderlich&#46;de">sw<span>&#64;</span>simonwunderlich<span>&#46;</span>de</a>&gt;</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/networking/batman-adv.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>