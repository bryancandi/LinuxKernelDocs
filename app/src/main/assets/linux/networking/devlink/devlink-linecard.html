
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Devlink Line card &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="bnxt devlink support" href="bnxt.html" />
    <link rel="prev" title="Devlink Trap" href="devlink-trap.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.7.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../subsystem-apis.html">Kernel subsystem documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../subsystem-apis.html#networking-interfaces">Networking interfaces</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user's and administrator's guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  sbar.scrollTop = currents[currents.length - 1].offsetTop;
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/networking/devlink/devlink-linecard.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="devlink-line-card">
<h1>Devlink Line card<a class="headerlink" href="#devlink-line-card" title="Permalink to this heading">¶</a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-linecard</span></code> mechanism is targeted for manipulation of
line cards that serve as a detachable PHY modules for modular switch
system. Following operations are provided:</p>
<blockquote>
<div><ul class="simple">
<li><p>Get a list of supported line card types.</p></li>
<li><p>Provision of a slot with specific line card type.</p></li>
<li><p>Get and monitor of line card state and its change.</p></li>
</ul>
</div></blockquote>
<p>Line card according to the type may contain one or more gearboxes
to mux the lanes with certain speed to multiple ports with lanes
of different speed. Line card ensures N:M mapping between
the switch ASIC modules and physical front panel ports.</p>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>Each line card devlink object is created by device driver,
according to the physical line card slots available on the device.</p>
<p>Similar to splitter cable, where the device might have no way
of detection of the splitter cable geometry, the device
might not have a way to detect line card type. For that devices,
concept of provisioning is introduced. It allows the user to:</p>
<blockquote>
<div><ul class="simple">
<li><p>Provision a line card slot with certain line card type</p>
<ul>
<li><p>Device driver would instruct the ASIC to prepare all
resources accordingly. The device driver would
create all instances, namely devlink port and netdevices
that reside on the line card, according to the line card type</p></li>
</ul>
</li>
<li><p>Manipulate of line card entities even without line card
being physically connected or powered-up</p></li>
<li><p>Setup splitter cable on line card ports</p>
<ul>
<li><p>As on the ordinary ports, user may provision a splitter
cable of a certain type, without the need to
be physically connected to the port</p></li>
</ul>
</li>
<li><p>Configure devlink ports and netdevices</p></li>
</ul>
</div></blockquote>
<p>Netdevice carrier is decided as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>Line card is not inserted or powered-down</p>
<ul>
<li><p>The carrier is always down</p></li>
</ul>
</li>
<li><p>Line card is inserted and powered up</p>
<ul>
<li><p>The carrier is decided as for ordinary port netdevice</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</section>
<section id="line-card-state">
<h2>Line card state<a class="headerlink" href="#line-card-state" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-linecard</span></code> mechanism supports the following line card states:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">unprovisioned</span></code>: Line card is not provisioned on the slot.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unprovisioning</span></code>: Line card slot is currently being unprovisioned.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">provisioning</span></code>: Line card slot is currently in a process of being provisioned
with a line card type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">provisioning_failed</span></code>: Provisioning was not successful.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">provisioned</span></code>: Line card slot is provisioned with a type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">active</span></code>: Line card is powered-up and active.</p></li>
</ul>
</div></blockquote>
<p>The following diagram provides a general overview of <code class="docutils literal notranslate"><span class="pre">devlink-linecard</span></code>
state transitions:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                                   +-------------------------+
                                   |                         |
+----------------------------------&gt;      unprovisioned      |
|                                  |                         |
|                                  +--------|-------^--------+
|                                           |       |
|                                           |       |
|                                  +--------v-------|--------+
|                                  |                         |
|                                  |       provisioning      |
|                                  |                         |
|                                  +------------|------------+
|                                               |
|                 +-----------------------------+
|                 |                             |
|    +------------v------------+   +------------v------------+   +-------------------------+
|    |                         |   |                         ----&gt;                         |
+-----   provisioning_failed   |   |       provisioned       |   |         active          |
|    |                         |   |                         &lt;----                         |
|    +------------^------------+   +------------|------------+   +-------------------------+
|                 |                             |
|                 |                             |
|                 |                +------------v------------+
|                 |                |                         |
|                 |                |     unprovisioning      |
|                 |                |                         |
|                 |                +------------|------------+
|                 |                             |
|                 +-----------------------------+
|                                               |
+-----------------------------------------------+
</pre></div>
</div>
</section>
<section id="example-usage">
<h2>Example usage<a class="headerlink" href="#example-usage" title="Permalink to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>devlink<span class="w"> </span>lc<span class="w"> </span>show<span class="w"> </span><span class="o">[</span><span class="w"> </span>DEV<span class="w"> </span><span class="o">[</span><span class="w"> </span>lc<span class="w"> </span>LC_INDEX<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">]</span>
$<span class="w"> </span>devlink<span class="w"> </span>lc<span class="w"> </span><span class="nb">set</span><span class="w"> </span>DEV<span class="w"> </span>lc<span class="w"> </span>LC_INDEX<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>LC_TYPE<span class="w"> </span><span class="p">|</span><span class="w"> </span>notype<span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">]</span>

<span class="c1"># Show current line card configuration and status for all slots:</span>
$<span class="w"> </span>devlink<span class="w"> </span>lc

<span class="c1"># Set slot 8 to be provisioned with type &quot;16x100G&quot;:</span>
$<span class="w"> </span>devlink<span class="w"> </span>lc<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pci/0000:01:00.0<span class="w"> </span>lc<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>16x100G

<span class="c1"># Set slot 8 to be unprovisioned:</span>
$<span class="w"> </span>devlink<span class="w"> </span>lc<span class="w"> </span><span class="nb">set</span><span class="w"> </span>pci/0000:01:00.0<span class="w"> </span>lc<span class="w"> </span><span class="m">8</span><span class="w"> </span>notype
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/networking/devlink/devlink-linecard.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>