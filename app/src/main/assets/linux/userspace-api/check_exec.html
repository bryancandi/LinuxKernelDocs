<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Executability check &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=a152c8ac" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="OpenCAPI (Open Coherent Accelerator Processor Interface)" href="accelerators/ocxl.html" />
    <link rel="prev" title="TEE (Trusted Execution Environment) Userspace API" href="tee.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.14.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Userspace API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#system-calls">System calls</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#security-related-interfaces">Security-related interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="no_new_privs.html">No New Privileges Flag</a></li>
<li class="toctree-l3"><a class="reference internal" href="seccomp_filter.html">Seccomp BPF (SECure COMPuting with filters)</a></li>
<li class="toctree-l3"><a class="reference internal" href="landlock.html">Landlock: unprivileged access control</a></li>
<li class="toctree-l3"><a class="reference internal" href="lsm.html">Linux Security Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="mfd_noexec.html">Introduction of non-executable mfd</a></li>
<li class="toctree-l3"><a class="reference internal" href="spec_ctrl.html">Speculation Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="tee.html">TEE (Trusted Execution Environment) Userspace API</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Executability check</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#devices-and-i-o">Devices and I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#everything-else">Everything else</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userspace-api/check_exec.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="executability-check">
<h1>Executability check<a class="headerlink" href="#executability-check" title="Link to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">AT_EXECVE_CHECK</span></code> <em class="manpage">execveat(2)</em> flag, and the
<code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE</span></code> and <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE</span></code> securebits
are intended for script interpreters and dynamic linkers to enforce a
consistent execution security policy handled by the kernel.  See the
<a class="reference external" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/samples/check-exec/inc.c">samples/check-exec/inc.c</a> example.</p>
<p>Whether an interpreter should check these securebits or not depends on the
security risk of running malicious scripts with respect to the execution
environment, and whether the kernel can check if a script is trustworthy or
not.  For instance, Python scripts running on a server can use arbitrary
syscalls and access arbitrary files.  Such interpreters should then be
enlighten to use these securebits and let users define their security policy.
However, a JavaScript engine running in a web browser should already be
sandboxed and then should not be able to harm the user’s environment.</p>
<p>Script interpreters or dynamic linkers built for tailored execution environments
(e.g. hardened Linux distributions or hermetic container images) could use
<code class="docutils literal notranslate"><span class="pre">AT_EXECVE_CHECK</span></code> without checking the related securebits if backward
compatibility is handled by something else (e.g. atomic update ensuring that
all legitimate libraries are allowed to be executed).  It is then recommended
for script interpreters and dynamic linkers to check the securebits at run time
by default, but also to provide the ability for custom builds to behave like if
<code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE</span></code> or <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE</span></code> were always
set to 1 (i.e. always enforce restrictions).</p>
<section id="at-execve-check">
<h2>AT_EXECVE_CHECK<a class="headerlink" href="#at-execve-check" title="Link to this heading">¶</a></h2>
<p>Passing the <code class="docutils literal notranslate"><span class="pre">AT_EXECVE_CHECK</span></code> flag to <em class="manpage">execveat(2)</em> only performs a
check on a regular file and returns 0 if execution of this file would be
allowed, ignoring the file format and then the related interpreter dependencies
(e.g. ELF libraries, script’s shebang).</p>
<p>Programs should always perform this check to apply kernel-level checks against
files that are not directly executed by the kernel but passed to a user space
interpreter instead.  All files that contain executable code, from the point of
view of the interpreter, should be checked.  However the result of this check
should only be enforced according to <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE</span></code> or
<code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE.</span></code>.</p>
<p>The main purpose of this flag is to improve the security and consistency of an
execution environment to ensure that direct file execution (e.g.
<code class="docutils literal notranslate"><span class="pre">./script.sh</span></code>) and indirect file execution (e.g. <code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">script.sh</span></code>) lead to
the same result.  For instance, this can be used to check if a file is
trustworthy according to the caller’s environment.</p>
<p>In a secure environment, libraries and any executable dependencies should also
be checked.  For instance, dynamic linking should make sure that all libraries
are allowed for execution to avoid trivial bypass (e.g. using <code class="docutils literal notranslate"><span class="pre">LD_PRELOAD</span></code>).
For such secure execution environment to make sense, only trusted code should
be executable, which also requires integrity guarantees.</p>
<p>To avoid race conditions leading to time-of-check to time-of-use issues,
<code class="docutils literal notranslate"><span class="pre">AT_EXECVE_CHECK</span></code> should be used with <code class="docutils literal notranslate"><span class="pre">AT_EMPTY_PATH</span></code> to check against a
file descriptor instead of a path.</p>
</section>
<section id="secbit-exec-restrict-file-and-secbit-exec-deny-interactive">
<h2>SECBIT_EXEC_RESTRICT_FILE and SECBIT_EXEC_DENY_INTERACTIVE<a class="headerlink" href="#secbit-exec-restrict-file-and-secbit-exec-deny-interactive" title="Link to this heading">¶</a></h2>
<p>When <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE</span></code> is set, a process should only interpret or
execute a file if a call to <em class="manpage">execveat(2)</em> with the related file
descriptor and the <code class="docutils literal notranslate"><span class="pre">AT_EXECVE_CHECK</span></code> flag succeed.</p>
<p>This secure bit may be set by user session managers, service managers,
container runtimes, sandboxer tools...  Except for test environments, the
related <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE_LOCKED</span></code> bit should also be set.</p>
<p>Programs should only enforce consistent restrictions according to the
securebits but without relying on any other user-controlled configuration.
Indeed, the use case for these securebits is to only trust executable code
vetted by the system configuration (through the kernel), so we should be
careful to not let untrusted users control this configuration.</p>
<p>However, script interpreters may still use user configuration such as
environment variables as long as it is not a way to disable the securebits
checks.  For instance, the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">LD_PRELOAD</span></code> variables can be set by
a script’s caller.  Changing these variables may lead to unintended code
executions, but only from vetted executable programs, which is OK.  For this to
make sense, the system should provide a consistent security policy to avoid
arbitrary code execution e.g., by enforcing a write xor execute policy.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE</span></code> is set, a process should never interpret
interactive user commands (e.g. scripts).  However, if such commands are passed
through a file descriptor (e.g. stdin), its content should be interpreted if a
call to <em class="manpage">execveat(2)</em> with the related file descriptor and the
<code class="docutils literal notranslate"><span class="pre">AT_EXECVE_CHECK</span></code> flag succeed.</p>
<p>For instance, script interpreters called with a script snippet as argument
should always deny such execution if <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE</span></code> is set.</p>
<p>This secure bit may be set by user session managers, service managers,
container runtimes, sandboxer tools...  Except for test environments, the
related <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE_LOCKED</span></code> bit should also be set.</p>
<p>Here is the expected behavior for a script interpreter according to combination
of any exec securebits:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE=0</span></code> and <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE=0</span></code></p>
<p>Always interpret scripts, and allow arbitrary user commands (default).</p>
<p>No threat, everyone and everything is trusted, but we can get ahead of
potential issues thanks to the call to <em class="manpage">execveat(2)</em> with
<code class="docutils literal notranslate"><span class="pre">AT_EXECVE_CHECK</span></code> which should always be performed but ignored by the
script interpreter.  Indeed, this check is still important to enable systems
administrators to verify requests (e.g. with audit) and prepare for
migration to a secure mode.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE=1</span></code> and <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE=0</span></code></p>
<p>Deny script interpretation if they are not executable, but allow
arbitrary user commands.</p>
<p>The threat is (potential) malicious scripts run by trusted (and not fooled)
users.  That can protect against unintended script executions (e.g. <code class="docutils literal notranslate"><span class="pre">sh</span>
<span class="pre">/tmp/*.sh</span></code>).  This makes sense for (semi-restricted) user sessions.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE=0</span></code> and <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE=1</span></code></p>
<p>Always interpret scripts, but deny arbitrary user commands.</p>
<p>This use case may be useful for secure services (i.e. without interactive
user session) where scripts’ integrity is verified (e.g.  with IMA/EVM or
dm-verity/IPE) but where access rights might not be ready yet.  Indeed,
arbitrary interactive commands would be much more difficult to check.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_RESTRICT_FILE=1</span></code> and <code class="docutils literal notranslate"><span class="pre">SECBIT_EXEC_DENY_INTERACTIVE=1</span></code></p>
<p>Deny script interpretation if they are not executable, and also deny
any arbitrary user commands.</p>
<p>The threat is malicious scripts run by untrusted users (but trusted code).
This makes sense for system services that may only execute trusted scripts.</p>
</li>
</ol>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/userspace-api/check_exec.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>