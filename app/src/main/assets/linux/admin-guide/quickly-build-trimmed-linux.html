
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How to quickly build a trimmed Linux kernel &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bug hunting" href="bug-hunting.html" />
    <link rel="prev" title="Reporting regressions" href="reporting-regressions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.6.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">Kernel subsystem documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Linux kernel user's and administrator's guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Linux kernel release 6.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-parameters.html">The kernel's command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="abi.html">Linux ABI description</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html">Feature status on all architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-regressions.html">Reporting regressions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to quickly build a trimmed Linux kernel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-essence-of-the-process-aka-tl-dr">The essence of the process (aka 'TL;DR')</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-by-step-guide">Step-by-step guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reference-section-for-the-step-by-step-guide">Reference section for the step-by-step guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faq">FAQ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="init.html">Explaining the &quot;No working init found.&quot; boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="pstore-blk.html">pstore block oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="workload-tracing.html">Discovering Linux kernel subsystems used by a workload</a></li>
<li class="toctree-l2"><a class="reference internal" href="acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockdev/index.html">Block Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="filesystem-monitoring.html">File system Monitoring with fanotify</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_random.html">Hardware random number generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="jfs.html">IBM's Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="media/index.html">Media subsystem admin and user guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="syscall-user-dispatch.html">Syscall User Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermal/index.html">Thermal Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  sbar.scrollTop = currents[currents.length - 1].offsetTop;
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/admin-guide/quickly-build-trimmed-linux.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="how-to-quickly-build-a-trimmed-linux-kernel">
<h1>How to quickly build a trimmed Linux kernel<a class="headerlink" href="#how-to-quickly-build-a-trimmed-linux-kernel" title="Permalink to this heading">¶</a></h1>
<p>This guide explains how to swiftly build Linux kernels that are ideal for
testing purposes, but perfectly fine for day-to-day use, too.</p>
<section id="the-essence-of-the-process-aka-tl-dr">
<h2>The essence of the process (aka 'TL;DR')<a class="headerlink" href="#the-essence-of-the-process-aka-tl-dr" title="Permalink to this heading">¶</a></h2>
<p><em>[If you are new to compiling Linux, ignore this TLDR and head over to the next
section below: it contains a step-by-step guide, which is more detailed, but
still brief and easy to follow; that guide and its accompanying reference
section also mention alternatives, pitfalls, and additional aspects, all of
which might be relevant for you.]</em></p>
<p>If your system uses techniques like Secure Boot, prepare it to permit starting
self-compiled Linux kernels; install compilers and everything else needed for
building Linux; make sure to have 12 Gigabyte free space in your home directory.
Now run the following commands to download fresh Linux mainline sources, which
you then use to configure, build and install your own kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone --depth 1 -b master \
  https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git ~/linux/
cd ~/linux/
# Hint: if you want to apply patches, do it at this point. See below for details.
# Hint: it&#39;s recommended to tag your build at this point. See below for details.
yes &quot;&quot; | make localmodconfig
# Hint: at this point you might want to adjust the build configuration; you&#39;ll
#   have to, if you are running Debian. See below for details.
make -j $(nproc --all)
# Note: on many commodity distributions the next command suffices, but on Arch
#   Linux, its derivatives, and some others it does not. See below for details.
command -v installkernel &amp;&amp; sudo make modules_install install
reboot
</pre></div>
</div>
<p>If you later want to build a newer mainline snapshot, use these commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ~/linux/
git fetch --depth 1 origin
# Note: the next command will discard any changes you did to the code:
git checkout --force --detach origin/master
# Reminder: if you want to (re)apply patches, do it at this point.
# Reminder: you might want to add or modify a build tag at this point.
make olddefconfig
make -j $(nproc --all)
# Reminder: the next command on some distributions does not suffice.
command -v installkernel &amp;&amp; sudo make modules_install install
reboot
</pre></div>
</div>
</section>
<section id="step-by-step-guide">
<h2>Step-by-step guide<a class="headerlink" href="#step-by-step-guide" title="Permalink to this heading">¶</a></h2>
<p>Compiling your own Linux kernel is easy in principle. There are various ways to
do it. Which of them actually work and is the best depends on the circumstances.</p>
<p>This guide describes a way perfectly suited for those who want to quickly
install Linux from sources without being bothered by complicated details; the
goal is to cover everything typically needed on mainstream Linux distributions
running on commodity PC or server hardware.</p>
<p>The described approach is great for testing purposes, for example to try a
proposed fix or to check if a problem was already fixed in the latest codebase.
Nonetheless, kernels built this way are also totally fine for day-to-day use
while at the same time being easy to keep up to date.</p>
<p>The following steps describe the important aspects of the process; a
comprehensive reference section later explains each of them in more detail. It
sometimes also describes alternative approaches, pitfalls, as well as errors
that might occur at a particular point -- and how to then get things rolling
again.</p>
<blockquote id="backup-sbs">
<div><ul>
<li><p>Create a fresh backup and put system repair and restore tools at hand, just
to be prepared for the unlikely case of something going sideways.</p>
<p>[<a class="reference internal" href="#backup"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="secureboot-sbs">
<div><ul>
<li><p>On platforms with 'Secure Boot' or similar techniques, prepare everything to
ensure the system will permit your self-compiled kernel to boot later. The
quickest and easiest way to achieve this on commodity x86 systems is to
disable such techniques in the BIOS setup utility; alternatively, remove
their restrictions through a process initiated by
<code class="docutils literal notranslate"><span class="pre">mokutil</span> <span class="pre">--disable-validation</span></code>.</p>
<p>[<a class="reference internal" href="#secureboot"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="buildrequires-sbs">
<div><ul>
<li><p>Install all software required to build a Linux kernel. Often you will need:
'bc', 'binutils' ('ld' et al.), 'bison', 'flex', 'gcc', 'git', 'openssl',
'pahole', 'perl', and the development headers for 'libelf' and 'openssl'. The
reference section shows how to quickly install those on various popular Linux
distributions.</p>
<p>[<a class="reference internal" href="#buildrequires"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="diskspace-sbs">
<div><ul>
<li><p>Ensure to have enough free space for building and installing Linux. For the
latter 150 Megabyte in /lib/ and 100 in /boot/ are a safe bet. For storing
sources and build artifacts 12 Gigabyte in your home directory should
typically suffice. If you have less available, be sure to check the reference
section for the step that explains adjusting your kernels build
configuration: it mentions a trick that reduce the amount of required space
in /home/ to around 4 Gigabyte.</p>
<p>[<a class="reference internal" href="#diskspace"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="sources-sbs">
<div><ul>
<li><p>Retrieve the sources of the Linux version you intend to build; then change
into the directory holding them, as all further commands in this guide are
meant to be executed from there.</p>
<p><em>[Note: the following paragraphs describe how to retrieve the sources by
partially cloning the Linux stable git repository. This is called a shallow
clone. The reference section explains two alternatives:</em> <a class="reference internal" href="#sources-archive"><span class="std std-ref">packaged
archives</span></a> <em>and</em> <a class="reference internal" href="#sources-full"><span class="std std-ref">a full git clone</span></a> <em>;
prefer the latter, if downloading a lot of data does not bother you, as that
will avoid some</em> <a class="reference internal" href="#sources-shallow"><span class="std std-ref">peculiar characteristics of shallow clones the
reference section explains</span></a> <em>.]</em></p>
<p>First, execute the following command to retrieve a fresh mainline codebase:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone --no-checkout --depth 1 -b master \
  https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git ~/linux/
cd ~/linux/
</pre></div>
</div>
<p>If you want to access recent mainline releases and pre-releases, deepen you
clone's history to the oldest mainline version you are interested in:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git fetch --shallow-exclude=v6.0 origin
</pre></div>
</div>
<p>In case you want to access a stable/longterm release (say v6.1.5), simply add
the branch holding that series; afterwards fetch the history at least up to
the mainline version that started the series (v6.1):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git remote set-branches --add origin linux-6.1.y
git fetch --shallow-exclude=v6.0 origin
</pre></div>
</div>
<p>Now checkout the code you are interested in. If you just performed the
initial clone, you will be able to check out a fresh mainline codebase, which
is ideal for checking whether developers already fixed an issue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git checkout --detach origin/master
</pre></div>
</div>
<p>If you deepened your clone, you instead of <code class="docutils literal notranslate"><span class="pre">origin/master</span></code> can specify the
version you deepened to (<code class="docutils literal notranslate"><span class="pre">v6.0</span></code> above); later releases like <code class="docutils literal notranslate"><span class="pre">v6.1</span></code> and
pre-release like <code class="docutils literal notranslate"><span class="pre">v6.2-rc1</span></code> will work, too. Stable or longterm versions
like <code class="docutils literal notranslate"><span class="pre">v6.1.5</span></code> work just the same, if you added the appropriate
stable/longterm branch as described.</p>
<p>[<a class="reference internal" href="#sources"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="patching-sbs">
<div><ul>
<li><p>In case you want to apply a kernel patch, do so now. Often a command like
this will do the trick:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>patch -p1 &lt; ../proposed-fix.patch
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">-p1</span></code> is actually needed, depends on how the patch was created; in
case it does not apply thus try without it.</p>
<p>If you cloned the sources with git and anything goes sideways, run <code class="docutils literal notranslate"><span class="pre">git</span>
<span class="pre">reset</span> <span class="pre">--hard</span></code> to undo any changes to the sources.</p>
<p>[<a class="reference internal" href="#patching"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="tagging-sbs">
<div><ul>
<li><p>If you patched your kernel or have one of the same version installed already,
better add a unique tag to the one you are about to build:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;-proposed_fix&quot; &gt; localversion
</pre></div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-r</span></code> under your kernel later will then print something like
'6.1-rc4-proposed_fix'.</p>
<p>[<a class="reference internal" href="#tagging"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
<ul id="configuration-sbs">
<li><p>Create the build configuration for your kernel based on an existing
configuration.</p>
<p>If you already prepared such a '.config' file yourself, copy it to
~/linux/ and run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">olddefconfig</span></code>.</p>
<p>Use the same command, if your distribution or somebody else already tailored
your running kernel to your or your hardware's needs: the make target
'olddefconfig' will then try to use that kernel's .config as base.</p>
<p>Using this make target is fine for everybody else, too -- but you often can
save a lot of time by using this command instead:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>yes &quot;&quot; | make localmodconfig
</pre></div>
</div>
<p>This will try to pick your distribution's kernel as base, but then disable
modules for any features apparently superfluous for your setup. This will
reduce the compile time enormously, especially if you are running an
universal kernel from a commodity Linux distribution.</p>
<p>There is a catch: 'localmodconfig' is likely to disable kernel features you
did not use since you booted your Linux -- like drivers for currently
disconnected peripherals or a virtualization software not haven't used yet.
You can reduce or nearly eliminate that risk with tricks the reference
section outlines; but when building a kernel just for quick testing purposes
it is often negligible if such features are missing. But you should keep that
aspect in mind when using a kernel built with this make target, as it might
be the reason why something you only use occasionally stopped working.</p>
<p>[<a class="reference internal" href="#configuration"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="configmods-sbs">
<div><ul class="simple">
<li><p>Check if you might want to or have to adjust some kernel configuration
options:</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Evaluate how you want to handle debug symbols. Enable them, if you later
might need to decode a stack trace found for example in a 'panic', 'Oops',
'warning', or 'BUG'; on the other hand disable them, if you are short on
storage space or prefer a smaller kernel binary. See the reference section
for details on how to do either. If neither applies, it will likely be fine
to simply not bother with this. [<a class="reference internal" href="#configmods-debugsymbols"><span class="std std-ref">details</span></a>]</p></li>
<li><p>Are you running Debian? Then to avoid known problems by performing
additional adjustments explained in the reference section.
[<a class="reference internal" href="#configmods-distros"><span class="std std-ref">details</span></a>].</p></li>
<li><p>If you want to influence the other aspects of the configuration, do so now
by using make targets like 'menuconfig' or 'xconfig'.
[<a class="reference internal" href="#configmods-individual"><span class="std std-ref">details</span></a>].</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<blockquote id="build-sbs">
<div><ul>
<li><p>Build the image and the modules of your kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make -j $(nproc --all)
</pre></div>
</div>
<p>If you want your kernel packaged up as deb, rpm, or tar file, see the
reference section for alternatives.</p>
<p>[<a class="reference internal" href="#build"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="install-sbs">
<div><ul>
<li><p>Now install your kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>command -v installkernel &amp;&amp; sudo make modules_install install
</pre></div>
</div>
<p>Often all left for you to do afterwards is a <code class="docutils literal notranslate"><span class="pre">reboot</span></code>, as many commodity
Linux distributions will then create an initramfs (also known as initrd) and
an entry for your kernel in your bootloader's configuration; but on some
distributions you have to take care of these two steps manually for reasons
the reference section explains.</p>
<p>On a few distributions like Arch Linux and its derivatives the above command
does nothing at all; in that case you have to manually install your kernel,
as outlined in the reference section.</p>
<p>If you are running a immutable Linux distribution, check its documentation
and the web to find out how to install your own kernel there.</p>
<p>[<a class="reference internal" href="#install"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="another-sbs">
<div><ul>
<li><p>To later build another kernel you need similar steps, but sometimes slightly
different commands.</p>
<p>First, switch back into the sources tree:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd ~/linux/
</pre></div>
</div>
<p>In case you want to build a version from a stable/longterm series you have
not used yet (say 6.2.y), tell git to track it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git remote set-branches --add origin linux-6.2.y
</pre></div>
</div>
<p>Now fetch the latest upstream changes; you again need to specify the earliest
version you care about, as git otherwise might retrieve the entire commit
history:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git fetch --shallow-exclude=v6.0 origin
</pre></div>
</div>
<p>Now switch to the version you are interested in -- but be aware the command
used here will discard any modifications you performed, as they would
conflict with the sources you want to checkout:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git checkout --force --detach origin/master
</pre></div>
</div>
<p>At this point you might want to patch the sources again or set/modify a build
tag, as explained earlier. Afterwards adjust the build configuration to the
new codebase using olddefconfig, which will now adjust the configuration file
you prepared earlier using localmodconfig  (~/linux/.config) for your next
kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># reminder: if you want to apply patches, do it at this point
# reminder: you might want to update your build tag at this point
make olddefconfig
</pre></div>
</div>
<p>Now build your kernel:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make -j $(nproc --all)
</pre></div>
</div>
<p>Afterwards install the kernel as outlined above:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>command -v installkernel &amp;&amp; sudo make modules_install install
</pre></div>
</div>
<p>[<a class="reference internal" href="#another"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<blockquote id="uninstall-sbs">
<div><ul>
<li><p>Your kernel is easy to remove later, as its parts are only stored in two
places and clearly identifiable by the kernel's release name. Just ensure to
not delete the kernel you are running, as that might render your system
unbootable.</p>
<p>Start by deleting the directory holding your kernel's modules, which is named
after its release name -- '6.0.1-foobar' in the following example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo rm -rf /lib/modules/6.0.1-foobar
</pre></div>
</div>
<p>Now try the following command, which on some distributions will delete all
other kernel files installed while also removing the kernel's entry from the
bootloader configuration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>command -v kernel-install &amp;&amp; sudo kernel-install -v remove 6.0.1-foobar
</pre></div>
</div>
<p>If that command does not output anything or fails, see the reference section;
do the same if any files named '<em>6.0.1-foobar</em>' remain in /boot/.</p>
<p>[<a class="reference internal" href="#uninstall"><span class="std std-ref">details</span></a>]</p>
</li>
</ul>
</div></blockquote>
<p id="submit-improvements">Did you run into trouble following any of the above steps that is not cleared up
by the reference section below? Or do you have ideas how to improve the text?
Then please take a moment of your time and let the maintainer of this document
know by email (Thorsten Leemhuis &lt;<a class="reference external" href="mailto:linux&#37;&#52;&#48;leemhuis&#46;info">linux<span>&#64;</span>leemhuis<span>&#46;</span>info</a>&gt;), ideally while CCing the
Linux docs mailing list (<a class="reference external" href="mailto:linux-doc&#37;&#52;&#48;vger&#46;kernel&#46;org">linux-doc<span>&#64;</span>vger<span>&#46;</span>kernel<span>&#46;</span>org</a>). Such feedback is vital to
improve this document further, which is in everybody's interest, as it will
enable more people to master the task described here.</p>
</section>
<section id="reference-section-for-the-step-by-step-guide">
<h2>Reference section for the step-by-step guide<a class="headerlink" href="#reference-section-for-the-step-by-step-guide" title="Permalink to this heading">¶</a></h2>
<p>This section holds additional information for each of the steps in the above
guide.</p>
<section id="prepare-for-emergencies">
<span id="backup"></span><h3>Prepare for emergencies<a class="headerlink" href="#prepare-for-emergencies" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>Create a fresh backup and put system repair and restore tools at hand</em>
[<a class="reference internal" href="#backup-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>Remember, you are dealing with computers, which sometimes do unexpected things
-- especially if you fiddle with crucial parts like the kernel of an operating
system. That's what you are about to do in this process. Hence, better prepare
for something going sideways, even if that should not happen.</p>
<p>[<a class="reference internal" href="#backup-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="dealing-with-techniques-like-secure-boot">
<span id="secureboot"></span><h3>Dealing with techniques like Secure Boot<a class="headerlink" href="#dealing-with-techniques-like-secure-boot" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>On platforms with 'Secure Boot' or similar techniques, prepare everything to
ensure the system will permit your self-compiled kernel to boot later.</em>
[<a class="reference internal" href="#secureboot-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>Many modern systems allow only certain operating systems to start; they thus by
default will reject booting self-compiled kernels.</p>
<p>You ideally deal with this by making your platform trust your self-built kernels
with the help of a certificate and signing. How to do that is not described
here, as it requires various steps that would take the text too far away from
its purpose; '<a class="reference internal" href="module-signing.html"><span class="doc">Kernel module signing facility</span></a>' and various web
sides already explain this in more detail.</p>
<p>Temporarily disabling solutions like Secure Boot is another way to make your own
Linux boot. On commodity x86 systems it is possible to do this in the BIOS Setup
utility; the steps to do so are not described here, as they greatly vary between
machines.</p>
<p>On mainstream x86 Linux distributions there is a third and universal option:
disable all Secure Boot restrictions for your Linux environment. You can
initiate this process by running <code class="docutils literal notranslate"><span class="pre">mokutil</span> <span class="pre">--disable-validation</span></code>; this will
tell you to create a one-time password, which is safe to write down. Now
restart; right after your BIOS performed all self-tests the bootloader Shim will
show a blue box with a message 'Press any key to perform MOK management'. Hit
some key before the countdown exposes. This will open a menu and choose 'Change
Secure Boot state' there. Shim's 'MokManager' will now ask you to enter three
randomly chosen characters from the one-time password specified earlier. Once
you provided them, confirm that you really want to disable the validation.
Afterwards, permit MokManager to reboot the machine.</p>
<p>[<a class="reference internal" href="#secureboot-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="install-build-requirements">
<span id="buildrequires"></span><h3>Install build requirements<a class="headerlink" href="#install-build-requirements" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>Install all software required to build a Linux kernel.</em>
[<a class="reference internal" href="#buildrequires-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>The kernel is pretty stand-alone, but besides tools like the compiler you will
sometimes need a few libraries to build one. How to install everything needed
depends on your Linux distribution and the configuration of the kernel you are
about to build.</p>
<p>Here are a few examples what you typically need on some mainstream
distributions:</p>
<blockquote>
<div><ul>
<li><p>Debian, Ubuntu, and derivatives:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt install bc binutils bison dwarves flex gcc git make openssl \
  pahole perl-base libssl-dev libelf-dev
</pre></div>
</div>
</li>
<li><p>Fedora and derivatives:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo dnf install binutils /usr/include/{libelf.h,openssl/pkcs7.h} \
  /usr/bin/{bc,bison,flex,gcc,git,openssl,make,perl,pahole}
</pre></div>
</div>
</li>
<li><p>openSUSE and derivatives:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo zypper install bc binutils bison dwarves flex gcc git make perl-base \
  openssl openssl-devel libelf-dev
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>In case you wonder why these lists include openssl and its development headers:
they are needed for the Secure Boot support, which many distributions enable in
their kernel configuration for x86 machines.</p>
<p>Sometimes you will need tools for compression formats like bzip2, gzip, lz4,
lzma, lzo, xz, or zstd as well.</p>
<p>You might need additional libraries and their development headers in case you
perform tasks not covered in this guide. For example, zlib will be needed when
building kernel tools from the tools/ directory; adjusting the build
configuration with make targets like 'menuconfig' or 'xconfig' will require
development headers for ncurses or Qt5.</p>
<p>[<a class="reference internal" href="#buildrequires-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="space-requirements">
<span id="diskspace"></span><h3>Space requirements<a class="headerlink" href="#space-requirements" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>Ensure to have enough free space for building and installing Linux.</em>
[<a class="reference internal" href="#diskspace-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>The numbers mentioned are rough estimates with a big extra charge to be on the
safe side, so often you will need less.</p>
<p>If you have space constraints, remember to read the reference section when you
reach the <a class="reference internal" href="#configmods"><span class="std std-ref">section about configuration adjustments'</span></a>, as
ensuring debug symbols are disabled will reduce the consumed disk space by quite
a few gigabytes.</p>
<p>[<a class="reference internal" href="#diskspace-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="download-the-sources">
<span id="sources"></span><h3>Download the sources<a class="headerlink" href="#download-the-sources" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>Retrieve the sources of the Linux version you intend to build.</em>
[<a class="reference internal" href="#sources-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>The step-by-step guide outlines how to retrieve Linux' sources using a shallow
git clone. There is <a class="reference internal" href="#sources-shallow"><span class="std std-ref">more to tell about this method</span></a> and
two alternate ways worth describing: <a class="reference internal" href="#sources-archive"><span class="std std-ref">packaged archives</span></a>
and <a class="reference internal" href="#sources-full"><span class="std std-ref">a full git clone</span></a>. And the aspects '<a class="reference internal" href="#sources-snapshot"><span class="std std-ref">wouldn't it
be wiser to use a proper pre-release than the latest mainline code</span></a>' and '<a class="reference internal" href="#sources-fresher"><span class="std std-ref">how to get an even fresher mainline codebase</span></a>' need elaboration, too.</p>
<p>Note, to keep things simple the commands used in this guide store the build
artifacts in the source tree. If you prefer to separate them, simply add
something like <code class="docutils literal notranslate"><span class="pre">O=~/linux-builddir/</span></code> to all make calls; also adjust the path
in all commands that add files or modify any generated (like your '.config').</p>
<p>[<a class="reference internal" href="#sources-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
<section id="noteworthy-characteristics-of-shallow-clones">
<span id="sources-shallow"></span><h4>Noteworthy characteristics of shallow clones<a class="headerlink" href="#noteworthy-characteristics-of-shallow-clones" title="Permalink to this heading">¶</a></h4>
<p>The step-by-step guide uses a shallow clone, as it is the best solution for most
of this document's target audience. There are a few aspects of this approach
worth mentioning:</p>
<blockquote>
<div><ul>
<li><p>This document in most places uses <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code> with <code class="docutils literal notranslate"><span class="pre">--shallow-exclude=</span></code>
to specify the earliest version you care about (or to be precise: its git
tag). You alternatively can use the parameter <code class="docutils literal notranslate"><span class="pre">--shallow-since=</span></code> to specify
an absolute (say <code class="docutils literal notranslate"><span class="pre">'2023-07-15'</span></code>) or relative (<code class="docutils literal notranslate"><span class="pre">'12</span> <span class="pre">months'</span></code>) date to
define the depth of the history you want to download. As a second
alternative, you can also specify a certain depth explicitly with a parameter
like <code class="docutils literal notranslate"><span class="pre">--depth=1</span></code>, unless you add branches for stable/longterm kernels.</p></li>
<li><p>When running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code>, remember to always specify the oldest version,
the time you care about, or an explicit depth as shown in the step-by-step
guide. Otherwise you will risk downloading nearly the entire git history,
which will consume quite a bit of time and bandwidth while also stressing the
servers.</p>
<p>Note, you do not have to use the same version or date all the time. But when
you change it over time, git will deepen or flatten the history to the
specified point. That allows you to retrieve versions you initially thought
you did not need -- or it will discard the sources of older versions, for
example in case you want to free up some disk space. The latter will happen
automatically when using <code class="docutils literal notranslate"><span class="pre">--shallow-since=</span></code> or
<code class="docutils literal notranslate"><span class="pre">--depth=</span></code>.</p>
</li>
<li><p>Be warned, when deepening your clone you might encounter an error like
'fatal: error in object: unshallow cafecaca0c0dacafecaca0c0dacafecaca0c0da'.
In that case run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">repack</span> <span class="pre">-d</span></code> and try again``</p></li>
<li><p>In case you want to revert changes from a certain version (say Linux 6.3) or
perform a bisection (v6.2..v6.3), better tell <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code> to retrieve
objects up to three versions earlier (e.g. 6.0): <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">describe</span></code> will then
be able to describe most commits just like it would in a full git clone.</p></li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#sources-sbs"><span class="std std-ref">back to step-by-step guide</span></a>] [<a class="reference internal" href="#sources"><span class="std std-ref">back to section intro</span></a>]</p>
</section>
<section id="downloading-the-sources-using-a-packages-archive">
<span id="sources-archive"></span><h4>Downloading the sources using a packages archive<a class="headerlink" href="#downloading-the-sources-using-a-packages-archive" title="Permalink to this heading">¶</a></h4>
<p>People new to compiling Linux often assume downloading an archive via the
front-page of <a class="reference external" href="https://kernel.org">https://kernel.org</a> is the best approach to retrieve Linux'
sources. It actually can be, if you are certain to build just one particular
kernel version without changing any code. Thing is: you might be sure this will
be the case, but in practice it often will turn out to be a wrong assumption.</p>
<p>That's because when reporting or debugging an issue developers will often ask to
give another version a try. They also might suggest temporarily undoing a commit
with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">revert</span></code> or might provide various patches to try. Sometimes reporters
will also be asked to use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> to find the change causing a problem.
These things rely on git or are a lot easier and quicker to handle with it.</p>
<p>A shallow clone also does not add any significant overhead. For example, when
you use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">--depth=1</span></code> to create a shallow clone of the latest mainline
codebase git will only retrieve a little more data than downloading the latest
mainline pre-release (aka 'rc') via the front-page of kernel.org would.</p>
<p>A shallow clone therefore is often the better choice. If you nevertheless want
to use a packaged source archive, download one via kernel.org; afterwards
extract its content to some directory and change to the subdirectory created
during extraction. The rest of the step-by-step guide will work just fine, apart
from things that rely on git -- but this mainly concerns the section on
successive builds of other versions.</p>
<p>[<a class="reference internal" href="#sources-sbs"><span class="std std-ref">back to step-by-step guide</span></a>] [<a class="reference internal" href="#sources"><span class="std std-ref">back to section intro</span></a>]</p>
</section>
<section id="downloading-the-sources-using-a-full-git-clone">
<span id="sources-full"></span><h4>Downloading the sources using a full git clone<a class="headerlink" href="#downloading-the-sources-using-a-full-git-clone" title="Permalink to this heading">¶</a></h4>
<p>If downloading and storing a lot of data (~4,4 Gigabyte as of early 2023) is
nothing that bothers you, instead of a shallow clone perform a full git clone
instead. You then will avoid the specialties mentioned above and will have all
versions and individual commits at hand at any time:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>curl -L \
  https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/clone.bundle \
  -o linux-stable.git.bundle
git clone linux-stable.git.bundle ~/linux/
rm linux-stable.git.bundle
cd ~/linux/
git remote set-url origin \
  https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git
git fetch origin
git checkout --detach origin/master
</pre></div>
</div>
<p>[<a class="reference internal" href="#sources-sbs"><span class="std std-ref">back to step-by-step guide</span></a>] [<a class="reference internal" href="#sources"><span class="std std-ref">back to section intro</span></a>]</p>
</section>
<section id="proper-pre-releases-rcs-vs-latest-mainline">
<span id="sources-snapshot"></span><h4>Proper pre-releases (RCs) vs. latest mainline<a class="headerlink" href="#proper-pre-releases-rcs-vs-latest-mainline" title="Permalink to this heading">¶</a></h4>
<p>When cloning the sources using git and checking out origin/master, you often
will retrieve a codebase that is somewhere between the latest and the next
release or pre-release. This almost always is the code you want when giving
mainline a shot: pre-releases like v6.1-rc5 are in no way special, as they do
not get any significant extra testing before being published.</p>
<p>There is one exception: you might want to stick to the latest mainline release
(say v6.1) before its successor's first pre-release (v6.2-rc1) is out. That is
because compiler errors and other problems are more likely to occur during this
time, as mainline then is in its 'merge window': a usually two week long phase,
in which the bulk of the changes for the next release is merged.</p>
<p>[<a class="reference internal" href="#sources-sbs"><span class="std std-ref">back to step-by-step guide</span></a>] [<a class="reference internal" href="#sources"><span class="std std-ref">back to section intro</span></a>]</p>
</section>
<section id="avoiding-the-mainline-lag">
<span id="sources-fresher"></span><h4>Avoiding the mainline lag<a class="headerlink" href="#avoiding-the-mainline-lag" title="Permalink to this heading">¶</a></h4>
<p>The explanations for both the shallow clone and the full clone both retrieve the
code from the Linux stable git repository. That makes things simpler for this
document's audience, as it allows easy access to both mainline and
stable/longterm releases. This approach has just one downside:</p>
<p>Changes merged into the mainline repository are only synced to the master branch
of the Linux stable repository  every few hours. This lag most of the time is
not something to worry about; but in case you really need the latest code, just
add the mainline repo as additional remote and checkout the code from there:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git remote add mainline \
  https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
git fetch mainline
git checkout --detach mainline/master
</pre></div>
</div>
<p>When doing this with a shallow clone, remember to call <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code> with one
of the parameters described earlier to limit the depth.</p>
<p>[<a class="reference internal" href="#sources-sbs"><span class="std std-ref">back to step-by-step guide</span></a>] [<a class="reference internal" href="#sources"><span class="std std-ref">back to section intro</span></a>]</p>
</section>
</section>
<section id="patch-the-sources-optional">
<span id="patching"></span><h3>Patch the sources (optional)<a class="headerlink" href="#patch-the-sources-optional" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>In case you want to apply a kernel patch, do so now.</em>
[<a class="reference internal" href="#patching-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>This is the point where you might want to patch your kernel -- for example when
a developer proposed a fix and asked you to check if it helps. The step-by-step
guide already explains everything crucial here.</p>
<p>[<a class="reference internal" href="#patching-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="tagging-this-kernel-build-optional-often-wise">
<span id="tagging"></span><h3>Tagging this kernel build (optional, often wise)<a class="headerlink" href="#tagging-this-kernel-build-optional-often-wise" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>If you patched your kernel or already have that kernel version installed,
better tag your kernel by extending its release name:</em>
[<a class="reference internal" href="#tagging-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>Tagging your kernel will help avoid confusion later, especially when you patched
your kernel. Adding an individual tag will also ensure the kernel's image and
its modules are installed in parallel to any existing kernels.</p>
<p>There are various ways to add such a tag. The step-by-step guide realizes one by
creating a 'localversion' file in your build directory from which the kernel
build scripts will automatically pick up the tag. You can later change that file
to use a different tag in subsequent builds or simply remove that file to dump
the tag.</p>
<p>[<a class="reference internal" href="#tagging-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="define-the-build-configuration-for-your-kernel">
<span id="configuration"></span><h3>Define the build configuration for your kernel<a class="headerlink" href="#define-the-build-configuration-for-your-kernel" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>Create the build configuration for your kernel based on an existing
configuration.</em> [<a class="reference internal" href="#configuration-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>There are various aspects for this steps that require a more careful
explanation:</p>
<section id="pitfalls-when-using-another-configuration-file-as-base">
<h4>Pitfalls when using another configuration file as base<a class="headerlink" href="#pitfalls-when-using-another-configuration-file-as-base" title="Permalink to this heading">¶</a></h4>
<p>Make targets like localmodconfig and olddefconfig share a few common snares you
want to be aware of:</p>
<blockquote>
<div><ul class="simple">
<li><p>These targets will reuse a kernel build configuration in your build directory
(e.g. '~/linux/.config'), if one exists. In case you want to start from
scratch you thus need to delete it.</p></li>
<li><p>The make targets try to find the configuration for your running kernel
automatically, but might choose poorly. A line like '# using defaults found
in /boot/config-6.0.7-250.fc36.x86_64' or 'using config:
'/boot/config-6.0.7-250.fc36.x86_64' tells you which file they picked. If
that is not the intended one, simply store it as '~/linux/.config'
before using these make targets.</p></li>
<li><p>Unexpected things might happen if you try to use a config file prepared for
one kernel (say v6.0) on an older generation (say v5.15). In that case you
might want to use a configuration as base which your distribution utilized
when they used that or an slightly older kernel version.</p></li>
</ul>
</div></blockquote>
</section>
<section id="influencing-the-configuration">
<h4>Influencing the configuration<a class="headerlink" href="#influencing-the-configuration" title="Permalink to this heading">¶</a></h4>
<p>The make target olddefconfig and the <code class="docutils literal notranslate"><span class="pre">yes</span> <span class="pre">&quot;&quot;</span> <span class="pre">|</span></code> used when utilizing
localmodconfig will set any undefined build options to their default value. This
among others will disable many kernel features that were introduced after your
base kernel was released.</p>
<p>If you want to set these configurations options manually, use <code class="docutils literal notranslate"><span class="pre">oldconfig</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">olddefconfig</span></code> or omit the <code class="docutils literal notranslate"><span class="pre">yes</span> <span class="pre">&quot;&quot;</span> <span class="pre">|</span></code> when utilizing
localmodconfig. Then for each undefined configuration option you will be asked
how to proceed. In case you are unsure what to answer, simply hit 'enter' to
apply the default value.</p>
</section>
<section id="big-pitfall-when-using-localmodconfig">
<h4>Big pitfall when using localmodconfig<a class="headerlink" href="#big-pitfall-when-using-localmodconfig" title="Permalink to this heading">¶</a></h4>
<p>As explained briefly in the step-by-step guide already: with localmodconfig it
can easily happen that your self-built kernel will lack modules for tasks you
did not perform before utilizing this make target. That's because those tasks
require kernel modules that are normally autoloaded when you perform that task
for the first time; if you didn't perform that task at least once before using
localmodonfig, the latter will thus assume these modules are superfluous and
disable them.</p>
<p>You can try to avoid this by performing typical tasks that often will autoload
additional kernel modules: start a VM, establish VPN connections, loop-mount a
CD/DVD ISO, mount network shares (CIFS, NFS, ...), and connect all external
devices (2FA keys, headsets, webcams, ...) as well as storage devices with file
systems you otherwise do not utilize (btrfs, ext4, FAT, NTFS, XFS, ...). But it
is hard to think of everything that might be needed -- even kernel developers
often forget one thing or another at this point.</p>
<p>Do not let that risk bother you, especially when compiling a kernel only for
testing purposes: everything typically crucial will be there. And if you forget
something important you can turn on a missing feature later and quickly run the
commands to compile and install a better kernel.</p>
<p>But if you plan to build and use self-built kernels regularly, you might want to
reduce the risk by recording which modules your system loads over the course of
a few weeks. You can automate this with <a class="reference external" href="https://github.com/graysky2/modprobed-db">modprobed-db</a>. Afterwards use <code class="docutils literal notranslate"><span class="pre">LSMOD=&lt;path&gt;</span></code> to
point localmodconfig to the list of modules modprobed-db noticed being used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>yes &quot;&quot; | make LSMOD=&quot;${HOME}&quot;/.config/modprobed.db localmodconfig
</pre></div>
</div>
</section>
<section id="remote-building-with-localmodconfig">
<h4>Remote building with localmodconfig<a class="headerlink" href="#remote-building-with-localmodconfig" title="Permalink to this heading">¶</a></h4>
<p>If you want to use localmodconfig to build a kernel for another machine, run
<code class="docutils literal notranslate"><span class="pre">lsmod</span> <span class="pre">&gt;</span> <span class="pre">lsmod_foo-machine</span></code> on it and transfer that file to your build host.
Now point the build scripts to the file like this: <code class="docutils literal notranslate"><span class="pre">yes</span> <span class="pre">&quot;&quot;</span> <span class="pre">|</span> <span class="pre">make</span>
<span class="pre">LSMOD=~/lsmod_foo-machine</span> <span class="pre">localmodconfig</span></code>. Note, in this case
you likely want to copy a base kernel configuration from the other machine over
as well and place it as .config in your build directory.</p>
<p>[<a class="reference internal" href="#configuration-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
</section>
<section id="adjust-build-configuration">
<span id="configmods"></span><h3>Adjust build configuration<a class="headerlink" href="#adjust-build-configuration" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>Check if you might want to or have to adjust some kernel configuration
options:</em></p>
</div></blockquote>
<p>Depending on your needs you at this point might want or have to adjust some
kernel configuration options.</p>
<section id="debug-symbols">
<span id="configmods-debugsymbols"></span><h4>Debug symbols<a class="headerlink" href="#debug-symbols" title="Permalink to this heading">¶</a></h4>
<blockquote>
<div><p><em>Evaluate how you want to handle debug symbols.</em>
[<a class="reference internal" href="#configmods-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>Most users do not need to care about this, it's often fine to leave everything
as it is; but you should take a closer look at this, if you might need to decode
a stack trace or want to reduce space consumption.</p>
<p>Having debug symbols available can be important when your kernel throws a
'panic', 'Oops', 'warning', or 'BUG' later when running, as then you will be
able to find the exact place where the problem occurred in the code. But
collecting and embedding the needed debug information takes time and consumes
quite a bit of space: in late 2022 the build artifacts for a typical x86 kernel
configured with localmodconfig consumed around 5 Gigabyte of space with debug
symbols, but less than 1 when they were disabled. The resulting kernel image and
the modules are bigger as well, which increases load times.</p>
<p>Hence, if you want a small kernel and are unlikely to decode a stack trace
later, you might want to disable debug symbols to avoid above downsides:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./scripts/config --file .config -d DEBUG_INFO \
  -d DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT -d DEBUG_INFO_DWARF4 \
  -d DEBUG_INFO_DWARF5 -e CONFIG_DEBUG_INFO_NONE
make olddefconfig
</pre></div>
</div>
<p>You on the other hand definitely want to enable them, if there is a decent
chance that you need to decode a stack trace later (as explained by 'Decode
failure messages' in <a class="reference internal" href="tainted-kernels.html"><span class="doc">Tainted kernels</span></a> in more
detail):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./scripts/config --file .config -d DEBUG_INFO_NONE -e DEBUG_KERNEL
  -e DEBUG_INFO -e DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT -e KALLSYMS -e KALLSYMS_ALL
make olddefconfig
</pre></div>
</div>
<p>Note, many mainstream distributions enable debug symbols in their kernel
configurations -- make targets like localmodconfig and olddefconfig thus will
often pick that setting up.</p>
<p>[<a class="reference internal" href="#configmods-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="distro-specific-adjustments">
<span id="configmods-distros"></span><h4>Distro specific adjustments<a class="headerlink" href="#distro-specific-adjustments" title="Permalink to this heading">¶</a></h4>
<blockquote>
<div><p><em>Are you running</em> [<a class="reference internal" href="#configmods-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>The following sections help you to avoid build problems that are known to occur
when following this guide on a few commodity distributions.</p>
<p><strong>Debian:</strong></p>
<blockquote>
<div><ul>
<li><p>Remove a stale reference to a certificate file that would cause your build to
fail:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./scripts/config --file .config --set-str SYSTEM_TRUSTED_KEYS &#39;&#39;
</pre></div>
</div>
<p>Alternatively, download the needed certificate and make that configuration
option point to it, as <a class="reference external" href="https://debian-handbook.info/browse/stable/sect.kernel-compilation.html">the Debian handbook explains in more detail</a>
-- or generate your own, as explained in
<a class="reference internal" href="module-signing.html"><span class="doc">Kernel module signing facility</span></a>.</p>
</li>
</ul>
</div></blockquote>
<p>[<a class="reference internal" href="#configmods-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="individual-adjustments">
<span id="configmods-individual"></span><h4>Individual adjustments<a class="headerlink" href="#individual-adjustments" title="Permalink to this heading">¶</a></h4>
<blockquote>
<div><p><em>If you want to influence the other aspects of the configuration, do so
now</em> [<a class="reference internal" href="#configmods-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>You at this point can use a command like <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code> to enable or
disable certain features using a text-based user interface; to use a graphical
configuration utilize, use the make target <code class="docutils literal notranslate"><span class="pre">xconfig</span></code> or <code class="docutils literal notranslate"><span class="pre">gconfig</span></code> instead.
All of them require development libraries from toolkits they are based on
(ncurses, Qt5, Gtk2); an error message will tell you if something required is
missing.</p>
<p>[<a class="reference internal" href="#configmods-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
</section>
<section id="build-your-kernel">
<span id="build"></span><h3>Build your kernel<a class="headerlink" href="#build-your-kernel" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>Build the image and the modules of your kernel</em> [<a class="reference internal" href="#build-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>A lot can go wrong at this stage, but the instructions below will help you help
yourself. Another subsection explains how to directly package your kernel up as
deb, rpm or tar file.</p>
<section id="dealing-with-build-errors">
<h4>Dealing with build errors<a class="headerlink" href="#dealing-with-build-errors" title="Permalink to this heading">¶</a></h4>
<p>When a build error occurs, it might be caused by some aspect of your machine's
setup that often can be fixed quickly; other times though the problem lies in
the code and can only be fixed by a developer. A close examination of the
failure messages coupled with some research on the internet will often tell you
which of the two it is. To perform such a investigation, restart the build
process like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make V=1
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">V=1</span></code> activates verbose output, which might be needed to see the actual
error. To make it easier to spot, this command also omits the <code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">$(nproc</span>
<span class="pre">--all)</span></code> used earlier to utilize every CPU core in the system for the job -- but
this parallelism also results in some clutter when failures occur.</p>
<p>After a few seconds the build process should run into the error again. Now try
to find the most crucial line describing the problem. Then search the internet
for the most important and non-generic section of that line (say 4 to 8 words);
avoid or remove anything that looks remotely system-specific, like your username
or local path names like <code class="docutils literal notranslate"><span class="pre">/home/username/linux/</span></code>. First try your regular
internet search engine with that string, afterwards search Linux kernel mailing
lists via <a class="reference external" href="https://lore.kernel.org/all/">lore.kernel.org/all/</a>.</p>
<p>This most of the time will find something that will explain what is wrong; quite
often one of the hits will provide a solution for your problem, too. If you
do not find anything that matches your problem, try again from a different angle
by modifying your search terms or using another line from the error messages.</p>
<p>In the end, most trouble you are to run into has likely been encountered and
reported by others already. That includes issues where the cause is not your
system, but lies the code. If you run into one of those, you might thus find a
solution (e.g. a patch) or workaround for your problem, too.</p>
</section>
<section id="package-your-kernel-up">
<h4>Package your kernel up<a class="headerlink" href="#package-your-kernel-up" title="Permalink to this heading">¶</a></h4>
<p>The step-by-step guide uses the default make targets (e.g. 'bzImage' and
'modules' on x86) to build the image and the modules of your kernel, which later
steps of the guide then install. You instead can also directly build everything
and directly package it up by using one of the following targets:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j</span> <span class="pre">$(nproc</span> <span class="pre">--all)</span> <span class="pre">bindeb-pkg</span></code> to generate a deb package</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j</span> <span class="pre">$(nproc</span> <span class="pre">--all)</span> <span class="pre">binrpm-pkg</span></code> to generate a rpm package</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j</span> <span class="pre">$(nproc</span> <span class="pre">--all)</span> <span class="pre">tarbz2-pkg</span></code> to generate a bz2 compressed tarball</p></li>
</ul>
</div></blockquote>
<p>This is just a selection of available make targets for this purpose, see
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">help</span></code> for others. You can also use these targets after running
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j</span> <span class="pre">$(nproc</span> <span class="pre">--all)</span></code>, as they will pick up everything already built.</p>
<p>If you employ the targets to generate deb or rpm packages, ignore the
step-by-step guide's instructions on installing and removing your kernel;
instead install and remove the packages using the package utility for the format
(e.g. dpkg and rpm) or a package management utility build on top of them (apt,
aptitude, dnf/yum, zypper, ...). Be aware that the packages generated using
these two make targets are designed to work on various distributions utilizing
those formats, they thus will sometimes behave differently than your
distribution's kernel packages.</p>
<p>[<a class="reference internal" href="#build-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
</section>
<section id="install-your-kernel">
<span id="install"></span><h3>Install your kernel<a class="headerlink" href="#install-your-kernel" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>Now install your kernel</em> [<a class="reference internal" href="#install-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>What you need to do after executing the command in the step-by-step guide
depends on the existence and the implementation of an <code class="docutils literal notranslate"><span class="pre">installkernel</span></code>
executable. Many commodity Linux distributions ship such a kernel installer in
<code class="docutils literal notranslate"><span class="pre">/sbin/</span></code> that does everything needed, hence there is nothing left for you
except rebooting. But some distributions contain an installkernel that does
only part of the job -- and a few lack it completely and leave all the work to
you.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">installkernel</span></code> is found, the kernel's build system will delegate the
actual installation of your kernel's image and related files to this executable.
On almost all Linux distributions it will store the image as '/boot/vmlinuz-
&lt;your kernel's release name&gt;' and put a 'System.map-&lt;your kernel's release
name&gt;' alongside it. Your kernel will thus be installed in parallel to any
existing ones, unless you already have one with exactly the same release name.</p>
<p>Installkernel on many distributions will afterwards generate an 'initramfs'
(often also called 'initrd'), which commodity distributions rely on for booting;
hence be sure to keep the order of the two make targets used in the step-by-step
guide, as things will go sideways if you install your kernel's image before its
modules. Often installkernel will then add your kernel to the bootloader
configuration, too. You have to take care of one or both of these tasks
yourself, if your distributions installkernel doesn't handle them.</p>
<p>A few distributions like Arch Linux and its derivatives totally lack an
installkernel executable. On those just install the modules using the kernel's
build system and then install the image and the System.map file manually:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo make modules_install
sudo install -m 0600 $(make -s image_name) /boot/vmlinuz-$(make -s kernelrelease)
sudo install -m 0600 System.map /boot/System.map-$(make -s kernelrelease)
</pre></div>
</div>
<p>If your distribution boots with the help of an initramfs, now generate one for
your kernel using the tools your distribution provides for this process.
Afterwards add your kernel to your bootloader configuration and reboot.</p>
<p>[<a class="reference internal" href="#install-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="another-round-later">
<span id="another"></span><h3>Another round later<a class="headerlink" href="#another-round-later" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>To later build another kernel you need similar, but sometimes slightly
different commands</em> [<a class="reference internal" href="#another-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>The process to build later kernels is similar, but at some points slightly
different. You for example do not want to use 'localmodconfig' for succeeding
kernel builds, as you already created a trimmed down configuration you want to
use from now on. Hence instead just use <code class="docutils literal notranslate"><span class="pre">oldconfig</span></code> or <code class="docutils literal notranslate"><span class="pre">olddefconfig</span></code> to
adjust your build configurations to the needs of the kernel version you are
about to build.</p>
<p>If you created a shallow-clone with git, remember what the <a class="reference internal" href="#sources"><span class="std std-ref">section that
explained the setup described in more detail</span></a>: you need to use a
slightly different <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code> command and when switching to another series
need to add an additional remote branch.</p>
<p>[<a class="reference internal" href="#another-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
<section id="uninstall-the-kernel-later">
<span id="uninstall"></span><h3>Uninstall the kernel later<a class="headerlink" href="#uninstall-the-kernel-later" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><em>All parts of your installed kernel are identifiable by its release name and
thus easy to remove later.</em> [<a class="reference internal" href="#uninstall-sbs"><span class="std std-ref">...</span></a>]</p>
</div></blockquote>
<p>Do not worry installing your kernel manually and thus bypassing your
distribution's packaging system will totally mess up your machine: all parts of
your kernel are easy to remove later, as files are stored in two places only and
normally identifiable by the kernel's release name.</p>
<p>One of the two places is a directory in /lib/modules/, which holds the modules
for each installed kernel. This directory is named after the kernel's release
name; hence, to remove all modules for one of your kernels, simply remove its
modules directory in /lib/modules/.</p>
<p>The other place is /boot/, where typically one to five files will be placed
during installation of a kernel. All of them usually contain the release name in
their file name, but how many files and their name depends somewhat on your
distribution's installkernel executable (<a class="reference internal" href="#install"><span class="std std-ref">see above</span></a>) and its
initramfs generator. On some distributions the <code class="docutils literal notranslate"><span class="pre">kernel-install</span></code> command
mentioned in the step-by-step guide will remove all of these files for you --
and the entry for your kernel in the bootloader configuration at the same time,
too. On others you have to take care of these steps yourself. The following
command should interactively remove the two main files of a kernel with the
release name '6.0.1-foobar':</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>rm -i /boot/{System.map,vmlinuz}-6.0.1-foobar
</pre></div>
</div>
<p>Now remove the belonging initramfs, which often will be called something like
<code class="docutils literal notranslate"><span class="pre">/boot/initramfs-6.0.1-foobar.img</span></code> or <code class="docutils literal notranslate"><span class="pre">/boot/initrd.img-6.0.1-foobar</span></code>.
Afterwards check for other files in /boot/ that have '6.0.1-foobar' in their
name and delete them as well. Now remove the kernel from your bootloader's
configuration.</p>
<p>Note, be very careful with wildcards like '*' when deleting files or directories
for kernels manually: you might accidentally remove files of a 6.0.11 kernel
when all you want is to remove 6.0 or 6.0.1.</p>
<p>[<a class="reference internal" href="#uninstall-sbs"><span class="std std-ref">back to step-by-step guide</span></a>]</p>
</section>
</section>
<section id="faq">
<span id="id1"></span><h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this heading">¶</a></h2>
<section id="why-does-this-how-to-not-work-on-my-system">
<h3>Why does this 'how-to' not work on my system?<a class="headerlink" href="#why-does-this-how-to-not-work-on-my-system" title="Permalink to this heading">¶</a></h3>
<p>As initially stated, this guide is 'designed to cover everything typically
needed [to build a kernel] on mainstream Linux distributions running on
commodity PC or server hardware'. The outlined approach despite this should work
on many other setups as well. But trying to cover every possible use-case in one
guide would defeat its purpose, as without such a focus you would need dozens or
hundreds of constructs along the lines of 'in case you are having &lt;insert
machine or distro&gt;, you at this point have to do &lt;this and that&gt;
&lt;instead|additionally&gt;'. Each of which would make the text longer, more
complicated, and harder to follow.</p>
<p>That being said: this of course is a balancing act. Hence, if you think an
additional use-case is worth describing, suggest it to the maintainers of this
document, as <a class="reference internal" href="#submit-improvements"><span class="std std-ref">described above</span></a>.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/admin-guide/quickly-build-trimmed-linux.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>