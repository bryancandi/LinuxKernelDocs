
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Discovering Linux kernel subsystems used by a workload &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ACPI Support" href="acpi/index.html" />
    <link rel="prev" title="Rules on how to access information in sysfs" href="sysfs-rules.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.7.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">Kernel subsystem documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The Linux kernel user's and administrator's guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Linux kernel release 6.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-parameters.html">The kernel's command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="abi.html">Linux ABI description</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html">Feature status on all architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-regressions.html">Reporting regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickly-build-trimmed-linux.html">How to quickly build a trimmed Linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="init.html">Explaining the &quot;No working init found.&quot; boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="pstore-blk.html">pstore block oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Discovering Linux kernel subsystems used by a workload</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#key-points">Key Points</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methodology">Methodology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-we-gather-fine-grained-system-information">How do we gather fine-grained system information?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-the-system-ready-for-tracing">Getting the system ready for tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workload-overview">Workload overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-strace-and-how-do-we-use-it">What is strace and how do we use it?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-cscope-and-how-do-we-use-it">What is cscope and how do we use it?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-perf-and-how-do-we-use-it">What is perf and how do we use it?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-stress-ng-and-how-do-we-use-it">What is stress-ng and how do we use it?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-paxtest-and-how-do-we-use-it">What is paxtest and how do we use it?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tracing-workloads">Tracing workloads</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockdev/index.html">Block Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="filesystem-monitoring.html">File system Monitoring with fanotify</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio/index.html">gpio</a></li>
<li class="toctree-l2"><a class="reference internal" href="highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_random.html">Hardware random number generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="jfs.html">IBM's Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="media/index.html">Media subsystem admin and user guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="ras.html">Reliability, Availability and Serviceability</a></li>
<li class="toctree-l2"><a class="reference internal" href="rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="syscall-user-dispatch.html">Syscall User Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermal/index.html">Thermal Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  sbar.scrollTop = currents[currents.length - 1].offsetTop;
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/admin-guide/workload-tracing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="discovering-linux-kernel-subsystems-used-by-a-workload">
<h1>Discovering Linux kernel subsystems used by a workload<a class="headerlink" href="#discovering-linux-kernel-subsystems-used-by-a-workload" title="Permalink to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Authors<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>Shuah Khan &lt;<a class="reference external" href="mailto:skhan&#37;&#52;&#48;linuxfoundation&#46;org">skhan<span>&#64;</span>linuxfoundation<span>&#46;</span>org</a>&gt;</p></li>
<li><p>Shefali Sharma &lt;<a class="reference external" href="mailto:sshefali021&#37;&#52;&#48;gmail&#46;com">sshefali021<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</dd>
<dt class="field-even">maintained-by<span class="colon">:</span></dt>
<dd class="field-even"><p>Shuah Khan &lt;<a class="reference external" href="mailto:skhan&#37;&#52;&#48;linuxfoundation&#46;org">skhan<span>&#64;</span>linuxfoundation<span>&#46;</span>org</a>&gt;</p>
</dd>
</dl>
<section id="key-points">
<h2>Key Points<a class="headerlink" href="#key-points" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Understanding system resources necessary to build and run a workload
is important.</p></li>
<li><p>Linux tracing and strace can be used to discover the system resources
in use by a workload. The completeness of the system usage information
depends on the completeness of coverage of a workload.</p></li>
<li><p>Performance and security of the operating system can be analyzed with
the help of tools such as:
<a class="reference external" href="https://man7.org/linux/man-pages/man1/perf.1.html">perf</a>,
<a class="reference external" href="https://www.mankier.com/1/stress-ng">stress-ng</a>,
<a class="reference external" href="https://github.com/opntr/paxtest-freebsd">paxtest</a>.</p></li>
<li><p>Once we discover and understand the workload needs, we can focus on them
to avoid regressions and use it to evaluate safety considerations.</p></li>
</ul>
</div></blockquote>
</section>
<section id="methodology">
<h2>Methodology<a class="headerlink" href="#methodology" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://man7.org/linux/man-pages/man1/strace.1.html">strace</a> is a
diagnostic, instructional, and debugging tool and can be used to discover
the system resources in use by a workload. Once we discover and understand
the workload needs, we can focus on them to avoid regressions and use it
to evaluate safety considerations. We use strace tool to trace workloads.</p>
<p>This method of tracing using strace tells us the system calls invoked by
the workload and doesn't include all the system calls that can be invoked
by it. In addition, this tracing method tells us just the code paths within
these system calls that are invoked. As an example, if a workload opens a
file and reads from it successfully, then the success path is the one that
is traced. Any error paths in that system call will not be traced. If there
is a workload that provides full coverage of a workload then the method
outlined here will trace and find all possible code paths. The completeness
of the system usage information depends on the completeness of coverage of a
workload.</p>
<p>The goal is tracing a workload on a system running a default kernel without
requiring custom kernel installs.</p>
</section>
<section id="how-do-we-gather-fine-grained-system-information">
<h2>How do we gather fine-grained system information?<a class="headerlink" href="#how-do-we-gather-fine-grained-system-information" title="Permalink to this heading">¶</a></h2>
<p>strace tool can be used to trace system calls made by a process and signals
it receives. System calls are the fundamental interface between an
application and the operating system kernel. They enable a program to
request services from the kernel. For instance, the open() system call in
Linux is used to provide access to a file in the file system. strace enables
us to track all the system calls made by an application. It lists all the
system calls made by a process and their resulting output.</p>
<p>You can generate profiling data combining strace and perf record tools to
record the events and information associated with a process. This provides
insight into the process. &quot;perf annotate&quot; tool generates the statistics of
each instruction of the program. This document goes over the details of how
to gather fine-grained information on a workload's usage of system resources.</p>
<p>We used strace to trace the perf, stress-ng, paxtest workloads to illustrate
our methodology to discover resources used by a workload. This process can
be applied to trace other workloads.</p>
</section>
<section id="getting-the-system-ready-for-tracing">
<h2>Getting the system ready for tracing<a class="headerlink" href="#getting-the-system-ready-for-tracing" title="Permalink to this heading">¶</a></h2>
<p>Before we can get started we will show you how to get your system ready.
We assume that you have a Linux distribution running on a physical system
or a virtual machine. Most distributions will include strace command. Let’s
install other tools that aren’t usually included to build Linux kernel.
Please note that the following works on Debian based distributions. You
might have to find equivalent packages on other Linux distributions.</p>
<p>Install tools to build Linux kernel and tools in kernel repository.
scripts/ver_linux is a good way to check if your system already has
the necessary tools:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt-get build-essentials flex bison yacc
sudo apt install libelf-dev systemtap-sdt-dev libaudit-dev libslang2-dev libperl-dev libdw-dev
</pre></div>
</div>
<p>cscope is a good tool to browse kernel sources. Let's install it now:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt-get install cscope
</pre></div>
</div>
<p>Install stress-ng and paxtest:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>apt-get install stress-ng
apt-get install paxtest
</pre></div>
</div>
</section>
<section id="workload-overview">
<h2>Workload overview<a class="headerlink" href="#workload-overview" title="Permalink to this heading">¶</a></h2>
<p>As mentioned earlier, we used strace to trace perf bench, stress-ng and
paxtest workloads to show how to analyze a workload and identify Linux
subsystems used by these workloads. Let's start with an overview of these
three workloads to get a better understanding of what they do and how to
use them.</p>
<section id="perf-bench-all-workload">
<h3>perf bench (all) workload<a class="headerlink" href="#perf-bench-all-workload" title="Permalink to this heading">¶</a></h3>
<p>The perf bench command contains multiple multi-threaded microkernel
benchmarks for executing different subsystems in the Linux kernel and
system calls. This allows us to easily measure the impact of changes,
which can help mitigate performance regressions. It also acts as a common
benchmarking framework, enabling developers to easily create test cases,
integrate transparently, and use performance-rich tooling subsystems.</p>
</section>
<section id="stress-ng-netdev-stressor-workload">
<h3>Stress-ng netdev stressor workload<a class="headerlink" href="#stress-ng-netdev-stressor-workload" title="Permalink to this heading">¶</a></h3>
<p>stress-ng is used for performing stress testing on the kernel. It allows
you to exercise various physical subsystems of the computer, as well as
interfaces of the OS kernel, using &quot;stressor-s&quot;. They are available for
CPU, CPU cache, devices, I/O, interrupts, file system, memory, network,
operating system, pipelines, schedulers, and virtual machines. Please refer
to the <a class="reference external" href="https://www.mankier.com/1/stress-ng">stress-ng man-page</a> to
find the description of all the available stressor-s. The netdev stressor
starts specified number (N) of workers that exercise various netdevice
ioctl commands across all the available network devices.</p>
</section>
<section id="paxtest-kiddie-workload">
<h3>paxtest kiddie workload<a class="headerlink" href="#paxtest-kiddie-workload" title="Permalink to this heading">¶</a></h3>
<p>paxtest is a program that tests buffer overflows in the kernel. It tests
kernel enforcements over memory usage. Generally, execution in some memory
segments makes buffer overflows possible. It runs a set of programs that
attempt to subvert memory usage. It is used as a regression test suite for
PaX, but might be useful to test other memory protection patches for the
kernel. We used paxtest kiddie mode which looks for simple vulnerabilities.</p>
</section>
</section>
<section id="what-is-strace-and-how-do-we-use-it">
<h2>What is strace and how do we use it?<a class="headerlink" href="#what-is-strace-and-how-do-we-use-it" title="Permalink to this heading">¶</a></h2>
<p>As mentioned earlier, strace which is a useful diagnostic, instructional,
and debugging tool and can be used to discover the system resources in use
by a workload. It can be used:</p>
<blockquote>
<div><ul class="simple">
<li><p>To see how a process interacts with the kernel.</p></li>
<li><p>To see why a process is failing or hanging.</p></li>
<li><p>For reverse engineering a process.</p></li>
<li><p>To find the files on which a program depends.</p></li>
<li><p>For analyzing the performance of an application.</p></li>
<li><p>For troubleshooting various problems related to the operating system.</p></li>
</ul>
</div></blockquote>
<p>In addition, strace can generate run-time statistics on times, calls, and
errors for each system call and report a summary when program exits,
suppressing the regular output. This attempts to show system time (CPU time
spent running in the kernel) independent of wall clock time. We plan to use
these features to get information on workload system usage.</p>
<p>strace command supports basic, verbose, and stats modes. strace command when
run in verbose mode gives more detailed information about the system calls
invoked by a process.</p>
<p>Running strace -c generates a report of the percentage of time spent in each
system call, the total time in seconds, the microseconds per call, the total
number of calls, the count of each system call that has failed with an error
and the type of system call made.</p>
<blockquote>
<div><ul class="simple">
<li><p>Usage: strace &lt;command we want to trace&gt;</p></li>
<li><p>Verbose mode usage: strace -v &lt;command&gt;</p></li>
<li><p>Gather statistics: strace -c &lt;command&gt;</p></li>
</ul>
</div></blockquote>
<p>We used the “-c” option to gather fine-grained run-time statistics in use
by three workloads we have chose for this analysis.</p>
<blockquote>
<div><ul class="simple">
<li><p>perf</p></li>
<li><p>stress-ng</p></li>
<li><p>paxtest</p></li>
</ul>
</div></blockquote>
</section>
<section id="what-is-cscope-and-how-do-we-use-it">
<h2>What is cscope and how do we use it?<a class="headerlink" href="#what-is-cscope-and-how-do-we-use-it" title="Permalink to this heading">¶</a></h2>
<p>Now let’s look at <a class="reference external" href="https://cscope.sourceforge.net/">cscope</a>, a command
line tool for browsing C, C++ or Java code-bases. We can use it to find
all the references to a symbol, global definitions, functions called by a
function, functions calling a function, text strings, regular expression
patterns, files including a file.</p>
<p>We can use cscope to find which system call belongs to which subsystem.
This way we can find the kernel subsystems used by a process when it is
executed.</p>
<p>Let’s checkout the latest Linux repository and build cscope database:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git linux
cd linux
cscope -R -p10  # builds cscope.out database before starting browse session
cscope -d -p10  # starts browse session on cscope.out database
</pre></div>
</div>
<p>Note: Run &quot;cscope -R -p10&quot; to build the database and c&quot;scope -d -p10&quot; to
enter into the browsing session. cscope by default cscope.out database.
To get out of this mode press ctrl+d. -p option is used to specify the
number of file path components to display. -p10 is optimal for browsing
kernel sources.</p>
</section>
<section id="what-is-perf-and-how-do-we-use-it">
<h2>What is perf and how do we use it?<a class="headerlink" href="#what-is-perf-and-how-do-we-use-it" title="Permalink to this heading">¶</a></h2>
<p>Perf is an analysis tool based on Linux 2.6+ systems, which abstracts the
CPU hardware difference in performance measurement in Linux, and provides
a simple command line interface. Perf is based on the perf_events interface
exported by the kernel. It is very useful for profiling the system and
finding performance bottlenecks in an application.</p>
<p>If you haven't already checked out the Linux mainline repository, you can do
so and then build kernel and perf tool:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git linux
cd linux
make -j3 all
cd tools/perf
make
</pre></div>
</div>
<p>Note: The perf command can be built without building the kernel in the
repository and can be run on older kernels. However matching the kernel
and perf revisions gives more accurate information on the subsystem usage.</p>
<p>We used &quot;perf stat&quot; and &quot;perf bench&quot; options. For a detailed information on
the perf tool, run &quot;perf -h&quot;.</p>
<section id="perf-stat">
<h3>perf stat<a class="headerlink" href="#perf-stat" title="Permalink to this heading">¶</a></h3>
<p>The perf stat command generates a report of various hardware and software
events. It does so with the help of hardware counter registers found in
modern CPUs that keep the count of these activities. &quot;perf stat cal&quot; shows
stats for cal command.</p>
</section>
<section id="perf-bench">
<h3>Perf bench<a class="headerlink" href="#perf-bench" title="Permalink to this heading">¶</a></h3>
<p>The perf bench command contains multiple multi-threaded microkernel
benchmarks for executing different subsystems in the Linux kernel and
system calls. This allows us to easily measure the impact of changes,
which can help mitigate performance regressions. It also acts as a common
benchmarking framework, enabling developers to easily create test cases,
integrate transparently, and use performance-rich tooling.</p>
<p>&quot;perf bench all&quot; command runs the following benchmarks:</p>
<blockquote>
<div><ul class="simple">
<li><p>sched/messaging</p></li>
<li><p>sched/pipe</p></li>
<li><p>syscall/basic</p></li>
<li><p>mem/memcpy</p></li>
<li><p>mem/memset</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="what-is-stress-ng-and-how-do-we-use-it">
<h2>What is stress-ng and how do we use it?<a class="headerlink" href="#what-is-stress-ng-and-how-do-we-use-it" title="Permalink to this heading">¶</a></h2>
<p>As mentioned earlier, stress-ng is used for performing stress testing on
the kernel. It allows you to exercise various physical subsystems of the
computer, as well as interfaces of the OS kernel, using stressor-s. They
are available for CPU, CPU cache, devices, I/O, interrupts, file system,
memory, network, operating system, pipelines, schedulers, and virtual
machines.</p>
<p>The netdev stressor starts N workers that exercise various netdevice ioctl
commands across all the available network devices. The following ioctls are
exercised:</p>
<blockquote>
<div><ul class="simple">
<li><p>SIOCGIFCONF, SIOCGIFINDEX, SIOCGIFNAME, SIOCGIFFLAGS</p></li>
<li><p>SIOCGIFADDR, SIOCGIFNETMASK, SIOCGIFMETRIC, SIOCGIFMTU</p></li>
<li><p>SIOCGIFHWADDR, SIOCGIFMAP, SIOCGIFTXQLEN</p></li>
</ul>
</div></blockquote>
<p>The following command runs the stressor:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>stress-ng --netdev 1 -t 60 --metrics command.
</pre></div>
</div>
<p>We can use the perf record command to record the events and information
associated with a process. This command records the profiling data in the
perf.data file in the same directory.</p>
<p>Using the following commands you can record the events associated with the
netdev stressor, view the generated report perf.data and annotate the to
view the statistics of each instruction of the program:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf record stress-ng --netdev 1 -t 60 --metrics command.
perf report
perf annotate
</pre></div>
</div>
</section>
<section id="what-is-paxtest-and-how-do-we-use-it">
<h2>What is paxtest and how do we use it?<a class="headerlink" href="#what-is-paxtest-and-how-do-we-use-it" title="Permalink to this heading">¶</a></h2>
<p>paxtest is a program that tests buffer overflows in the kernel. It tests
kernel enforcements over memory usage. Generally, execution in some memory
segments makes buffer overflows possible. It runs a set of programs that
attempt to subvert memory usage. It is used as a regression test suite for
PaX, and will be useful to test other memory protection patches for the
kernel.</p>
<p>paxtest provides kiddie and blackhat modes. The paxtest kiddie mode runs
in normal mode, whereas the blackhat mode tries to get around the protection
of the kernel testing for vulnerabilities. We focus on the kiddie mode here
and combine &quot;paxtest kiddie&quot; run with &quot;perf record&quot; to collect CPU stack
traces for the paxtest kiddie run to see which function is calling other
functions in the performance profile. Then the &quot;dwarf&quot; (DWARF's Call Frame
Information) mode can be used to unwind the stack.</p>
<p>The following command can be used to view resulting report in call-graph
format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf record --call-graph dwarf paxtest kiddie
perf report --stdio
</pre></div>
</div>
</section>
<section id="tracing-workloads">
<h2>Tracing workloads<a class="headerlink" href="#tracing-workloads" title="Permalink to this heading">¶</a></h2>
<p>Now that we understand the workloads, let's start tracing them.</p>
<section id="tracing-perf-bench-all-workload">
<h3>Tracing perf bench all workload<a class="headerlink" href="#tracing-perf-bench-all-workload" title="Permalink to this heading">¶</a></h3>
<p>Run the following command to trace perf bench all workload:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>strace -c perf bench all
</pre></div>
</div>
<p><strong>System Calls made by the workload</strong></p>
<p>The below table shows the system calls invoked by the workload, number of
times each system call is invoked, and the corresponding Linux subsystem.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>System Call</p></th>
<th class="head"><p># calls</p></th>
<th class="head"><p>Linux Subsystem</p></th>
<th class="head"><p>System Call (API)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>getppid</p></td>
<td><p>10000001</p></td>
<td><p>Process Mgmt</p></td>
<td><p>sys_getpid()</p></td>
</tr>
<tr class="row-odd"><td><p>clone</p></td>
<td><p>1077</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_clone()</p></td>
</tr>
<tr class="row-even"><td><p>prctl</p></td>
<td><p>23</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_prctl()</p></td>
</tr>
<tr class="row-odd"><td><p>prlimit64</p></td>
<td><p>7</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_prlimit64()</p></td>
</tr>
<tr class="row-even"><td><p>getpid</p></td>
<td><p>10</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getpid()</p></td>
</tr>
<tr class="row-odd"><td><p>uname</p></td>
<td><p>3</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_uname()</p></td>
</tr>
<tr class="row-even"><td><p>sysinfo</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_sysinfo()</p></td>
</tr>
<tr class="row-odd"><td><p>getuid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getuid()</p></td>
</tr>
<tr class="row-even"><td><p>getgid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getgid()</p></td>
</tr>
<tr class="row-odd"><td><p>geteuid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_geteuid()</p></td>
</tr>
<tr class="row-even"><td><p>getegid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getegid</p></td>
</tr>
<tr class="row-odd"><td><p>close</p></td>
<td><p>49951</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_close()</p></td>
</tr>
<tr class="row-even"><td><p>pipe</p></td>
<td><p>604</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_pipe()</p></td>
</tr>
<tr class="row-odd"><td><p>openat</p></td>
<td><p>48560</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_opennat()</p></td>
</tr>
<tr class="row-even"><td><p>fstat</p></td>
<td><p>8338</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_fstat()</p></td>
</tr>
<tr class="row-odd"><td><p>stat</p></td>
<td><p>1573</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_stat()</p></td>
</tr>
<tr class="row-even"><td><p>pread64</p></td>
<td><p>9646</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_pread64()</p></td>
</tr>
<tr class="row-odd"><td><p>getdents64</p></td>
<td><p>1873</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_getdents64()</p></td>
</tr>
<tr class="row-even"><td><p>access</p></td>
<td><p>3</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_access()</p></td>
</tr>
<tr class="row-odd"><td><p>lstat</p></td>
<td><p>1880</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_lstat()</p></td>
</tr>
<tr class="row-even"><td><p>lseek</p></td>
<td><p>6</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_lseek()</p></td>
</tr>
<tr class="row-odd"><td><p>ioctl</p></td>
<td><p>3</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_ioctl()</p></td>
</tr>
<tr class="row-even"><td><p>dup2</p></td>
<td><p>1</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_dup2()</p></td>
</tr>
<tr class="row-odd"><td><p>execve</p></td>
<td><p>2</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_execve()</p></td>
</tr>
<tr class="row-even"><td><p>fcntl</p></td>
<td><p>8779</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_fcntl()</p></td>
</tr>
<tr class="row-odd"><td><p>statfs</p></td>
<td><p>1</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_statfs()</p></td>
</tr>
<tr class="row-even"><td><p>epoll_create</p></td>
<td><p>2</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_epoll_create()</p></td>
</tr>
<tr class="row-odd"><td><p>epoll_ctl</p></td>
<td><p>64</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_epoll_ctl()</p></td>
</tr>
<tr class="row-even"><td><p>newfstatat</p></td>
<td><p>8318</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_newfstatat()</p></td>
</tr>
<tr class="row-odd"><td><p>eventfd2</p></td>
<td><p>192</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_eventfd2()</p></td>
</tr>
<tr class="row-even"><td><p>mmap</p></td>
<td><p>243</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_mmap()</p></td>
</tr>
<tr class="row-odd"><td><p>mprotect</p></td>
<td><p>32</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_mprotect()</p></td>
</tr>
<tr class="row-even"><td><p>brk</p></td>
<td><p>21</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_brk()</p></td>
</tr>
<tr class="row-odd"><td><p>munmap</p></td>
<td><p>128</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_munmap()</p></td>
</tr>
<tr class="row-even"><td><p>set_mempolicy</p></td>
<td><p>156</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_set_mempolicy()</p></td>
</tr>
<tr class="row-odd"><td><p>set_tid_address</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_set_tid_address()</p></td>
</tr>
<tr class="row-even"><td><p>set_robust_list</p></td>
<td><p>1</p></td>
<td><p>Futex</p></td>
<td><p>sys_set_robust_list()</p></td>
</tr>
<tr class="row-odd"><td><p>futex</p></td>
<td><p>341</p></td>
<td><p>Futex</p></td>
<td><p>sys_futex()</p></td>
</tr>
<tr class="row-even"><td><p>sched_getaffinity</p></td>
<td><p>79</p></td>
<td><p>Scheduler</p></td>
<td><p>sys_sched_getaffinity()</p></td>
</tr>
<tr class="row-odd"><td><p>sched_setaffinity</p></td>
<td><p>223</p></td>
<td><p>Scheduler</p></td>
<td><p>sys_sched_setaffinity()</p></td>
</tr>
<tr class="row-even"><td><p>socketpair</p></td>
<td><p>202</p></td>
<td><p>Network</p></td>
<td><p>sys_socketpair()</p></td>
</tr>
<tr class="row-odd"><td><p>rt_sigprocmask</p></td>
<td><p>21</p></td>
<td><p>Signal</p></td>
<td><p><a class="reference internal" href="../driver-api/basics.html#c.sys_rt_sigprocmask" title="sys_rt_sigprocmask"><code class="xref c c-func docutils literal notranslate"><span class="pre">sys_rt_sigprocmask()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>rt_sigaction</p></td>
<td><p>36</p></td>
<td><p>Signal</p></td>
<td><p><a class="reference internal" href="../driver-api/basics.html#c.sys_rt_sigaction" title="sys_rt_sigaction"><code class="xref c c-func docutils literal notranslate"><span class="pre">sys_rt_sigaction()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>rt_sigreturn</p></td>
<td><p>2</p></td>
<td><p>Signal</p></td>
<td><p>sys_rt_sigreturn()</p></td>
</tr>
<tr class="row-even"><td><p>wait4</p></td>
<td><p>889</p></td>
<td><p>Time</p></td>
<td><p>sys_wait4()</p></td>
</tr>
<tr class="row-odd"><td><p>clock_nanosleep</p></td>
<td><p>37</p></td>
<td><p>Time</p></td>
<td><p>sys_clock_nanosleep()</p></td>
</tr>
<tr class="row-even"><td><p>capget</p></td>
<td><p>4</p></td>
<td><p>Capability</p></td>
<td><p>sys_capget()</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tracing-stress-ng-netdev-stressor-workload">
<h3>Tracing stress-ng netdev stressor workload<a class="headerlink" href="#tracing-stress-ng-netdev-stressor-workload" title="Permalink to this heading">¶</a></h3>
<p>Run the following command to trace stress-ng netdev stressor workload:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>strace -c  stress-ng --netdev 1 -t 60 --metrics
</pre></div>
</div>
<p><strong>System Calls made by the workload</strong></p>
<p>The below table shows the system calls invoked by the workload, number of
times each system call is invoked, and the corresponding Linux subsystem.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>System Call</p></th>
<th class="head"><p># calls</p></th>
<th class="head"><p>Linux Subsystem</p></th>
<th class="head"><p>System Call (API)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>openat</p></td>
<td><p>74</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_openat()</p></td>
</tr>
<tr class="row-odd"><td><p>close</p></td>
<td><p>75</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_close()</p></td>
</tr>
<tr class="row-even"><td><p>read</p></td>
<td><p>58</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_read()</p></td>
</tr>
<tr class="row-odd"><td><p>fstat</p></td>
<td><p>20</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_fstat()</p></td>
</tr>
<tr class="row-even"><td><p>flock</p></td>
<td><p>10</p></td>
<td><p>Filesystem</p></td>
<td><p><a class="reference internal" href="../filesystems/api-summary.html#c.sys_flock" title="sys_flock"><code class="xref c c-func docutils literal notranslate"><span class="pre">sys_flock()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>write</p></td>
<td><p>7</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_write()</p></td>
</tr>
<tr class="row-even"><td><p>getdents64</p></td>
<td><p>8</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_getdents64()</p></td>
</tr>
<tr class="row-odd"><td><p>pread64</p></td>
<td><p>8</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_pread64()</p></td>
</tr>
<tr class="row-even"><td><p>lseek</p></td>
<td><p>1</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_lseek()</p></td>
</tr>
<tr class="row-odd"><td><p>access</p></td>
<td><p>2</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_access()</p></td>
</tr>
<tr class="row-even"><td><p>getcwd</p></td>
<td><p>1</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_getcwd()</p></td>
</tr>
<tr class="row-odd"><td><p>execve</p></td>
<td><p>1</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_execve()</p></td>
</tr>
<tr class="row-even"><td><p>mmap</p></td>
<td><p>61</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_mmap()</p></td>
</tr>
<tr class="row-odd"><td><p>munmap</p></td>
<td><p>3</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_munmap()</p></td>
</tr>
<tr class="row-even"><td><p>mprotect</p></td>
<td><p>20</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_mprotect()</p></td>
</tr>
<tr class="row-odd"><td><p>mlock</p></td>
<td><p>2</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_mlock()</p></td>
</tr>
<tr class="row-even"><td><p>brk</p></td>
<td><p>3</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_brk()</p></td>
</tr>
<tr class="row-odd"><td><p>rt_sigaction</p></td>
<td><p>21</p></td>
<td><p>Signal</p></td>
<td><p><a class="reference internal" href="../driver-api/basics.html#c.sys_rt_sigaction" title="sys_rt_sigaction"><code class="xref c c-func docutils literal notranslate"><span class="pre">sys_rt_sigaction()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>rt_sigprocmask</p></td>
<td><p>1</p></td>
<td><p>Signal</p></td>
<td><p><a class="reference internal" href="../driver-api/basics.html#c.sys_rt_sigprocmask" title="sys_rt_sigprocmask"><code class="xref c c-func docutils literal notranslate"><span class="pre">sys_rt_sigprocmask()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>sigaltstack</p></td>
<td><p>1</p></td>
<td><p>Signal</p></td>
<td><p>sys_sigaltstack()</p></td>
</tr>
<tr class="row-even"><td><p>rt_sigreturn</p></td>
<td><p>1</p></td>
<td><p>Signal</p></td>
<td><p>sys_rt_sigreturn()</p></td>
</tr>
<tr class="row-odd"><td><p>getpid</p></td>
<td><p>8</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getpid()</p></td>
</tr>
<tr class="row-even"><td><p>prlimit64</p></td>
<td><p>5</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_prlimit64()</p></td>
</tr>
<tr class="row-odd"><td><p>arch_prctl</p></td>
<td><p>2</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_arch_prctl()</p></td>
</tr>
<tr class="row-even"><td><p>sysinfo</p></td>
<td><p>2</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_sysinfo()</p></td>
</tr>
<tr class="row-odd"><td><p>getuid</p></td>
<td><p>2</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getuid()</p></td>
</tr>
<tr class="row-even"><td><p>uname</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_uname()</p></td>
</tr>
<tr class="row-odd"><td><p>setpgid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_setpgid()</p></td>
</tr>
<tr class="row-even"><td><p>getrusage</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getrusage()</p></td>
</tr>
<tr class="row-odd"><td><p>geteuid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_geteuid()</p></td>
</tr>
<tr class="row-even"><td><p>getppid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getppid()</p></td>
</tr>
<tr class="row-odd"><td><p>sendto</p></td>
<td><p>3</p></td>
<td><p>Network</p></td>
<td><p>sys_sendto()</p></td>
</tr>
<tr class="row-even"><td><p>connect</p></td>
<td><p>1</p></td>
<td><p>Network</p></td>
<td><p>sys_connect()</p></td>
</tr>
<tr class="row-odd"><td><p>socket</p></td>
<td><p>1</p></td>
<td><p>Network</p></td>
<td><p>sys_socket()</p></td>
</tr>
<tr class="row-even"><td><p>clone</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_clone()</p></td>
</tr>
<tr class="row-odd"><td><p>set_tid_address</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_set_tid_address()</p></td>
</tr>
<tr class="row-even"><td><p>wait4</p></td>
<td><p>2</p></td>
<td><p>Time</p></td>
<td><p>sys_wait4()</p></td>
</tr>
<tr class="row-odd"><td><p>alarm</p></td>
<td><p>1</p></td>
<td><p>Time</p></td>
<td><p>sys_alarm()</p></td>
</tr>
<tr class="row-even"><td><p>set_robust_list</p></td>
<td><p>1</p></td>
<td><p>Futex</p></td>
<td><p>sys_set_robust_list()</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tracing-paxtest-kiddie-workload">
<h3>Tracing paxtest kiddie workload<a class="headerlink" href="#tracing-paxtest-kiddie-workload" title="Permalink to this heading">¶</a></h3>
<p>Run the following command to trace paxtest kiddie workload:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>strace -c paxtest kiddie
</pre></div>
</div>
<p><strong>System Calls made by the workload</strong></p>
<p>The below table shows the system calls invoked by the workload, number of
times each system call is invoked, and the corresponding Linux subsystem.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>System Call</p></th>
<th class="head"><p># calls</p></th>
<th class="head"><p>Linux Subsystem</p></th>
<th class="head"><p>System Call (API)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>read</p></td>
<td><p>3</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_read()</p></td>
</tr>
<tr class="row-odd"><td><p>write</p></td>
<td><p>11</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_write()</p></td>
</tr>
<tr class="row-even"><td><p>close</p></td>
<td><p>41</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_close()</p></td>
</tr>
<tr class="row-odd"><td><p>stat</p></td>
<td><p>24</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_stat()</p></td>
</tr>
<tr class="row-even"><td><p>fstat</p></td>
<td><p>2</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_fstat()</p></td>
</tr>
<tr class="row-odd"><td><p>pread64</p></td>
<td><p>6</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_pread64()</p></td>
</tr>
<tr class="row-even"><td><p>access</p></td>
<td><p>1</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_access()</p></td>
</tr>
<tr class="row-odd"><td><p>pipe</p></td>
<td><p>1</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_pipe()</p></td>
</tr>
<tr class="row-even"><td><p>dup2</p></td>
<td><p>24</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_dup2()</p></td>
</tr>
<tr class="row-odd"><td><p>execve</p></td>
<td><p>1</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_execve()</p></td>
</tr>
<tr class="row-even"><td><p>fcntl</p></td>
<td><p>26</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_fcntl()</p></td>
</tr>
<tr class="row-odd"><td><p>openat</p></td>
<td><p>14</p></td>
<td><p>Filesystem</p></td>
<td><p>sys_openat()</p></td>
</tr>
<tr class="row-even"><td><p>rt_sigaction</p></td>
<td><p>7</p></td>
<td><p>Signal</p></td>
<td><p><a class="reference internal" href="../driver-api/basics.html#c.sys_rt_sigaction" title="sys_rt_sigaction"><code class="xref c c-func docutils literal notranslate"><span class="pre">sys_rt_sigaction()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>rt_sigreturn</p></td>
<td><p>38</p></td>
<td><p>Signal</p></td>
<td><p>sys_rt_sigreturn()</p></td>
</tr>
<tr class="row-even"><td><p>clone</p></td>
<td><p>38</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_clone()</p></td>
</tr>
<tr class="row-odd"><td><p>wait4</p></td>
<td><p>44</p></td>
<td><p>Time</p></td>
<td><p>sys_wait4()</p></td>
</tr>
<tr class="row-even"><td><p>mmap</p></td>
<td><p>7</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_mmap()</p></td>
</tr>
<tr class="row-odd"><td><p>mprotect</p></td>
<td><p>3</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_mprotect()</p></td>
</tr>
<tr class="row-even"><td><p>munmap</p></td>
<td><p>1</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_munmap()</p></td>
</tr>
<tr class="row-odd"><td><p>brk</p></td>
<td><p>3</p></td>
<td><p>Memory Mgmt.</p></td>
<td><p>sys_brk()</p></td>
</tr>
<tr class="row-even"><td><p>getpid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getpid()</p></td>
</tr>
<tr class="row-odd"><td><p>getuid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getuid()</p></td>
</tr>
<tr class="row-even"><td><p>getgid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getgid()</p></td>
</tr>
<tr class="row-odd"><td><p>geteuid</p></td>
<td><p>2</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_geteuid()</p></td>
</tr>
<tr class="row-even"><td><p>getegid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getegid()</p></td>
</tr>
<tr class="row-odd"><td><p>getppid</p></td>
<td><p>1</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_getppid()</p></td>
</tr>
<tr class="row-even"><td><p>arch_prctl</p></td>
<td><p>2</p></td>
<td><p>Process Mgmt.</p></td>
<td><p>sys_arch_prctl()</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>This document is intended to be used as a guide on how to gather fine-grained
information on the resources in use by workloads using strace.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://elisa.tech/blog/2022/02/02/discovery-linux-kernel-subsystems-used-by-openaps">Discovery Linux Kernel Subsystems used by OpenAPS</a></p></li>
<li><p><a class="reference external" href="https://github.com/elisa-tech/ELISA-White-Papers/blob/master/Processes/Discovering_Linux_kernel_subsystems_used_by_a_workload.md">ELISA-White-Papers-Discovering Linux kernel subsystems used by a workload</a></p></li>
<li><p><a class="reference external" href="https://man7.org/linux/man-pages/man1/strace.1.html">strace</a></p></li>
<li><p><a class="reference external" href="https://man7.org/linux/man-pages/man1/perf.1.html">perf</a></p></li>
<li><p><a class="reference external" href="https://github.com/opntr/paxtest-freebsd/blob/hardenedbsd/0.9.14-hbsd/README">paxtest README</a></p></li>
<li><p><a class="reference external" href="https://www.mankier.com/1/stress-ng">stress-ng</a></p></li>
<li><p><a class="reference external" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/monitoring_and_managing_system_status_and_performance/index">Monitoring and managing system status and performance</a></p></li>
</ul>
</div></blockquote>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/admin-guide/workload-tracing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>