<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Detailed Usages &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="DAMON-based Reclamation" href="reclaim.html" />
    <link rel="prev" title="Getting Started" href="start.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.13.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../README.html">Linux kernel release 6.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../abi.html">Linux ABI description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features.html">Feature status on all architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reporting-regressions.html">Reporting regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickly-build-trimmed-linux.html">How to quickly build a trimmed Linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../verify-bugs-and-bisect-regressions.html">How to verify bugs and bisect regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bug-bisect.html">Bisecting a regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../init.html">Explaining the “No working init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pstore-blk.html">pstore block oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../workload-tracing.html">Discovering Linux kernel subsystems used by a workload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../blockdev/index.html">Block Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../filesystem-monitoring.html">File system Monitoring with fanotify</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpio/index.html">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hw_random.html">Hardware random number generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../media/index.html">Media subsystem admin and user guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Memory Management</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../concepts.html">Concepts overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cma_debugfs.html">CMA Debugfs Interface</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">DAMON: Data Access MONitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hugetlbpage.html">HugeTLB Pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../idle_page_tracking.html">Idle Page Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ksm.html">Kernel Samepage Merging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../memory-hotplug.html">Memory Hot(Un)Plug</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multigen_lru.html">Multi-Gen LRU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nommu-mmap.html">No-MMU memory mapping support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numa_memory_policy.html">NUMA Memory Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../numaperf.html">NUMA Memory Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pagemap.html">Examining Process Page Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shrinker_debugfs.html">Shrinker Debugfs Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soft-dirty.html">Soft-Dirty PTEs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../swap_numa.html">Automatically bind swap device to numa node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../transhuge.html">Transparent Hugepage Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userfaultfd.html">Userfaultfd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zswap.html">zswap</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../RAS/main.html">Reliability, Availability and Serviceability (RAS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../RAS/error-decoding.html">Error decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../RAS/address-translation.html">Address translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../syscall-user-dispatch.html">Syscall User Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../thermal/index.html">Thermal Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/admin-guide/mm/damon/usage.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->



<div class="language-selection">
English

<ul>

<li><a href="../../../translations/zh_CN/admin-guide/mm/damon/usage.html">Chinese (Simplified)</a></li>

<li><a href="../../../translations/zh_TW/admin-guide/mm/damon/usage.html">Chinese (Traditional)</a></li>

</ul>
</div>
<section id="detailed-usages">
<h1>Detailed Usages<a class="headerlink" href="#detailed-usages" title="Link to this heading">¶</a></h1>
<p>DAMON provides below interfaces for different users.</p>
<ul class="simple">
<li><p><em>DAMON user space tool.</em>
<a class="reference external" href="https://github.com/damonitor/damo">This</a> is for privileged people such as
system administrators who want a just-working human-friendly interface.
Using this, users can use the DAMON’s major features in a human-friendly way.
It may not be highly tuned for special cases, though.  For more detail,
please refer to its <a class="reference external" href="https://github.com/damonitor/damo/blob/next/USAGE.md">usage document</a>.</p></li>
<li><p><em>sysfs interface.</em>
<a class="reference internal" href="#sysfs-interface"><span class="std std-ref">This</span></a> is for privileged user space programmers who
want more optimized use of DAMON.  Using this, users can use DAMON’s major
features by reading from and writing to special sysfs files.  Therefore,
you can write and use your personalized DAMON sysfs wrapper programs that
reads/writes the sysfs files instead of you.  The <a class="reference external" href="https://github.com/damonitor/damo">DAMON user space tool</a> is one example of such programs.</p></li>
<li><p><em>Kernel Space Programming Interface.</em>
<a class="reference internal" href="../../../mm/damon/api.html"><span class="doc">This</span></a> is for kernel space programmers.  Using this,
users can utilize every feature of DAMON most flexibly and efficiently by
writing kernel space DAMON application programs for you.  You can even extend
DAMON for various address spaces.  For detail, please refer to the interface
<a class="reference internal" href="../../../mm/damon/api.html"><span class="doc">document</span></a>.</p></li>
<li><p><em>debugfs interface. (DEPRECATED!)</em>
<a class="reference internal" href="#debugfs-interface"><span class="std std-ref">This</span></a> is almost identical to <a class="reference internal" href="#sysfs-interface"><span class="std std-ref">sysfs interface</span></a>.  This is deprecated, so users should move to the
<a class="reference internal" href="#sysfs-interface"><span class="std std-ref">sysfs interface</span></a>.  If you depend on this and cannot
move, please report your usecase to <a class="reference external" href="mailto:damon&#37;&#52;&#48;lists&#46;linux&#46;dev">damon<span>&#64;</span>lists<span>&#46;</span>linux<span>&#46;</span>dev</a> and
<a class="reference external" href="mailto:linux-mm&#37;&#52;&#48;kvack&#46;org">linux-mm<span>&#64;</span>kvack<span>&#46;</span>org</a>.</p></li>
</ul>
<section id="sysfs-interface">
<span id="id1"></span><h2>sysfs Interface<a class="headerlink" href="#sysfs-interface" title="Link to this heading">¶</a></h2>
<p>DAMON sysfs interface is built when <code class="docutils literal notranslate"><span class="pre">CONFIG_DAMON_SYSFS</span></code> is defined.  It
creates multiple directories and files under its sysfs directory,
<code class="docutils literal notranslate"><span class="pre">&lt;sysfs&gt;/kernel/mm/damon/</span></code>.  You can control DAMON by writing to and reading
from the files under the directory.</p>
<p>For a short example, users can monitor the virtual address space of a given
workload as below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /sys/kernel/mm/damon/admin/
# echo 1 &gt; kdamonds/nr_kdamonds &amp;&amp; echo 1 &gt; kdamonds/0/contexts/nr_contexts
# echo vaddr &gt; kdamonds/0/contexts/0/operations
# echo 1 &gt; kdamonds/0/contexts/0/targets/nr_targets
# echo $(pidof &lt;workload&gt;) &gt; kdamonds/0/contexts/0/targets/0/pid_target
# echo on &gt; kdamonds/0/state
</pre></div>
</div>
<section id="files-hierarchy">
<h3>Files Hierarchy<a class="headerlink" href="#files-hierarchy" title="Link to this heading">¶</a></h3>
<p>The files hierarchy of DAMON sysfs interface is shown below.  In the below
figure, parents-children relations are represented with indentations, each
directory is having <code class="docutils literal notranslate"><span class="pre">/</span></code> suffix, and files in each directory are separated by
comma (“,”).</p>
<pre class="literal-block"><a class="reference internal" href="#sysfs-root"><span class="std std-ref">/sys/kernel/mm/damon</span></a>/admin
│ <a class="reference internal" href="#sysfs-kdamonds"><span class="std std-ref">kdamonds</span></a>/nr_kdamonds
│ │ <a class="reference internal" href="#sysfs-kdamond"><span class="std std-ref">0</span></a>/state,pid
│ │ │ <a class="reference internal" href="#sysfs-contexts"><span class="std std-ref">contexts</span></a>/nr_contexts
│ │ │ │ <a class="reference internal" href="#sysfs-context"><span class="std std-ref">0</span></a>/avail_operations,operations
│ │ │ │ │ <a class="reference internal" href="#sysfs-monitoring-attrs"><span class="std std-ref">monitoring_attrs</span></a>/
│ │ │ │ │ │ intervals/sample_us,aggr_us,update_us
│ │ │ │ │ │ nr_regions/min,max
│ │ │ │ │ <a class="reference internal" href="#sysfs-targets"><span class="std std-ref">targets</span></a>/nr_targets
│ │ │ │ │ │ <a class="reference internal" href="#sysfs-target"><span class="std std-ref">0</span></a>/pid_target
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-regions"><span class="std std-ref">regions</span></a>/nr_regions
│ │ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-region"><span class="std std-ref">0</span></a>/start,end
│ │ │ │ │ │ │ │ ...
│ │ │ │ │ │ ...
│ │ │ │ │ <a class="reference internal" href="#sysfs-schemes"><span class="std std-ref">schemes</span></a>/nr_schemes
│ │ │ │ │ │ <a class="reference internal" href="#sysfs-scheme"><span class="std std-ref">0</span></a>/action,target_nid,apply_interval_us
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-access-pattern"><span class="std std-ref">access_pattern</span></a>/
│ │ │ │ │ │ │ │ sz/min,max
│ │ │ │ │ │ │ │ nr_accesses/min,max
│ │ │ │ │ │ │ │ age/min,max
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-quotas"><span class="std std-ref">quotas</span></a>/ms,bytes,reset_interval_ms,effective_bytes
│ │ │ │ │ │ │ │ weights/sz_permil,nr_accesses_permil,age_permil
│ │ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-schemes-quota-goals"><span class="std std-ref">goals</span></a>/nr_goals
│ │ │ │ │ │ │ │ │ 0/target_metric,target_value,current_value
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-watermarks"><span class="std std-ref">watermarks</span></a>/metric,interval_us,high,mid,low
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-filters"><span class="std std-ref">filters</span></a>/nr_filters
│ │ │ │ │ │ │ │ 0/type,matching,memcg_id
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-schemes-stats"><span class="std std-ref">stats</span></a>/nr_tried,sz_tried,nr_applied,sz_applied,qt_exceeds
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-schemes-tried-regions"><span class="std std-ref">tried_regions</span></a>/total_bytes
│ │ │ │ │ │ │ │ 0/start,end,nr_accesses,age
│ │ │ │ │ │ │ │ ...
│ │ │ │ │ │ ...
│ │ │ │ ...
│ │ ...</pre>
</section>
<section id="root">
<span id="sysfs-root"></span><h3>Root<a class="headerlink" href="#root" title="Link to this heading">¶</a></h3>
<p>The root of the DAMON sysfs interface is <code class="docutils literal notranslate"><span class="pre">&lt;sysfs&gt;/kernel/mm/damon/</span></code>, and it
has one directory named <code class="docutils literal notranslate"><span class="pre">admin</span></code>.  The directory contains the files for
privileged user space programs’ control of DAMON.  User space tools or daemons
having the root permission could use this directory.</p>
</section>
<section id="kdamonds">
<span id="sysfs-kdamonds"></span><h3>kdamonds/<a class="headerlink" href="#kdamonds" title="Link to this heading">¶</a></h3>
<p>Under the <code class="docutils literal notranslate"><span class="pre">admin</span></code> directory, one directory, <code class="docutils literal notranslate"><span class="pre">kdamonds</span></code>, which has files for
controlling the kdamonds (refer to
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-execution-model-and-data-structures"><span class="std std-ref">design</span></a> for more
details) exists.  In the beginning, this directory has only one file,
<code class="docutils literal notranslate"><span class="pre">nr_kdamonds</span></code>.  Writing a number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of
child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each
kdamond.</p>
</section>
<section id="kdamonds-n">
<span id="sysfs-kdamond"></span><h3>kdamonds/&lt;N&gt;/<a class="headerlink" href="#kdamonds-n" title="Link to this heading">¶</a></h3>
<p>In each kdamond directory, two files (<code class="docutils literal notranslate"><span class="pre">state</span></code> and <code class="docutils literal notranslate"><span class="pre">pid</span></code>) and one directory
(<code class="docutils literal notranslate"><span class="pre">contexts</span></code>) exist.</p>
<p>Reading <code class="docutils literal notranslate"><span class="pre">state</span></code> returns <code class="docutils literal notranslate"><span class="pre">on</span></code> if the kdamond is currently running, or
<code class="docutils literal notranslate"><span class="pre">off</span></code> if it is not running.</p>
<p>Users can write below commands for the kdamond to the <code class="docutils literal notranslate"><span class="pre">state</span></code> file.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code>: Start running.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">off</span></code>: Stop running.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">commit</span></code>: Read the user inputs in the sysfs files except <code class="docutils literal notranslate"><span class="pre">state</span></code> file
again.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">commit_schemes_quota_goals</span></code>: Read the DAMON-based operation schemes’
<a class="reference internal" href="#sysfs-schemes-quota-goals"><span class="std std-ref">quota goals</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_schemes_stats</span></code>: Update the contents of stats files for each
DAMON-based operation scheme of the kdamond.  For details of the stats,
please refer to <a class="reference internal" href="#sysfs-schemes-stats"><span class="std std-ref">stats section</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_schemes_tried_regions</span></code>: Update the DAMON-based operation scheme
action tried regions directory for each DAMON-based operation scheme of the
kdamond.  For details of the DAMON-based operation scheme action tried
regions directory, please refer to
<a class="reference internal" href="#sysfs-schemes-tried-regions"><span class="std std-ref">tried_regions section</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_schemes_tried_bytes</span></code>: Update only <code class="docutils literal notranslate"><span class="pre">.../tried_regions/total_bytes</span></code>
files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clear_schemes_tried_regions</span></code>: Clear the DAMON-based operating scheme
action tried regions directory for each DAMON-based operation scheme of the
kdamond.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_schemes_effective_quotas</span></code>: Update the contents of
<code class="docutils literal notranslate"><span class="pre">effective_bytes</span></code> files for each DAMON-based operation scheme of the
kdamond.  For more details, refer to <a class="reference internal" href="#sysfs-quotas"><span class="std std-ref">quotas directory</span></a>.</p></li>
</ul>
<p>If the state is <code class="docutils literal notranslate"><span class="pre">on</span></code>, reading <code class="docutils literal notranslate"><span class="pre">pid</span></code> shows the pid of the kdamond thread.</p>
<p><code class="docutils literal notranslate"><span class="pre">contexts</span></code> directory contains files for controlling the monitoring contexts
that this kdamond will execute.</p>
</section>
<section id="kdamonds-n-contexts">
<span id="sysfs-contexts"></span><h3>kdamonds/&lt;N&gt;/contexts/<a class="headerlink" href="#kdamonds-n-contexts" title="Link to this heading">¶</a></h3>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_contexts</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named as
<code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each monitoring context (refer to
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-execution-model-and-data-structures"><span class="std std-ref">design</span></a> for more
details).  At the moment, only one context per kdamond is supported, so only
<code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> can be written to the file.</p>
</section>
<section id="contexts-n">
<span id="sysfs-context"></span><h3>contexts/&lt;N&gt;/<a class="headerlink" href="#contexts-n" title="Link to this heading">¶</a></h3>
<p>In each context directory, two files (<code class="docutils literal notranslate"><span class="pre">avail_operations</span></code> and <code class="docutils literal notranslate"><span class="pre">operations</span></code>)
and three directories (<code class="docutils literal notranslate"><span class="pre">monitoring_attrs</span></code>, <code class="docutils literal notranslate"><span class="pre">targets</span></code>, and <code class="docutils literal notranslate"><span class="pre">schemes</span></code>)
exist.</p>
<p>DAMON supports multiple types of <a class="reference internal" href="../../../mm/damon/design.html#damon-design-configurable-operations-set"><span class="std std-ref">monitoring operations</span></a>, including those for virtual address
space and the physical address space.  You can get the list of available
monitoring operations set on the currently running kernel by reading
<code class="docutils literal notranslate"><span class="pre">avail_operations</span></code> file.  Based on the kernel configuration, the file will
list different available operation sets.  Please refer to the <a class="reference internal" href="../../../mm/damon/design.html#damon-operations-set"><span class="std std-ref">design</span></a> for the list of all available operation sets and their
brief explanations.</p>
<p>You can set and get what type of monitoring operations DAMON will use for the
context by writing one of the keywords listed in <code class="docutils literal notranslate"><span class="pre">avail_operations</span></code> file and
reading from the <code class="docutils literal notranslate"><span class="pre">operations</span></code> file.</p>
</section>
<section id="contexts-n-monitoring-attrs">
<span id="sysfs-monitoring-attrs"></span><h3>contexts/&lt;N&gt;/monitoring_attrs/<a class="headerlink" href="#contexts-n-monitoring-attrs" title="Link to this heading">¶</a></h3>
<p>Files for specifying attributes of the monitoring including required quality
and efficiency of the monitoring are in <code class="docutils literal notranslate"><span class="pre">monitoring_attrs</span></code> directory.
Specifically, two directories, <code class="docutils literal notranslate"><span class="pre">intervals</span></code> and <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code> exist in this
directory.</p>
<p>Under <code class="docutils literal notranslate"><span class="pre">intervals</span></code> directory, three files for DAMON’s sampling interval
(<code class="docutils literal notranslate"><span class="pre">sample_us</span></code>), aggregation interval (<code class="docutils literal notranslate"><span class="pre">aggr_us</span></code>), and update interval
(<code class="docutils literal notranslate"><span class="pre">update_us</span></code>) exist.  You can set and get the values in micro-seconds by
writing to and reading from the files.</p>
<p>Under <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code> directory, two files for the lower-bound and upper-bound
of DAMON’s monitoring regions (<code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code>, respectively), which
controls the monitoring overhead, exist.  You can set and get the values by
writing to and rading from the files.</p>
<p>For more details about the intervals and monitoring regions range, please refer
to the Design document (<a class="reference internal" href="../../../mm/damon/design.html"><span class="doc">Design</span></a>).</p>
</section>
<section id="contexts-n-targets">
<span id="sysfs-targets"></span><h3>contexts/&lt;N&gt;/targets/<a class="headerlink" href="#contexts-n-targets" title="Link to this heading">¶</a></h3>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_targets</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each monitoring target.</p>
</section>
<section id="targets-n">
<span id="sysfs-target"></span><h3>targets/&lt;N&gt;/<a class="headerlink" href="#targets-n" title="Link to this heading">¶</a></h3>
<p>In each target directory, one file (<code class="docutils literal notranslate"><span class="pre">pid_target</span></code>) and one directory
(<code class="docutils literal notranslate"><span class="pre">regions</span></code>) exist.</p>
<p>If you wrote <code class="docutils literal notranslate"><span class="pre">vaddr</span></code> to the <code class="docutils literal notranslate"><span class="pre">contexts/&lt;N&gt;/operations</span></code>, each target should
be a process.  You can specify the process to DAMON by writing the pid of the
process to the <code class="docutils literal notranslate"><span class="pre">pid_target</span></code> file.</p>
</section>
<section id="targets-n-regions">
<span id="sysfs-regions"></span><h3>targets/&lt;N&gt;/regions<a class="headerlink" href="#targets-n-regions" title="Link to this heading">¶</a></h3>
<p>In case of <code class="docutils literal notranslate"><span class="pre">fvaddr</span></code> or <code class="docutils literal notranslate"><span class="pre">paddr</span></code> monitoring operations sets, users are
required to set the monitoring target address ranges.  In case of <code class="docutils literal notranslate"><span class="pre">vaddr</span></code>
operations set, it is not mandatory, but users can optionally set the initial
monitoring region to specific address ranges.  Please refer to the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-vaddr-target-regions-construction"><span class="std std-ref">design</span></a> for more details.</p>
<p>For such cases, users can explicitly set the initial monitoring target regions
as they want, by writing proper values to the files under this directory.</p>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each initial monitoring target region.</p>
</section>
<section id="regions-n">
<span id="sysfs-region"></span><h3>regions/&lt;N&gt;/<a class="headerlink" href="#regions-n" title="Link to this heading">¶</a></h3>
<p>In each region directory, you will find two files (<code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code>).  You
can set and get the start and end addresses of the initial monitoring target
region by writing to and reading from the files, respectively.</p>
<p>Each region should not overlap with others.  <code class="docutils literal notranslate"><span class="pre">end</span></code> of directory <code class="docutils literal notranslate"><span class="pre">N</span></code> should
be equal or smaller than <code class="docutils literal notranslate"><span class="pre">start</span></code> of directory <code class="docutils literal notranslate"><span class="pre">N+1</span></code>.</p>
</section>
<section id="contexts-n-schemes">
<span id="sysfs-schemes"></span><h3>contexts/&lt;N&gt;/schemes/<a class="headerlink" href="#contexts-n-schemes" title="Link to this heading">¶</a></h3>
<p>The directory for DAMON-based Operation Schemes (<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">DAMOS</span></a>).  Users can get and set the schemes by reading from and
writing to files under this directory.</p>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_schemes</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each DAMON-based operation scheme.</p>
</section>
<section id="schemes-n">
<span id="sysfs-scheme"></span><h3>schemes/&lt;N&gt;/<a class="headerlink" href="#schemes-n" title="Link to this heading">¶</a></h3>
<p>In each scheme directory, five directories (<code class="docutils literal notranslate"><span class="pre">access_pattern</span></code>, <code class="docutils literal notranslate"><span class="pre">quotas</span></code>,
<code class="docutils literal notranslate"><span class="pre">watermarks</span></code>, <code class="docutils literal notranslate"><span class="pre">filters</span></code>, <code class="docutils literal notranslate"><span class="pre">stats</span></code>, and <code class="docutils literal notranslate"><span class="pre">tried_regions</span></code>) and three files
(<code class="docutils literal notranslate"><span class="pre">action</span></code>, <code class="docutils literal notranslate"><span class="pre">target_nid</span></code> and <code class="docutils literal notranslate"><span class="pre">apply_interval</span></code>) exist.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">action</span></code> file is for setting and getting the scheme’s <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-action"><span class="std std-ref">action</span></a>.  The keywords that can be written to and read
from the file and their meaning are same to those of the list on
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-action"><span class="std std-ref">design doc</span></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_nid</span></code> file is for setting the migration target node, which is
only meaningful when the <code class="docutils literal notranslate"><span class="pre">action</span></code> is either <code class="docutils literal notranslate"><span class="pre">migrate_hot</span></code> or
<code class="docutils literal notranslate"><span class="pre">migrate_cold</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">apply_interval_us</span></code> file is for setting and getting the scheme’s
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">apply_interval</span></a> in microseconds.</p>
</section>
<section id="schemes-n-access-pattern">
<span id="sysfs-access-pattern"></span><h3>schemes/&lt;N&gt;/access_pattern/<a class="headerlink" href="#schemes-n-access-pattern" title="Link to this heading">¶</a></h3>
<p>The directory for the target access <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-access-pattern"><span class="std std-ref">pattern</span></a> of the given DAMON-based operation scheme.</p>
<p>Under the <code class="docutils literal notranslate"><span class="pre">access_pattern</span></code> directory, three directories (<code class="docutils literal notranslate"><span class="pre">sz</span></code>,
<code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, and <code class="docutils literal notranslate"><span class="pre">age</span></code>) each having two files (<code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code>)
exist.  You can set and get the access pattern for the given scheme by writing
to and reading from the <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> files under <code class="docutils literal notranslate"><span class="pre">sz</span></code>,
<code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, and <code class="docutils literal notranslate"><span class="pre">age</span></code> directories, respectively.  Note that the <code class="docutils literal notranslate"><span class="pre">min</span></code>
and the <code class="docutils literal notranslate"><span class="pre">max</span></code> form a closed interval.</p>
</section>
<section id="schemes-n-quotas">
<span id="sysfs-quotas"></span><h3>schemes/&lt;N&gt;/quotas/<a class="headerlink" href="#schemes-n-quotas" title="Link to this heading">¶</a></h3>
<p>The directory for the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas"><span class="std std-ref">quotas</span></a> of the given
DAMON-based operation scheme.</p>
<p>Under <code class="docutils literal notranslate"><span class="pre">quotas</span></code> directory, four files (<code class="docutils literal notranslate"><span class="pre">ms</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>,
<code class="docutils literal notranslate"><span class="pre">reset_interval_ms</span></code>, <code class="docutils literal notranslate"><span class="pre">effective_bytes</span></code>) and two directores (<code class="docutils literal notranslate"><span class="pre">weights</span></code> and
<code class="docutils literal notranslate"><span class="pre">goals</span></code>) exist.</p>
<p>You can set the <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">quota</span></code> in milliseconds, <code class="docutils literal notranslate"><span class="pre">size</span> <span class="pre">quota</span></code> in bytes, and
<code class="docutils literal notranslate"><span class="pre">reset</span> <span class="pre">interval</span></code> in milliseconds by writing the values to the three files,
respectively.  Then, DAMON tries to use only up to <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">quota</span></code> milliseconds
for applying the <code class="docutils literal notranslate"><span class="pre">action</span></code> to memory regions of the <code class="docutils literal notranslate"><span class="pre">access_pattern</span></code>, and to
apply the action to only up to <code class="docutils literal notranslate"><span class="pre">bytes</span></code> bytes of memory regions within the
<code class="docutils literal notranslate"><span class="pre">reset_interval_ms</span></code>.  Setting both <code class="docutils literal notranslate"><span class="pre">ms</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> zero disables the
quota limits unless at least one <a class="reference internal" href="#sysfs-schemes-quota-goals"><span class="std std-ref">goal</span></a> is
set.</p>
<p>The time quota is internally transformed to a size quota.  Between the
transformed size quota and user-specified size quota, smaller one is applied.
Based on the user-specified <a class="reference internal" href="#sysfs-schemes-quota-goals"><span class="std std-ref">goal</span></a>, the
effective size quota is further adjusted.  Reading <code class="docutils literal notranslate"><span class="pre">effective_bytes</span></code> returns
the current effective size quota.  The file is not updated in real time, so
users should ask DAMON sysfs interface to update the content of the file for
the stats by writing a special keyword, <code class="docutils literal notranslate"><span class="pre">update_schemes_effective_quotas</span></code> to
the relevant <code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> file.</p>
<p>Under <code class="docutils literal notranslate"><span class="pre">weights</span></code> directory, three files (<code class="docutils literal notranslate"><span class="pre">sz_permil</span></code>,
<code class="docutils literal notranslate"><span class="pre">nr_accesses_permil</span></code>, and <code class="docutils literal notranslate"><span class="pre">age_permil</span></code>) exist.
You can set the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas-prioritization"><span class="std std-ref">prioritization weights</span></a> for size, access frequency, and age
in per-thousand unit by writing the values to the three files under the
<code class="docutils literal notranslate"><span class="pre">weights</span></code> directory.</p>
</section>
<section id="schemes-n-quotas-goals">
<span id="sysfs-schemes-quota-goals"></span><h3>schemes/&lt;N&gt;/quotas/goals/<a class="headerlink" href="#schemes-n-quotas-goals" title="Link to this heading">¶</a></h3>
<p>The directory for the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas-auto-tuning"><span class="std std-ref">automatic quota tuning goals</span></a> of the given DAMON-based operation
scheme.</p>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_goals</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each goal and current achievement.
Among the multiple feedback, the best one is used.</p>
<p>Each goal directory contains three files, namely <code class="docutils literal notranslate"><span class="pre">target_metric</span></code>,
<code class="docutils literal notranslate"><span class="pre">target_value</span></code> and <code class="docutils literal notranslate"><span class="pre">current_value</span></code>.  Users can set and get the three
parameters for the quota auto-tuning goals that specified on the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas-auto-tuning"><span class="std std-ref">design
doc</span></a> by writing to and reading from each
of the files.  Note that users should further write
<code class="docutils literal notranslate"><span class="pre">commit_schemes_quota_goals</span></code> to the <code class="docutils literal notranslate"><span class="pre">state</span></code> file of the <a class="reference internal" href="#sysfs-kdamond"><span class="std std-ref">kdamond
directory</span></a> to pass the feedback to DAMON.</p>
</section>
<section id="schemes-n-watermarks">
<span id="sysfs-watermarks"></span><h3>schemes/&lt;N&gt;/watermarks/<a class="headerlink" href="#schemes-n-watermarks" title="Link to this heading">¶</a></h3>
<p>The directory for the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-watermarks"><span class="std std-ref">watermarks</span></a> of the
given DAMON-based operation scheme.</p>
<p>Under the watermarks directory, five files (<code class="docutils literal notranslate"><span class="pre">metric</span></code>, <code class="docutils literal notranslate"><span class="pre">interval_us</span></code>,
<code class="docutils literal notranslate"><span class="pre">high</span></code>, <code class="docutils literal notranslate"><span class="pre">mid</span></code>, and <code class="docutils literal notranslate"><span class="pre">low</span></code>) for setting the metric, the time interval
between check of the metric, and the three watermarks exist.  You can set and
get the five values by writing to the files, respectively.</p>
<p>Keywords and meanings of those that can be written to the <code class="docutils literal notranslate"><span class="pre">metric</span></code> file are
as below.</p>
<blockquote>
<div><ul class="simple">
<li><p>none: Ignore the watermarks</p></li>
<li><p>free_mem_rate: System’s free memory rate (per thousand)</p></li>
</ul>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">interval</span></code> should written in microseconds unit.</p>
</section>
<section id="schemes-n-filters">
<span id="sysfs-filters"></span><h3>schemes/&lt;N&gt;/filters/<a class="headerlink" href="#schemes-n-filters" title="Link to this heading">¶</a></h3>
<p>The directory for the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-filters"><span class="std std-ref">filters</span></a> of the given
DAMON-based operation scheme.</p>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_filters</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each filter.  The filters are evaluated
in the numeric order.</p>
<p>Each filter directory contains six files, namely <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">matcing</span></code>,
<code class="docutils literal notranslate"><span class="pre">memcg_path</span></code>, <code class="docutils literal notranslate"><span class="pre">addr_start</span></code>, <code class="docutils literal notranslate"><span class="pre">addr_end</span></code>, and <code class="docutils literal notranslate"><span class="pre">target_idx</span></code>.  To <code class="docutils literal notranslate"><span class="pre">type</span></code>
file, you can write one of five special keywords: <code class="docutils literal notranslate"><span class="pre">anon</span></code> for anonymous pages,
<code class="docutils literal notranslate"><span class="pre">memcg</span></code> for specific memory cgroup, <code class="docutils literal notranslate"><span class="pre">young</span></code> for young pages, <code class="docutils literal notranslate"><span class="pre">addr</span></code> for
specific address range (an open-ended interval), or <code class="docutils literal notranslate"><span class="pre">target</span></code> for specific
DAMON monitoring target filtering.  In case of the memory cgroup filtering, you
can specify the memory cgroup of the interest by writing the path of the memory
cgroup from the cgroups mount point to <code class="docutils literal notranslate"><span class="pre">memcg_path</span></code> file.  In case of the
address range filtering, you can specify the start and end address of the range
to <code class="docutils literal notranslate"><span class="pre">addr_start</span></code> and <code class="docutils literal notranslate"><span class="pre">addr_end</span></code> files, respectively.  For the DAMON
monitoring target filtering, you can specify the index of the target between
the list of the DAMON context’s monitoring targets list to <code class="docutils literal notranslate"><span class="pre">target_idx</span></code> file.
You can write <code class="docutils literal notranslate"><span class="pre">Y</span></code> or <code class="docutils literal notranslate"><span class="pre">N</span></code> to <code class="docutils literal notranslate"><span class="pre">matching</span></code> file to filter out pages that does
or does not match to the type, respectively.  Then, the scheme’s action will
not be applied to the pages that specified to be filtered out.</p>
<p>For example, below restricts a DAMOS action to be applied to only non-anonymous
pages of all memory cgroups except <code class="docutils literal notranslate"><span class="pre">/having_care_already</span></code>.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 2 &gt; nr_filters
# # filter out anonymous pages
echo anon &gt; 0/type
echo Y &gt; 0/matching
# # further filter out all cgroups except one at &#39;/having_care_already&#39;
echo memcg &gt; 1/type
echo /having_care_already &gt; 1/memcg_path
echo Y &gt; 1/matching
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">anon</span></code> and <code class="docutils literal notranslate"><span class="pre">memcg</span></code> filters are currently supported only when
<code class="docutils literal notranslate"><span class="pre">paddr</span></code> <a class="reference internal" href="#sysfs-context"><span class="std std-ref">implementation</span></a> is being used.</p>
<p>Also, memory regions that are filtered out by <code class="docutils literal notranslate"><span class="pre">addr</span></code> or <code class="docutils literal notranslate"><span class="pre">target</span></code> filters
are not counted as the scheme has tried to those, while regions that filtered
out by other type filters are counted as the scheme has tried to.  The
difference is applied to <a class="reference internal" href="#damos-stats"><span class="std std-ref">stats</span></a> and
<a class="reference internal" href="#sysfs-schemes-tried-regions"><span class="std std-ref">tried regions</span></a>.</p>
</section>
<section id="schemes-n-stats">
<span id="sysfs-schemes-stats"></span><h3>schemes/&lt;N&gt;/stats/<a class="headerlink" href="#schemes-n-stats" title="Link to this heading">¶</a></h3>
<p>DAMON counts the total number and bytes of regions that each scheme is tried to
be applied, the two numbers for the regions that each scheme is successfully
applied, and the total number of the quota limit exceeds.  This statistics can
be used for online analysis or tuning of the schemes.</p>
<p>The statistics can be retrieved by reading the files under <code class="docutils literal notranslate"><span class="pre">stats</span></code> directory
(<code class="docutils literal notranslate"><span class="pre">nr_tried</span></code>, <code class="docutils literal notranslate"><span class="pre">sz_tried</span></code>, <code class="docutils literal notranslate"><span class="pre">nr_applied</span></code>, <code class="docutils literal notranslate"><span class="pre">sz_applied</span></code>, and
<code class="docutils literal notranslate"><span class="pre">qt_exceeds</span></code>), respectively.  The files are not updated in real time, so you
should ask DAMON sysfs interface to update the content of the files for the
stats by writing a special keyword, <code class="docutils literal notranslate"><span class="pre">update_schemes_stats</span></code> to the relevant
<code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> file.</p>
</section>
<section id="schemes-n-tried-regions">
<span id="sysfs-schemes-tried-regions"></span><h3>schemes/&lt;N&gt;/tried_regions/<a class="headerlink" href="#schemes-n-tried-regions" title="Link to this heading">¶</a></h3>
<p>This directory initially has one file, <code class="docutils literal notranslate"><span class="pre">total_bytes</span></code>.</p>
<p>When a special keyword, <code class="docutils literal notranslate"><span class="pre">update_schemes_tried_regions</span></code>, is written to the
relevant <code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> file, DAMON updates the <code class="docutils literal notranslate"><span class="pre">total_bytes</span></code> file so
that reading it returns the total size of the scheme tried regions, and creates
directories named integer starting from <code class="docutils literal notranslate"><span class="pre">0</span></code> under this directory.  Each
directory contains files exposing detailed information about each of the memory
region that the corresponding scheme’s <code class="docutils literal notranslate"><span class="pre">action</span></code> has tried to be applied under
this directory, during next <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">apply interval</span></a> of the
corresponding scheme.  The information includes address range, <code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>,
and <code class="docutils literal notranslate"><span class="pre">age</span></code> of the region.</p>
<p>Writing <code class="docutils literal notranslate"><span class="pre">update_schemes_tried_bytes</span></code> to the relevant <code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code>
file will only update the <code class="docutils literal notranslate"><span class="pre">total_bytes</span></code> file, and will not create the
subdirectories.</p>
<p>The directories will be removed when another special keyword,
<code class="docutils literal notranslate"><span class="pre">clear_schemes_tried_regions</span></code>, is written to the relevant
<code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> file.</p>
<p>The expected usage of this directory is investigations of schemes’ behaviors,
and query-like efficient data access monitoring results retrievals.  For the
latter use case, in particular, users can set the <code class="docutils literal notranslate"><span class="pre">action</span></code> as <code class="docutils literal notranslate"><span class="pre">stat</span></code> and
set the <code class="docutils literal notranslate"><span class="pre">access</span> <span class="pre">pattern</span></code> as their interested pattern that they want to query.</p>
</section>
<section id="tried-regions-n">
<span id="sysfs-schemes-tried-region"></span><h3>tried_regions/&lt;N&gt;/<a class="headerlink" href="#tried-regions-n" title="Link to this heading">¶</a></h3>
<p>In each region directory, you will find four files (<code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">end</span></code>,
<code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, and <code class="docutils literal notranslate"><span class="pre">age</span></code>).  Reading the files will show the start and end
addresses, <code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, and <code class="docutils literal notranslate"><span class="pre">age</span></code> of the region that corresponding
DAMON-based operation scheme <code class="docutils literal notranslate"><span class="pre">action</span></code> has tried to be applied.</p>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h4>
<p>Below commands applies a scheme saying “If a memory region of size in [4KiB,
8KiB] is showing accesses per aggregate interval in [0, 5] for aggregate
interval in [10, 20], page out the region.  For the paging out, use only up to
10ms per second, and also don’t page out more than 1GiB per second.  Under the
limitation, page out memory regions having longer age first.  Also, check the
free memory rate of the system every 5 seconds, start the monitoring and paging
out when the free memory rate becomes lower than 50%, but stop it if the free
memory rate becomes larger than 60%, or lower than 30%”.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;sysfs&gt;/kernel/mm/damon/admin
# # populate directories
# echo 1 &gt; kdamonds/nr_kdamonds; echo 1 &gt; kdamonds/0/contexts/nr_contexts;
# echo 1 &gt; kdamonds/0/contexts/0/schemes/nr_schemes
# cd kdamonds/0/contexts/0/schemes/0
# # set the basic access pattern and the action
# echo 4096 &gt; access_pattern/sz/min
# echo 8192 &gt; access_pattern/sz/max
# echo 0 &gt; access_pattern/nr_accesses/min
# echo 5 &gt; access_pattern/nr_accesses/max
# echo 10 &gt; access_pattern/age/min
# echo 20 &gt; access_pattern/age/max
# echo pageout &gt; action
# # set quotas
# echo 10 &gt; quotas/ms
# echo $((1024*1024*1024)) &gt; quotas/bytes
# echo 1000 &gt; quotas/reset_interval_ms
# # set watermark
# echo free_mem_rate &gt; watermarks/metric
# echo 5000000 &gt; watermarks/interval_us
# echo 600 &gt; watermarks/high
# echo 500 &gt; watermarks/mid
# echo 300 &gt; watermarks/low
</pre></div>
</div>
<p>Please note that it’s highly recommended to use user space tools like <a class="reference external" href="https://github.com/damonitor/damo">damo</a> rather than manually reading and writing
the files as above.  Above is only for an example.</p>
</section>
</section>
</section>
<section id="tracepoints-for-monitoring-results">
<span id="tracepoint"></span><h2>Tracepoints for Monitoring Results<a class="headerlink" href="#tracepoints-for-monitoring-results" title="Link to this heading">¶</a></h2>
<p>Users can get the monitoring results via the <a class="reference internal" href="#sysfs-schemes-tried-regions"><span class="std std-ref">tried_regions</span></a>.  The interface is useful for getting a
snapshot, but it could be inefficient for fully recording all the monitoring
results.  For the purpose, two trace points, namely <code class="docutils literal notranslate"><span class="pre">damon:damon_aggregated</span></code>
and <code class="docutils literal notranslate"><span class="pre">damon:damos_before_apply</span></code>, are provided.  <code class="docutils literal notranslate"><span class="pre">damon:damon_aggregated</span></code>
provides the whole monitoring results, while <code class="docutils literal notranslate"><span class="pre">damon:damos_before_apply</span></code>
provides the monitoring results for regions that each DAMON-based Operation
Scheme (<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">DAMOS</span></a>) is gonna be applied.  Hence,
<code class="docutils literal notranslate"><span class="pre">damon:damos_before_apply</span></code> is more useful for recording internal behavior of
DAMOS, or DAMOS target access
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-access-pattern"><span class="std std-ref">pattern</span></a> based query-like efficient
monitoring results recording.</p>
<p>While the monitoring is turned on, you could record the tracepoint events and
show results using tracepoint supporting tools like <code class="docutils literal notranslate"><span class="pre">perf</span></code>.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo on &gt; kdamonds/0/state
# perf record -e damon:damon_aggregated &amp;
# sleep 5
# kill 9 $(pidof perf)
# echo off &gt; kdamonds/0/state
# perf script
kdamond.0 46568 [027] 79357.842179: damon:damon_aggregated: target_id=0 nr_regions=11 122509119488-135708762112: 0 864
[...]
</pre></div>
</div>
<p>Each line of the perf script output represents each monitoring region.  The
first five fields are as usual other tracepoint outputs.  The sixth field
(<code class="docutils literal notranslate"><span class="pre">target_id=X</span></code>) shows the ide of the monitoring target of the region.  The
seventh field (<code class="docutils literal notranslate"><span class="pre">nr_regions=X</span></code>) shows the total number of monitoring regions
for the target.  The eighth field (<code class="docutils literal notranslate"><span class="pre">X-Y:</span></code>) shows the start (<code class="docutils literal notranslate"><span class="pre">X</span></code>) and end
(<code class="docutils literal notranslate"><span class="pre">Y</span></code>) addresses of the region in bytes.  The ninth field (<code class="docutils literal notranslate"><span class="pre">X</span></code>) shows the
<code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code> of the region (refer to
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-region-based-sampling"><span class="std std-ref">design</span></a> for more details of the
counter).  Finally the tenth field (<code class="docutils literal notranslate"><span class="pre">X</span></code>) shows the <code class="docutils literal notranslate"><span class="pre">age</span></code> of the region
(refer to <a class="reference internal" href="../../../mm/damon/design.html#damon-design-age-tracking"><span class="std std-ref">design</span></a> for more details of the
counter).</p>
<p>If the event was <code class="docutils literal notranslate"><span class="pre">damon:damos_beofre_apply</span></code>, the <code class="docutils literal notranslate"><span class="pre">perf</span> <span class="pre">script</span></code> output would
be somewhat like below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>kdamond.0 47293 [000] 80801.060214: damon:damos_before_apply: ctx_idx=0 scheme_idx=0 target_idx=0 nr_regions=11 121932607488-135128711168: 0 136
[...]
</pre></div>
</div>
<p>Each line of the output represents each monitoring region that each DAMON-based
Operation Scheme was about to be applied at the traced time.  The first five
fields are as usual.  It shows the index of the DAMON context (<code class="docutils literal notranslate"><span class="pre">ctx_idx=X</span></code>)
of the scheme in the list of the contexts of the context’s kdamond, the index
of the scheme (<code class="docutils literal notranslate"><span class="pre">scheme_idx=X</span></code>) in the list of the schemes of the context, in
addition to the output of <code class="docutils literal notranslate"><span class="pre">damon_aggregated</span></code> tracepoint.</p>
</section>
<section id="debugfs-interface-deprecated">
<span id="debugfs-interface"></span><h2>debugfs Interface (DEPRECATED!)<a class="headerlink" href="#debugfs-interface-deprecated" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>THIS IS DEPRECATED!</p>
<p>DAMON debugfs interface is deprecated, so users should move to the
<a class="reference internal" href="#sysfs-interface"><span class="std std-ref">sysfs interface</span></a>.  If you depend on this and cannot
move, please report your usecase to <a class="reference external" href="mailto:damon&#37;&#52;&#48;lists&#46;linux&#46;dev">damon<span>&#64;</span>lists<span>&#46;</span>linux<span>&#46;</span>dev</a> and
<a class="reference external" href="mailto:linux-mm&#37;&#52;&#48;kvack&#46;org">linux-mm<span>&#64;</span>kvack<span>&#46;</span>org</a>.</p>
</div>
<p>DAMON exports nine files, <code class="docutils literal notranslate"><span class="pre">DEPRECATED</span></code>, <code class="docutils literal notranslate"><span class="pre">attrs</span></code>, <code class="docutils literal notranslate"><span class="pre">target_ids</span></code>,
<code class="docutils literal notranslate"><span class="pre">init_regions</span></code>, <code class="docutils literal notranslate"><span class="pre">schemes</span></code>, <code class="docutils literal notranslate"><span class="pre">monitor_on_DEPRECATED</span></code>, <code class="docutils literal notranslate"><span class="pre">kdamond_pid</span></code>,
<code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> and <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> under its debugfs directory,
<code class="docutils literal notranslate"><span class="pre">&lt;debugfs&gt;/damon/</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">DEPRECATED</span></code> is a read-only file for the DAMON debugfs interface deprecation
notice.  Reading it returns the deprecation notice, as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cat DEPRECATED
DAMON debugfs interface is deprecated, so users should move to DAMON_SYSFS. If you cannot, please report your usecase to damon@lists.linux.dev and linux-mm@kvack.org.
</pre></div>
</div>
<section id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Link to this heading">¶</a></h3>
<p>Users can get and set the <code class="docutils literal notranslate"><span class="pre">sampling</span> <span class="pre">interval</span></code>, <code class="docutils literal notranslate"><span class="pre">aggregation</span> <span class="pre">interval</span></code>,
<code class="docutils literal notranslate"><span class="pre">update</span> <span class="pre">interval</span></code>, and min/max number of monitoring target regions by
reading from and writing to the <code class="docutils literal notranslate"><span class="pre">attrs</span></code> file.  To know about the monitoring
attributes in detail, please refer to the <a class="reference internal" href="../../../mm/damon/design.html"><span class="doc">Design</span></a>.  For
example, below commands set those values to 5 ms, 100 ms, 1,000 ms, 10 and
1000, and then check it again:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo 5000 100000 1000000 10 1000 &gt; attrs
# cat attrs
5000 100000 1000000 10 1000
</pre></div>
</div>
</section>
<section id="target-ids">
<h3>Target IDs<a class="headerlink" href="#target-ids" title="Link to this heading">¶</a></h3>
<p>Some types of address spaces supports multiple monitoring target.  For example,
the virtual memory address spaces monitoring can have multiple processes as the
monitoring targets.  Users can set the targets by writing relevant id values of
the targets to, and get the ids of the current targets by reading from the
<code class="docutils literal notranslate"><span class="pre">target_ids</span></code> file.  In case of the virtual address spaces monitoring, the
values should be pids of the monitoring target processes.  For example, below
commands set processes having pids 42 and 4242 as the monitoring targets and
check it again:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo 42 4242 &gt; target_ids
# cat target_ids
42 4242
</pre></div>
</div>
<p>Users can also monitor the physical memory address space of the system by
writing a special keyword, “<code class="docutils literal notranslate"><span class="pre">paddr\n</span></code>” to the file.  Because physical address
space monitoring doesn’t support multiple targets, reading the file will show a
fake value, <code class="docutils literal notranslate"><span class="pre">42</span></code>, as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo paddr &gt; target_ids
# cat target_ids
42
</pre></div>
</div>
<p>Note that setting the target ids doesn’t start the monitoring.</p>
</section>
<section id="initial-monitoring-target-regions">
<h3>Initial Monitoring Target Regions<a class="headerlink" href="#initial-monitoring-target-regions" title="Link to this heading">¶</a></h3>
<p>In case of the virtual address space monitoring, DAMON automatically sets and
updates the monitoring target regions so that entire memory mappings of target
processes can be covered.  However, users can want to limit the monitoring
region to specific address ranges, such as the heap, the stack, or specific
file-mapped area.  Or, some users can know the initial access pattern of their
workloads and therefore want to set optimal initial regions for the ‘adaptive
regions adjustment’.</p>
<p>In contrast, DAMON do not automatically sets and updates the monitoring target
regions in case of physical memory monitoring.  Therefore, users should set the
monitoring target regions by themselves.</p>
<p>In such cases, users can explicitly set the initial monitoring target regions
as they want, by writing proper values to the <code class="docutils literal notranslate"><span class="pre">init_regions</span></code> file.  The input
should be a sequence of three integers separated by white spaces that represent
one region in below form.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;target idx&gt; &lt;start address&gt; &lt;end address&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">target</span> <span class="pre">idx</span></code> should be the index of the target in <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> file,
starting from <code class="docutils literal notranslate"><span class="pre">0</span></code>, and the regions should be passed in address order.  For
example, below commands will set a couple of address ranges, <code class="docutils literal notranslate"><span class="pre">1-100</span></code> and
<code class="docutils literal notranslate"><span class="pre">100-200</span></code> as the initial monitoring target region of pid 42, which is the
first one (index <code class="docutils literal notranslate"><span class="pre">0</span></code>) in <code class="docutils literal notranslate"><span class="pre">target_ids</span></code>, and another couple of address
ranges, <code class="docutils literal notranslate"><span class="pre">20-40</span></code> and <code class="docutils literal notranslate"><span class="pre">50-100</span></code> as that of pid 4242, which is the second one
(index <code class="docutils literal notranslate"><span class="pre">1</span></code>) in <code class="docutils literal notranslate"><span class="pre">target_ids</span></code>.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# cat target_ids
42 4242
# echo &quot;0   1       100 \
        0   100     200 \
        1   20      40  \
        1   50      100&quot; &gt; init_regions
</pre></div>
</div>
<p>Note that this sets the initial monitoring target regions only.  In case of
virtual memory monitoring, DAMON will automatically updates the boundary of the
regions after one <code class="docutils literal notranslate"><span class="pre">update</span> <span class="pre">interval</span></code>.  Therefore, users should set the
<code class="docutils literal notranslate"><span class="pre">update</span> <span class="pre">interval</span></code> large enough in this case, if they don’t want the
update.</p>
</section>
<section id="schemes">
<h3>Schemes<a class="headerlink" href="#schemes" title="Link to this heading">¶</a></h3>
<p>Users can get and set the DAMON-based operation <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">schemes</span></a> by reading from and writing to <code class="docutils literal notranslate"><span class="pre">schemes</span></code> debugfs file.
Reading the file also shows the statistics of each scheme.  To the file, each
of the schemes should be represented in each line in below form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;target access pattern&gt; &lt;action&gt; &lt;quota&gt; &lt;watermarks&gt;
</pre></div>
</div>
<p>You can disable schemes by simply writing an empty string to the file.</p>
<section id="target-access-pattern">
<h4>Target Access Pattern<a class="headerlink" href="#target-access-pattern" title="Link to this heading">¶</a></h4>
<p>The target access <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-access-pattern"><span class="std std-ref">pattern</span></a> of the
scheme.  The <code class="docutils literal notranslate"><span class="pre">&lt;target</span> <span class="pre">access</span> <span class="pre">pattern&gt;</span></code> is constructed with three ranges in
below form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>min-size max-size min-acc max-acc min-age max-age
</pre></div>
</div>
<p>Specifically, bytes for the size of regions (<code class="docutils literal notranslate"><span class="pre">min-size</span></code> and <code class="docutils literal notranslate"><span class="pre">max-size</span></code>),
number of monitored accesses per aggregate interval for access frequency
(<code class="docutils literal notranslate"><span class="pre">min-acc</span></code> and <code class="docutils literal notranslate"><span class="pre">max-acc</span></code>), number of aggregate intervals for the age of
regions (<code class="docutils literal notranslate"><span class="pre">min-age</span></code> and <code class="docutils literal notranslate"><span class="pre">max-age</span></code>) are specified.  Note that the ranges are
closed interval.</p>
</section>
<section id="action">
<h4>Action<a class="headerlink" href="#action" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;action&gt;</span></code> is a predefined integer for memory management <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-action"><span class="std std-ref">actions</span></a>.  The mapping between the <code class="docutils literal notranslate"><span class="pre">&lt;action&gt;</span></code> values and
the memory management actions is as below.  For the detailed meaning of the
action and DAMON operations set supporting each action, please refer to the
list on <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-action"><span class="std std-ref">design doc</span></a>.</p>
<blockquote>
<div><ul class="simple">
<li><p>0: <code class="docutils literal notranslate"><span class="pre">willneed</span></code></p></li>
<li><p>1: <code class="docutils literal notranslate"><span class="pre">cold</span></code></p></li>
<li><p>2: <code class="docutils literal notranslate"><span class="pre">pageout</span></code></p></li>
<li><p>3: <code class="docutils literal notranslate"><span class="pre">hugepage</span></code></p></li>
<li><p>4: <code class="docutils literal notranslate"><span class="pre">nohugepage</span></code></p></li>
<li><p>5: <code class="docutils literal notranslate"><span class="pre">stat</span></code></p></li>
</ul>
</div></blockquote>
</section>
<section id="quota">
<h4>Quota<a class="headerlink" href="#quota" title="Link to this heading">¶</a></h4>
<p>Users can set the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas"><span class="std std-ref">quotas</span></a> of the given scheme
via the <code class="docutils literal notranslate"><span class="pre">&lt;quota&gt;</span></code> in below form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;ms&gt; &lt;sz&gt; &lt;reset interval&gt; &lt;priority weights&gt;
</pre></div>
</div>
<p>This makes DAMON to try to use only up to <code class="docutils literal notranslate"><span class="pre">&lt;ms&gt;</span></code> milliseconds for applying
the action to memory regions of the <code class="docutils literal notranslate"><span class="pre">target</span> <span class="pre">access</span> <span class="pre">pattern</span></code> within the
<code class="docutils literal notranslate"><span class="pre">&lt;reset</span> <span class="pre">interval&gt;</span></code> milliseconds, and to apply the action to only up to
<code class="docutils literal notranslate"><span class="pre">&lt;sz&gt;</span></code> bytes of memory regions within the <code class="docutils literal notranslate"><span class="pre">&lt;reset</span> <span class="pre">interval&gt;</span></code>.  Setting both
<code class="docutils literal notranslate"><span class="pre">&lt;ms&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;sz&gt;</span></code> zero disables the quota limits.</p>
<p>For the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas-prioritization"><span class="std std-ref">prioritization</span></a>, users
can set the weights for the three properties in <code class="docutils literal notranslate"><span class="pre">&lt;priority</span> <span class="pre">weights&gt;</span></code> in below
form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;size weight&gt; &lt;access frequency weight&gt; &lt;age weight&gt;
</pre></div>
</div>
</section>
<section id="watermarks">
<h4>Watermarks<a class="headerlink" href="#watermarks" title="Link to this heading">¶</a></h4>
<p>Users can specify <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-watermarks"><span class="std std-ref">watermarks</span></a> of the
given scheme via <code class="docutils literal notranslate"><span class="pre">&lt;watermarks&gt;</span></code> in below form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;metric&gt; &lt;check interval&gt; &lt;high mark&gt; &lt;middle mark&gt; &lt;low mark&gt;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;metric&gt;</span></code> is a predefined integer for the metric to be checked.  The
supported numbers and their meanings are as below.</p>
<blockquote>
<div><ul class="simple">
<li><p>0: Ignore the watermarks</p></li>
<li><p>1: System’s free memory rate (per thousand)</p></li>
</ul>
</div></blockquote>
<p>The value of the metric is checked every <code class="docutils literal notranslate"><span class="pre">&lt;check</span> <span class="pre">interval&gt;</span></code> microseconds.</p>
<p>If the value is higher than <code class="docutils literal notranslate"><span class="pre">&lt;high</span> <span class="pre">mark&gt;</span></code> or lower than <code class="docutils literal notranslate"><span class="pre">&lt;low</span> <span class="pre">mark&gt;</span></code>, the
scheme is deactivated.  If the value is lower than <code class="docutils literal notranslate"><span class="pre">&lt;mid</span> <span class="pre">mark&gt;</span></code>, the scheme
is activated.</p>
</section>
<section id="statistics">
<span id="damos-stats"></span><h4>Statistics<a class="headerlink" href="#statistics" title="Link to this heading">¶</a></h4>
<p>It also counts the total number and bytes of regions that each scheme is tried
to be applied, the two numbers for the regions that each scheme is successfully
applied, and the total number of the quota limit exceeds.  This statistics can
be used for online analysis or tuning of the schemes.</p>
<p>The statistics can be shown by reading the <code class="docutils literal notranslate"><span class="pre">schemes</span></code> file.  Reading the file
will show each scheme you entered in each line, and the five numbers for the
statistics will be added at the end of each line.</p>
</section>
<section id="id2">
<h4>Example<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<p>Below commands applies a scheme saying “If a memory region of size in [4KiB,
8KiB] is showing accesses per aggregate interval in [0, 5] for aggregate
interval in [10, 20], page out the region.  For the paging out, use only up to
10ms per second, and also don’t page out more than 1GiB per second.  Under the
limitation, page out memory regions having longer age first.  Also, check the
free memory rate of the system every 5 seconds, start the monitoring and paging
out when the free memory rate becomes lower than 50%, but stop it if the free
memory rate becomes larger than 60%, or lower than 30%”.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# scheme=&quot;4096 8192  0 5    10 20    2&quot;  # target access pattern and action
# scheme+=&quot; 10 $((1024*1024*1024)) 1000&quot; # quotas
# scheme+=&quot; 0 0 100&quot;                     # prioritization weights
# scheme+=&quot; 1 5000000 600 500 300&quot;       # watermarks
# echo &quot;$scheme&quot; &gt; schemes
</pre></div>
</div>
</section>
</section>
<section id="turning-on-off">
<h3>Turning On/Off<a class="headerlink" href="#turning-on-off" title="Link to this heading">¶</a></h3>
<p>Setting the files as described above doesn’t incur effect unless you explicitly
start the monitoring.  You can start, stop, and check the current status of the
monitoring by writing to and reading from the <code class="docutils literal notranslate"><span class="pre">monitor_on_DEPRECATED</span></code> file.
Writing <code class="docutils literal notranslate"><span class="pre">on</span></code> to the file starts the monitoring of the targets with the
attributes.  Writing <code class="docutils literal notranslate"><span class="pre">off</span></code> to the file stops those.  DAMON also stops if
every target process is terminated.  Below example commands turn on, off, and
check the status of DAMON:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo on &gt; monitor_on_DEPRECATED
# echo off &gt; monitor_on_DEPRECATED
# cat monitor_on_DEPRECATED
off
</pre></div>
</div>
<p>Please note that you cannot write to the above-mentioned debugfs files while
the monitoring is turned on.  If you write to the files while DAMON is running,
an error code such as <code class="docutils literal notranslate"><span class="pre">-EBUSY</span></code> will be returned.</p>
</section>
<section id="monitoring-thread-pid">
<h3>Monitoring Thread PID<a class="headerlink" href="#monitoring-thread-pid" title="Link to this heading">¶</a></h3>
<p>DAMON does requested monitoring with a kernel thread called <code class="docutils literal notranslate"><span class="pre">kdamond</span></code>.  You
can get the pid of the thread by reading the <code class="docutils literal notranslate"><span class="pre">kdamond_pid</span></code> file.  When the
monitoring is turned off, reading the file returns <code class="docutils literal notranslate"><span class="pre">none</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# cat monitor_on_DEPRECATED
off
# cat kdamond_pid
none
# echo on &gt; monitor_on_DEPRECATED
# cat kdamond_pid
18594
</pre></div>
</div>
</section>
<section id="using-multiple-monitoring-threads">
<h3>Using Multiple Monitoring Threads<a class="headerlink" href="#using-multiple-monitoring-threads" title="Link to this heading">¶</a></h3>
<p>One <code class="docutils literal notranslate"><span class="pre">kdamond</span></code> thread is created for each monitoring context.  You can create
and remove monitoring contexts for multiple <code class="docutils literal notranslate"><span class="pre">kdamond</span></code> required use case using
the <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> and <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> files.</p>
<p>Writing the name of the new context to the <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> file creates a
directory of the name on the DAMON debugfs directory.  The directory will have
DAMON debugfs files for the context.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# ls foo
# ls: cannot access &#39;foo&#39;: No such file or directory
# echo foo &gt; mk_contexts
# ls foo
# attrs  init_regions  kdamond_pid  schemes  target_ids
</pre></div>
</div>
<p>If the context is not needed anymore, you can remove it and the corresponding
directory by putting the name of the context to the <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo foo &gt; rm_contexts
# ls foo
# ls: cannot access &#39;foo&#39;: No such file or directory
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code>, <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code>, and <code class="docutils literal notranslate"><span class="pre">monitor_on_DEPRECATED</span></code> files
are in the root directory only.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/admin-guide/mm/damon/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>