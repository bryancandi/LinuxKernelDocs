<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Detailed Usages &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="DAMON-based Reclamation" href="reclaim.html" />
    <link rel="prev" title="Getting Started" href="start.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.14.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#general-guides-to-kernel-administration">General guides to kernel administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#booting-the-kernel">Booting the kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#tracking-down-and-identifying-problems">Tracking down and identifying problems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#core-kernel-subsystems">Core-kernel subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cpu-load.html">CPU load</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Memory Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../namespaces/index.html">Namespaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../pm/index.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../syscall-user-dispatch.html">Syscall User Dispatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#block-layer-and-filesystem-administration">Block-layer and filesystem administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#device-specific-guides">Device-specific guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#workload-analysis">Workload analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#everything-else">Everything else</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/admin-guide/mm/damon/usage.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->



<div class="language-selection">
English

<ul>

<li><a href="../../../translations/zh_CN/admin-guide/mm/damon/usage.html">Chinese (Simplified)</a></li>

<li><a href="../../../translations/zh_TW/admin-guide/mm/damon/usage.html">Chinese (Traditional)</a></li>

</ul>
</div>
<section id="detailed-usages">
<h1>Detailed Usages<a class="headerlink" href="#detailed-usages" title="Link to this heading">¶</a></h1>
<p>DAMON provides below interfaces for different users.</p>
<ul class="simple">
<li><p><em>DAMON user space tool.</em>
<a class="reference external" href="https://github.com/damonitor/damo">This</a> is for privileged people such as
system administrators who want a just-working human-friendly interface.
Using this, users can use the DAMON’s major features in a human-friendly way.
It may not be highly tuned for special cases, though.  For more detail,
please refer to its <a class="reference external" href="https://github.com/damonitor/damo/blob/next/USAGE.md">usage document</a>.</p></li>
<li><p><em>sysfs interface.</em>
<a class="reference internal" href="#sysfs-interface"><span class="std std-ref">This</span></a> is for privileged user space programmers who
want more optimized use of DAMON.  Using this, users can use DAMON’s major
features by reading from and writing to special sysfs files.  Therefore,
you can write and use your personalized DAMON sysfs wrapper programs that
reads/writes the sysfs files instead of you.  The <a class="reference external" href="https://github.com/damonitor/damo">DAMON user space tool</a> is one example of such programs.</p></li>
<li><p><em>Kernel Space Programming Interface.</em>
<a class="reference internal" href="../../../mm/damon/api.html"><span class="doc">This</span></a> is for kernel space programmers.  Using this,
users can utilize every feature of DAMON most flexibly and efficiently by
writing kernel space DAMON application programs for you.  You can even extend
DAMON for various address spaces.  For detail, please refer to the interface
<a class="reference internal" href="../../../mm/damon/api.html"><span class="doc">document</span></a>.</p></li>
</ul>
<section id="sysfs-interface">
<span id="id1"></span><h2>sysfs Interface<a class="headerlink" href="#sysfs-interface" title="Link to this heading">¶</a></h2>
<p>DAMON sysfs interface is built when <code class="docutils literal notranslate"><span class="pre">CONFIG_DAMON_SYSFS</span></code> is defined.  It
creates multiple directories and files under its sysfs directory,
<code class="docutils literal notranslate"><span class="pre">&lt;sysfs&gt;/kernel/mm/damon/</span></code>.  You can control DAMON by writing to and reading
from the files under the directory.</p>
<p>For a short example, users can monitor the virtual address space of a given
workload as below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /sys/kernel/mm/damon/admin/
# echo 1 &gt; kdamonds/nr_kdamonds &amp;&amp; echo 1 &gt; kdamonds/0/contexts/nr_contexts
# echo vaddr &gt; kdamonds/0/contexts/0/operations
# echo 1 &gt; kdamonds/0/contexts/0/targets/nr_targets
# echo $(pidof &lt;workload&gt;) &gt; kdamonds/0/contexts/0/targets/0/pid_target
# echo on &gt; kdamonds/0/state
</pre></div>
</div>
<section id="files-hierarchy">
<h3>Files Hierarchy<a class="headerlink" href="#files-hierarchy" title="Link to this heading">¶</a></h3>
<p>The files hierarchy of DAMON sysfs interface is shown below.  In the below
figure, parents-children relations are represented with indentations, each
directory is having <code class="docutils literal notranslate"><span class="pre">/</span></code> suffix, and files in each directory are separated by
comma (“,”).</p>
<pre class="literal-block"><a class="reference internal" href="#sysfs-root"><span class="std std-ref">/sys/kernel/mm/damon</span></a>/admin
│ <a class="reference internal" href="#sysfs-kdamonds"><span class="std std-ref">kdamonds</span></a>/nr_kdamonds
│ │ <a class="reference internal" href="#sysfs-kdamond"><span class="std std-ref">0</span></a>/state,pid
│ │ │ <a class="reference internal" href="#sysfs-contexts"><span class="std std-ref">contexts</span></a>/nr_contexts
│ │ │ │ <a class="reference internal" href="#sysfs-context"><span class="std std-ref">0</span></a>/avail_operations,operations
│ │ │ │ │ <a class="reference internal" href="#sysfs-monitoring-attrs"><span class="std std-ref">monitoring_attrs</span></a>/
│ │ │ │ │ │ intervals/sample_us,aggr_us,update_us
│ │ │ │ │ │ nr_regions/min,max
│ │ │ │ │ <a class="reference internal" href="#sysfs-targets"><span class="std std-ref">targets</span></a>/nr_targets
│ │ │ │ │ │ <a class="reference internal" href="#sysfs-target"><span class="std std-ref">0</span></a>/pid_target
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-regions"><span class="std std-ref">regions</span></a>/nr_regions
│ │ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-region"><span class="std std-ref">0</span></a>/start,end
│ │ │ │ │ │ │ │ ...
│ │ │ │ │ │ ...
│ │ │ │ │ <a class="reference internal" href="#sysfs-schemes"><span class="std std-ref">schemes</span></a>/nr_schemes
│ │ │ │ │ │ <a class="reference internal" href="#sysfs-scheme"><span class="std std-ref">0</span></a>/action,target_nid,apply_interval_us
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-access-pattern"><span class="std std-ref">access_pattern</span></a>/
│ │ │ │ │ │ │ │ sz/min,max
│ │ │ │ │ │ │ │ nr_accesses/min,max
│ │ │ │ │ │ │ │ age/min,max
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-quotas"><span class="std std-ref">quotas</span></a>/ms,bytes,reset_interval_ms,effective_bytes
│ │ │ │ │ │ │ │ weights/sz_permil,nr_accesses_permil,age_permil
│ │ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-schemes-quota-goals"><span class="std std-ref">goals</span></a>/nr_goals
│ │ │ │ │ │ │ │ │ 0/target_metric,target_value,current_value
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-watermarks"><span class="std std-ref">watermarks</span></a>/metric,interval_us,high,mid,low
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-filters"><span class="std std-ref">filters</span></a>/nr_filters
│ │ │ │ │ │ │ │ 0/type,matching,allow,memcg_path,addr_start,addr_end,target_idx
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-schemes-stats"><span class="std std-ref">stats</span></a>/nr_tried,sz_tried,nr_applied,sz_applied,sz_ops_filter_passed,qt_exceeds
│ │ │ │ │ │ │ <a class="reference internal" href="#sysfs-schemes-tried-regions"><span class="std std-ref">tried_regions</span></a>/total_bytes
│ │ │ │ │ │ │ │ 0/start,end,nr_accesses,age,sz_filter_passed
│ │ │ │ │ │ │ │ ...
│ │ │ │ │ │ ...
│ │ │ │ ...
│ │ ...</pre>
</section>
<section id="root">
<span id="sysfs-root"></span><h3>Root<a class="headerlink" href="#root" title="Link to this heading">¶</a></h3>
<p>The root of the DAMON sysfs interface is <code class="docutils literal notranslate"><span class="pre">&lt;sysfs&gt;/kernel/mm/damon/</span></code>, and it
has one directory named <code class="docutils literal notranslate"><span class="pre">admin</span></code>.  The directory contains the files for
privileged user space programs’ control of DAMON.  User space tools or daemons
having the root permission could use this directory.</p>
</section>
<section id="kdamonds">
<span id="sysfs-kdamonds"></span><h3>kdamonds/<a class="headerlink" href="#kdamonds" title="Link to this heading">¶</a></h3>
<p>Under the <code class="docutils literal notranslate"><span class="pre">admin</span></code> directory, one directory, <code class="docutils literal notranslate"><span class="pre">kdamonds</span></code>, which has files for
controlling the kdamonds (refer to
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-execution-model-and-data-structures"><span class="std std-ref">design</span></a> for more
details) exists.  In the beginning, this directory has only one file,
<code class="docutils literal notranslate"><span class="pre">nr_kdamonds</span></code>.  Writing a number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of
child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each
kdamond.</p>
</section>
<section id="kdamonds-n">
<span id="sysfs-kdamond"></span><h3>kdamonds/&lt;N&gt;/<a class="headerlink" href="#kdamonds-n" title="Link to this heading">¶</a></h3>
<p>In each kdamond directory, two files (<code class="docutils literal notranslate"><span class="pre">state</span></code> and <code class="docutils literal notranslate"><span class="pre">pid</span></code>) and one directory
(<code class="docutils literal notranslate"><span class="pre">contexts</span></code>) exist.</p>
<p>Reading <code class="docutils literal notranslate"><span class="pre">state</span></code> returns <code class="docutils literal notranslate"><span class="pre">on</span></code> if the kdamond is currently running, or
<code class="docutils literal notranslate"><span class="pre">off</span></code> if it is not running.</p>
<p>Users can write below commands for the kdamond to the <code class="docutils literal notranslate"><span class="pre">state</span></code> file.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code>: Start running.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">off</span></code>: Stop running.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">commit</span></code>: Read the user inputs in the sysfs files except <code class="docutils literal notranslate"><span class="pre">state</span></code> file
again.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">commit_schemes_quota_goals</span></code>: Read the DAMON-based operation schemes’
<a class="reference internal" href="#sysfs-schemes-quota-goals"><span class="std std-ref">quota goals</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_schemes_stats</span></code>: Update the contents of stats files for each
DAMON-based operation scheme of the kdamond.  For details of the stats,
please refer to <a class="reference internal" href="#sysfs-schemes-stats"><span class="std std-ref">stats section</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_schemes_tried_regions</span></code>: Update the DAMON-based operation scheme
action tried regions directory for each DAMON-based operation scheme of the
kdamond.  For details of the DAMON-based operation scheme action tried
regions directory, please refer to
<a class="reference internal" href="#sysfs-schemes-tried-regions"><span class="std std-ref">tried_regions section</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_schemes_tried_bytes</span></code>: Update only <code class="docutils literal notranslate"><span class="pre">.../tried_regions/total_bytes</span></code>
files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clear_schemes_tried_regions</span></code>: Clear the DAMON-based operating scheme
action tried regions directory for each DAMON-based operation scheme of the
kdamond.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_schemes_effective_quotas</span></code>: Update the contents of
<code class="docutils literal notranslate"><span class="pre">effective_bytes</span></code> files for each DAMON-based operation scheme of the
kdamond.  For more details, refer to <a class="reference internal" href="#sysfs-quotas"><span class="std std-ref">quotas directory</span></a>.</p></li>
</ul>
<p>If the state is <code class="docutils literal notranslate"><span class="pre">on</span></code>, reading <code class="docutils literal notranslate"><span class="pre">pid</span></code> shows the pid of the kdamond thread.</p>
<p><code class="docutils literal notranslate"><span class="pre">contexts</span></code> directory contains files for controlling the monitoring contexts
that this kdamond will execute.</p>
</section>
<section id="kdamonds-n-contexts">
<span id="sysfs-contexts"></span><h3>kdamonds/&lt;N&gt;/contexts/<a class="headerlink" href="#kdamonds-n-contexts" title="Link to this heading">¶</a></h3>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_contexts</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named as
<code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each monitoring context (refer to
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-execution-model-and-data-structures"><span class="std std-ref">design</span></a> for more
details).  At the moment, only one context per kdamond is supported, so only
<code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> can be written to the file.</p>
</section>
<section id="contexts-n">
<span id="sysfs-context"></span><h3>contexts/&lt;N&gt;/<a class="headerlink" href="#contexts-n" title="Link to this heading">¶</a></h3>
<p>In each context directory, two files (<code class="docutils literal notranslate"><span class="pre">avail_operations</span></code> and <code class="docutils literal notranslate"><span class="pre">operations</span></code>)
and three directories (<code class="docutils literal notranslate"><span class="pre">monitoring_attrs</span></code>, <code class="docutils literal notranslate"><span class="pre">targets</span></code>, and <code class="docutils literal notranslate"><span class="pre">schemes</span></code>)
exist.</p>
<p>DAMON supports multiple types of <a class="reference internal" href="../../../mm/damon/design.html#damon-design-configurable-operations-set"><span class="std std-ref">monitoring operations</span></a>, including those for virtual address
space and the physical address space.  You can get the list of available
monitoring operations set on the currently running kernel by reading
<code class="docutils literal notranslate"><span class="pre">avail_operations</span></code> file.  Based on the kernel configuration, the file will
list different available operation sets.  Please refer to the <a class="reference internal" href="../../../mm/damon/design.html#damon-operations-set"><span class="std std-ref">design</span></a> for the list of all available operation sets and their
brief explanations.</p>
<p>You can set and get what type of monitoring operations DAMON will use for the
context by writing one of the keywords listed in <code class="docutils literal notranslate"><span class="pre">avail_operations</span></code> file and
reading from the <code class="docutils literal notranslate"><span class="pre">operations</span></code> file.</p>
</section>
<section id="contexts-n-monitoring-attrs">
<span id="sysfs-monitoring-attrs"></span><h3>contexts/&lt;N&gt;/monitoring_attrs/<a class="headerlink" href="#contexts-n-monitoring-attrs" title="Link to this heading">¶</a></h3>
<p>Files for specifying attributes of the monitoring including required quality
and efficiency of the monitoring are in <code class="docutils literal notranslate"><span class="pre">monitoring_attrs</span></code> directory.
Specifically, two directories, <code class="docutils literal notranslate"><span class="pre">intervals</span></code> and <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code> exist in this
directory.</p>
<p>Under <code class="docutils literal notranslate"><span class="pre">intervals</span></code> directory, three files for DAMON’s sampling interval
(<code class="docutils literal notranslate"><span class="pre">sample_us</span></code>), aggregation interval (<code class="docutils literal notranslate"><span class="pre">aggr_us</span></code>), and update interval
(<code class="docutils literal notranslate"><span class="pre">update_us</span></code>) exist.  You can set and get the values in micro-seconds by
writing to and reading from the files.</p>
<p>Under <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code> directory, two files for the lower-bound and upper-bound
of DAMON’s monitoring regions (<code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code>, respectively), which
controls the monitoring overhead, exist.  You can set and get the values by
writing to and rading from the files.</p>
<p>For more details about the intervals and monitoring regions range, please refer
to the Design document (<a class="reference internal" href="../../../mm/damon/design.html"><span class="doc">Design</span></a>).</p>
</section>
<section id="contexts-n-targets">
<span id="sysfs-targets"></span><h3>contexts/&lt;N&gt;/targets/<a class="headerlink" href="#contexts-n-targets" title="Link to this heading">¶</a></h3>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_targets</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each monitoring target.</p>
</section>
<section id="targets-n">
<span id="sysfs-target"></span><h3>targets/&lt;N&gt;/<a class="headerlink" href="#targets-n" title="Link to this heading">¶</a></h3>
<p>In each target directory, one file (<code class="docutils literal notranslate"><span class="pre">pid_target</span></code>) and one directory
(<code class="docutils literal notranslate"><span class="pre">regions</span></code>) exist.</p>
<p>If you wrote <code class="docutils literal notranslate"><span class="pre">vaddr</span></code> to the <code class="docutils literal notranslate"><span class="pre">contexts/&lt;N&gt;/operations</span></code>, each target should
be a process.  You can specify the process to DAMON by writing the pid of the
process to the <code class="docutils literal notranslate"><span class="pre">pid_target</span></code> file.</p>
</section>
<section id="targets-n-regions">
<span id="sysfs-regions"></span><h3>targets/&lt;N&gt;/regions<a class="headerlink" href="#targets-n-regions" title="Link to this heading">¶</a></h3>
<p>In case of <code class="docutils literal notranslate"><span class="pre">fvaddr</span></code> or <code class="docutils literal notranslate"><span class="pre">paddr</span></code> monitoring operations sets, users are
required to set the monitoring target address ranges.  In case of <code class="docutils literal notranslate"><span class="pre">vaddr</span></code>
operations set, it is not mandatory, but users can optionally set the initial
monitoring region to specific address ranges.  Please refer to the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-vaddr-target-regions-construction"><span class="std std-ref">design</span></a> for more details.</p>
<p>For such cases, users can explicitly set the initial monitoring target regions
as they want, by writing proper values to the files under this directory.</p>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each initial monitoring target region.</p>
</section>
<section id="regions-n">
<span id="sysfs-region"></span><h3>regions/&lt;N&gt;/<a class="headerlink" href="#regions-n" title="Link to this heading">¶</a></h3>
<p>In each region directory, you will find two files (<code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code>).  You
can set and get the start and end addresses of the initial monitoring target
region by writing to and reading from the files, respectively.</p>
<p>Each region should not overlap with others.  <code class="docutils literal notranslate"><span class="pre">end</span></code> of directory <code class="docutils literal notranslate"><span class="pre">N</span></code> should
be equal or smaller than <code class="docutils literal notranslate"><span class="pre">start</span></code> of directory <code class="docutils literal notranslate"><span class="pre">N+1</span></code>.</p>
</section>
<section id="contexts-n-schemes">
<span id="sysfs-schemes"></span><h3>contexts/&lt;N&gt;/schemes/<a class="headerlink" href="#contexts-n-schemes" title="Link to this heading">¶</a></h3>
<p>The directory for DAMON-based Operation Schemes (<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">DAMOS</span></a>).  Users can get and set the schemes by reading from and
writing to files under this directory.</p>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_schemes</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each DAMON-based operation scheme.</p>
</section>
<section id="schemes-n">
<span id="sysfs-scheme"></span><h3>schemes/&lt;N&gt;/<a class="headerlink" href="#schemes-n" title="Link to this heading">¶</a></h3>
<p>In each scheme directory, five directories (<code class="docutils literal notranslate"><span class="pre">access_pattern</span></code>, <code class="docutils literal notranslate"><span class="pre">quotas</span></code>,
<code class="docutils literal notranslate"><span class="pre">watermarks</span></code>, <code class="docutils literal notranslate"><span class="pre">filters</span></code>, <code class="docutils literal notranslate"><span class="pre">stats</span></code>, and <code class="docutils literal notranslate"><span class="pre">tried_regions</span></code>) and three files
(<code class="docutils literal notranslate"><span class="pre">action</span></code>, <code class="docutils literal notranslate"><span class="pre">target_nid</span></code> and <code class="docutils literal notranslate"><span class="pre">apply_interval</span></code>) exist.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">action</span></code> file is for setting and getting the scheme’s <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-action"><span class="std std-ref">action</span></a>.  The keywords that can be written to and read
from the file and their meaning are same to those of the list on
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-action"><span class="std std-ref">design doc</span></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_nid</span></code> file is for setting the migration target node, which is
only meaningful when the <code class="docutils literal notranslate"><span class="pre">action</span></code> is either <code class="docutils literal notranslate"><span class="pre">migrate_hot</span></code> or
<code class="docutils literal notranslate"><span class="pre">migrate_cold</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">apply_interval_us</span></code> file is for setting and getting the scheme’s
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">apply_interval</span></a> in microseconds.</p>
</section>
<section id="schemes-n-access-pattern">
<span id="sysfs-access-pattern"></span><h3>schemes/&lt;N&gt;/access_pattern/<a class="headerlink" href="#schemes-n-access-pattern" title="Link to this heading">¶</a></h3>
<p>The directory for the target access <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-access-pattern"><span class="std std-ref">pattern</span></a> of the given DAMON-based operation scheme.</p>
<p>Under the <code class="docutils literal notranslate"><span class="pre">access_pattern</span></code> directory, three directories (<code class="docutils literal notranslate"><span class="pre">sz</span></code>,
<code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, and <code class="docutils literal notranslate"><span class="pre">age</span></code>) each having two files (<code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code>)
exist.  You can set and get the access pattern for the given scheme by writing
to and reading from the <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> files under <code class="docutils literal notranslate"><span class="pre">sz</span></code>,
<code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, and <code class="docutils literal notranslate"><span class="pre">age</span></code> directories, respectively.  Note that the <code class="docutils literal notranslate"><span class="pre">min</span></code>
and the <code class="docutils literal notranslate"><span class="pre">max</span></code> form a closed interval.</p>
</section>
<section id="schemes-n-quotas">
<span id="sysfs-quotas"></span><h3>schemes/&lt;N&gt;/quotas/<a class="headerlink" href="#schemes-n-quotas" title="Link to this heading">¶</a></h3>
<p>The directory for the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas"><span class="std std-ref">quotas</span></a> of the given
DAMON-based operation scheme.</p>
<p>Under <code class="docutils literal notranslate"><span class="pre">quotas</span></code> directory, four files (<code class="docutils literal notranslate"><span class="pre">ms</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>,
<code class="docutils literal notranslate"><span class="pre">reset_interval_ms</span></code>, <code class="docutils literal notranslate"><span class="pre">effective_bytes</span></code>) and two directores (<code class="docutils literal notranslate"><span class="pre">weights</span></code> and
<code class="docutils literal notranslate"><span class="pre">goals</span></code>) exist.</p>
<p>You can set the <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">quota</span></code> in milliseconds, <code class="docutils literal notranslate"><span class="pre">size</span> <span class="pre">quota</span></code> in bytes, and
<code class="docutils literal notranslate"><span class="pre">reset</span> <span class="pre">interval</span></code> in milliseconds by writing the values to the three files,
respectively.  Then, DAMON tries to use only up to <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">quota</span></code> milliseconds
for applying the <code class="docutils literal notranslate"><span class="pre">action</span></code> to memory regions of the <code class="docutils literal notranslate"><span class="pre">access_pattern</span></code>, and to
apply the action to only up to <code class="docutils literal notranslate"><span class="pre">bytes</span></code> bytes of memory regions within the
<code class="docutils literal notranslate"><span class="pre">reset_interval_ms</span></code>.  Setting both <code class="docutils literal notranslate"><span class="pre">ms</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> zero disables the
quota limits unless at least one <a class="reference internal" href="#sysfs-schemes-quota-goals"><span class="std std-ref">goal</span></a> is
set.</p>
<p>The time quota is internally transformed to a size quota.  Between the
transformed size quota and user-specified size quota, smaller one is applied.
Based on the user-specified <a class="reference internal" href="#sysfs-schemes-quota-goals"><span class="std std-ref">goal</span></a>, the
effective size quota is further adjusted.  Reading <code class="docutils literal notranslate"><span class="pre">effective_bytes</span></code> returns
the current effective size quota.  The file is not updated in real time, so
users should ask DAMON sysfs interface to update the content of the file for
the stats by writing a special keyword, <code class="docutils literal notranslate"><span class="pre">update_schemes_effective_quotas</span></code> to
the relevant <code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> file.</p>
<p>Under <code class="docutils literal notranslate"><span class="pre">weights</span></code> directory, three files (<code class="docutils literal notranslate"><span class="pre">sz_permil</span></code>,
<code class="docutils literal notranslate"><span class="pre">nr_accesses_permil</span></code>, and <code class="docutils literal notranslate"><span class="pre">age_permil</span></code>) exist.
You can set the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas-prioritization"><span class="std std-ref">prioritization weights</span></a> for size, access frequency, and age
in per-thousand unit by writing the values to the three files under the
<code class="docutils literal notranslate"><span class="pre">weights</span></code> directory.</p>
</section>
<section id="schemes-n-quotas-goals">
<span id="sysfs-schemes-quota-goals"></span><h3>schemes/&lt;N&gt;/quotas/goals/<a class="headerlink" href="#schemes-n-quotas-goals" title="Link to this heading">¶</a></h3>
<p>The directory for the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas-auto-tuning"><span class="std std-ref">automatic quota tuning goals</span></a> of the given DAMON-based operation
scheme.</p>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_goals</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each goal and current achievement.
Among the multiple feedback, the best one is used.</p>
<p>Each goal directory contains three files, namely <code class="docutils literal notranslate"><span class="pre">target_metric</span></code>,
<code class="docutils literal notranslate"><span class="pre">target_value</span></code> and <code class="docutils literal notranslate"><span class="pre">current_value</span></code>.  Users can set and get the three
parameters for the quota auto-tuning goals that specified on the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-quotas-auto-tuning"><span class="std std-ref">design
doc</span></a> by writing to and reading from each
of the files.  Note that users should further write
<code class="docutils literal notranslate"><span class="pre">commit_schemes_quota_goals</span></code> to the <code class="docutils literal notranslate"><span class="pre">state</span></code> file of the <a class="reference internal" href="#sysfs-kdamond"><span class="std std-ref">kdamond
directory</span></a> to pass the feedback to DAMON.</p>
</section>
<section id="schemes-n-watermarks">
<span id="sysfs-watermarks"></span><h3>schemes/&lt;N&gt;/watermarks/<a class="headerlink" href="#schemes-n-watermarks" title="Link to this heading">¶</a></h3>
<p>The directory for the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-watermarks"><span class="std std-ref">watermarks</span></a> of the
given DAMON-based operation scheme.</p>
<p>Under the watermarks directory, five files (<code class="docutils literal notranslate"><span class="pre">metric</span></code>, <code class="docutils literal notranslate"><span class="pre">interval_us</span></code>,
<code class="docutils literal notranslate"><span class="pre">high</span></code>, <code class="docutils literal notranslate"><span class="pre">mid</span></code>, and <code class="docutils literal notranslate"><span class="pre">low</span></code>) for setting the metric, the time interval
between check of the metric, and the three watermarks exist.  You can set and
get the five values by writing to the files, respectively.</p>
<p>Keywords and meanings of those that can be written to the <code class="docutils literal notranslate"><span class="pre">metric</span></code> file are
as below.</p>
<blockquote>
<div><ul class="simple">
<li><p>none: Ignore the watermarks</p></li>
<li><p>free_mem_rate: System’s free memory rate (per thousand)</p></li>
</ul>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">interval</span></code> should written in microseconds unit.</p>
</section>
<section id="schemes-n-filters">
<span id="sysfs-filters"></span><h3>schemes/&lt;N&gt;/filters/<a class="headerlink" href="#schemes-n-filters" title="Link to this heading">¶</a></h3>
<p>The directory for the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-filters"><span class="std std-ref">filters</span></a> of the given
DAMON-based operation scheme.</p>
<p>In the beginning, this directory has only one file, <code class="docutils literal notranslate"><span class="pre">nr_filters</span></code>.  Writing a
number (<code class="docutils literal notranslate"><span class="pre">N</span></code>) to the file creates the number of child directories named <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">N-1</span></code>.  Each directory represents each filter.  The filters are evaluated
in the numeric order.</p>
<p>Each filter directory contains seven files, namely <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">matching</span></code>,
<code class="docutils literal notranslate"><span class="pre">allow</span></code>, <code class="docutils literal notranslate"><span class="pre">memcg_path</span></code>, <code class="docutils literal notranslate"><span class="pre">addr_start</span></code>, <code class="docutils literal notranslate"><span class="pre">addr_end</span></code>, and <code class="docutils literal notranslate"><span class="pre">target_idx</span></code>.
To <code class="docutils literal notranslate"><span class="pre">type</span></code> file, you can write one of five special keywords: <code class="docutils literal notranslate"><span class="pre">anon</span></code> for
anonymous pages, <code class="docutils literal notranslate"><span class="pre">memcg</span></code> for specific memory cgroup, <code class="docutils literal notranslate"><span class="pre">young</span></code> for young
pages, <code class="docutils literal notranslate"><span class="pre">addr</span></code> for specific address range (an open-ended interval), or
<code class="docutils literal notranslate"><span class="pre">target</span></code> for specific DAMON monitoring target filtering.  Meaning of the
types are same to the description on the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-filters"><span class="std std-ref">design doc</span></a>.</p>
<p>In case of the memory cgroup filtering, you can specify the memory cgroup of
the interest by writing the path of the memory cgroup from the cgroups mount
point to <code class="docutils literal notranslate"><span class="pre">memcg_path</span></code> file.  In case of the address range filtering, you can
specify the start and end address of the range to <code class="docutils literal notranslate"><span class="pre">addr_start</span></code> and
<code class="docutils literal notranslate"><span class="pre">addr_end</span></code> files, respectively.  For the DAMON monitoring target filtering,
you can specify the index of the target between the list of the DAMON context’s
monitoring targets list to <code class="docutils literal notranslate"><span class="pre">target_idx</span></code> file.</p>
<p>You can write <code class="docutils literal notranslate"><span class="pre">Y</span></code> or <code class="docutils literal notranslate"><span class="pre">N</span></code> to <code class="docutils literal notranslate"><span class="pre">matching</span></code> file to specify whether the filter
is for memory that matches the <code class="docutils literal notranslate"><span class="pre">type</span></code>.  You can write <code class="docutils literal notranslate"><span class="pre">Y</span></code> or <code class="docutils literal notranslate"><span class="pre">N</span></code> to
<code class="docutils literal notranslate"><span class="pre">allow</span></code> file to specify if applying the action to the memory that satisfies
the <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">matching</span></code> should be allowed or not.</p>
<p>For example, below restricts a DAMOS action to be applied to only non-anonymous
pages of all memory cgroups except <code class="docutils literal notranslate"><span class="pre">/having_care_already</span></code>.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 2 &gt; nr_filters
# # disallow anonymous pages
echo anon &gt; 0/type
echo Y &gt; 0/matching
echo N &gt; 0/allow
# # further filter out all cgroups except one at &#39;/having_care_already&#39;
echo memcg &gt; 1/type
echo /having_care_already &gt; 1/memcg_path
echo Y &gt; 1/matching
echo N &gt; 1/allow
</pre></div>
</div>
<p>Refer to the <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-filters"><span class="std std-ref">DAMOS filters design documentation</span></a> for more details including how multiple filters
of different <code class="docutils literal notranslate"><span class="pre">allow</span></code> works, when each of the filters are supported, and
differences on stats.</p>
</section>
<section id="schemes-n-stats">
<span id="sysfs-schemes-stats"></span><h3>schemes/&lt;N&gt;/stats/<a class="headerlink" href="#schemes-n-stats" title="Link to this heading">¶</a></h3>
<p>DAMON counts statistics for each scheme.  This statistics can be used for
online analysis or tuning of the schemes.  Refer to <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-stat"><span class="std std-ref">design doc</span></a> for more details about the stats.</p>
<p>The statistics can be retrieved by reading the files under <code class="docutils literal notranslate"><span class="pre">stats</span></code> directory
(<code class="docutils literal notranslate"><span class="pre">nr_tried</span></code>, <code class="docutils literal notranslate"><span class="pre">sz_tried</span></code>, <code class="docutils literal notranslate"><span class="pre">nr_applied</span></code>, <code class="docutils literal notranslate"><span class="pre">sz_applied</span></code>,
<code class="docutils literal notranslate"><span class="pre">sz_ops_filter_passed</span></code>, and <code class="docutils literal notranslate"><span class="pre">qt_exceeds</span></code>), respectively.  The files are not
updated in real time, so you should ask DAMON sysfs interface to update the
content of the files for the stats by writing a special keyword,
<code class="docutils literal notranslate"><span class="pre">update_schemes_stats</span></code> to the relevant <code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> file.</p>
</section>
<section id="schemes-n-tried-regions">
<span id="sysfs-schemes-tried-regions"></span><h3>schemes/&lt;N&gt;/tried_regions/<a class="headerlink" href="#schemes-n-tried-regions" title="Link to this heading">¶</a></h3>
<p>This directory initially has one file, <code class="docutils literal notranslate"><span class="pre">total_bytes</span></code>.</p>
<p>When a special keyword, <code class="docutils literal notranslate"><span class="pre">update_schemes_tried_regions</span></code>, is written to the
relevant <code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> file, DAMON updates the <code class="docutils literal notranslate"><span class="pre">total_bytes</span></code> file so
that reading it returns the total size of the scheme tried regions, and creates
directories named integer starting from <code class="docutils literal notranslate"><span class="pre">0</span></code> under this directory.  Each
directory contains files exposing detailed information about each of the memory
region that the corresponding scheme’s <code class="docutils literal notranslate"><span class="pre">action</span></code> has tried to be applied under
this directory, during next <a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">apply interval</span></a> of the
corresponding scheme.  The information includes address range, <code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>,
and <code class="docutils literal notranslate"><span class="pre">age</span></code> of the region.</p>
<p>Writing <code class="docutils literal notranslate"><span class="pre">update_schemes_tried_bytes</span></code> to the relevant <code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code>
file will only update the <code class="docutils literal notranslate"><span class="pre">total_bytes</span></code> file, and will not create the
subdirectories.</p>
<p>The directories will be removed when another special keyword,
<code class="docutils literal notranslate"><span class="pre">clear_schemes_tried_regions</span></code>, is written to the relevant
<code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> file.</p>
<p>The expected usage of this directory is investigations of schemes’ behaviors,
and query-like efficient data access monitoring results retrievals.  For the
latter use case, in particular, users can set the <code class="docutils literal notranslate"><span class="pre">action</span></code> as <code class="docutils literal notranslate"><span class="pre">stat</span></code> and
set the <code class="docutils literal notranslate"><span class="pre">access</span> <span class="pre">pattern</span></code> as their interested pattern that they want to query.</p>
</section>
<section id="tried-regions-n">
<span id="sysfs-schemes-tried-region"></span><h3>tried_regions/&lt;N&gt;/<a class="headerlink" href="#tried-regions-n" title="Link to this heading">¶</a></h3>
<p>In each region directory, you will find five files (<code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">end</span></code>,
<code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, <code class="docutils literal notranslate"><span class="pre">age</span></code>, and <code class="docutils literal notranslate"><span class="pre">sz_filter_passed</span></code>).  Reading the files will
show the properties of the region that corresponding DAMON-based operation
scheme <code class="docutils literal notranslate"><span class="pre">action</span></code> has tried to be applied.</p>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h4>
<p>Below commands applies a scheme saying “If a memory region of size in [4KiB,
8KiB] is showing accesses per aggregate interval in [0, 5] for aggregate
interval in [10, 20], page out the region.  For the paging out, use only up to
10ms per second, and also don’t page out more than 1GiB per second.  Under the
limitation, page out memory regions having longer age first.  Also, check the
free memory rate of the system every 5 seconds, start the monitoring and paging
out when the free memory rate becomes lower than 50%, but stop it if the free
memory rate becomes larger than 60%, or lower than 30%”.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;sysfs&gt;/kernel/mm/damon/admin
# # populate directories
# echo 1 &gt; kdamonds/nr_kdamonds; echo 1 &gt; kdamonds/0/contexts/nr_contexts;
# echo 1 &gt; kdamonds/0/contexts/0/schemes/nr_schemes
# cd kdamonds/0/contexts/0/schemes/0
# # set the basic access pattern and the action
# echo 4096 &gt; access_pattern/sz/min
# echo 8192 &gt; access_pattern/sz/max
# echo 0 &gt; access_pattern/nr_accesses/min
# echo 5 &gt; access_pattern/nr_accesses/max
# echo 10 &gt; access_pattern/age/min
# echo 20 &gt; access_pattern/age/max
# echo pageout &gt; action
# # set quotas
# echo 10 &gt; quotas/ms
# echo $((1024*1024*1024)) &gt; quotas/bytes
# echo 1000 &gt; quotas/reset_interval_ms
# # set watermark
# echo free_mem_rate &gt; watermarks/metric
# echo 5000000 &gt; watermarks/interval_us
# echo 600 &gt; watermarks/high
# echo 500 &gt; watermarks/mid
# echo 300 &gt; watermarks/low
</pre></div>
</div>
<p>Please note that it’s highly recommended to use user space tools like <a class="reference external" href="https://github.com/damonitor/damo">damo</a> rather than manually reading and writing
the files as above.  Above is only for an example.</p>
</section>
</section>
</section>
<section id="tracepoints-for-monitoring-results">
<span id="tracepoint"></span><h2>Tracepoints for Monitoring Results<a class="headerlink" href="#tracepoints-for-monitoring-results" title="Link to this heading">¶</a></h2>
<p>Users can get the monitoring results via the <a class="reference internal" href="#sysfs-schemes-tried-regions"><span class="std std-ref">tried_regions</span></a>.  The interface is useful for getting a
snapshot, but it could be inefficient for fully recording all the monitoring
results.  For the purpose, two trace points, namely <code class="docutils literal notranslate"><span class="pre">damon:damon_aggregated</span></code>
and <code class="docutils literal notranslate"><span class="pre">damon:damos_before_apply</span></code>, are provided.  <code class="docutils literal notranslate"><span class="pre">damon:damon_aggregated</span></code>
provides the whole monitoring results, while <code class="docutils literal notranslate"><span class="pre">damon:damos_before_apply</span></code>
provides the monitoring results for regions that each DAMON-based Operation
Scheme (<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos"><span class="std std-ref">DAMOS</span></a>) is gonna be applied.  Hence,
<code class="docutils literal notranslate"><span class="pre">damon:damos_before_apply</span></code> is more useful for recording internal behavior of
DAMOS, or DAMOS target access
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-damos-access-pattern"><span class="std std-ref">pattern</span></a> based query-like efficient
monitoring results recording.</p>
<p>While the monitoring is turned on, you could record the tracepoint events and
show results using tracepoint supporting tools like <code class="docutils literal notranslate"><span class="pre">perf</span></code>.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo on &gt; kdamonds/0/state
# perf record -e damon:damon_aggregated &amp;
# sleep 5
# kill 9 $(pidof perf)
# echo off &gt; kdamonds/0/state
# perf script
kdamond.0 46568 [027] 79357.842179: damon:damon_aggregated: target_id=0 nr_regions=11 122509119488-135708762112: 0 864
[...]
</pre></div>
</div>
<p>Each line of the perf script output represents each monitoring region.  The
first five fields are as usual other tracepoint outputs.  The sixth field
(<code class="docutils literal notranslate"><span class="pre">target_id=X</span></code>) shows the ide of the monitoring target of the region.  The
seventh field (<code class="docutils literal notranslate"><span class="pre">nr_regions=X</span></code>) shows the total number of monitoring regions
for the target.  The eighth field (<code class="docutils literal notranslate"><span class="pre">X-Y:</span></code>) shows the start (<code class="docutils literal notranslate"><span class="pre">X</span></code>) and end
(<code class="docutils literal notranslate"><span class="pre">Y</span></code>) addresses of the region in bytes.  The ninth field (<code class="docutils literal notranslate"><span class="pre">X</span></code>) shows the
<code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code> of the region (refer to
<a class="reference internal" href="../../../mm/damon/design.html#damon-design-region-based-sampling"><span class="std std-ref">design</span></a> for more details of the
counter).  Finally the tenth field (<code class="docutils literal notranslate"><span class="pre">X</span></code>) shows the <code class="docutils literal notranslate"><span class="pre">age</span></code> of the region
(refer to <a class="reference internal" href="../../../mm/damon/design.html#damon-design-age-tracking"><span class="std std-ref">design</span></a> for more details of the
counter).</p>
<p>If the event was <code class="docutils literal notranslate"><span class="pre">damon:damos_beofre_apply</span></code>, the <code class="docutils literal notranslate"><span class="pre">perf</span> <span class="pre">script</span></code> output would
be somewhat like below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>kdamond.0 47293 [000] 80801.060214: damon:damos_before_apply: ctx_idx=0 scheme_idx=0 target_idx=0 nr_regions=11 121932607488-135128711168: 0 136
[...]
</pre></div>
</div>
<p>Each line of the output represents each monitoring region that each DAMON-based
Operation Scheme was about to be applied at the traced time.  The first five
fields are as usual.  It shows the index of the DAMON context (<code class="docutils literal notranslate"><span class="pre">ctx_idx=X</span></code>)
of the scheme in the list of the contexts of the context’s kdamond, the index
of the scheme (<code class="docutils literal notranslate"><span class="pre">scheme_idx=X</span></code>) in the list of the schemes of the context, in
addition to the output of <code class="docutils literal notranslate"><span class="pre">damon_aggregated</span></code> tracepoint.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/admin-guide/mm/damon/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>