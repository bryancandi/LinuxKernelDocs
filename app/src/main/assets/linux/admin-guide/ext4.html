<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ext4 General Information &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=a152c8ac" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="File system Monitoring with fanotify" href="filesystem-monitoring.html" />
    <link rel="prev" title="The EFI Boot Stub" href="efi-stub.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.11.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="README.html">Linux kernel release 6.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="abi.html">Linux ABI description</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html">Feature status on all architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="reporting-regressions.html">Reporting regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickly-build-trimmed-linux.html">How to quickly build a trimmed Linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="verify-bugs-and-bisect-regressions.html">How to verify bugs and bisect regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="init.html">Explaining the “No working init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="pstore-blk.html">pstore block oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="workload-tracing.html">Discovering Linux kernel subsystems used by a workload</a></li>
<li class="toctree-l2"><a class="reference internal" href="acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockdev/index.html">Block Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ext4 General Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#quick-usage-instructions">Quick usage instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#case-insensitive-file-name-lookups">case-insensitive file name lookups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#options">Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-mode">Data Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proc-entries">/proc entries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sys-entries">/sys entries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ioctls">Ioctls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="filesystem-monitoring.html">File system Monitoring with fanotify</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio/index.html">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw_random.html">Hardware random number generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="md.html">RAID arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="media/index.html">Media subsystem admin and user guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="RAS/main.html">Reliability, Availability and Serviceability (RAS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="RAS/error-decoding.html">Error decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="RAS/address-translation.html">Address translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="syscall-user-dispatch.html">Syscall User Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermal/index.html">Thermal Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/admin-guide/ext4.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="ext4-general-information">
<h1>ext4 General Information<a class="headerlink" href="#ext4-general-information" title="Link to this heading">¶</a></h1>
<p>Ext4 is an advanced level of the ext3 filesystem which incorporates
scalability and reliability enhancements for supporting large filesystems
(64 bit) in keeping with increasing disk capacities and state-of-the-art
feature requirements.</p>
<p>Mailing list:   <a class="reference external" href="mailto:linux-ext4&#37;&#52;&#48;vger&#46;kernel&#46;org">linux-ext4<span>&#64;</span>vger<span>&#46;</span>kernel<span>&#46;</span>org</a>
Web site:       <a class="reference external" href="http://ext4.wiki.kernel.org">http://ext4.wiki.kernel.org</a></p>
<section id="quick-usage-instructions">
<h2>Quick usage instructions<a class="headerlink" href="#quick-usage-instructions" title="Link to this heading">¶</a></h2>
<p>Note: More extensive information for getting started with ext4 can be
found at the ext4 wiki site at the URL:
<a class="reference external" href="http://ext4.wiki.kernel.org/index.php/Ext4_Howto">http://ext4.wiki.kernel.org/index.php/Ext4_Howto</a></p>
<blockquote>
<div><ul>
<li><p>The latest version of e2fsprogs can be found at:</p>
<p><a class="reference external" href="https://www.kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/">https://www.kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/</a></p>
<blockquote>
<div><p>or</p>
</div></blockquote>
<p><a class="reference external" href="http://sourceforge.net/project/showfiles.php?group_id=2406">http://sourceforge.net/project/showfiles.php?group_id=2406</a></p>
<blockquote>
<div><p>or grab the latest git repository from:</p>
</div></blockquote>
</li>
</ul>
<blockquote>
<div><p><a class="reference external" href="https://git.kernel.org/pub/scm/fs/ext2/e2fsprogs.git">https://git.kernel.org/pub/scm/fs/ext2/e2fsprogs.git</a></p>
</div></blockquote>
<ul>
<li><p>Create a new filesystem using the ext4 filesystem type:</p>
<blockquote>
<div><p># mke2fs -t ext4 /dev/hda1</p>
</div></blockquote>
<p>Or to configure an existing ext3 filesystem to support extents:</p>
<blockquote>
<div><p># tune2fs -O extents /dev/hda1</p>
</div></blockquote>
<p>If the filesystem was created with 128 byte inodes, it can be
converted to use 256 byte for greater efficiency via:</p>
<blockquote>
<div><p># tune2fs -I 256 /dev/hda1</p>
</div></blockquote>
</li>
<li><p>Mounting:</p>
<blockquote>
<div><p># mount -t ext4 /dev/hda1 /wherever</p>
</div></blockquote>
</li>
<li><p>When comparing performance with other filesystems, it’s always
important to try multiple workloads; very often a subtle change in a
workload parameter can completely change the ranking of which
filesystems do well compared to others.  When comparing versus ext3,
note that ext4 enables write barriers by default, while ext3 does
not enable write barriers by default.  So it is useful to use
explicitly specify whether barriers are enabled or not when via the
‘-o barriers=[0|1]’ mount option for both ext3 and ext4 filesystems
for a fair comparison.  When tuning ext3 for best benchmark numbers,
it is often worthwhile to try changing the data journaling mode; ‘-o
data=writeback’ can be faster for some workloads.  (Note however that
running mounted with data=writeback can potentially leave stale data
exposed in recently written files in case of an unclean shutdown,
which could be a security exposure in some situations.)  Configuring
the filesystem with a large journal can also be helpful for
metadata-intensive workloads.</p></li>
</ul>
</div></blockquote>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading">¶</a></h2>
<section id="currently-available">
<h3>Currently Available<a class="headerlink" href="#currently-available" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>ability to use filesystems &gt; 16TB (e2fsprogs support not available yet)</p></li>
<li><p>extent format reduces metadata overhead (RAM, IO for access, transactions)</p></li>
<li><p>extent format more robust in face of on-disk corruption due to magics,</p></li>
<li><p>internal redundancy in tree</p></li>
<li><p>improved file allocation (multi-block alloc)</p></li>
<li><p>lift 32000 subdirectory limit imposed by i_links_count[1]</p></li>
<li><p>nsec timestamps for mtime, atime, ctime, create time</p></li>
<li><p>inode version field on disk (NFSv4, Lustre)</p></li>
<li><p>reduced e2fsck time via uninit_bg feature</p></li>
<li><p>journal checksumming for robustness, performance</p></li>
<li><p>persistent file preallocation (e.g for streaming media, databases)</p></li>
<li><p>ability to pack bitmaps and inode tables into larger virtual groups via the
flex_bg feature</p></li>
<li><p>large file support</p></li>
<li><p>inode allocation using large virtual block groups via flex_bg</p></li>
<li><p>delayed allocation</p></li>
<li><p>large block (up to pagesize) support</p></li>
<li><p>efficient new ordered mode in JBD2 and ext4 (avoid using buffer head to force
the ordering)</p></li>
<li><p>Case-insensitive file name lookups</p></li>
<li><p>file-based encryption support (fscrypt)</p></li>
<li><p>file-based verity support (fsverity)</p></li>
</ul>
<p>[1] Filesystems with a block size of 1k may see a limit imposed by the
directory hash tree having a maximum depth of two.</p>
</section>
</section>
<section id="case-insensitive-file-name-lookups">
<h2>case-insensitive file name lookups<a class="headerlink" href="#case-insensitive-file-name-lookups" title="Link to this heading">¶</a></h2>
<p>The case-insensitive file name lookup feature is supported on a
per-directory basis, allowing the user to mix case-insensitive and
case-sensitive directories in the same filesystem.  It is enabled by
flipping the +F inode attribute of an empty directory.  The
case-insensitive string match operation is only defined when we know how
text in encoded in a byte sequence.  For that reason, in order to enable
case-insensitive directories, the filesystem must have the
casefold feature, which stores the filesystem-wide encoding
model used.  By default, the charset adopted is the latest version of
Unicode (12.1.0, by the time of this writing), encoded in the UTF-8
form.  The comparison algorithm is implemented by normalizing the
strings to the Canonical decomposition form, as defined by Unicode,
followed by a byte per byte comparison.</p>
<p>The case-awareness is name-preserving on the disk, meaning that the file
name provided by userspace is a byte-per-byte match to what is actually
written in the disk.  The Unicode normalization format used by the
kernel is thus an internal representation, and not exposed to the
userspace nor to the disk, with the important exception of disk hashes,
used on large case-insensitive directories with DX feature.  On DX
directories, the hash must be calculated using the casefolded version of
the filename, meaning that the normalization format used actually has an
impact on where the directory entry is stored.</p>
<p>When we change from viewing filenames as opaque byte sequences to seeing
them as encoded strings we need to address what happens when a program
tries to create a file with an invalid name.  The Unicode subsystem
within the kernel leaves the decision of what to do in this case to the
filesystem, which select its preferred behavior by enabling/disabling
the strict mode.  When Ext4 encounters one of those strings and the
filesystem did not require strict mode, it falls back to considering the
entire string as an opaque byte sequence, which still allows the user to
operate on that file, but the case-insensitive lookups won’t work.</p>
</section>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Link to this heading">¶</a></h2>
<p>When mounting an ext4 filesystem, the following option are accepted:
(*) == default</p>
<blockquote>
<div><dl class="simple">
<dt>ro</dt><dd><p>Mount filesystem read only. Note that ext4 will replay the journal (and
thus write to the partition) even when mounted “read only”. The mount
options “ro,noload” can be used to prevent writes to the filesystem.</p>
</dd>
<dt>journal_checksum</dt><dd><p>Enable checksumming of the journal transactions.  This will allow the
recovery code in e2fsck and the kernel to detect corruption in the
kernel.  It is a compatible change and will be ignored by older
kernels.</p>
</dd>
<dt>journal_async_commit</dt><dd><p>Commit block can be written to disk without waiting for descriptor
blocks. If enabled older kernels cannot mount the device. This will
enable ‘journal_checksum’ internally.</p>
</dd>
<dt>journal_path=path, journal_dev=devnum</dt><dd><p>When the external journal device’s major/minor numbers have changed,
these options allow the user to specify the new journal location.  The
journal device is identified through either its new major/minor numbers
encoded in devnum, or via a path to the device.</p>
</dd>
<dt>norecovery, noload</dt><dd><p>Don’t load the journal on mounting.  Note that if the filesystem was
not unmounted cleanly, skipping the journal replay will lead to the
filesystem containing inconsistencies that can lead to any number of
problems.</p>
</dd>
<dt>data=journal</dt><dd><p>All data are committed into the journal prior to being written into the
main file system.  Enabling this mode will disable delayed allocation
and O_DIRECT support.</p>
</dd>
<dt>data=ordered  (*)</dt><dd><p>All data are forced directly out to the main file system prior to its
metadata being committed to the journal.</p>
</dd>
<dt>data=writeback</dt><dd><p>Data ordering is not preserved, data may be written into the main file
system after its metadata has been committed to the journal.</p>
</dd>
<dt>commit=nrsec  (*)</dt><dd><p>This setting limits the maximum age of the running transaction to
‘nrsec’ seconds.  The default value is 5 seconds.  This means that if
you lose your power, you will lose as much as the latest 5 seconds of
metadata changes (your filesystem will not be damaged though, thanks
to the journaling). This default value (or any low value) will hurt
performance, but it’s good for data-safety.  Setting it to 0 will have
the same effect as leaving it at the default (5 seconds).  Setting it
to very large values will improve performance.  Note that due to
delayed allocation even older data can be lost on power failure since
writeback of those data begins only after time set in
/proc/sys/vm/dirty_expire_centisecs.</p>
</dd>
<dt>barrier=&lt;0|1(*)&gt;, barrier(*), nobarrier</dt><dd><p>This enables/disables the use of write barriers in the jbd code.
barrier=0 disables, barrier=1 enables.  This also requires an IO stack
which can support barriers, and if jbd gets an error on a barrier
write, it will disable again with a warning.  Write barriers enforce
proper on-disk ordering of journal commits, making volatile disk write
caches safe to use, at some performance penalty.  If your disks are
battery-backed in one way or another, disabling barriers may safely
improve performance.  The mount options “barrier” and “nobarrier” can
also be used to enable or disable barriers, for consistency with other
ext4 mount options.</p>
</dd>
<dt>inode_readahead_blks=n</dt><dd><p>This tuning parameter controls the maximum number of inode table blocks
that ext4’s inode table readahead algorithm will pre-read into the
buffer cache.  The default value is 32 blocks.</p>
</dd>
<dt>nouser_xattr</dt><dd><p>Disables Extended User Attributes.  See the attr(5) manual page for
more information about extended attributes.</p>
</dd>
<dt>noacl</dt><dd><p>This option disables POSIX Access Control List support. If ACL support
is enabled in the kernel configuration (CONFIG_EXT4_FS_POSIX_ACL), ACL
is enabled by default on mount. See the acl(5) manual page for more
information about acl.</p>
</dd>
<dt>bsddf (*)</dt><dd><p>Make ‘df’ act like BSD.</p>
</dd>
<dt>minixdf</dt><dd><p>Make ‘df’ act like Minix.</p>
</dd>
<dt>debug</dt><dd><p>Extra debugging information is sent to syslog.</p>
</dd>
<dt>abort</dt><dd><p>Simulate the effects of calling ext4_abort() for debugging purposes.
This is normally used while remounting a filesystem which is already
mounted.</p>
</dd>
<dt>errors=remount-ro</dt><dd><p>Remount the filesystem read-only on an error.</p>
</dd>
<dt>errors=continue</dt><dd><p>Keep going on a filesystem error.</p>
</dd>
<dt>errors=panic</dt><dd><p>Panic and halt the machine if an error occurs.  (These mount options
override the errors behavior specified in the superblock, which can be
configured using tune2fs)</p>
</dd>
<dt>data_err=ignore(*)</dt><dd><p>Just print an error message if an error occurs in a file data buffer in
ordered mode.</p>
</dd>
<dt>data_err=abort</dt><dd><p>Abort the journal if an error occurs in a file data buffer in ordered
mode.</p>
</dd>
<dt>grpid | bsdgroups</dt><dd><p>New objects have the group ID of their parent.</p>
</dd>
<dt>nogrpid (*) | sysvgroups</dt><dd><p>New objects have the group ID of their creator.</p>
</dd>
<dt>resgid=n</dt><dd><p>The group ID which may use the reserved blocks.</p>
</dd>
<dt>resuid=n</dt><dd><p>The user ID which may use the reserved blocks.</p>
</dd>
<dt>sb=</dt><dd><p>Use alternate superblock at this location.</p>
</dd>
<dt>quota, noquota, grpquota, usrquota</dt><dd><p>These options are ignored by the filesystem. They are used only by
quota tools to recognize volumes where quota should be turned on. See
documentation in the quota-tools package for more details
(<a class="reference external" href="http://sourceforge.net/projects/linuxquota">http://sourceforge.net/projects/linuxquota</a>).</p>
</dd>
<dt>jqfmt=&lt;quota type&gt;, usrjquota=&lt;file&gt;, grpjquota=&lt;file&gt;</dt><dd><p>These options tell filesystem details about quota so that quota
information can be properly updated during journal replay. They replace
the above quota options. See documentation in the quota-tools package
for more details (<a class="reference external" href="http://sourceforge.net/projects/linuxquota">http://sourceforge.net/projects/linuxquota</a>).</p>
</dd>
<dt>stripe=n</dt><dd><p>Number of filesystem blocks that mballoc will try to use for allocation
size and alignment. For RAID5/6 systems this should be the number of
data disks *  RAID chunk size in file system blocks.</p>
</dd>
<dt>delalloc      (*)</dt><dd><p>Defer block allocation until just before ext4 writes out the block(s)
in question.  This allows ext4 to better allocation decisions more
efficiently.</p>
</dd>
<dt>nodelalloc</dt><dd><p>Disable delayed allocation.  Blocks are allocated when the data is
copied from userspace to the page cache, either via the write(2) system
call or when an mmap’ed page which was previously unallocated is
written for the first time.</p>
</dd>
<dt>max_batch_time=usec</dt><dd><p>Maximum amount of time ext4 should wait for additional filesystem
operations to be batch together with a synchronous write operation.
Since a synchronous write operation is going to force a commit and then
a wait for the I/O complete, it doesn’t cost much, and can be a huge
throughput win, we wait for a small amount of time to see if any other
transactions can piggyback on the synchronous write.   The algorithm
used is designed to automatically tune for the speed of the disk, by
measuring the amount of time (on average) that it takes to finish
committing a transaction.  Call this time the “commit time”.  If the
time that the transaction has been running is less than the commit
time, ext4 will try sleeping for the commit time to see if other
operations will join the transaction.   The commit time is capped by
the max_batch_time, which defaults to 15000us (15ms).   This
optimization can be turned off entirely by setting max_batch_time to 0.</p>
</dd>
<dt>min_batch_time=usec</dt><dd><p>This parameter sets the commit time (as described above) to be at least
min_batch_time.  It defaults to zero microseconds.  Increasing this
parameter may improve the throughput of multi-threaded, synchronous
workloads on very fast disks, at the cost of increasing latency.</p>
</dd>
<dt>journal_ioprio=prio</dt><dd><p>The I/O priority (from 0 to 7, where 0 is the highest priority) which
should be used for I/O operations submitted by kjournald2 during a
commit operation.  This defaults to 3, which is a slightly higher
priority than the default I/O priority.</p>
</dd>
<dt>auto_da_alloc(*), noauto_da_alloc</dt><dd><p>Many broken applications don’t use fsync() when replacing existing
files via patterns such as fd = open(“foo.new”)/write(fd,..)/close(fd)/
rename(“foo.new”, “foo”), or worse yet, fd = open(“foo”,
O_TRUNC)/write(fd,..)/close(fd).  If auto_da_alloc is enabled, ext4
will detect the replace-via-rename and replace-via-truncate patterns
and force that any delayed allocation blocks are allocated such that at
the next journal commit, in the default data=ordered mode, the data
blocks of the new file are forced to disk before the rename() operation
is committed.  This provides roughly the same level of guarantees as
ext3, and avoids the “zero-length” problem that can happen when a
system crashes before the delayed allocation blocks are forced to disk.</p>
</dd>
<dt>noinit_itable</dt><dd><p>Do not initialize any uninitialized inode table blocks in the
background.  This feature may be used by installation CD’s so that the
install process can complete as quickly as possible; the inode table
initialization process would then be deferred until the next time the
file system is unmounted.</p>
</dd>
<dt>init_itable=n</dt><dd><p>The lazy itable init code will wait n times the number of milliseconds
it took to zero out the previous block group’s inode table.  This
minimizes the impact on the system performance while file system’s
inode table is being initialized.</p>
</dd>
<dt>discard, nodiscard(*)</dt><dd><p>Controls whether ext4 should issue discard/TRIM commands to the
underlying block device when blocks are freed.  This is useful for SSD
devices and sparse/thinly-provisioned LUNs, but it is off by default
until sufficient testing has been done.</p>
</dd>
<dt>nouid32</dt><dd><p>Disables 32-bit UIDs and GIDs.  This is for interoperability  with
older kernels which only store and expect 16-bit values.</p>
</dd>
<dt>block_validity(*), noblock_validity</dt><dd><p>These options enable or disable the in-kernel facility for tracking
filesystem metadata blocks within internal data structures.  This
allows multi- block allocator and other routines to notice bugs or
corrupted allocation bitmaps which cause blocks to be allocated which
overlap with filesystem metadata blocks.</p>
</dd>
<dt>dioread_lock, dioread_nolock</dt><dd><p>Controls whether or not ext4 should use the DIO read locking. If the
dioread_nolock option is specified ext4 will allocate uninitialized
extent before buffer write and convert the extent to initialized after
IO completes. This approach allows ext4 code to avoid using inode
mutex, which improves scalability on high speed storages. However this
does not work with data journaling and dioread_nolock option will be
ignored with kernel warning. Note that dioread_nolock code path is only
used for extent-based files.  Because of the restrictions this options
comprises it is off by default (e.g. dioread_lock).</p>
</dd>
<dt>max_dir_size_kb=n</dt><dd><p>This limits the size of directories so that any attempt to expand them
beyond the specified limit in kilobytes will cause an ENOSPC error.
This is useful in memory constrained environments, where a very large
directory can cause severe performance problems or even provoke the Out
Of Memory killer.  (For example, if there is only 512mb memory
available, a 176mb directory may seriously cramp the system’s style.)</p>
</dd>
<dt>i_version</dt><dd><p>Enable 64-bit inode version support. This option is off by default.</p>
</dd>
<dt>dax</dt><dd><p>Use direct access (no page cache).  See
<a class="reference internal" href="../filesystems/dax.html"><span class="doc">Direct Access for files</span></a>.  Note that this option is
incompatible with data=journal.</p>
</dd>
<dt>inlinecrypt</dt><dd><p>When possible, encrypt/decrypt the contents of encrypted files using the
blk-crypto framework rather than filesystem-layer encryption. This
allows the use of inline encryption hardware. The on-disk format is
unaffected. For more details, see
<a class="reference internal" href="../block/inline-encryption.html"><span class="doc">Inline Encryption</span></a>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="data-mode">
<h2>Data Mode<a class="headerlink" href="#data-mode" title="Link to this heading">¶</a></h2>
<p>There are 3 different data modes:</p>
<ul>
<li><p>writeback mode</p>
<p>In data=writeback mode, ext4 does not journal data at all.  This mode provides
a similar level of journaling as that of XFS, JFS, and ReiserFS in its default
mode - metadata journaling.  A crash+recovery can cause incorrect data to
appear in files which were written shortly before the crash.  This mode will
typically provide the best ext4 performance.</p>
</li>
<li><p>ordered mode</p>
<p>In data=ordered mode, ext4 only officially journals metadata, but it logically
groups metadata information related to data changes with the data blocks into
a single unit called a transaction.  When it’s time to write the new metadata
out to disk, the associated data blocks are written first.  In general, this
mode performs slightly slower than writeback but significantly faster than
journal mode.</p>
</li>
<li><p>journal mode</p>
<p>data=journal mode provides full data and metadata journaling.  All new data is
written to the journal first, and then to its final location.  In the event of
a crash, the journal can be replayed, bringing both data and metadata into a
consistent state.  This mode is the slowest except when data needs to be read
from and written to disk at the same time where it outperforms all others
modes.  Enabling this mode will disable delayed allocation and O_DIRECT
support.</p>
</li>
</ul>
</section>
<section id="proc-entries">
<h2>/proc entries<a class="headerlink" href="#proc-entries" title="Link to this heading">¶</a></h2>
<p>Information about mounted ext4 file systems can be found in
/proc/fs/ext4.  Each mounted filesystem will have a directory in
/proc/fs/ext4 based on its device name (i.e., /proc/fs/ext4/hdc or
/proc/fs/ext4/dm-0).   The files in each per-device directory are shown
in table below.</p>
<p>Files in /proc/fs/ext4/&lt;devname&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>mb_groups</dt><dd><p>details of multiblock allocator buddy cache of free blocks</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="sys-entries">
<h2>/sys entries<a class="headerlink" href="#sys-entries" title="Link to this heading">¶</a></h2>
<p>Information about mounted ext4 file systems can be found in
/sys/fs/ext4.  Each mounted filesystem will have a directory in
/sys/fs/ext4 based on its device name (i.e., /sys/fs/ext4/hdc or
/sys/fs/ext4/dm-0).   The files in each per-device directory are shown
in table below.</p>
<p>Files in /sys/fs/ext4/&lt;devname&gt;:</p>
<p>(see also Documentation/ABI/testing/sysfs-fs-ext4)</p>
<blockquote>
<div><dl class="simple">
<dt>delayed_allocation_blocks</dt><dd><p>This file is read-only and shows the number of blocks that are dirty in
the page cache, but which do not have their location in the filesystem
allocated yet.</p>
</dd>
<dt>inode_goal</dt><dd><p>Tuning parameter which (if non-zero) controls the goal inode used by
the inode allocator in preference to all other allocation heuristics.
This is intended for debugging use only, and should be 0 on production
systems.</p>
</dd>
<dt>inode_readahead_blks</dt><dd><p>Tuning parameter which controls the maximum number of inode table
blocks that ext4’s inode table readahead algorithm will pre-read into
the buffer cache.</p>
</dd>
<dt>lifetime_write_kbytes</dt><dd><p>This file is read-only and shows the number of kilobytes of data that
have been written to this filesystem since it was created.</p>
</dd>
<dt>max_writeback_mb_bump</dt><dd><p>The maximum number of megabytes the writeback code will try to write
out before move on to another inode.</p>
</dd>
<dt>mb_group_prealloc</dt><dd><p>The multiblock allocator will round up allocation requests to a
multiple of this tuning parameter if the stripe size is not set in the
ext4 superblock</p>
</dd>
<dt>mb_max_to_scan</dt><dd><p>The maximum number of extents the multiblock allocator will search to
find the best extent.</p>
</dd>
<dt>mb_min_to_scan</dt><dd><p>The minimum number of extents the multiblock allocator will search to
find the best extent.</p>
</dd>
<dt>mb_order2_req</dt><dd><p>Tuning parameter which controls the minimum size for requests (as a
power of 2) where the buddy cache is used.</p>
</dd>
<dt>mb_stats</dt><dd><p>Controls whether the multiblock allocator should collect statistics,
which are shown during the unmount. 1 means to collect statistics, 0
means not to collect statistics.</p>
</dd>
<dt>mb_stream_req</dt><dd><p>Files which have fewer blocks than this tunable parameter will have
their blocks allocated out of a block group specific preallocation
pool, so that small files are packed closely together.  Each large file
will have its blocks allocated out of its own unique preallocation
pool.</p>
</dd>
<dt>session_write_kbytes</dt><dd><p>This file is read-only and shows the number of kilobytes of data that
have been written to this filesystem since it was mounted.</p>
</dd>
<dt>reserved_clusters</dt><dd><p>This is RW file and contains number of reserved clusters in the file
system which will be used in the specific situations to avoid costly
zeroout, unexpected ENOSPC, or possible data loss. The default is 2% or
4096 clusters, whichever is smaller and this can be changed however it
can never exceed number of clusters in the file system. If there is not
enough space for the reserved space when mounting the file mount will
_not_ fail.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="ioctls">
<h2>Ioctls<a class="headerlink" href="#ioctls" title="Link to this heading">¶</a></h2>
<p>Ext4 implements various ioctls which can be used by applications to access
ext4-specific functionality. An incomplete list of these ioctls is shown in the
table below. This list includes truly ext4-specific ioctls (<code class="docutils literal notranslate"><span class="pre">EXT4_IOC_*</span></code>) as
well as ioctls that may have been ext4-specific originally but are now supported
by some other filesystem(s) too (<code class="docutils literal notranslate"><span class="pre">FS_IOC_*</span></code>).</p>
<p>Table of Ext4 ioctls</p>
<blockquote>
<div><dl class="simple">
<dt>FS_IOC_GETFLAGS</dt><dd><p>Get additional attributes associated with inode.  The ioctl argument is
an integer bitfield, with bit values described in ext4.h.</p>
</dd>
<dt>FS_IOC_SETFLAGS</dt><dd><p>Set additional attributes associated with inode.  The ioctl argument is
an integer bitfield, with bit values described in ext4.h.</p>
</dd>
<dt>EXT4_IOC_GETVERSION, EXT4_IOC_GETVERSION_OLD</dt><dd><p>Get the inode i_generation number stored for each inode. The
i_generation number is normally changed only when new inode is created
and it is particularly useful for network filesystems. The ‘_OLD’
version of this ioctl is an alias for FS_IOC_GETVERSION.</p>
</dd>
<dt>EXT4_IOC_SETVERSION, EXT4_IOC_SETVERSION_OLD</dt><dd><p>Set the inode i_generation number stored for each inode. The ‘_OLD’
version of this ioctl is an alias for FS_IOC_SETVERSION.</p>
</dd>
<dt>EXT4_IOC_GROUP_EXTEND</dt><dd><p>This ioctl has the same purpose as the resize mount option. It allows
to resize filesystem to the end of the last existing block group,
further resize has to be done with resize2fs, either online, or
offline. The argument points to the unsigned logn number representing
the filesystem new block count.</p>
</dd>
<dt>EXT4_IOC_MOVE_EXT</dt><dd><p>Move the block extents from orig_fd (the one this ioctl is pointing to)
to the donor_fd (the one specified in move_extent structure passed as
an argument to this ioctl). Then, exchange inode metadata between
orig_fd and donor_fd.  This is especially useful for online
defragmentation, because the allocator has the opportunity to allocate
moved blocks better, ideally into one contiguous extent.</p>
</dd>
<dt>EXT4_IOC_GROUP_ADD</dt><dd><p>Add a new group descriptor to an existing or new group descriptor
block. The new group descriptor is described by ext4_new_group_input
structure, which is passed as an argument to this ioctl. This is
especially useful in conjunction with EXT4_IOC_GROUP_EXTEND, which
allows online resize of the filesystem to the end of the last existing
block group.  Those two ioctls combined is used in userspace online
resize tool (e.g. resize2fs).</p>
</dd>
<dt>EXT4_IOC_MIGRATE</dt><dd><p>This ioctl operates on the filesystem itself.  It converts (migrates)
ext3 indirect block mapped inode to ext4 extent mapped inode by walking
through indirect block mapping of the original inode and converting
contiguous block ranges into ext4 extents of the temporary inode. Then,
inodes are swapped. This ioctl might help, when migrating from ext3 to
ext4 filesystem, however suggestion is to create fresh ext4 filesystem
and copy data from the backup. Note, that filesystem has to support
extents for this ioctl to work.</p>
</dd>
<dt>EXT4_IOC_ALLOC_DA_BLKS</dt><dd><p>Force all of the delay allocated blocks to be allocated to preserve
application-expected ext3 behaviour. Note that this will also start
triggering a write of the data blocks, but this behaviour may change in
the future as it is not necessary and has been done this way only for
sake of simplicity.</p>
</dd>
<dt>EXT4_IOC_RESIZE_FS</dt><dd><p>Resize the filesystem to a new size.  The number of blocks of resized
filesystem is passed in via 64 bit integer argument.  The kernel
allocates bitmaps and inode table, the userspace tool thus just passes
the new number of blocks.</p>
</dd>
<dt>EXT4_IOC_SWAP_BOOT</dt><dd><p>Swap i_blocks and associated attributes (like i_blocks, i_size,
i_flags, ...) from the specified inode with inode EXT4_BOOT_LOADER_INO
(#5). This is typically used to store a boot loader in a secure part of
the filesystem, where it can’t be changed by a normal user by accident.
The data blocks of the previous boot loader will be associated with the
given inode.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>kernel source:  &lt;<a class="reference external" href="file:fs/ext4/">file:fs/ext4/</a>&gt;</dt><dd><p>&lt;<a class="reference external" href="file:fs/jbd2/">file:fs/jbd2/</a>&gt;</p>
</dd>
</dl>
<p>programs:       <a class="reference external" href="http://e2fsprogs.sourceforge.net/">http://e2fsprogs.sourceforge.net/</a></p>
<dl class="simple">
<dt>useful links:   <a class="reference external" href="https://fedoraproject.org/wiki/ext3-devel">https://fedoraproject.org/wiki/ext3-devel</a></dt><dd><p><a class="reference external" href="http://www.bullopensource.org/ext4/">http://www.bullopensource.org/ext4/</a>
<a class="reference external" href="http://ext4.wiki.kernel.org/index.php/Main_Page">http://ext4.wiki.kernel.org/index.php/Main_Page</a>
<a class="reference external" href="https://fedoraproject.org/wiki/Features/Ext4">https://fedoraproject.org/wiki/Features/Ext4</a></p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/admin-guide/ext4.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>