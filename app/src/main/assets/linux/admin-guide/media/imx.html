<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>7.5. i.MX Video Capture Driver &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7.6. i.MX7 Video Capture Driver" href="imx7.html" />
    <link rel="prev" title="7.4. The Samsung S5P/Exynos4 FIMC driver" href="fimc.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.10.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../README.html">Linux kernel release 6.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-parameters.html">The kernel’s command-line parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi.html">Linux ABI description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features.html">Feature status on all architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reporting-regressions.html">Reporting regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickly-build-trimmed-linux.html">How to quickly build a trimmed Linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../verify-bugs-and-bisect-regressions.html">How to verify bugs and bisect regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-hunting.html">Bug hunting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bug-bisect.html">Bisecting a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tainted-kernels.html">Tainted kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ramoops.html">Ramoops oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamic-debug-howto.html">Dynamic debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../init.html">Explaining the “No working init found.” boot hang message</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kdump/index.html">Documentation for Kdump - The kexec-based Crash Dumping Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf/index.html">Performance monitor support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pstore-blk.html">pstore block oops/panic logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workload-tracing.html">Discovering Linux kernel subsystems used by a workload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aoe/index.html">ATA over Ethernet (AoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auxdisplay/index.html">Auxiliary Display Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bcache.html">A block layer cache (bcache)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binderfs.html">The Android binderfs Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../binfmt-misc.html">Kernel Support for miscellaneous Binary Formats (binfmt_misc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blockdev/index.html">Block Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootconfig.html">Boot Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../braille-console.html">Linux Braille Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../btmrvl.html">btmrvl driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v1/index.html">Control Groups version 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cgroup-v2.html">Control Group v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cifs/index.html">CIFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clearing-warn-once.html">Clearing WARN_ONCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpu-load.html">CPU load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dell_rbu.html">Dell Remote BIOS Update driver (dell_rbu)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-mapper/index.html">Device Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edid.html">EDID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../efi-stub.html">The EFI Boot Stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ext4.html">ext4 General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystem-monitoring.html">File system Monitoring with fanotify</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfs/index.html">NFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../highuid.html">Notes on the change from 16-bit UIDs to 32-bit UIDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hw_random.html">Hardware random number generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../initrd.html">Using the initial RAM disk (initrd)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iostats.html">I/O statistics fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../java.html">Java(tm) Binary Kernel Support for Linux v1.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jfs.html">IBM’s Journaled File System (JFS) for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kernel-per-CPU-kthreads.html">Reducing OS jitter due to per-cpu kthreads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../laptops/index.html">Laptop Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lcd-panel-cgram.html">Parallel port LCD/Keypad Panel support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ldm.html">LDM - Logical Disk Manager (Dynamic Disks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lockup-watchdogs.html">Softlockup detector and hardlockup detector (aka nmi_watchdog)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LSM/index.html">Linux Security Module Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md.html">RAID arrays</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Media subsystem admin and user guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="building.html">2. Building support for a media device</a></li>
<li class="toctree-l3"><a class="reference internal" href="remote-controller.html">3. Infrared remote control support in video4linux drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cec.html">4. HDMI CEC</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvb.html">5. Digital TV</a></li>
<li class="toctree-l3"><a class="reference internal" href="cardlist.html">6. Cards List</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="v4l-drivers.html">7. Video4Linux (V4L) driver-specific documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="dvb-drivers.html">8. Digital TV driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mm/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module-signing.html">Kernel module signing facility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mono.html">Mono(tm) Binary Kernel Support for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../namespaces/index.html">Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numastat.html">Numa policy hit/miss statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport.html">Parport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../perf-security.html">Perf events and tool security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pmf.html">Set udev rules for PMF Smart PC Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pnp.html">Linux Plug and Play Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio.html">RapidIO Subsystem Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../RAS/main.html">Reliability, Availability and Serviceability (RAS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../RAS/error-decoding.html">Error decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../RAS/address-translation.html">Address translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rtc.html">Real Time Clock (RTC) Drivers for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial-console.html">Linux Serial Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../svga.html">Video Mode Selection Support 2.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="../syscall-user-dispatch.html">Syscall User Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysrq.html">Linux Magic System Request Key Hacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thermal/index.html">Thermal Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thunderbolt.html">USB4 and Thunderbolt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ufs.html">Using UFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unicode.html">Unicode support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vga-softcursor.html">Software cursor for VGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../video-output.html">Video Output Switcher Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfs.html">The SGI XFS Filesystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/media/imx.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="i-mx-video-capture-driver">
<h1><span class="section-number">7.5. </span>i.MX Video Capture Driver<a class="headerlink" href="#i-mx-video-capture-driver" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2><span class="section-number">7.5.1. </span>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>The Freescale i.MX5/6 contains an Image Processing Unit (IPU), which
handles the flow of image frames to and from capture devices and
display devices.</p>
<p>For image capture, the IPU contains the following internal subunits:</p>
<ul class="simple">
<li><p>Image DMA Controller (IDMAC)</p></li>
<li><p>Camera Serial Interface (CSI)</p></li>
<li><p>Image Converter (IC)</p></li>
<li><p>Sensor Multi-FIFO Controller (SMFC)</p></li>
<li><p>Image Rotator (IRT)</p></li>
<li><p>Video De-Interlacing or Combining Block (VDIC)</p></li>
</ul>
<p>The IDMAC is the DMA controller for transfer of image frames to and from
memory. Various dedicated DMA channels exist for both video capture and
display paths. During transfer, the IDMAC is also capable of vertical
image flip, 8x8 block transfer (see IRT description), pixel component
re-ordering (for example UYVY to YUYV) within the same colorspace, and
packed &lt;--&gt; planar conversion. The IDMAC can also perform a simple
de-interlacing by interweaving even and odd lines during transfer
(without motion compensation which requires the VDIC).</p>
<p>The CSI is the backend capture unit that interfaces directly with
camera sensors over Parallel, BT.656/1120, and MIPI CSI-2 buses.</p>
<p>The IC handles color-space conversion, resizing (downscaling and
upscaling), horizontal flip, and 90/270 degree rotation operations.</p>
<p>There are three independent “tasks” within the IC that can carry out
conversions concurrently: pre-process encoding, pre-process viewfinder,
and post-processing. Within each task, conversions are split into three
sections: downsizing section, main section (upsizing, flip, colorspace
conversion, and graphics plane combining), and rotation section.</p>
<p>The IPU time-shares the IC task operations. The time-slice granularity
is one burst of eight pixels in the downsizing section, one image line
in the main processing section, one image frame in the rotation section.</p>
<p>The SMFC is composed of four independent FIFOs that each can transfer
captured frames from sensors directly to memory concurrently via four
IDMAC channels.</p>
<p>The IRT carries out 90 and 270 degree image rotation operations. The
rotation operation is carried out on 8x8 pixel blocks at a time. This
operation is supported by the IDMAC which handles the 8x8 block transfer
along with block reordering, in coordination with vertical flip.</p>
<p>The VDIC handles the conversion of interlaced video to progressive, with
support for different motion compensation modes (low, medium, and high
motion). The deinterlaced output frames from the VDIC can be sent to the
IC pre-process viewfinder task for further conversions. The VDIC also
contains a Combiner that combines two image planes, with alpha blending
and color keying.</p>
<p>In addition to the IPU internal subunits, there are also two units
outside the IPU that are also involved in video capture on i.MX:</p>
<ul class="simple">
<li><p>MIPI CSI-2 Receiver for camera sensors with the MIPI CSI-2 bus
interface. This is a Synopsys DesignWare core.</p></li>
<li><p>Two video multiplexers for selecting among multiple sensor inputs
to send to a CSI.</p></li>
</ul>
<p>For more info, refer to the latest versions of the i.MX5/6 reference
manuals <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> and <a class="footnote-reference brackets" href="#f2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="features">
<h2><span class="section-number">7.5.2. </span>Features<a class="headerlink" href="#features" title="Link to this heading">¶</a></h2>
<p>Some of the features of this driver include:</p>
<ul class="simple">
<li><p>Many different pipelines can be configured via media controller API,
that correspond to the hardware video capture pipelines supported in
the i.MX.</p></li>
<li><p>Supports parallel, BT.565, and MIPI CSI-2 interfaces.</p></li>
<li><p>Concurrent independent streams, by configuring pipelines to multiple
video capture interfaces using independent entities.</p></li>
<li><p>Scaling, color-space conversion, horizontal and vertical flip, and
image rotation via IC task subdevs.</p></li>
<li><p>Many pixel formats supported (RGB, packed and planar YUV, partial
planar YUV).</p></li>
<li><p>The VDIC subdev supports motion compensated de-interlacing, with three
motion compensation modes: low, medium, and high motion. Pipelines are
defined that allow sending frames to the VDIC subdev directly from the
CSI. There is also support in the future for sending frames to the
VDIC from memory buffers via a output/mem2mem devices.</p></li>
<li><p>Includes a Frame Interval Monitor (FIM) that can correct vertical sync
problems with the ADV718x video decoders.</p></li>
</ul>
</section>
<section id="topology">
<h2><span class="section-number">7.5.3. </span>Topology<a class="headerlink" href="#topology" title="Link to this heading">¶</a></h2>
<p>The following shows the media topologies for the i.MX6Q SabreSD and
i.MX6Q SabreAuto. Refer to these diagrams in the entity descriptions
in the next section.</p>
<p>The i.MX5/6 topologies can differ upstream from the IPUv3 CSI video
multiplexers, but the internal IPUv3 topology downstream from there
is common to all i.MX5/6 platforms. For example, the SabreSD, with the
MIPI CSI-2 OV5640 sensor, requires the i.MX6 MIPI CSI-2 receiver. But
the SabreAuto has only the ADV7180 decoder on a parallel bt.656 bus, and
therefore does not require the MIPI CSI-2 receiver, so it is missing in
its graph.</p>
<figure class="align-center" id="id3">
<img alt="Diagram of the i.MX6Q SabreSD media pipeline topology" src="../../_images/imx6q-sabresd.svg" /><figcaption>
<p><span class="caption-text">Media pipeline graph on i.MX6Q SabreSD</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id4">
<img alt="Diagram of the i.MX6Q SabreAuto media pipeline topology" src="../../_images/imx6q-sabreauto.svg" /><figcaption>
<p><span class="caption-text">Media pipeline graph on i.MX6Q SabreAuto</span><a class="headerlink" href="#id4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="entities">
<h2><span class="section-number">7.5.4. </span>Entities<a class="headerlink" href="#entities" title="Link to this heading">¶</a></h2>
</section>
<section id="imx6-mipi-csi2">
<h2><span class="section-number">7.5.5. </span>imx6-mipi-csi2<a class="headerlink" href="#imx6-mipi-csi2" title="Link to this heading">¶</a></h2>
<p>This is the MIPI CSI-2 receiver entity. It has one sink pad to receive
the MIPI CSI-2 stream (usually from a MIPI CSI-2 camera sensor). It has
four source pads, corresponding to the four MIPI CSI-2 demuxed virtual
channel outputs. Multiple source pads can be enabled to independently
stream from multiple virtual channels.</p>
<p>This entity actually consists of two sub-blocks. One is the MIPI CSI-2
core. This is a Synopsys Designware MIPI CSI-2 core. The other sub-block
is a “CSI-2 to IPU gasket”. The gasket acts as a demultiplexer of the
four virtual channels streams, providing four separate parallel buses
containing each virtual channel that are routed to CSIs or video
multiplexers as described below.</p>
<p>On i.MX6 solo/dual-lite, all four virtual channel buses are routed to
two video multiplexers. Both CSI0 and CSI1 can receive any virtual
channel, as selected by the video multiplexers.</p>
<p>On i.MX6 Quad, virtual channel 0 is routed to IPU1-CSI0 (after selected
by a video mux), virtual channels 1 and 2 are hard-wired to IPU1-CSI1
and IPU2-CSI0, respectively, and virtual channel 3 is routed to
IPU2-CSI1 (again selected by a video mux).</p>
</section>
<section id="ipux-csiy-mux">
<h2><span class="section-number">7.5.6. </span>ipuX_csiY_mux<a class="headerlink" href="#ipux-csiy-mux" title="Link to this heading">¶</a></h2>
<p>These are the video multiplexers. They have two or more sink pads to
select from either camera sensors with a parallel interface, or from
MIPI CSI-2 virtual channels from imx6-mipi-csi2 entity. They have a
single source pad that routes to a CSI (ipuX_csiY entities).</p>
<p>On i.MX6 solo/dual-lite, there are two video mux entities. One sits
in front of IPU1-CSI0 to select between a parallel sensor and any of
the four MIPI CSI-2 virtual channels (a total of five sink pads). The
other mux sits in front of IPU1-CSI1, and again has five sink pads to
select between a parallel sensor and any of the four MIPI CSI-2 virtual
channels.</p>
<p>On i.MX6 Quad, there are two video mux entities. One sits in front of
IPU1-CSI0 to select between a parallel sensor and MIPI CSI-2 virtual
channel 0 (two sink pads). The other mux sits in front of IPU2-CSI1 to
select between a parallel sensor and MIPI CSI-2 virtual channel 3 (two
sink pads).</p>
</section>
<section id="ipux-csiy">
<h2><span class="section-number">7.5.7. </span>ipuX_csiY<a class="headerlink" href="#ipux-csiy" title="Link to this heading">¶</a></h2>
<p>These are the CSI entities. They have a single sink pad receiving from
either a video mux or from a MIPI CSI-2 virtual channel as described
above.</p>
<p>This entity has two source pads. The first source pad can link directly
to the ipuX_vdic entity or the ipuX_ic_prp entity, using hardware links
that require no IDMAC memory buffer transfer.</p>
<p>When the direct source pad is routed to the ipuX_ic_prp entity, frames
from the CSI can be processed by one or both of the IC pre-processing
tasks.</p>
<p>When the direct source pad is routed to the ipuX_vdic entity, the VDIC
will carry out motion-compensated de-interlace using “high motion” mode
(see description of ipuX_vdic entity).</p>
<p>The second source pad sends video frames directly to memory buffers
via the SMFC and an IDMAC channel, bypassing IC pre-processing. This
source pad is routed to a capture device node, with a node name of the
format “ipuX_csiY capture”.</p>
<p>Note that since the IDMAC source pad makes use of an IDMAC channel,
pixel reordering within the same colorspace can be carried out by the
IDMAC channel. For example, if the CSI sink pad is receiving in UYVY
order, the capture device linked to the IDMAC source pad can capture
in YUYV order. Also, if the CSI sink pad is receiving a packed YUV
format, the capture device can capture a planar YUV format such as
YUV420.</p>
<p>The IDMAC channel at the IDMAC source pad also supports simple
interweave without motion compensation, which is activated if the source
pad’s field type is sequential top-bottom or bottom-top, and the
requested capture interface field type is set to interlaced (t-b, b-t,
or unqualified interlaced). The capture interface will enforce the same
field order as the source pad field order (interlaced-bt if source pad
is seq-bt, interlaced-tb if source pad is seq-tb).</p>
<p>For events produced by ipuX_csiY, see ref:<cite>imx_api_ipuX_csiY</cite>.</p>
</section>
<section id="cropping-in-ipux-csiy">
<h2><span class="section-number">7.5.8. </span>Cropping in ipuX_csiY<a class="headerlink" href="#cropping-in-ipux-csiy" title="Link to this heading">¶</a></h2>
<p>The CSI supports cropping the incoming raw sensor frames. This is
implemented in the ipuX_csiY entities at the sink pad, using the
crop selection subdev API.</p>
<p>The CSI also supports fixed divide-by-two downscaling independently in
width and height. This is implemented in the ipuX_csiY entities at
the sink pad, using the compose selection subdev API.</p>
<p>The output rectangle at the ipuX_csiY source pad is the same as
the compose rectangle at the sink pad. So the source pad rectangle
cannot be negotiated, it must be set using the compose selection
API at sink pad (if /2 downscale is desired, otherwise source pad
rectangle is equal to incoming rectangle).</p>
<p>To give an example of crop and /2 downscale, this will crop a
1280x960 input frame to 640x480, and then /2 downscale in both
dimensions to 320x240 (assumes ipu1_csi0 is linked to ipu1_csi0_mux):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>media-ctl -V &quot;&#39;ipu1_csi0_mux&#39;:2[fmt:UYVY2X8/1280x960]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:0[crop:(0,0)/640x480]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:0[compose:(0,0)/320x240]&quot;
</pre></div>
</div>
</section>
<section id="frame-skipping-in-ipux-csiy">
<h2><span class="section-number">7.5.9. </span>Frame Skipping in ipuX_csiY<a class="headerlink" href="#frame-skipping-in-ipux-csiy" title="Link to this heading">¶</a></h2>
<p>The CSI supports frame rate decimation, via frame skipping. Frame
rate decimation is specified by setting the frame intervals at
sink and source pads. The ipuX_csiY entity then applies the best
frame skip setting to the CSI to achieve the desired frame rate
at the source pad.</p>
<p>The following example reduces an assumed incoming 60 Hz frame
rate by half at the IDMAC output source pad:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>media-ctl -V &quot;&#39;ipu1_csi0&#39;:0[fmt:UYVY2X8/640x480@1/60]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:2[fmt:UYVY2X8/640x480@1/30]&quot;
</pre></div>
</div>
</section>
<section id="frame-interval-monitor-in-ipux-csiy">
<h2><span class="section-number">7.5.10. </span>Frame Interval Monitor in ipuX_csiY<a class="headerlink" href="#frame-interval-monitor-in-ipux-csiy" title="Link to this heading">¶</a></h2>
<p>See ref:<cite>imx_api_FIM</cite>.</p>
</section>
<section id="ipux-vdic">
<h2><span class="section-number">7.5.11. </span>ipuX_vdic<a class="headerlink" href="#ipux-vdic" title="Link to this heading">¶</a></h2>
<p>The VDIC carries out motion compensated de-interlacing, with three
motion compensation modes: low, medium, and high motion. The mode is
specified with the menu control V4L2_CID_DEINTERLACING_MODE. The VDIC
has two sink pads and a single source pad.</p>
<p>The direct sink pad receives from an ipuX_csiY direct pad. With this
link the VDIC can only operate in high motion mode.</p>
<p>When the IDMAC sink pad is activated, it receives from an output
or mem2mem device node. With this pipeline, the VDIC can also operate
in low and medium modes, because these modes require receiving
frames from memory buffers. Note that an output or mem2mem device
is not implemented yet, so this sink pad currently has no links.</p>
<p>The source pad routes to the IC pre-processing entity ipuX_ic_prp.</p>
</section>
<section id="ipux-ic-prp">
<h2><span class="section-number">7.5.12. </span>ipuX_ic_prp<a class="headerlink" href="#ipux-ic-prp" title="Link to this heading">¶</a></h2>
<p>This is the IC pre-processing entity. It acts as a router, routing
data from its sink pad to one or both of its source pads.</p>
<p>This entity has a single sink pad. The sink pad can receive from the
ipuX_csiY direct pad, or from ipuX_vdic.</p>
<p>This entity has two source pads. One source pad routes to the
pre-process encode task entity (ipuX_ic_prpenc), the other to the
pre-process viewfinder task entity (ipuX_ic_prpvf). Both source pads
can be activated at the same time if the sink pad is receiving from
ipuX_csiY. Only the source pad to the pre-process viewfinder task entity
can be activated if the sink pad is receiving from ipuX_vdic (frames
from the VDIC can only be processed by the pre-process viewfinder task).</p>
</section>
<section id="ipux-ic-prpenc">
<h2><span class="section-number">7.5.13. </span>ipuX_ic_prpenc<a class="headerlink" href="#ipux-ic-prpenc" title="Link to this heading">¶</a></h2>
<p>This is the IC pre-processing encode entity. It has a single sink
pad from ipuX_ic_prp, and a single source pad. The source pad is
routed to a capture device node, with a node name of the format
“ipuX_ic_prpenc capture”.</p>
<p>This entity performs the IC pre-process encode task operations:
color-space conversion, resizing (downscaling and upscaling),
horizontal and vertical flip, and 90/270 degree rotation. Flip
and rotation are provided via standard V4L2 controls.</p>
<p>Like the ipuX_csiY IDMAC source, this entity also supports simple
de-interlace without motion compensation, and pixel reordering.</p>
</section>
<section id="ipux-ic-prpvf">
<h2><span class="section-number">7.5.14. </span>ipuX_ic_prpvf<a class="headerlink" href="#ipux-ic-prpvf" title="Link to this heading">¶</a></h2>
<p>This is the IC pre-processing viewfinder entity. It has a single sink
pad from ipuX_ic_prp, and a single source pad. The source pad is routed
to a capture device node, with a node name of the format
“ipuX_ic_prpvf capture”.</p>
<p>This entity is identical in operation to ipuX_ic_prpenc, with the same
resizing and CSC operations and flip/rotation controls. It will receive
and process de-interlaced frames from the ipuX_vdic if ipuX_ic_prp is
receiving from ipuX_vdic.</p>
<p>Like the ipuX_csiY IDMAC source, this entity supports simple
interweaving without motion compensation. However, note that if the
ipuX_vdic is included in the pipeline (ipuX_ic_prp is receiving from
ipuX_vdic), it’s not possible to use interweave in ipuX_ic_prpvf,
since the ipuX_vdic has already carried out de-interlacing (with
motion compensation) and therefore the field type output from
ipuX_vdic can only be none (progressive).</p>
</section>
<section id="capture-pipelines">
<h2><span class="section-number">7.5.15. </span>Capture Pipelines<a class="headerlink" href="#capture-pipelines" title="Link to this heading">¶</a></h2>
<p>The following describe the various use-cases supported by the pipelines.</p>
<p>The links shown do not include the backend sensor, video mux, or mipi
csi-2 receiver links. This depends on the type of sensor interface
(parallel or mipi csi-2). So these pipelines begin with:</p>
<p>sensor -&gt; ipuX_csiY_mux -&gt; ...</p>
<p>for parallel sensors, or:</p>
<p>sensor -&gt; imx6-mipi-csi2 -&gt; (ipuX_csiY_mux) -&gt; ...</p>
<p>for mipi csi-2 sensors. The imx6-mipi-csi2 receiver may need to route
to the video mux (ipuX_csiY_mux) before sending to the CSI, depending
on the mipi csi-2 virtual channel, hence ipuX_csiY_mux is shown in
parenthesis.</p>
</section>
<section id="unprocessed-video-capture">
<h2><span class="section-number">7.5.16. </span>Unprocessed Video Capture:<a class="headerlink" href="#unprocessed-video-capture" title="Link to this heading">¶</a></h2>
<p>Send frames directly from sensor to camera device interface node, with
no conversions, via ipuX_csiY IDMAC source pad:</p>
<p>-&gt; ipuX_csiY:2 -&gt; ipuX_csiY capture</p>
</section>
<section id="ic-direct-conversions">
<h2><span class="section-number">7.5.17. </span>IC Direct Conversions:<a class="headerlink" href="#ic-direct-conversions" title="Link to this heading">¶</a></h2>
<p>This pipeline uses the preprocess encode entity to route frames directly
from the CSI to the IC, to carry out scaling up to 1024x1024 resolution,
CSC, flipping, and image rotation:</p>
<p>-&gt; ipuX_csiY:1 -&gt; 0:ipuX_ic_prp:1 -&gt; 0:ipuX_ic_prpenc:1 -&gt; ipuX_ic_prpenc capture</p>
</section>
<section id="motion-compensated-de-interlace">
<h2><span class="section-number">7.5.18. </span>Motion Compensated De-interlace:<a class="headerlink" href="#motion-compensated-de-interlace" title="Link to this heading">¶</a></h2>
<p>This pipeline routes frames from the CSI direct pad to the VDIC entity to
support motion-compensated de-interlacing (high motion mode only),
scaling up to 1024x1024, CSC, flip, and rotation:</p>
<p>-&gt; ipuX_csiY:1 -&gt; 0:ipuX_vdic:2 -&gt; 0:ipuX_ic_prp:2 -&gt; 0:ipuX_ic_prpvf:1 -&gt; ipuX_ic_prpvf capture</p>
</section>
<section id="usage-notes">
<h2><span class="section-number">7.5.19. </span>Usage Notes<a class="headerlink" href="#usage-notes" title="Link to this heading">¶</a></h2>
<p>To aid in configuration and for backward compatibility with V4L2
applications that access controls only from video device nodes, the
capture device interfaces inherit controls from the active entities
in the current pipeline, so controls can be accessed either directly
from the subdev or from the active capture device interface. For
example, the FIM controls are available either from the ipuX_csiY
subdevs or from the active capture device.</p>
<p>The following are specific usage notes for the Sabre* reference
boards:</p>
</section>
<section id="i-mx6q-sabrelite-with-ov5642-and-ov5640">
<h2><span class="section-number">7.5.20. </span>i.MX6Q SabreLite with OV5642 and OV5640<a class="headerlink" href="#i-mx6q-sabrelite-with-ov5642-and-ov5640" title="Link to this heading">¶</a></h2>
<p>This platform requires the OmniVision OV5642 module with a parallel
camera interface, and the OV5640 module with a MIPI CSI-2
interface. Both modules are available from Boundary Devices:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://boundarydevices.com/product/nit6x_5mp">https://boundarydevices.com/product/nit6x_5mp</a></p></li>
<li><p><a class="reference external" href="https://boundarydevices.com/product/nit6x_5mp_mipi">https://boundarydevices.com/product/nit6x_5mp_mipi</a></p></li>
</ul>
<p>Note that if only one camera module is available, the other sensor
node can be disabled in the device tree.</p>
<p>The OV5642 module is connected to the parallel bus input on the i.MX
internal video mux to IPU1 CSI0. It’s i2c bus connects to i2c bus 2.</p>
<p>The MIPI CSI-2 OV5640 module is connected to the i.MX internal MIPI CSI-2
receiver, and the four virtual channel outputs from the receiver are
routed as follows: vc0 to the IPU1 CSI0 mux, vc1 directly to IPU1 CSI1,
vc2 directly to IPU2 CSI0, and vc3 to the IPU2 CSI1 mux. The OV5640 is
also connected to i2c bus 2 on the SabreLite, therefore the OV5642 and
OV5640 must not share the same i2c slave address.</p>
<p>The following basic example configures unprocessed video capture
pipelines for both sensors. The OV5642 is routed to ipu1_csi0, and
the OV5640, transmitting on MIPI CSI-2 virtual channel 1 (which is
imx6-mipi-csi2 pad 2), is routed to ipu1_csi1. Both sensors are
configured to output 640x480, and the OV5642 outputs YUYV2X8, the
OV5640 UYVY2X8:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Setup links for OV5642
media-ctl -l &quot;&#39;ov5642 1-0042&#39;:0 -&gt; &#39;ipu1_csi0_mux&#39;:1[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0_mux&#39;:2 -&gt; &#39;ipu1_csi0&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0&#39;:2 -&gt; &#39;ipu1_csi0 capture&#39;:0[1]&quot;
# Setup links for OV5640
media-ctl -l &quot;&#39;ov5640 1-0040&#39;:0 -&gt; &#39;imx6-mipi-csi2&#39;:0[1]&quot;
media-ctl -l &quot;&#39;imx6-mipi-csi2&#39;:2 -&gt; &#39;ipu1_csi1&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi1&#39;:2 -&gt; &#39;ipu1_csi1 capture&#39;:0[1]&quot;
# Configure pads for OV5642 pipeline
media-ctl -V &quot;&#39;ov5642 1-0042&#39;:0 [fmt:YUYV2X8/640x480 field:none]&quot;
media-ctl -V &quot;&#39;ipu1_csi0_mux&#39;:2 [fmt:YUYV2X8/640x480 field:none]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:2 [fmt:AYUV32/640x480 field:none]&quot;
# Configure pads for OV5640 pipeline
media-ctl -V &quot;&#39;ov5640 1-0040&#39;:0 [fmt:UYVY2X8/640x480 field:none]&quot;
media-ctl -V &quot;&#39;imx6-mipi-csi2&#39;:2 [fmt:UYVY2X8/640x480 field:none]&quot;
media-ctl -V &quot;&#39;ipu1_csi1&#39;:2 [fmt:AYUV32/640x480 field:none]&quot;
</pre></div>
</div>
<p>Streaming can then begin independently on the capture device nodes
“ipu1_csi0 capture” and “ipu1_csi1 capture”. The v4l2-ctl tool can
be used to select any supported YUV pixelformat on the capture device
nodes, including planar.</p>
</section>
<section id="i-mx6q-sabreauto-with-adv7180-decoder">
<h2><span class="section-number">7.5.21. </span>i.MX6Q SabreAuto with ADV7180 decoder<a class="headerlink" href="#i-mx6q-sabreauto-with-adv7180-decoder" title="Link to this heading">¶</a></h2>
<p>On the i.MX6Q SabreAuto, an on-board ADV7180 SD decoder is connected to the
parallel bus input on the internal video mux to IPU1 CSI0.</p>
<p>The following example configures a pipeline to capture from the ADV7180
video decoder, assuming NTSC 720x480 input signals, using simple
interweave (unconverted and without motion compensation). The adv7180
must output sequential or alternating fields (field type ‘seq-bt’ for
NTSC, or ‘alternate’):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Setup links
media-ctl -l &quot;&#39;adv7180 3-0021&#39;:0 -&gt; &#39;ipu1_csi0_mux&#39;:1[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0_mux&#39;:2 -&gt; &#39;ipu1_csi0&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0&#39;:2 -&gt; &#39;ipu1_csi0 capture&#39;:0[1]&quot;
# Configure pads
media-ctl -V &quot;&#39;adv7180 3-0021&#39;:0 [fmt:UYVY2X8/720x480 field:seq-bt]&quot;
media-ctl -V &quot;&#39;ipu1_csi0_mux&#39;:2 [fmt:UYVY2X8/720x480]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:2 [fmt:AYUV32/720x480]&quot;
# Configure &quot;ipu1_csi0 capture&quot; interface (assumed at /dev/video4)
v4l2-ctl -d4 --set-fmt-video=field=interlaced_bt
</pre></div>
</div>
<p>Streaming can then begin on /dev/video4. The v4l2-ctl tool can also be
used to select any supported YUV pixelformat on /dev/video4.</p>
<p>This example configures a pipeline to capture from the ADV7180
video decoder, assuming PAL 720x576 input signals, with Motion
Compensated de-interlacing. The adv7180 must output sequential or
alternating fields (field type ‘seq-tb’ for PAL, or ‘alternate’).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Setup links
media-ctl -l &quot;&#39;adv7180 3-0021&#39;:0 -&gt; &#39;ipu1_csi0_mux&#39;:1[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0_mux&#39;:2 -&gt; &#39;ipu1_csi0&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0&#39;:1 -&gt; &#39;ipu1_vdic&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_vdic&#39;:2 -&gt; &#39;ipu1_ic_prp&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_ic_prp&#39;:2 -&gt; &#39;ipu1_ic_prpvf&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_ic_prpvf&#39;:1 -&gt; &#39;ipu1_ic_prpvf capture&#39;:0[1]&quot;
# Configure pads
media-ctl -V &quot;&#39;adv7180 3-0021&#39;:0 [fmt:UYVY2X8/720x576 field:seq-tb]&quot;
media-ctl -V &quot;&#39;ipu1_csi0_mux&#39;:2 [fmt:UYVY2X8/720x576]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:1 [fmt:AYUV32/720x576]&quot;
media-ctl -V &quot;&#39;ipu1_vdic&#39;:2 [fmt:AYUV32/720x576 field:none]&quot;
media-ctl -V &quot;&#39;ipu1_ic_prp&#39;:2 [fmt:AYUV32/720x576 field:none]&quot;
media-ctl -V &quot;&#39;ipu1_ic_prpvf&#39;:1 [fmt:AYUV32/720x576 field:none]&quot;
# Configure &quot;ipu1_ic_prpvf capture&quot; interface (assumed at /dev/video2)
v4l2-ctl -d2 --set-fmt-video=field=none
</pre></div>
</div>
<p>Streaming can then begin on /dev/video2. The v4l2-ctl tool can also be
used to select any supported YUV pixelformat on /dev/video2.</p>
<p>This platform accepts Composite Video analog inputs to the ADV7180 on
Ain1 (connector J42).</p>
</section>
<section id="i-mx6dl-sabreauto-with-adv7180-decoder">
<h2><span class="section-number">7.5.22. </span>i.MX6DL SabreAuto with ADV7180 decoder<a class="headerlink" href="#i-mx6dl-sabreauto-with-adv7180-decoder" title="Link to this heading">¶</a></h2>
<p>On the i.MX6DL SabreAuto, an on-board ADV7180 SD decoder is connected to the
parallel bus input on the internal video mux to IPU1 CSI0.</p>
<p>The following example configures a pipeline to capture from the ADV7180
video decoder, assuming NTSC 720x480 input signals, using simple
interweave (unconverted and without motion compensation). The adv7180
must output sequential or alternating fields (field type ‘seq-bt’ for
NTSC, or ‘alternate’):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Setup links
media-ctl -l &quot;&#39;adv7180 4-0021&#39;:0 -&gt; &#39;ipu1_csi0_mux&#39;:4[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0_mux&#39;:5 -&gt; &#39;ipu1_csi0&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0&#39;:2 -&gt; &#39;ipu1_csi0 capture&#39;:0[1]&quot;
# Configure pads
media-ctl -V &quot;&#39;adv7180 4-0021&#39;:0 [fmt:UYVY2X8/720x480 field:seq-bt]&quot;
media-ctl -V &quot;&#39;ipu1_csi0_mux&#39;:5 [fmt:UYVY2X8/720x480]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:2 [fmt:AYUV32/720x480]&quot;
# Configure &quot;ipu1_csi0 capture&quot; interface (assumed at /dev/video0)
v4l2-ctl -d0 --set-fmt-video=field=interlaced_bt
</pre></div>
</div>
<p>Streaming can then begin on /dev/video0. The v4l2-ctl tool can also be
used to select any supported YUV pixelformat on /dev/video0.</p>
<p>This example configures a pipeline to capture from the ADV7180
video decoder, assuming PAL 720x576 input signals, with Motion
Compensated de-interlacing. The adv7180 must output sequential or
alternating fields (field type ‘seq-tb’ for PAL, or ‘alternate’).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Setup links
media-ctl -l &quot;&#39;adv7180 4-0021&#39;:0 -&gt; &#39;ipu1_csi0_mux&#39;:4[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0_mux&#39;:5 -&gt; &#39;ipu1_csi0&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0&#39;:1 -&gt; &#39;ipu1_vdic&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_vdic&#39;:2 -&gt; &#39;ipu1_ic_prp&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_ic_prp&#39;:2 -&gt; &#39;ipu1_ic_prpvf&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_ic_prpvf&#39;:1 -&gt; &#39;ipu1_ic_prpvf capture&#39;:0[1]&quot;
# Configure pads
media-ctl -V &quot;&#39;adv7180 4-0021&#39;:0 [fmt:UYVY2X8/720x576 field:seq-tb]&quot;
media-ctl -V &quot;&#39;ipu1_csi0_mux&#39;:5 [fmt:UYVY2X8/720x576]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:1 [fmt:AYUV32/720x576]&quot;
media-ctl -V &quot;&#39;ipu1_vdic&#39;:2 [fmt:AYUV32/720x576 field:none]&quot;
media-ctl -V &quot;&#39;ipu1_ic_prp&#39;:2 [fmt:AYUV32/720x576 field:none]&quot;
media-ctl -V &quot;&#39;ipu1_ic_prpvf&#39;:1 [fmt:AYUV32/720x576 field:none]&quot;
# Configure &quot;ipu1_ic_prpvf capture&quot; interface (assumed at /dev/video2)
v4l2-ctl -d2 --set-fmt-video=field=none
</pre></div>
</div>
<p>Streaming can then begin on /dev/video2. The v4l2-ctl tool can also be
used to select any supported YUV pixelformat on /dev/video2.</p>
<p>This platform accepts Composite Video analog inputs to the ADV7180 on
Ain1 (connector J42).</p>
</section>
<section id="i-mx6q-sabresd-with-mipi-csi-2-ov5640">
<h2><span class="section-number">7.5.23. </span>i.MX6Q SabreSD with MIPI CSI-2 OV5640<a class="headerlink" href="#i-mx6q-sabresd-with-mipi-csi-2-ov5640" title="Link to this heading">¶</a></h2>
<p>Similarly to i.MX6Q SabreLite, the i.MX6Q SabreSD supports a parallel
interface OV5642 module on IPU1 CSI0, and a MIPI CSI-2 OV5640
module. The OV5642 connects to i2c bus 1 and the OV5640 to i2c bus 2.</p>
<p>The device tree for SabreSD includes OF graphs for both the parallel
OV5642 and the MIPI CSI-2 OV5640, but as of this writing only the MIPI
CSI-2 OV5640 has been tested, so the OV5642 node is currently disabled.
The OV5640 module connects to MIPI connector J5. The NXP part number
for the OV5640 module that connects to the SabreSD board is H120729.</p>
<p>The following example configures unprocessed video capture pipeline to
capture from the OV5640, transmitting on MIPI CSI-2 virtual channel 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Setup links
media-ctl -l &quot;&#39;ov5640 1-003c&#39;:0 -&gt; &#39;imx6-mipi-csi2&#39;:0[1]&quot;
media-ctl -l &quot;&#39;imx6-mipi-csi2&#39;:1 -&gt; &#39;ipu1_csi0_mux&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0_mux&#39;:2 -&gt; &#39;ipu1_csi0&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0&#39;:2 -&gt; &#39;ipu1_csi0 capture&#39;:0[1]&quot;
# Configure pads
media-ctl -V &quot;&#39;ov5640 1-003c&#39;:0 [fmt:UYVY2X8/640x480]&quot;
media-ctl -V &quot;&#39;imx6-mipi-csi2&#39;:1 [fmt:UYVY2X8/640x480]&quot;
media-ctl -V &quot;&#39;ipu1_csi0_mux&#39;:0 [fmt:UYVY2X8/640x480]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:0 [fmt:AYUV32/640x480]&quot;
</pre></div>
</div>
<p>Streaming can then begin on “ipu1_csi0 capture” node. The v4l2-ctl
tool can be used to select any supported pixelformat on the capture
device node.</p>
<p>To determine what is the /dev/video node correspondent to
“ipu1_csi0 capture”:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>media-ctl -e &quot;ipu1_csi0 capture&quot;
/dev/video0
</pre></div>
</div>
<p>/dev/video0 is the streaming element in this case.</p>
<p>Starting the streaming via v4l2-ctl:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>v4l2-ctl --stream-mmap -d /dev/video0
</pre></div>
</div>
<p>Starting the streaming via Gstreamer and sending the content to the display:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video0 ! kmssink
</pre></div>
</div>
<p>The following example configures a direct conversion pipeline to capture
from the OV5640, transmitting on MIPI CSI-2 virtual channel 0. It also
shows colorspace conversion and scaling at IC output.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Setup links
media-ctl -l &quot;&#39;ov5640 1-003c&#39;:0 -&gt; &#39;imx6-mipi-csi2&#39;:0[1]&quot;
media-ctl -l &quot;&#39;imx6-mipi-csi2&#39;:1 -&gt; &#39;ipu1_csi0_mux&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0_mux&#39;:2 -&gt; &#39;ipu1_csi0&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_csi0&#39;:1 -&gt; &#39;ipu1_ic_prp&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_ic_prp&#39;:1 -&gt; &#39;ipu1_ic_prpenc&#39;:0[1]&quot;
media-ctl -l &quot;&#39;ipu1_ic_prpenc&#39;:1 -&gt; &#39;ipu1_ic_prpenc capture&#39;:0[1]&quot;
# Configure pads
media-ctl -V &quot;&#39;ov5640 1-003c&#39;:0 [fmt:UYVY2X8/640x480]&quot;
media-ctl -V &quot;&#39;imx6-mipi-csi2&#39;:1 [fmt:UYVY2X8/640x480]&quot;
media-ctl -V &quot;&#39;ipu1_csi0_mux&#39;:2 [fmt:UYVY2X8/640x480]&quot;
media-ctl -V &quot;&#39;ipu1_csi0&#39;:1 [fmt:AYUV32/640x480]&quot;
media-ctl -V &quot;&#39;ipu1_ic_prp&#39;:1 [fmt:AYUV32/640x480]&quot;
media-ctl -V &quot;&#39;ipu1_ic_prpenc&#39;:1 [fmt:ARGB8888_1X32/800x600]&quot;
# Set a format at the capture interface
v4l2-ctl -d /dev/video1 --set-fmt-video=pixelformat=RGB3
</pre></div>
</div>
<p>Streaming can then begin on “ipu1_ic_prpenc capture” node.</p>
<p>To determine what is the /dev/video node correspondent to
“ipu1_ic_prpenc capture”:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>media-ctl -e &quot;ipu1_ic_prpenc capture&quot;
/dev/video1
</pre></div>
</div>
<p>/dev/video1 is the streaming element in this case.</p>
<p>Starting the streaming via v4l2-ctl:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>v4l2-ctl --stream-mmap -d /dev/video1
</pre></div>
</div>
<p>Starting the streaming via Gstreamer and sending the content to the display:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video1 ! kmssink
</pre></div>
</div>
</section>
<section id="known-issues">
<h2><span class="section-number">7.5.24. </span>Known Issues<a class="headerlink" href="#known-issues" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>When using 90 or 270 degree rotation control at capture resolutions
near the IC resizer limit of 1024x1024, and combined with planar
pixel formats (YUV420, YUV422p), frame capture will often fail with
no end-of-frame interrupts from the IDMAC channel. To work around
this, use lower resolution and/or packed formats (YUYV, RGB3, etc.)
when 90 or 270 rotations are needed.</p></li>
</ol>
</section>
<section id="file-list">
<h2><span class="section-number">7.5.25. </span>File list<a class="headerlink" href="#file-list" title="Link to this heading">¶</a></h2>
<p>drivers/staging/media/imx/
include/media/imx.h
include/linux/imx-media.h</p>
</section>
<section id="references">
<h2><span class="section-number">7.5.26. </span>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://www.nxp.com/assets/documents/data/en/reference-manuals/IMX6DQRM.pdf">http://www.nxp.com/assets/documents/data/en/reference-manuals/IMX6DQRM.pdf</a></p>
</aside>
<aside class="footnote brackets" id="f2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://www.nxp.com/assets/documents/data/en/reference-manuals/IMX6SDLRM.pdf">http://www.nxp.com/assets/documents/data/en/reference-manuals/IMX6SDLRM.pdf</a></p>
</aside>
</aside>
</section>
<section id="authors">
<h2><span class="section-number">7.5.27. </span>Authors<a class="headerlink" href="#authors" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Steve Longerbeam &lt;<a class="reference external" href="mailto:steve_longerbeam&#37;&#52;&#48;mentor&#46;com">steve_longerbeam<span>&#64;</span>mentor<span>&#46;</span>com</a>&gt;</p></li>
<li><p>Philipp Zabel &lt;<a class="reference external" href="mailto:kernel&#37;&#52;&#48;pengutronix&#46;de">kernel<span>&#64;</span>pengutronix<span>&#46;</span>de</a>&gt;</p></li>
<li><p>Russell King &lt;<a class="reference external" href="mailto:linux&#37;&#52;&#48;armlinux&#46;org&#46;uk">linux<span>&#64;</span>armlinux<span>&#46;</span>org<span>&#46;</span>uk</a>&gt;</p></li>
</ul>
<p>Copyright (C) 2012-2017 Mentor Graphics Inc.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/media/imx.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>