<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Display Core Debug tools &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=3918102e" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="AMDGPU - Display Contributions" href="display-contributing.html" />
    <link rel="prev" title="Multiplane Overlay (MPO)" href="mpo-overview.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.12.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../subsystem-apis.html#human-interfaces">Human interfaces</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../input/index.html">Input Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sound/index.html">Sound Subsystem Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">GPU Driver Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../leds/index.html">LEDs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystem-apis.html#other-subsystems">Other subsystems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/gpu/amdgpu/display/dc-debug.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="display-core-debug-tools">
<h1>Display Core Debug tools<a class="headerlink" href="#display-core-debug-tools" title="Link to this heading">¶</a></h1>
<section id="dc-visual-confirmation">
<h2>DC Visual Confirmation<a class="headerlink" href="#dc-visual-confirmation" title="Link to this heading">¶</a></h2>
<p>Display core provides a feature named visual confirmation, which is a set of
bars added at the scanout time by the driver to convey some specific
information. In general, you can enable this debug option by using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &lt;N&gt; &gt; /sys/kernel/debug/dri/0/amdgpu_dm_visual_confirm
</pre></div>
</div>
<p>Where <cite>N</cite> is an integer number for some specific scenarios that the developer
wants to enable, you will see some of these debug cases in the following
subsection.</p>
<section id="multiple-planes-debug">
<h3>Multiple Planes Debug<a class="headerlink" href="#multiple-planes-debug" title="Link to this heading">¶</a></h3>
<p>If you want to enable or debug multiple planes in a specific user-space
application, you can leverage a debug feature named visual confirm. For
enabling it, you will need:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 1 &gt; /sys/kernel/debug/dri/0/amdgpu_dm_visual_confirm
</pre></div>
</div>
<p>You need to reload your GUI to see the visual confirmation. When the plane
configuration changes or a full update occurs there will be a colored bar at
the bottom of each hardware plane being drawn on the screen.</p>
<ul class="simple">
<li><p>The color indicates the format - For example, red is AR24 and green is NV12</p></li>
<li><p>The height of the bar indicates the index of the plane</p></li>
<li><p>Pipe split can be observed if there are two bars with a difference in height
covering the same plane</p></li>
</ul>
<p>Consider the video playback case in which a video is played in a specific
plane, and the desktop is drawn in another plane. The video plane should
feature one or two green bars at the bottom of the video depending on pipe
split configuration.</p>
<ul class="simple">
<li><p>There should <strong>not</strong> be any visual corruption</p></li>
<li><p>There should <strong>not</strong> be any underflow or screen flashes</p></li>
<li><p>There should <strong>not</strong> be any black screens</p></li>
<li><p>There should <strong>not</strong> be any cursor corruption</p></li>
<li><p>Multiple plane <strong>may</strong> be briefly disabled during window transitions or
resizing but should come back after the action has finished</p></li>
</ul>
</section>
<section id="pipe-split-debug">
<h3>Pipe Split Debug<a class="headerlink" href="#pipe-split-debug" title="Link to this heading">¶</a></h3>
<p>Sometimes we need to debug if DCN is splitting pipes correctly, and visual
confirmation is also handy for this case. Similar to the MPO case, you can use
the below command to enable visual confirmation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 1 &gt; /sys/kernel/debug/dri/0/amdgpu_dm_visual_confirm
</pre></div>
</div>
<p>In this case, if you have a pipe split, you will see one small red bar at the
bottom of the display covering the entire display width and another bar
covering the second pipe. In other words, you will see a bit high bar in the
second pipe.</p>
</section>
</section>
<section id="dtn-debug">
<h2>DTN Debug<a class="headerlink" href="#dtn-debug" title="Link to this heading">¶</a></h2>
<p>DC (DCN) provides an extensive log that dumps multiple details from our
hardware configuration. Via debugfs, you can capture those status values by
using Display Test Next (DTN) log, which can be captured via debugfs by using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /sys/kernel/debug/dri/0/amdgpu_dm_dtn_log
</pre></div>
</div>
<p>Since this log is updated accordingly with DCN status, you can also follow the
change in real-time by using something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo watch -d cat /sys/kernel/debug/dri/0/amdgpu_dm_dtn_log
</pre></div>
</div>
<p>When reporting a bug related to DC, consider attaching this log before and
after you reproduce the bug.</p>
</section>
<section id="dmub-firmware-debug">
<h2>DMUB Firmware Debug<a class="headerlink" href="#dmub-firmware-debug" title="Link to this heading">¶</a></h2>
<p>Sometimes, dmesg logs aren’t enough. This is especially true if a feature is
implemented primarily in DMUB firmware. In such cases, all we see in dmesg when
an issue arises is some generic timeout error. So, to get more relevant
information, we can trace DMUB commands by enabling the relevant bits in
<cite>amdgpu_dm_dmub_trace_mask</cite>.</p>
<p>Currently, we support the tracing of the following groups:</p>
<section id="trace-groups">
<h3>Trace Groups<a class="headerlink" href="#trace-groups" title="Link to this heading">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Mask Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>INFO</p></td>
<td><p>0x1</p></td>
</tr>
<tr class="row-odd"><td><p>IRQ SVC</p></td>
<td><p>0x2</p></td>
</tr>
<tr class="row-even"><td><p>VBIOS</p></td>
<td><p>0x4</p></td>
</tr>
<tr class="row-odd"><td><p>REGISTER</p></td>
<td><p>0x8</p></td>
</tr>
<tr class="row-even"><td><p>PHY DBG</p></td>
<td><p>0x10</p></td>
</tr>
<tr class="row-odd"><td><p>PSR</p></td>
<td><p>0x20</p></td>
</tr>
<tr class="row-even"><td><p>AUX</p></td>
<td><p>0x40</p></td>
</tr>
<tr class="row-odd"><td><p>SMU</p></td>
<td><p>0x80</p></td>
</tr>
<tr class="row-even"><td><p>MALL</p></td>
<td><p>0x100</p></td>
</tr>
<tr class="row-odd"><td><p>ABM</p></td>
<td><p>0x200</p></td>
</tr>
<tr class="row-even"><td><p>ALPM</p></td>
<td><p>0x400</p></td>
</tr>
<tr class="row-odd"><td><p>TIMER</p></td>
<td><p>0x800</p></td>
</tr>
<tr class="row-even"><td><p>HW LOCK MGR</p></td>
<td><p>0x1000</p></td>
</tr>
<tr class="row-odd"><td><p>INBOX1</p></td>
<td><p>0x2000</p></td>
</tr>
<tr class="row-even"><td><p>PHY SEQ</p></td>
<td><p>0x4000</p></td>
</tr>
<tr class="row-odd"><td><p>PSR STATE</p></td>
<td><p>0x8000</p></td>
</tr>
<tr class="row-even"><td><p>ZSTATE</p></td>
<td><p>0x10000</p></td>
</tr>
<tr class="row-odd"><td><p>TRANSMITTER CTL</p></td>
<td><p>0x20000</p></td>
</tr>
<tr class="row-even"><td><p>PANEL CNTL</p></td>
<td><p>0x40000</p></td>
</tr>
<tr class="row-odd"><td><p>FAMS</p></td>
<td><p>0x80000</p></td>
</tr>
<tr class="row-even"><td><p>DPIA</p></td>
<td><p>0x100000</p></td>
</tr>
<tr class="row-odd"><td><p>SUBVP</p></td>
<td><p>0x200000</p></td>
</tr>
<tr class="row-even"><td><p>INBOX0</p></td>
<td><p>0x400000</p></td>
</tr>
<tr class="row-odd"><td><p>SDP</p></td>
<td><p>0x4000000</p></td>
</tr>
<tr class="row-even"><td><p>REPLAY</p></td>
<td><p>0x8000000</p></td>
</tr>
<tr class="row-odd"><td><p>REPLAY RESIDENCY</p></td>
<td><p>0x20000000</p></td>
</tr>
<tr class="row-even"><td><p>CURSOR INFO</p></td>
<td><p>0x80000000</p></td>
</tr>
<tr class="row-odd"><td><p>IPS</p></td>
<td><p>0x100000000</p></td>
</tr>
</tbody>
</table>
<p><strong>Note: Not all ASICs support all of the listed trace groups</strong></p>
<p>So, to enable just PSR tracing you can use the following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 0x8020 &gt; /sys/kernel/debug/dri/0/amdgpu_dm_dmub_trace_mask
</pre></div>
</div>
<p>Then, you need to enable logging trace events to the buffer, which you can do
using the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 1 &gt; /sys/kernel/debug/dri/0/amdgpu_dm_dmcub_trace_event_en
</pre></div>
</div>
<p>Lastly, after you are able to reproduce the issue you are trying to debug,
you can disable tracing and read the trace log by using the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo 0 &gt; /sys/kernel/debug/dri/0/amdgpu_dm_dmcub_trace_event_en
# cat /sys/kernel/debug/dri/0/amdgpu_dm_dmub_tracebuffer
</pre></div>
</div>
<p>So, when reporting bugs related to features such as PSR and ABM, consider
enabling the relevant bits in the mask before reproducing the issue and
attach the log that you obtain from the trace buffer in any bug reports that you
create.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../../_sources/gpu/amdgpu/display/dc-debug.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>