<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Debugging advice for driver development &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Debugging kernel and modules via gdb" href="gdb-kernel-debugging.html" />
    <link rel="prev" title="Debugging advice for Linux Kernel developers" href="index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.14.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">All development-process docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#an-introduction-to-how-kernel-development-works">An introduction to how kernel development works</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tools-and-technical-guides-for-kernel-developers">Tools and technical guides for kernel developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#policy-guides-and-developer-statements">Policy guides and developer statements</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#dealing-with-bugs">Dealing with bugs</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Debugging advice for Linux Kernel developers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../handling-regressions.html">Handling regressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security-bugs.html">Security bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cve.html">CVEs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../embargoed-hardware-issues.html">Embargoed hardware issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#maintainer-information">Maintainer information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#other-material">Other material</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/process/debugging/driver_development_debugging_guide.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="debugging-advice-for-driver-development">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Debugging advice for driver development</a><a class="headerlink" href="#debugging-advice-for-driver-development" title="Link to this heading">¶</a></h1>
<p>This document serves as a general starting point and lookup for debugging
device drivers.
While this guide focuses on debugging that requires re-compiling the
module/kernel, the <a class="reference internal" href="userspace_debugging_guide.html"><span class="doc">userspace debugging guide</span></a> will guide
you through tools like dynamic debug, ftrace and other tools useful for
debugging issues and behavior.
For general debugging advice, see the <a class="reference internal" href="index.html"><span class="doc">general advice document</span></a>.</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#debugging-advice-for-driver-development" id="id1">Debugging advice for driver development</a></p>
<ul>
<li><p><a class="reference internal" href="#printk-friends" id="id2">printk() &amp; friends</a></p>
<ul>
<li><p><a class="reference internal" href="#simple-printk" id="id3">Simple printk()</a></p></li>
<li><p><a class="reference internal" href="#trace-printk" id="id4">Trace_printk</a></p></li>
<li><p><a class="reference internal" href="#dev-dbg" id="id5">dev_dbg</a></p></li>
<li><p><a class="reference internal" href="#custom-printk" id="id6">Custom printk</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#ftrace" id="id7">Ftrace</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-a-custom-ftrace-tracepoint" id="id8">Creating a custom Ftrace tracepoint</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#debugfs" id="id9">DebugFS</a></p></li>
<li><p><a class="reference internal" href="#kasan-ubsan-lockdep-and-other-error-checkers" id="id10">KASAN, UBSAN, lockdep and other error checkers</a></p>
<ul>
<li><p><a class="reference internal" href="#kasan-kernel-address-sanitizer" id="id11">KASAN (Kernel Address Sanitizer)</a></p></li>
<li><p><a class="reference internal" href="#ubsan-undefined-behavior-sanitizer" id="id12">UBSAN (Undefined Behavior Sanitizer)</a></p></li>
<li><p><a class="reference internal" href="#lockdep-lock-dependency-validator" id="id13">lockdep (Lock Dependency Validator)</a></p></li>
<li><p><a class="reference internal" href="#psi-pressure-stall-information-tracking" id="id14">PSI (Pressure stall information tracking)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#device-coredump" id="id15">device coredump</a></p>
<ul>
<li><p><a class="reference internal" href="#devcoredump-interfaces" id="id16">devcoredump interfaces</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>The following sections show you the available tools.</p>
<section id="printk-friends">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">printk() &amp; friends</a><a class="headerlink" href="#printk-friends" title="Link to this heading">¶</a></h2>
<p>These are derivatives of printf() with varying destinations and support for
being dynamically turned on or off, or lack thereof.</p>
<section id="simple-printk">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Simple printk()</a><a class="headerlink" href="#simple-printk" title="Link to this heading">¶</a></h3>
<p>The classic, can be used to great effect for quick and dirty development
of new modules or to extract arbitrary necessary data for troubleshooting.</p>
<p>Prerequisite: <code class="docutils literal notranslate"><span class="pre">CONFIG_PRINTK</span></code> (usually enabled by default)</p>
<p><strong>Pros</strong>:</p>
<ul class="simple">
<li><p>No need to learn anything, simple to use</p></li>
<li><p>Easy to modify exactly to your needs (formatting of the data (See:
<a class="reference internal" href="../../core-api/printk-formats.html"><span class="doc">How to get printk format specifiers right</span></a>), visibility in the log)</p></li>
<li><p>Can cause delays in the execution of the code (beneficial to confirm whether
timing is a factor)</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul class="simple">
<li><p>Requires rebuilding the kernel/module</p></li>
<li><p>Can cause delays in the execution of the code (which can cause issues to be
not reproducible)</p></li>
</ul>
<p>For the full documentation see <a class="reference internal" href="../../core-api/printk-basics.html"><span class="doc">Message logging with printk</span></a></p>
</section>
<section id="trace-printk">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Trace_printk</a><a class="headerlink" href="#trace-printk" title="Link to this heading">¶</a></h3>
<p>Prerequisite: <code class="docutils literal notranslate"><span class="pre">CONFIG_DYNAMIC_FTRACE</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;linux/ftrace.h&gt;</span></code></p>
<p>It is a tiny bit less comfortable to use than <a class="reference internal" href="../../core-api/printk-basics.html#c.printk" title="printk"><code class="xref c c-func docutils literal notranslate"><span class="pre">printk()</span></code></a>, because you will have
to read the messages from the trace file (See: <a class="reference internal" href="userspace_debugging_guide.html#read-ftrace-log"><span class="std std-ref">Reading the ftrace log</span></a>
instead of from the kernel log, but very useful when <a class="reference internal" href="../../core-api/printk-basics.html#c.printk" title="printk"><code class="xref c c-func docutils literal notranslate"><span class="pre">printk()</span></code></a> adds unwanted
delays into the code execution, causing issues to be flaky or hidden.)</p>
<p>If the processing of this still causes timing issues then you can try
<a class="reference internal" href="../../driver-api/basics.html#c.trace_puts" title="trace_puts"><code class="xref c c-func docutils literal notranslate"><span class="pre">trace_puts()</span></code></a>.</p>
<p>For the full Documentation see <a class="reference internal" href="../../driver-api/basics.html#c.trace_printk" title="trace_printk"><code class="xref c c-func docutils literal notranslate"><span class="pre">trace_printk()</span></code></a></p>
</section>
<section id="dev-dbg">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">dev_dbg</a><a class="headerlink" href="#dev-dbg" title="Link to this heading">¶</a></h3>
<p>Print statement, which can be targeted by
<a class="reference internal" href="userspace_debugging_guide.html#dynamic-debug"><span class="std std-ref">Dynamic debug</span></a> that contains
additional information about the device used within the context.</p>
<p><strong>When is it appropriate to leave a debug print in the code?</strong></p>
<p>Permanent debug statements have to be useful for a developer to troubleshoot
driver misbehavior. Judging that is a bit more of an art than a science, but
some guidelines are in the <a class="reference internal" href="../coding-style.html#printing-kernel-messages"><span class="std std-ref">Coding style guidelines</span></a>. In almost all cases the
debug statements shouldn’t be upstreamed, as a working driver is supposed to be
silent.</p>
</section>
<section id="custom-printk">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Custom printk</a><a class="headerlink" href="#custom-printk" title="Link to this heading">¶</a></h3>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#define core_dbg(fmt, arg...) do { \
        if (core_debug) \
                printk(KERN_DEBUG pr_fmt(&quot;core: &quot; fmt), ## arg); \
        } while (0)
</pre></div>
</div>
<p><strong>When should you do this?</strong></p>
<p>It is better to just use a <a class="reference internal" href="../../core-api/printk-basics.html#c.pr_debug" title="pr_debug"><code class="xref c c-func docutils literal notranslate"><span class="pre">pr_debug()</span></code></a>, which can later be turned on/off with
dynamic debug. Additionally, a lot of drivers activate these prints via a
variable like <code class="docutils literal notranslate"><span class="pre">core_debug</span></code> set by a module parameter. However, Module
parameters <a class="reference external" href="https://lore.kernel.org/all/2024032757-surcharge-grime-d3dd&#64;gregkh">are not recommended anymore</a>.</p>
</section>
</section>
<section id="ftrace">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Ftrace</a><a class="headerlink" href="#ftrace" title="Link to this heading">¶</a></h2>
<section id="creating-a-custom-ftrace-tracepoint">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Creating a custom Ftrace tracepoint</a><a class="headerlink" href="#creating-a-custom-ftrace-tracepoint" title="Link to this heading">¶</a></h3>
<p>A tracepoint adds a hook into your code that will be called and logged when the
tracepoint is enabled. This can be used, for example, to trace hitting a
conditional branch or to dump the internal state at specific points of the code
flow during a debugging session.</p>
<p>Here is a basic description of <a class="reference internal" href="../../trace/tracepoints.html#usage"><span class="std std-ref">how to implement new tracepoints</span></a>.</p>
<p>For the full event tracing documentation see <a class="reference internal" href="../../trace/events.html"><span class="doc">Event Tracing</span></a></p>
<p>For the full Ftrace documentation see <a class="reference internal" href="../../trace/ftrace.html"><span class="doc">ftrace - Function Tracer</span></a></p>
</section>
</section>
<section id="debugfs">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">DebugFS</a><a class="headerlink" href="#debugfs" title="Link to this heading">¶</a></h2>
<p>Prerequisite: <code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_FS`</span> <span class="pre">&amp;</span> <span class="pre">`#include</span> <span class="pre">&lt;linux/debugfs.h&gt;</span></code></p>
<p>DebugFS differs from the other approaches of debugging, as it doesn’t write
messages to the kernel log nor add traces to the code. Instead it allows the
developer to handle a set of files.
With these files you can either store values of variables or make
register/memory dumps or you can make these files writable and modify
values/settings in the driver.</p>
<p>Possible use-cases among others:</p>
<ul class="simple">
<li><p>Store register values</p></li>
<li><p>Keep track of variables</p></li>
<li><p>Store errors</p></li>
<li><p>Store settings</p></li>
<li><p>Toggle a setting like debug on/off</p></li>
<li><p>Error injection</p></li>
</ul>
<p>This is especially useful, when the size of a data dump would be hard to digest
as part of the general kernel log (for example when dumping raw bitstream data)
or when you are not interested in all the values all the time, but with the
possibility to inspect them.</p>
<p>The general idea is:</p>
<ul class="simple">
<li><p>Create a directory during probe (<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dentry</span> <span class="pre">*parent</span> <span class="pre">=</span>
<span class="pre">debugfs_create_dir(&quot;my_driver&quot;,</span> <span class="pre">NULL);</span></code>)</p></li>
<li><p>Create a file (<code class="docutils literal notranslate"><span class="pre">debugfs_create_u32(&quot;my_value&quot;,</span> <span class="pre">444,</span> <span class="pre">parent,</span> <span class="pre">&amp;my_variable);</span></code>)</p>
<ul>
<li><p>In this example the file is found in
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/my_driver/my_value</span></code> (with read permissions for
user/group/all)</p></li>
<li><p>any read of the file will return the current contents of the variable
<code class="docutils literal notranslate"><span class="pre">my_variable</span></code></p></li>
</ul>
</li>
<li><p>Clean up the directory when removing the device
(<code class="docutils literal notranslate"><span class="pre">debugfs_remove_recursive(parent);</span></code>)</p></li>
</ul>
<p>For the full documentation see <a class="reference internal" href="../../filesystems/debugfs.html"><span class="doc">DebugFS</span></a>.</p>
</section>
<section id="kasan-ubsan-lockdep-and-other-error-checkers">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">KASAN, UBSAN, lockdep and other error checkers</a><a class="headerlink" href="#kasan-ubsan-lockdep-and-other-error-checkers" title="Link to this heading">¶</a></h2>
<section id="kasan-kernel-address-sanitizer">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">KASAN (Kernel Address Sanitizer)</a><a class="headerlink" href="#kasan-kernel-address-sanitizer" title="Link to this heading">¶</a></h3>
<p>Prerequisite: <code class="docutils literal notranslate"><span class="pre">CONFIG_KASAN</span></code></p>
<p>KASAN is a dynamic memory error detector that helps to find use-after-free and
out-of-bounds bugs. It uses compile-time instrumentation to check every memory
access.</p>
<p>For the full documentation see <a class="reference internal" href="../../dev-tools/kasan.html"><span class="doc">Kernel Address Sanitizer (KASAN)</span></a>.</p>
</section>
<section id="ubsan-undefined-behavior-sanitizer">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">UBSAN (Undefined Behavior Sanitizer)</a><a class="headerlink" href="#ubsan-undefined-behavior-sanitizer" title="Link to this heading">¶</a></h3>
<p>Prerequisite: <code class="docutils literal notranslate"><span class="pre">CONFIG_UBSAN</span></code></p>
<p>UBSAN relies on compiler instrumentation and runtime checks to detect undefined
behavior. It is designed to find a variety of issues, including signed integer
overflow, array index out of bounds, and more.</p>
<p>For the full documentation see <a class="reference internal" href="../../dev-tools/ubsan.html"><span class="doc">Undefined Behavior Sanitizer - UBSAN</span></a></p>
</section>
<section id="lockdep-lock-dependency-validator">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">lockdep (Lock Dependency Validator)</a><a class="headerlink" href="#lockdep-lock-dependency-validator" title="Link to this heading">¶</a></h3>
<p>Prerequisite: <code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_LOCKDEP</span></code></p>
<p>lockdep is a runtime lock dependency validator that detects potential deadlocks
and other locking-related issues in the kernel.
It tracks lock acquisitions and releases, building a dependency graph that is
analyzed for potential deadlocks.
lockdep is especially useful for validating the correctness of lock ordering in
the kernel.</p>
</section>
<section id="psi-pressure-stall-information-tracking">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">PSI (Pressure stall information tracking)</a><a class="headerlink" href="#psi-pressure-stall-information-tracking" title="Link to this heading">¶</a></h3>
<p>Prerequisite: <code class="docutils literal notranslate"><span class="pre">CONFIG_PSI</span></code></p>
<p>PSI is a measurement tool to identify excessive overcommits on hardware
resources, that can cause performance disruptions or even OOM kills.</p>
</section>
</section>
<section id="device-coredump">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">device coredump</a><a class="headerlink" href="#device-coredump" title="Link to this heading">¶</a></h2>
<p>Prerequisite: <code class="docutils literal notranslate"><span class="pre">CONFIG_DEV_COREDUMP</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;linux/devcoredump.h&gt;</span></code></p>
<p>Provides the infrastructure for a driver to provide arbitrary data to userland.
It is most often used in conjunction with udev or similar userland application
to listen for kernel uevents, which indicate that the dump is ready. Udev has
rules to copy that file somewhere for long-term storage and analysis, as by
default, the data for the dump is automatically cleaned up after a default
5 minutes. That data is analyzed with driver-specific tools or GDB.</p>
<p>A device coredump can be created with a vmalloc area, with read/free
methods, or as a scatter/gather list.</p>
<p>You can find an example implementation at:
<a class="reference external" href="https://elixir.bootlin.com/linux/v6.11.6/source/drivers/media/platform/qcom/venus/core.c#L30">drivers/media/platform/qcom/venus/core.c</a>,
in the Bluetooth HCI layer, in several wireless drivers, and in several
DRM drivers.</p>
<section id="devcoredump-interfaces">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">devcoredump interfaces</a><a class="headerlink" href="#devcoredump-interfaces" title="Link to this heading">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.dev_coredumpm">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dev_coredumpm</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">module</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">owner</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">datalen</span></span>, <span class="n"><span class="pre">gfp_t</span></span><span class="w"> </span><span class="n"><span class="pre">gfp</span></span>, <span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">read</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buffer</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">loff_t</span></span><span class="w"> </span><span class="n"><span class="pre">offset</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">count</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">datalen</span></span><span class="p"><span class="pre">)</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">free</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">)</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.dev_coredumpm" title="Link to this definition">¶</a><br /></dt>
<dd><p>create device coredump with read/free methods</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>the <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span></code></a> for the crashed device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">module</span> <span class="pre">*owner</span></code></dt><dd><p>the module that contains the read/free functions, use <code class="docutils literal notranslate"><span class="pre">THIS_MODULE</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>data cookie for the <strong>read</strong>/<strong>free</strong> functions</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">datalen</span></code></dt><dd><p>length of the data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gfp_t</span> <span class="pre">gfp</span></code></dt><dd><p>allocation flags</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssize_t</span> <span class="pre">(*read)(char</span> <span class="pre">*buffer,</span> <span class="pre">loff_t</span> <span class="pre">offset,</span> <span class="pre">size_t</span> <span class="pre">count,</span> <span class="pre">void</span> <span class="pre">*data,</span> <span class="pre">size_t</span> <span class="pre">datalen)</span></code></dt><dd><p>function to read from the given buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">(*free)(void</span> <span class="pre">*data)</span></code></dt><dd><p>function to free the given buffer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates a new device coredump for the given device. If a previous one hasn’t
been read yet, the new coredump is discarded. The data lifetime is determined
by the device coredump framework and when it is no longer needed the <strong>free</strong>
function will be called to free the data.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.dev_coredumpv">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dev_coredumpv</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">datalen</span></span>, <span class="n"><span class="pre">gfp_t</span></span><span class="w"> </span><span class="n"><span class="pre">gfp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.dev_coredumpv" title="Link to this definition">¶</a><br /></dt>
<dd><p>create device coredump with vmalloc data</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>the <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span></code></a> for the crashed device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>vmalloc data containing the device coredump</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">datalen</span></code></dt><dd><p>length of the data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gfp_t</span> <span class="pre">gfp</span></code></dt><dd><p>allocation flags</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function takes ownership of the vmalloc’ed data and will free
it when it is no longer used. See <a class="reference internal" href="#c.dev_coredumpm" title="dev_coredumpm"><code class="xref c c-func docutils literal notranslate"><span class="pre">dev_coredumpm()</span></code></a> for more information.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.devcd_free_sgtable">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">devcd_free_sgtable</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.devcd_free_sgtable" title="Link to this definition">¶</a><br /></dt>
<dd><p>free all the memory of the given scatterlist table (i.e. both pages and scatterlist instances)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>pointer to sg_table to free</p>
</dd>
</dl>
<p><strong>NOTE</strong></p>
<p>if two tables allocated with devcd_alloc_sgtable and then chained
using the sg_chain function then that function should be called only once
on the chained table</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.devcd_read_from_sgtable">
<span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">devcd_read_from_sgtable</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buffer</span></span>, <span class="n"><span class="pre">loff_t</span></span><span class="w"> </span><span class="n"><span class="pre">offset</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">buf_len</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">data_len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.devcd_read_from_sgtable" title="Link to this definition">¶</a><br /></dt>
<dd><p>copy data from sg_table to a given buffer and return the number of bytes read</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*buffer</span></code></dt><dd><p>the buffer to copy the data to it</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">loff_t</span> <span class="pre">offset</span></code></dt><dd><p>start copy from <strong>offset****</strong> bytes from the head of the data
in the given scatterlist</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">buf_len</span></code></dt><dd><p>the length of the buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>the scatterlist table to copy from</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">data_len</span></code></dt><dd><p>the length of the data in the sg_table</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>the number of bytes copied</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.dev_coredump_put">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dev_coredump_put</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.dev_coredump_put" title="Link to this definition">¶</a><br /></dt>
<dd><p>remove device coredump</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>the <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span></code></a> for the crashed device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p><a class="reference internal" href="#c.dev_coredump_put" title="dev_coredump_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">dev_coredump_put()</span></code></a> removes coredump, if exists, for a given device from
the file system and free its associated data otherwise, does nothing.</p>
<p>It is useful for modules that do not want to keep coredump
available after its unload.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.dev_coredumpm_timeout">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dev_coredumpm_timeout</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">module</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">owner</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">datalen</span></span>, <span class="n"><span class="pre">gfp_t</span></span><span class="w"> </span><span class="n"><span class="pre">gfp</span></span>, <span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">read</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buffer</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">loff_t</span></span><span class="w"> </span><span class="n"><span class="pre">offset</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">count</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">datalen</span></span><span class="p"><span class="pre">)</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">free</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">)</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="n"><span class="pre">timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.dev_coredumpm_timeout" title="Link to this definition">¶</a><br /></dt>
<dd><p>create device coredump with read/free methods with a custom timeout.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>the <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span></code></a> for the crashed device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">module</span> <span class="pre">*owner</span></code></dt><dd><p>the module that contains the read/free functions, use <code class="docutils literal notranslate"><span class="pre">THIS_MODULE</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>data cookie for the <strong>read</strong>/<strong>free</strong> functions</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">datalen</span></code></dt><dd><p>length of the data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gfp_t</span> <span class="pre">gfp</span></code></dt><dd><p>allocation flags</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssize_t</span> <span class="pre">(*read)(char</span> <span class="pre">*buffer,</span> <span class="pre">loff_t</span> <span class="pre">offset,</span> <span class="pre">size_t</span> <span class="pre">count,</span> <span class="pre">void</span> <span class="pre">*data,</span> <span class="pre">size_t</span> <span class="pre">datalen)</span></code></dt><dd><p>function to read from the given buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">(*free)(void</span> <span class="pre">*data)</span></code></dt><dd><p>function to free the given buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">timeout</span></code></dt><dd><p>time in jiffies to remove coredump</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates a new device coredump for the given device. If a previous one hasn’t
been read yet, the new coredump is discarded. The data lifetime is determined
by the device coredump framework and when it is no longer needed the <strong>free</strong>
function will be called to free the data.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.dev_coredumpsg">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dev_coredumpsg</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">scatterlist</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">table</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">datalen</span></span>, <span class="n"><span class="pre">gfp_t</span></span><span class="w"> </span><span class="n"><span class="pre">gfp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.dev_coredumpsg" title="Link to this definition">¶</a><br /></dt>
<dd><p>create device coredump that uses scatterlist as data parameter</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>the <a class="reference internal" href="../../driver-api/infrastructure.html#c.device" title="device"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span></code></a> for the crashed device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">scatterlist</span> <span class="pre">*table</span></code></dt><dd><p>the dump data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">datalen</span></code></dt><dd><p>length of the data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gfp_t</span> <span class="pre">gfp</span></code></dt><dd><p>allocation flags</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates a new device coredump for the given device. If a previous one hasn’t
been read yet, the new coredump is discarded. The data lifetime is determined
by the device coredump framework and when it is no longer needed
it will free the data.</p>
</div>
<p><strong>Copyright</strong> ©2024 : Collabora</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/process/debugging/driver_development_debugging_guide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>