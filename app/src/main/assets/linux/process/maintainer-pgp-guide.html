
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Kernel Maintainer PGP guide &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Email clients info for Linux" href="email-clients.html" />
    <link rel="prev" title="5. KVM x86" href="maintainer-kvm-x86.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.6.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">All development-process docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto.html">HOWTO do Linux kernel development</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-of-conduct.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-of-conduct-interpretation.html">Linux Kernel Contributor Covenant Code of Conduct Interpretation</a></li>
<li class="toctree-l2"><a class="reference internal" href="development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="handling-regressions.html">Handling regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="programming-language.html">Programming Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="coding-style.html">Linux kernel coding style</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintainer-handbooks.html">Subsystem and maintainer tree specific development process notes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Kernel Maintainer PGP guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-role-of-pgp-in-linux-kernel-development">The role of PGP in Linux Kernel development</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pgp-tools">PGP tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#protect-your-pgp-key">Protect your PGP key</a></li>
<li class="toctree-l3"><a class="reference internal" href="#move-the-subkeys-to-a-dedicated-crypto-device">Move the subkeys to a dedicated crypto device</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-pgp-with-git">Using PGP with Git</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-verify-kernel-developer-identities">How to verify kernel developer identities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="email-clients.html">Email clients info for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-enforcement-statement.html">Linux Kernel Enforcement Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-driver-statement.html">Kernel Driver Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="security-bugs.html">Security bugs</a></li>
<li class="toctree-l2"><a class="reference internal" href="embargoed-hardware-issues.html">Embargoed hardware issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="changes.html">Minimal requirements to compile the Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="stable-api-nonsense.html">The Linux Kernel Driver Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="management-style.html">Linux kernel management style</a></li>
<li class="toctree-l2"><a class="reference internal" href="stable-kernel-rules.html">Everything you ever wanted to know about Linux -stable releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="submit-checklist.html">Linux Kernel patch submission checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel-docs.html">Index of Further Kernel Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="deprecated.html">Deprecated Interfaces, Language Features, Attributes, and Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintainers.html">List of maintainers</a></li>
<li class="toctree-l2"><a class="reference internal" href="researcher-guidelines.html">Researcher Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="contribution-maturity-model.html">Linux Kernel Contribution Maturity Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="applying-patches.html">Applying Patches To The Linux Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding-syscalls.html">Adding a New System Call</a></li>
<li class="toctree-l2"><a class="reference internal" href="magic-number.html">Linux magic numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="volatile-considered-harmful.html">Why the &quot;volatile&quot; type class should not be used</a></li>
<li class="toctree-l2"><a class="reference internal" href="botching-up-ioctls.html">(How to avoid) Botching up ioctls</a></li>
<li class="toctree-l2"><a class="reference internal" href="clang-format.html">clang-format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../riscv/patch-acceptance.html">arch/riscv maintenance guidelines for developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-api/unaligned-memory-access.html">Unaligned Memory Accesses</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">Kernel subsystem documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user's and administrator's guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  sbar.scrollTop = currents[currents.length - 1].offsetTop;
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/process/maintainer-pgp-guide.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="kernel-maintainer-pgp-guide">
<span id="pgpguide"></span><h1>Kernel Maintainer PGP guide<a class="headerlink" href="#kernel-maintainer-pgp-guide" title="Permalink to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Konstantin Ryabitsev &lt;<a class="reference external" href="mailto:konstantin&#37;&#52;&#48;linuxfoundation&#46;org">konstantin<span>&#64;</span>linuxfoundation<span>&#46;</span>org</a>&gt;</p>
</dd>
</dl>
<p>This document is aimed at Linux kernel developers, and especially at
subsystem maintainers. It contains a subset of information discussed in
the more general &quot;<a class="reference external" href="https://github.com/lfit/itpol/blob/master/protecting-code-integrity.md">Protecting Code Integrity</a>&quot; guide published by the
Linux Foundation. Please read that document for more in-depth discussion
on some of the topics mentioned in this guide.</p>
<section id="the-role-of-pgp-in-linux-kernel-development">
<h2>The role of PGP in Linux Kernel development<a class="headerlink" href="#the-role-of-pgp-in-linux-kernel-development" title="Permalink to this heading">¶</a></h2>
<p>PGP helps ensure the integrity of the code that is produced by the Linux
kernel development community and, to a lesser degree, establish trusted
communication channels between developers via PGP-signed email exchange.</p>
<p>The Linux kernel source code is available in two main formats:</p>
<ul class="simple">
<li><p>Distributed source repositories (git)</p></li>
<li><p>Periodic release snapshots (tarballs)</p></li>
</ul>
<p>Both git repositories and tarballs carry PGP signatures of the kernel
developers who create official kernel releases. These signatures offer a
cryptographic guarantee that downloadable versions made available via
kernel.org or any other mirrors are identical to what these developers
have on their workstations. To this end:</p>
<ul class="simple">
<li><p>git repositories provide PGP signatures on all tags</p></li>
<li><p>tarballs provide detached PGP signatures with all downloads</p></li>
</ul>
<section id="trusting-the-developers-not-infrastructure">
<span id="devs-not-infra"></span><h3>Trusting the developers, not infrastructure<a class="headerlink" href="#trusting-the-developers-not-infrastructure" title="Permalink to this heading">¶</a></h3>
<p>Ever since the 2011 compromise of core kernel.org systems, the main
operating principle of the Kernel Archives project has been to assume
that any part of the infrastructure can be compromised at any time. For
this reason, the administrators have taken deliberate steps to emphasize
that trust must always be placed with developers and never with the code
hosting infrastructure, regardless of how good the security practices
for the latter may be.</p>
<p>The above guiding principle is the reason why this guide is needed. We
want to make sure that by placing trust into developers we do not simply
shift the blame for potential future security incidents to someone else.
The goal is to provide a set of guidelines developers can use to create
a secure working environment and safeguard the PGP keys used to
establish the integrity of the Linux kernel itself.</p>
</section>
</section>
<section id="pgp-tools">
<span id="id1"></span><h2>PGP tools<a class="headerlink" href="#pgp-tools" title="Permalink to this heading">¶</a></h2>
<section id="use-gnupg-2-2-or-later">
<h3>Use GnuPG 2.2 or later<a class="headerlink" href="#use-gnupg-2-2-or-later" title="Permalink to this heading">¶</a></h3>
<p>Your distro should already have GnuPG installed by default, you just
need to verify that you are using a reasonably recent version of it.
To check, run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --version | head -n1
</pre></div>
</div>
<p>If you have version 2.2 or above, then you are good to go. If you have a
version that is prior than 2.2, then some commands from this guide may
not work.</p>
<section id="configure-gpg-agent-options">
<h4>Configure gpg-agent options<a class="headerlink" href="#configure-gpg-agent-options" title="Permalink to this heading">¶</a></h4>
<p>The GnuPG agent is a helper tool that will start automatically whenever
you use the <code class="docutils literal notranslate"><span class="pre">gpg</span></code> command and run in the background with the purpose
of caching the private key passphrase. There are two options you should
know in order to tweak when the passphrase should be expired from cache:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default-cache-ttl</span></code> (seconds): If you use the same key again before
the time-to-live expires, the countdown will reset for another period.
The default is 600 (10 minutes).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max-cache-ttl</span></code> (seconds): Regardless of how recently you've used
the key since initial passphrase entry, if the maximum time-to-live
countdown expires, you'll have to enter the passphrase again. The
default is 30 minutes.</p></li>
</ul>
<p>If you find either of these defaults too short (or too long), you can
edit your <code class="docutils literal notranslate"><span class="pre">~/.gnupg/gpg-agent.conf</span></code> file to set your own values:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># set to 30 minutes for regular ttl, and 2 hours for max ttl
default-cache-ttl 1800
max-cache-ttl 7200
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is no longer necessary to start gpg-agent manually at the
beginning of your shell session. You may want to check your rc files
to remove anything you had in place for older versions of GnuPG, as
it may not be doing the right thing any more.</p>
</div>
</section>
</section>
</section>
<section id="protect-your-pgp-key">
<span id="protect-your-key"></span><h2>Protect your PGP key<a class="headerlink" href="#protect-your-pgp-key" title="Permalink to this heading">¶</a></h2>
<p>This guide assumes that you already have a PGP key that you use for Linux
kernel development purposes. If you do not yet have one, please see the
&quot;<a class="reference external" href="https://github.com/lfit/itpol/blob/master/protecting-code-integrity.md">Protecting Code Integrity</a>&quot; document mentioned earlier for guidance
on how to create a new one.</p>
<p>You should also make a new key if your current one is weaker than 2048
bits (RSA).</p>
<section id="understanding-pgp-subkeys">
<h3>Understanding PGP Subkeys<a class="headerlink" href="#understanding-pgp-subkeys" title="Permalink to this heading">¶</a></h3>
<p>A PGP key rarely consists of a single keypair -- usually it is a
collection of independent subkeys that can be used for different
purposes based on their capabilities, assigned at their creation time.
PGP defines four capabilities that a key can have:</p>
<ul class="simple">
<li><p><strong>[S]</strong> keys can be used for signing</p></li>
<li><p><strong>[E]</strong> keys can be used for encryption</p></li>
<li><p><strong>[A]</strong> keys can be used for authentication</p></li>
<li><p><strong>[C]</strong> keys can be used for certifying other keys</p></li>
</ul>
<p>The key with the <strong>[C]</strong> capability is often called the &quot;master&quot; key,
but this terminology is misleading because it implies that the Certify
key can be used in place of any of other subkey on the same chain (like
a physical &quot;master key&quot; can be used to open locks made for other keys).
Since this is not the case, this guide will refer to it as &quot;the Certify
key&quot; to avoid any ambiguity.</p>
<p>It is critical to fully understand the following:</p>
<ol class="arabic simple">
<li><p>All subkeys are fully independent from each other. If you lose a
private subkey, it cannot be restored or recreated from any other
private key on your chain.</p></li>
<li><p>With the exception of the Certify key, there can be multiple subkeys
with identical capabilities (e.g. you can have 2 valid encryption
subkeys, 3 valid signing subkeys, but only one valid certification
subkey). All subkeys are fully independent -- a message encrypted to
one <strong>[E]</strong> subkey cannot be decrypted with any other <strong>[E]</strong> subkey
you may also have.</p></li>
<li><p>A single subkey may have multiple capabilities (e.g. your <strong>[C]</strong> key
can also be your <strong>[S]</strong> key).</p></li>
</ol>
<p>The key carrying the <strong>[C]</strong> (certify) capability is the only key that
can be used to indicate relationship with other keys. Only the <strong>[C]</strong>
key can be used to:</p>
<ul class="simple">
<li><p>add or revoke other keys (subkeys) with S/E/A capabilities</p></li>
<li><p>add, change or revoke identities (uids) associated with the key</p></li>
<li><p>add or change the expiration date on itself or any subkey</p></li>
<li><p>sign other people's keys for web of trust purposes</p></li>
</ul>
<p>By default, GnuPG creates the following when generating new keys:</p>
<ul class="simple">
<li><p>One subkey carrying both Certify and Sign capabilities (<strong>[SC]</strong>)</p></li>
<li><p>A separate subkey with the Encryption capability (<strong>[E]</strong>)</p></li>
</ul>
<p>If you used the default parameters when generating your key, then that
is what you will have. You can verify by running <code class="docutils literal notranslate"><span class="pre">gpg</span> <span class="pre">--list-secret-keys</span></code>,
for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sec   ed25519 2022-12-20 [SC] [expires: 2024-12-19]
      000000000000000000000000AAAABBBBCCCCDDDD
uid           [ultimate] Alice Dev &lt;adev@kernel.org&gt;
ssb   cv25519 2022-12-20 [E] [expires: 2024-12-19]
</pre></div>
</div>
<p>The long line under the <code class="docutils literal notranslate"><span class="pre">sec</span></code> entry is your key fingerprint --
whenever you see <code class="docutils literal notranslate"><span class="pre">[fpr]</span></code> in the examples below, that 40-character
string is what it refers to.</p>
</section>
<section id="ensure-your-passphrase-is-strong">
<h3>Ensure your passphrase is strong<a class="headerlink" href="#ensure-your-passphrase-is-strong" title="Permalink to this heading">¶</a></h3>
<p>GnuPG uses passphrases to encrypt your private keys before storing them on
disk. This way, even if your <code class="docutils literal notranslate"><span class="pre">.gnupg</span></code> directory is leaked or stolen in
its entirety, the attackers cannot use your private keys without first
obtaining the passphrase to decrypt them.</p>
<p>It is absolutely essential that your private keys are protected by a
strong passphrase. To set it or change it, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --change-passphrase [fpr]
</pre></div>
</div>
</section>
<section id="create-a-separate-signing-subkey">
<h3>Create a separate Signing subkey<a class="headerlink" href="#create-a-separate-signing-subkey" title="Permalink to this heading">¶</a></h3>
<p>Our goal is to protect your Certify key by moving it to offline media,
so if you only have a combined <strong>[SC]</strong> key, then you should create a
separate signing subkey:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --quick-addkey [fpr] ed25519 sign
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ECC support in GnuPG</p>
<p>Note, that if you intend to use a hardware token that does not
support ED25519 ECC keys, you should choose &quot;nistp256&quot; instead or
&quot;ed25519.&quot; See the section below on recommended hardware devices.</p>
</div>
</section>
<section id="back-up-your-certify-key-for-disaster-recovery">
<h3>Back up your Certify key for disaster recovery<a class="headerlink" href="#back-up-your-certify-key-for-disaster-recovery" title="Permalink to this heading">¶</a></h3>
<p>The more signatures you have on your PGP key from other developers, the
more reasons you have to create a backup version that lives on something
other than digital media, for disaster recovery reasons.</p>
<p>The best way to create a printable hardcopy of your private key is by
using the <code class="docutils literal notranslate"><span class="pre">paperkey</span></code> software written for this very purpose. See <code class="docutils literal notranslate"><span class="pre">man</span>
<span class="pre">paperkey</span></code> for more details on the output format and its benefits over
other solutions. Paperkey should already be packaged for most
distributions.</p>
<p>Run the following command to create a hardcopy backup of your private
key:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --export-secret-key [fpr] | paperkey -o /tmp/key-backup.txt
</pre></div>
</div>
<p>Print out that file (or pipe the output straight to lpr), then take a
pen and write your passphrase on the margin of the paper. <strong>This is
strongly recommended</strong> because the key printout is still encrypted with
that passphrase, and if you ever change it you will not remember what it
used to be when you had created the backup -- <em>guaranteed</em>.</p>
<p>Put the resulting printout and the hand-written passphrase into an envelope
and store in a secure and well-protected place, preferably away from your
home, such as your bank vault.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your printer is probably no longer a simple dumb device connected to
your parallel port, but since the output is still encrypted with
your passphrase, printing out even to &quot;cloud-integrated&quot; modern
printers should remain a relatively safe operation.</p>
</div>
</section>
<section id="back-up-your-whole-gnupg-directory">
<h3>Back up your whole GnuPG directory<a class="headerlink" href="#back-up-your-whole-gnupg-directory" title="Permalink to this heading">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>!!!Do not skip this step!!!</strong></p>
</div>
<p>It is important to have a readily available backup of your PGP keys
should you need to recover them. This is different from the
disaster-level preparedness we did with <code class="docutils literal notranslate"><span class="pre">paperkey</span></code>. You will also rely
on these external copies whenever you need to use your Certify key --
such as when making changes to your own key or signing other people's
keys after conferences and summits.</p>
<p>Start by getting a small USB &quot;thumb&quot; drive (preferably two!) that you
will use for backup purposes. You will need to encrypt them using LUKS
-- refer to your distro's documentation on how to accomplish this.</p>
<p>For the encryption passphrase, you can use the same one as on your
PGP key.</p>
<p>Once the encryption process is over, re-insert the USB drive and make
sure it gets properly mounted. Copy your entire <code class="docutils literal notranslate"><span class="pre">.gnupg</span></code> directory
over to the encrypted storage:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cp -a ~/.gnupg /media/disk/foo/gnupg-backup
</pre></div>
</div>
<p>You should now test to make sure everything still works:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --homedir=/media/disk/foo/gnupg-backup --list-key [fpr]
</pre></div>
</div>
<p>If you don't get any errors, then you should be good to go. Unmount the
USB drive, distinctly label it so you don't blow it away next time you
need to use a random USB drive, and put in a safe place -- but not too
far away, because you'll need to use it every now and again for things
like editing identities, adding or revoking subkeys, or signing other
people's keys.</p>
</section>
<section id="remove-the-certify-key-from-your-homedir">
<h3>Remove the Certify key from your homedir<a class="headerlink" href="#remove-the-certify-key-from-your-homedir" title="Permalink to this heading">¶</a></h3>
<p>The files in our home directory are not as well protected as we like to
think.  They can be leaked or stolen via many different means:</p>
<ul class="simple">
<li><p>by accident when making quick homedir copies to set up a new workstation</p></li>
<li><p>by systems administrator negligence or malice</p></li>
<li><p>via poorly secured backups</p></li>
<li><p>via malware in desktop apps (browsers, pdf viewers, etc)</p></li>
<li><p>via coercion when crossing international borders</p></li>
</ul>
<p>Protecting your key with a good passphrase greatly helps reduce the risk
of any of the above, but passphrases can be discovered via keyloggers,
shoulder-surfing, or any number of other means. For this reason, the
recommended setup is to remove your Certify key from your home directory
and store it on offline storage.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please see the previous section and make sure you have backed up
your GnuPG directory in its entirety. What we are about to do will
render your key useless if you do not have a usable backup!</p>
</div>
<p>First, identify the keygrip of your Certify key:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --with-keygrip --list-key [fpr]
</pre></div>
</div>
<p>The output will be something like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pub   ed25519 2022-12-20 [SC] [expires: 2022-12-19]
      000000000000000000000000AAAABBBBCCCCDDDD
      Keygrip = 1111000000000000000000000000000000000000
uid           [ultimate] Alice Dev &lt;adev@kernel.org&gt;
sub   cv25519 2022-12-20 [E] [expires: 2022-12-19]
      Keygrip = 2222000000000000000000000000000000000000
sub   ed25519 2022-12-20 [S]
      Keygrip = 3333000000000000000000000000000000000000
</pre></div>
</div>
<p>Find the keygrip entry that is beneath the <code class="docutils literal notranslate"><span class="pre">pub</span></code> line (right under the
Certify key fingerprint). This will correspond directly to a file in your
<code class="docutils literal notranslate"><span class="pre">~/.gnupg</span></code> directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd ~/.gnupg/private-keys-v1.d
$ ls
1111000000000000000000000000000000000000.key
2222000000000000000000000000000000000000.key
3333000000000000000000000000000000000000.key
</pre></div>
</div>
<p>All you have to do is simply remove the .key file that corresponds to
the Certify key keygrip:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd ~/.gnupg/private-keys-v1.d
$ rm 1111000000000000000000000000000000000000.key
</pre></div>
</div>
<p>Now, if you issue the <code class="docutils literal notranslate"><span class="pre">--list-secret-keys</span></code> command, it will show that
the Certify key is missing (the <code class="docutils literal notranslate"><span class="pre">#</span></code> indicates it is not available):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --list-secret-keys
sec#  ed25519 2022-12-20 [SC] [expires: 2024-12-19]
      000000000000000000000000AAAABBBBCCCCDDDD
uid           [ultimate] Alice Dev &lt;adev@kernel.org&gt;
ssb   cv25519 2022-12-20 [E] [expires: 2024-12-19]
ssb   ed25519 2022-12-20 [S]
</pre></div>
</div>
<p>You should also remove any <code class="docutils literal notranslate"><span class="pre">secring.gpg</span></code> files in the <code class="docutils literal notranslate"><span class="pre">~/.gnupg</span></code>
directory, which may be left over from previous versions of GnuPG.</p>
<section id="if-you-don-t-have-the-private-keys-v1-d-directory">
<h4>If you don't have the &quot;private-keys-v1.d&quot; directory<a class="headerlink" href="#if-you-don-t-have-the-private-keys-v1-d-directory" title="Permalink to this heading">¶</a></h4>
<p>If you do not have a <code class="docutils literal notranslate"><span class="pre">~/.gnupg/private-keys-v1.d</span></code> directory, then your
secret keys are still stored in the legacy <code class="docutils literal notranslate"><span class="pre">secring.gpg</span></code> file used by
GnuPG v1. Making any changes to your key, such as changing the
passphrase or adding a subkey, should automatically convert the old
<code class="docutils literal notranslate"><span class="pre">secring.gpg</span></code> format to use <code class="docutils literal notranslate"><span class="pre">private-keys-v1.d</span></code> instead.</p>
<p>Once you get that done, make sure to delete the obsolete <code class="docutils literal notranslate"><span class="pre">secring.gpg</span></code>
file, which still contains your private keys.</p>
</section>
</section>
</section>
<section id="move-the-subkeys-to-a-dedicated-crypto-device">
<span id="smartcards"></span><h2>Move the subkeys to a dedicated crypto device<a class="headerlink" href="#move-the-subkeys-to-a-dedicated-crypto-device" title="Permalink to this heading">¶</a></h2>
<p>Even though the Certify key is now safe from being leaked or stolen, the
subkeys are still in your home directory. Anyone who manages to get
their hands on those will be able to decrypt your communication or fake
your signatures (if they know the passphrase). Furthermore, each time a
GnuPG operation is performed, the keys are loaded into system memory and
can be stolen from there by sufficiently advanced malware (think
Meltdown and Spectre).</p>
<p>The best way to completely protect your keys is to move them to a
specialized hardware device that is capable of smartcard operations.</p>
<section id="the-benefits-of-smartcards">
<h3>The benefits of smartcards<a class="headerlink" href="#the-benefits-of-smartcards" title="Permalink to this heading">¶</a></h3>
<p>A smartcard contains a cryptographic chip that is capable of storing
private keys and performing crypto operations directly on the card
itself. Because the key contents never leave the smartcard, the
operating system of the computer into which you plug in the hardware
device is not able to retrieve the private keys themselves. This is very
different from the encrypted USB storage device we used earlier for
backup purposes -- while that USB device is plugged in and mounted, the
operating system is able to access the private key contents.</p>
<p>Using external encrypted USB media is not a substitute to having a
smartcard-capable device.</p>
</section>
<section id="available-smartcard-devices">
<h3>Available smartcard devices<a class="headerlink" href="#available-smartcard-devices" title="Permalink to this heading">¶</a></h3>
<p>Unless all your laptops and workstations have smartcard readers, the
easiest is to get a specialized USB device that implements smartcard
functionality. There are several options available:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://shop.nitrokey.com/shop/product/nitrokey-start-6">Nitrokey Start</a>: Open hardware and Free Software, based on FSI
Japan's <a class="reference external" href="https://www.fsij.org/doc-gnuk/">Gnuk</a>. One of the few available commercial devices that
support ED25519 ECC keys, but offer fewest security features (such as
resistance to tampering or some side-channel attacks).</p></li>
<li><p><a class="reference external" href="https://shop.nitrokey.com/shop/product/nkpr2-nitrokey-pro-2-3">Nitrokey Pro 2</a>: Similar to the Nitrokey Start, but more
tamper-resistant and offers more security features. Pro 2 supports ECC
cryptography (NISTP).</p></li>
<li><p><a class="reference external" href="https://www.yubico.com/products/yubikey-5-overview/">Yubikey 5</a>: proprietary hardware and software, but cheaper than
Nitrokey Pro and comes available in the USB-C form that is more useful
with newer laptops. Offers additional security features such as FIDO
U2F, among others, and now finally supports NISTP and ED25519 ECC
keys.</p></li>
</ul>
<p>Your choice will depend on cost, shipping availability in your
geographical region, and open/proprietary hardware considerations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are listed in MAINTAINERS or have an account at kernel.org,
you <a class="reference external" href="https://www.kernel.org/nitrokey-digital-tokens-for-kernel-developers.html">qualify for a free Nitrokey Start</a> courtesy of The Linux
Foundation.</p>
</div>
</section>
<section id="configure-your-smartcard-device">
<h3>Configure your smartcard device<a class="headerlink" href="#configure-your-smartcard-device" title="Permalink to this heading">¶</a></h3>
<p>Your smartcard device should Just Work (TM) the moment you plug it into
any modern Linux workstation. You can verify it by running:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --card-status
</pre></div>
</div>
<p>If you see full smartcard details, then you are good to go.
Unfortunately, troubleshooting all possible reasons why things may not
be working for you is way beyond the scope of this guide. If you are
having trouble getting the card to work with GnuPG, please seek help via
usual support channels.</p>
<p>To configure your smartcard, you will need to use the GnuPG menu system, as
there are no convenient command-line switches:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --card-edit
[...omitted...]
gpg/card&gt; admin
Admin commands are allowed
gpg/card&gt; passwd
</pre></div>
</div>
<p>You should set the user PIN (1), Admin PIN (3), and the Reset Code (4).
Please make sure to record and store these in a safe place -- especially
the Admin PIN and the Reset Code (which allows you to completely wipe
the smartcard). You so rarely need to use the Admin PIN, that you will
inevitably forget what it is if you do not record it.</p>
<p>Getting back to the main card menu, you can also set other values (such
as name, sex, login data, etc), but it's not necessary and will
additionally leak information about your smartcard should you lose it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Despite having the name &quot;PIN&quot;, neither the user PIN nor the admin
PIN on the card need to be numbers.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Some devices may require that you move the subkeys onto the device
before you can change the passphrase. Please check the documentation
provided by the device manufacturer.</p>
</div>
</section>
<section id="move-the-subkeys-to-your-smartcard">
<h3>Move the subkeys to your smartcard<a class="headerlink" href="#move-the-subkeys-to-your-smartcard" title="Permalink to this heading">¶</a></h3>
<p>Exit the card menu (using &quot;q&quot;) and save all changes. Next, let's move
your subkeys onto the smartcard. You will need both your PGP key
passphrase and the admin PIN of the card for most operations:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --edit-key [fpr]

Secret subkeys are available.

pub  ed25519/AAAABBBBCCCCDDDD
     created: 2022-12-20  expires: 2024-12-19  usage: SC
     trust: ultimate      validity: ultimate
ssb  cv25519/1111222233334444
     created: 2022-12-20  expires: never       usage: E
ssb  ed25519/5555666677778888
     created: 2017-12-07  expires: never       usage: S
[ultimate] (1). Alice Dev &lt;adev@kernel.org&gt;

gpg&gt;
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">--edit-key</span></code> puts us into the menu mode again, and you will
notice that the key listing is a little different. From here on, all
commands are done from inside this menu mode, as indicated by <code class="docutils literal notranslate"><span class="pre">gpg&gt;</span></code>.</p>
<p>First, let's select the key we'll be putting onto the card -- you do
this by typing <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">1</span></code> (it's the first one in the listing, the <strong>[E]</strong>
subkey):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg&gt; key 1
</pre></div>
</div>
<p>In the output, you should now see <code class="docutils literal notranslate"><span class="pre">ssb*</span></code> on the <strong>[E]</strong> key. The <code class="docutils literal notranslate"><span class="pre">*</span></code>
indicates which key is currently &quot;selected.&quot; It works as a <em>toggle</em>,
meaning that if you type <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">1</span></code> again, the <code class="docutils literal notranslate"><span class="pre">*</span></code> will disappear and
the key will not be selected any more.</p>
<p>Now, let's move that key onto the smartcard:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg&gt; keytocard
Please select where to store the key:
   (2) Encryption key
Your selection? 2
</pre></div>
</div>
<p>Since it's our <strong>[E]</strong> key, it makes sense to put it into the Encryption
slot.  When you submit your selection, you will be prompted first for
your PGP key passphrase, and then for the admin PIN. If the command
returns without an error, your key has been moved.</p>
<p><strong>Important</strong>: Now type <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">1</span></code> again to unselect the first key, and
<code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">2</span></code> to select the <strong>[S]</strong> key:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg&gt; key 1
gpg&gt; key 2
gpg&gt; keytocard
Please select where to store the key:
   (1) Signature key
   (3) Authentication key
Your selection? 1
</pre></div>
</div>
<p>You can use the <strong>[S]</strong> key both for Signature and Authentication, but
we want to make sure it's in the Signature slot, so choose (1). Once
again, if your command returns without an error, then the operation was
successful:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg&gt; q
Save changes? (y/N) y
</pre></div>
</div>
<p>Saving the changes will delete the keys you moved to the card from your
home directory (but it's okay, because we have them in our backups
should we need to do this again for a replacement smartcard).</p>
<section id="verifying-that-the-keys-were-moved">
<h4>Verifying that the keys were moved<a class="headerlink" href="#verifying-that-the-keys-were-moved" title="Permalink to this heading">¶</a></h4>
<p>If you perform <code class="docutils literal notranslate"><span class="pre">--list-secret-keys</span></code> now, you will see a subtle
difference in the output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --list-secret-keys
sec#  ed25519 2022-12-20 [SC] [expires: 2024-12-19]
      000000000000000000000000AAAABBBBCCCCDDDD
uid           [ultimate] Alice Dev &lt;adev@kernel.org&gt;
ssb&gt;  cv25519 2022-12-20 [E] [expires: 2024-12-19]
ssb&gt;  ed25519 2022-12-20 [S]
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> in the <code class="docutils literal notranslate"><span class="pre">ssb&gt;</span></code> output indicates that the subkey is only
available on the smartcard. If you go back into your secret keys
directory and look at the contents there, you will notice that the
<code class="docutils literal notranslate"><span class="pre">.key</span></code> files there have been replaced with stubs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd ~/.gnupg/private-keys-v1.d
$ strings *.key | grep &#39;private-key&#39;
</pre></div>
</div>
<p>The output should contain <code class="docutils literal notranslate"><span class="pre">shadowed-private-key</span></code> to indicate that
these files are only stubs and the actual content is on the smartcard.</p>
</section>
<section id="verifying-that-the-smartcard-is-functioning">
<h4>Verifying that the smartcard is functioning<a class="headerlink" href="#verifying-that-the-smartcard-is-functioning" title="Permalink to this heading">¶</a></h4>
<p>To verify that the smartcard is working as intended, you can create a
signature:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo &quot;Hello world&quot; | gpg --clearsign &gt; /tmp/test.asc
$ gpg --verify /tmp/test.asc
</pre></div>
</div>
<p>This should ask for your smartcard PIN on your first command, and then
show &quot;Good signature&quot; after you run <code class="docutils literal notranslate"><span class="pre">gpg</span> <span class="pre">--verify</span></code>.</p>
<p>Congratulations, you have successfully made it extremely difficult to
steal your digital developer identity!</p>
</section>
</section>
<section id="other-common-gnupg-operations">
<h3>Other common GnuPG operations<a class="headerlink" href="#other-common-gnupg-operations" title="Permalink to this heading">¶</a></h3>
<p>Here is a quick reference for some common operations you'll need to do
with your PGP key.</p>
<section id="mounting-your-safe-offline-storage">
<h4>Mounting your safe offline storage<a class="headerlink" href="#mounting-your-safe-offline-storage" title="Permalink to this heading">¶</a></h4>
<p>You will need your Certify key for any of the operations below, so you
will first need to mount your backup offline storage and tell GnuPG to
use it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ export GNUPGHOME=/media/disk/foo/gnupg-backup
$ gpg --list-secret-keys
</pre></div>
</div>
<p>You want to make sure that you see <code class="docutils literal notranslate"><span class="pre">sec</span></code> and not <code class="docutils literal notranslate"><span class="pre">sec#</span></code> in the
output (the <code class="docutils literal notranslate"><span class="pre">#</span></code> means the key is not available and you're still using
your regular home directory location).</p>
</section>
<section id="extending-key-expiration-date">
<h4>Extending key expiration date<a class="headerlink" href="#extending-key-expiration-date" title="Permalink to this heading">¶</a></h4>
<p>The Certify key has the default expiration date of 2 years from the date
of creation. This is done both for security reasons and to make obsolete
keys eventually disappear from keyservers.</p>
<p>To extend the expiration on your key by a year from current date, just
run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --quick-set-expire [fpr] 1y
</pre></div>
</div>
<p>You can also use a specific date if that is easier to remember (e.g.
your birthday, January 1st, or Canada Day):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --quick-set-expire [fpr] 2025-07-01
</pre></div>
</div>
<p>Remember to send the updated key back to keyservers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --send-key [fpr]
</pre></div>
</div>
</section>
<section id="updating-your-work-directory-after-any-changes">
<h4>Updating your work directory after any changes<a class="headerlink" href="#updating-your-work-directory-after-any-changes" title="Permalink to this heading">¶</a></h4>
<p>After you make any changes to your key using the offline storage, you will
want to import these changes back into your regular working directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --export | gpg --homedir ~/.gnupg --import
$ unset GNUPGHOME
</pre></div>
</div>
</section>
<section id="using-gpg-agent-over-ssh">
<h4>Using gpg-agent over ssh<a class="headerlink" href="#using-gpg-agent-over-ssh" title="Permalink to this heading">¶</a></h4>
<p>You can forward your gpg-agent over ssh if you need to sign tags or
commits on a remote system. Please refer to the instructions provided
on the GnuPG wiki:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://wiki.gnupg.org/AgentForwarding">Agent Forwarding over SSH</a></p></li>
</ul>
<p>It works more smoothly if you can modify the sshd server settings on the
remote end.</p>
</section>
</section>
</section>
<section id="using-pgp-with-git">
<span id="pgp-with-git"></span><h2>Using PGP with Git<a class="headerlink" href="#using-pgp-with-git" title="Permalink to this heading">¶</a></h2>
<p>One of the core features of Git is its decentralized nature -- once a
repository is cloned to your system, you have full history of the
project, including all of its tags, commits and branches. However, with
hundreds of cloned repositories floating around, how does anyone verify
that their copy of linux.git has not been tampered with by a malicious
third party?</p>
<p>Or what happens if a backdoor is discovered in the code and the &quot;Author&quot;
line in the commit says it was done by you, while you're pretty sure you
had <a class="reference external" href="https://github.com/jayphelps/git-blame-someone-else">nothing to do with it</a>?</p>
<p>To address both of these issues, Git introduced PGP integration. Signed
tags prove the repository integrity by assuring that its contents are
exactly the same as on the workstation of the developer who created the
tag, while signed commits make it nearly impossible for someone to
impersonate you without having access to your PGP keys.</p>
<section id="configure-git-to-use-your-pgp-key">
<h3>Configure git to use your PGP key<a class="headerlink" href="#configure-git-to-use-your-pgp-key" title="Permalink to this heading">¶</a></h3>
<p>If you only have one secret key in your keyring, then you don't really
need to do anything extra, as it becomes your default key.  However, if
you happen to have multiple secret keys, you can tell git which key
should be used (<code class="docutils literal notranslate"><span class="pre">[fpr]</span></code> is the fingerprint of your key):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git config --global user.signingKey [fpr]
</pre></div>
</div>
</section>
<section id="how-to-work-with-signed-tags">
<h3>How to work with signed tags<a class="headerlink" href="#how-to-work-with-signed-tags" title="Permalink to this heading">¶</a></h3>
<p>To create a signed tag, simply pass the <code class="docutils literal notranslate"><span class="pre">-s</span></code> switch to the tag
command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git tag -s [tagname]
</pre></div>
</div>
<p>Our recommendation is to always sign git tags, as this allows other
developers to ensure that the git repository they are pulling from has
not been maliciously altered.</p>
<section id="how-to-verify-signed-tags">
<h4>How to verify signed tags<a class="headerlink" href="#how-to-verify-signed-tags" title="Permalink to this heading">¶</a></h4>
<p>To verify a signed tag, simply use the <code class="docutils literal notranslate"><span class="pre">verify-tag</span></code> command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git verify-tag [tagname]
</pre></div>
</div>
<p>If you are pulling a tag from another fork of the project repository,
git should automatically verify the signature at the tip you're pulling
and show you the results during the merge operation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git pull [url] tags/sometag
</pre></div>
</div>
<p>The merge message will contain something like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Merge tag &#39;sometag&#39; of [url]

[Tag message]

# gpg: Signature made [...]
# gpg: Good signature from [...]
</pre></div>
</div>
<p>If you are verifying someone else's git tag, then you will need to
import their PGP key. Please refer to the
&quot;<a class="reference internal" href="#verify-identities"><span class="std std-ref">How to work with signed patches</span></a>&quot; section below.</p>
</section>
<section id="configure-git-to-always-sign-annotated-tags">
<h4>Configure git to always sign annotated tags<a class="headerlink" href="#configure-git-to-always-sign-annotated-tags" title="Permalink to this heading">¶</a></h4>
<p>Chances are, if you're creating an annotated tag, you'll want to sign
it. To force git to always sign annotated tags, you can set a global
configuration option:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git config --global tag.forceSignAnnotated true
</pre></div>
</div>
</section>
</section>
<section id="how-to-work-with-signed-commits">
<h3>How to work with signed commits<a class="headerlink" href="#how-to-work-with-signed-commits" title="Permalink to this heading">¶</a></h3>
<p>It is easy to create signed commits, but it is much more difficult to
use them in Linux kernel development, since it relies on patches sent to
the mailing list, and this workflow does not preserve PGP commit
signatures. Furthermore, when rebasing your repository to match
upstream, even your own PGP commit signatures will end up discarded. For
this reason, most kernel developers don't bother signing their commits
and will ignore signed commits in any external repositories that they
rely upon in their work.</p>
<p>However, if you have your working git tree publicly available at some
git hosting service (kernel.org, infradead.org, ozlabs.org, or others),
then the recommendation is that you sign all your git commits even if
upstream developers do not directly benefit from this practice.</p>
<p>We recommend this for the following reasons:</p>
<ol class="arabic simple">
<li><p>Should there ever be a need to perform code forensics or track code
provenance, even externally maintained trees carrying PGP commit
signatures will be valuable for such purposes.</p></li>
<li><p>If you ever need to re-clone your local repository (for example,
after a disk failure), this lets you easily verify the repository
integrity before resuming your work.</p></li>
<li><p>If someone needs to cherry-pick your commits, this allows them to
quickly verify their integrity before applying them.</p></li>
</ol>
<section id="creating-signed-commits">
<h4>Creating signed commits<a class="headerlink" href="#creating-signed-commits" title="Permalink to this heading">¶</a></h4>
<p>To create a signed commit, you just need to pass the <code class="docutils literal notranslate"><span class="pre">-S</span></code> flag to the
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span></code> command (it's capital <code class="docutils literal notranslate"><span class="pre">-S</span></code> due to collision with
another flag):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git commit -S
</pre></div>
</div>
</section>
<section id="configure-git-to-always-sign-commits">
<h4>Configure git to always sign commits<a class="headerlink" href="#configure-git-to-always-sign-commits" title="Permalink to this heading">¶</a></h4>
<p>You can tell git to always sign commits:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git config --global commit.gpgSign true
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure you configure <code class="docutils literal notranslate"><span class="pre">gpg-agent</span></code> before you turn this on.</p>
</div>
</section>
</section>
<section id="how-to-work-with-signed-patches">
<span id="verify-identities"></span><h3>How to work with signed patches<a class="headerlink" href="#how-to-work-with-signed-patches" title="Permalink to this heading">¶</a></h3>
<p>It is possible to use your PGP key to sign patches sent to kernel
developer mailing lists. Since existing email signature mechanisms
(PGP-Mime or PGP-inline) tend to cause problems with regular code
review tasks, you should use the tool kernel.org created for this
purpose that puts cryptographic attestation signatures into message
headers (a-la DKIM):</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.org/project/patatt/">Patatt Patch Attestation</a></p></li>
</ul>
<section id="installing-and-configuring-patatt">
<h4>Installing and configuring patatt<a class="headerlink" href="#installing-and-configuring-patatt" title="Permalink to this heading">¶</a></h4>
<p>Patatt is packaged for many distributions already, so please check there
first. You can also install it from pypi using &quot;<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">patatt</span></code>&quot;.</p>
<p>If you already have your PGP key configured with git (via the
<code class="docutils literal notranslate"><span class="pre">user.signingKey</span></code> configuration parameter), then patatt requires no
further configuration. You can start signing your patches by installing
the git-send-email hook in the repository you want:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>patatt install-hook
</pre></div>
</div>
<p>Now any patches you send with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">send-email</span></code> will be automatically
signed with your cryptographic signature.</p>
</section>
<section id="checking-patatt-signatures">
<h4>Checking patatt signatures<a class="headerlink" href="#checking-patatt-signatures" title="Permalink to this heading">¶</a></h4>
<p>If you are using <code class="docutils literal notranslate"><span class="pre">b4</span></code> to retrieve and apply patches, then it will
automatically attempt to verify all DKIM and patatt signatures it
encounters, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ b4 am 20220720205013.890942-1-broonie@kernel.org
[...]
Checking attestation on all messages, may take a moment...
---
  ✓ [PATCH v1 1/3] kselftest/arm64: Correct buffer allocation for SVE Z registers
  ✓ [PATCH v1 2/3] arm64/sve: Document our actual ABI for clearing registers on syscall
  ✓ [PATCH v1 3/3] kselftest/arm64: Enforce actual ABI for SVE syscalls
  ---
  ✓ Signed: openpgp/broonie@kernel.org
  ✓ Signed: DKIM/kernel.org
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Patatt and b4 are still in active development and you should check
the latest documentation for these projects for any new or updated
features.</p>
</div>
</section>
</section>
</section>
<section id="how-to-verify-kernel-developer-identities">
<span id="kernel-identities"></span><h2>How to verify kernel developer identities<a class="headerlink" href="#how-to-verify-kernel-developer-identities" title="Permalink to this heading">¶</a></h2>
<p>Signing tags and commits is easy, but how does one go about verifying
that the key used to sign something belongs to the actual kernel
developer and not to a malicious imposter?</p>
<section id="configure-auto-key-retrieval-using-wkd-and-dane">
<h3>Configure auto-key-retrieval using WKD and DANE<a class="headerlink" href="#configure-auto-key-retrieval-using-wkd-and-dane" title="Permalink to this heading">¶</a></h3>
<p>If you are not already someone with an extensive collection of other
developers' public keys, then you can jumpstart your keyring by relying
on key auto-discovery and auto-retrieval. GnuPG can piggyback on other
delegated trust technologies, namely DNSSEC and TLS, to get you going if
the prospect of starting your own Web of Trust from scratch is too
daunting.</p>
<p>Add the following to your <code class="docutils literal notranslate"><span class="pre">~/.gnupg/gpg.conf</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>auto-key-locate wkd,dane,local
auto-key-retrieve
</pre></div>
</div>
<p>DNS-Based Authentication of Named Entities (&quot;DANE&quot;) is a method for
publishing public keys in DNS and securing them using DNSSEC signed
zones. Web Key Directory (&quot;WKD&quot;) is the alternative method that uses
https lookups for the same purpose. When using either DANE or WKD for
looking up public keys, GnuPG will validate DNSSEC or TLS certificates,
respectively, before adding auto-retrieved public keys to your local
keyring.</p>
<p>Kernel.org publishes the WKD for all developers who have kernel.org
accounts. Once you have the above changes in your <code class="docutils literal notranslate"><span class="pre">gpg.conf</span></code>, you can
auto-retrieve the keys for Linus Torvalds and Greg Kroah-Hartman (if you
don't already have them):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gpg --locate-keys torvalds@kernel.org gregkh@kernel.org
</pre></div>
</div>
<p>If you have a kernel.org account, then you should <a class="reference external" href="https://korg.wiki.kernel.org/userdoc/mail#adding_a_kernelorg_uid_to_your_pgp_key">add the kernel.org
UID to your key</a> to make WKD more useful to other kernel developers.</p>
</section>
<section id="web-of-trust-wot-vs-trust-on-first-use-tofu">
<h3>Web of Trust (WOT) vs. Trust on First Use (TOFU)<a class="headerlink" href="#web-of-trust-wot-vs-trust-on-first-use-tofu" title="Permalink to this heading">¶</a></h3>
<p>PGP incorporates a trust delegation mechanism known as the &quot;Web of
Trust.&quot; At its core, this is an attempt to replace the need for
centralized Certification Authorities of the HTTPS/TLS world. Instead of
various software makers dictating who should be your trusted certifying
entity, PGP leaves this responsibility to each user.</p>
<p>Unfortunately, very few people understand how the Web of Trust works.
While it remains an important aspect of the OpenPGP specification,
recent versions of GnuPG (2.2 and above) have implemented an alternative
mechanism called &quot;Trust on First Use&quot; (TOFU). You can think of TOFU as
&quot;the SSH-like approach to trust.&quot; With SSH, the first time you connect
to a remote system, its key fingerprint is recorded and remembered. If
the key changes in the future, the SSH client will alert you and refuse
to connect, forcing you to make a decision on whether you choose to
trust the changed key or not. Similarly, the first time you import
someone's PGP key, it is assumed to be valid. If at any point in the
future GnuPG comes across another key with the same identity, both the
previously imported key and the new key will be marked as invalid and
you will need to manually figure out which one to keep.</p>
<p>We recommend that you use the combined TOFU+PGP trust model (which is
the new default in GnuPG v2). To set it, add (or modify) the
<code class="docutils literal notranslate"><span class="pre">trust-model</span></code> setting in <code class="docutils literal notranslate"><span class="pre">~/.gnupg/gpg.conf</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>trust-model tofu+pgp
</pre></div>
</div>
</section>
<section id="using-the-kernel-org-web-of-trust-repository">
<h3>Using the kernel.org web of trust repository<a class="headerlink" href="#using-the-kernel-org-web-of-trust-repository" title="Permalink to this heading">¶</a></h3>
<p>Kernel.org maintains a git repository with developers' public keys as a
replacement for replicating keyserver networks that have gone mostly
dark in the past few years. The full documentation for how to set up
that repository as your source of public keys can be found here:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://korg.docs.kernel.org/pgpkeys.html">Kernel developer PGP Keyring</a></p></li>
</ul>
<p>If you are a kernel developer, please consider submitting your key for
inclusion into that keyring.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/process/maintainer-pgp-guide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>