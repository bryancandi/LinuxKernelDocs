
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>TTY Port &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TTY Struct" href="tty_struct.html" />
    <link rel="prev" title="TTY Driver and TTY Operations" href="tty_driver.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.6.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Driver implementer's API guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../driver-model/index.html">Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html">Driver Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infrastructure.html">Device drivers infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ioctl.html">ioctl based interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../early-userspace/index.html">Early Userspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">CPU and Device Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clk.html">The Common Clk Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-io.html">Bus-Independent Device Accesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dma-buf.html">Buffer Sharing and Synchronization (dma-buf)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_link.html">Device links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../component.html">Component Helper for Aggregate Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../message-based.html">Message-based devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aperture.html">Managing Ownership of the Framebuffer Aperture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reset.html">Reset controller API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input.html">Input Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usb/index.html">Linux USB API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pci/index.html">The Linux PCI driver implementer's API guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cxl/index.html">Compute Express Link</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devfreq.html">Device Frequency Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libata.html">libATA Developer's Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mailbox.html">The Common Mailbox Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../w1.html">W1: Dallas' 1-wire bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vme.html">VME Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../80211/index.html">Linux 802.11 Driver Developer's Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uio-howto.html">The Userspace I/O HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pin-control.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md/index.html">RAID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../media/index.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thermal/index.html">Thermal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auxiliary_bus.html">Auxiliary Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connector.html">Kernel Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console.html">Console Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dcdbas.html">Dell Systems Management Base Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../eisa.html">EISA bus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isa.html">ISA Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isapnp.html">ISA Plug &amp; Play support by Jaroslav Kysela &lt;perex&#64;suse.cz&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io-mapping.html">The io_mapping functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io_ordering.html">Ordering I/O writes to memory-mapped addresses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ntb.html">NTB Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pldmfw/index.html">PLDM Firmware Flash Update Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pldmfw/index.html#overview-of-the-pldmfw-library">Overview of the <code class="docutils literal notranslate"><span class="pre">pldmfw</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sm501.html">SM501 Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../surface_aggregator/index.html">Surface System Aggregator Module (SSAM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">TTY</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html#tty-structures">TTY structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#writing-tty-driver">Writing TTY Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#other-documentation">Other Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../vfio-mediated-device.html">VFIO Mediated devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio.html">VFIO - &quot;Virtual Function I/O&quot; </a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio-pci-device-specific-driver-acceptance.html">Acceptance criteria for vfio-pci device specific driver variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../virtio/index.html">Virtio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xillybus.html">Xillybus driver for generic FPGA interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zorro.html">Writing Device Drivers for Zorro Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hte/index.html">The Linux Hardware Timestamping Engine (HTE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wmi.html">WMI Driver API</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../subsystem-apis.html">Kernel subsystem documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../subsystem-apis.html#core-subsystems">Core subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Driver implementer's API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mm/index.html">Memory Management Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../timers/index.html">Timers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user's and administrator's guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  sbar.scrollTop = currents[currents.length - 1].offsetTop;
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/tty/tty_port.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tty-port">
<h1>TTY Port<a class="headerlink" href="#tty-port" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#tty-port-functions" id="id1">TTY Port Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#init-destroy" id="id2">Init &amp; Destroy</a></p></li>
<li><p><a class="reference internal" href="#open-close-hangup-helpers" id="id3">Open/Close/Hangup Helpers</a></p></li>
<li><p><a class="reference internal" href="#tty-refcounting" id="id4">TTY Refcounting</a></p></li>
<li><p><a class="reference internal" href="#tty-helpers" id="id5">TTY Helpers</a></p></li>
<li><p><a class="reference internal" href="#modem-signals" id="id6">Modem Signals</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tty-port-reference" id="id7">TTY Port Reference</a></p></li>
<li><p><a class="reference internal" href="#tty-port-operations-reference" id="id8">TTY Port Operations Reference</a></p></li>
</ul>
</nav>
<p>The TTY drivers are advised to use <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a> helpers as much as possible.
If the drivers implement <code class="xref c c-member docutils literal notranslate"><span class="pre">tty_port.ops.activate()</span></code> and
<code class="xref c c-member docutils literal notranslate"><span class="pre">tty_port.ops.shutdown()</span></code>, they can use <a class="reference internal" href="#c.tty_port_open" title="tty_port_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_open()</span></code></a>,
<a class="reference internal" href="#c.tty_port_close" title="tty_port_close"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close()</span></code></a>, and <a class="reference internal" href="#c.tty_port_hangup" title="tty_port_hangup"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_hangup()</span></code></a> in respective
<code class="xref c c-member docutils literal notranslate"><span class="pre">tty_struct.ops</span></code> hooks.</p>
<p>The reference and details are contained in the <a class="reference internal" href="#tty-port-reference">TTY Port Reference</a> and <a class="reference internal" href="#tty-port-operations-reference">TTY
Port Operations Reference</a> sections at the bottom.</p>
<section id="tty-port-functions">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">TTY Port Functions</a><a class="headerlink" href="#tty-port-functions" title="Permalink to this heading">¶</a></h2>
<section id="init-destroy">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Init &amp; Destroy</a><a class="headerlink" href="#init-destroy" title="Permalink to this heading">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_init">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><ul class="simple">
<li><p>initialize tty_port</p></li>
</ul>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty_port to initialize</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Initializes the state of <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a>. When a port was initialized using
this function, one has to destroy the port by <a class="reference internal" href="#c.tty_port_destroy" title="tty_port_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_destroy()</span></code></a>. Either
indirectly by using <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_port</span></code></a> refcounting (<a class="reference internal" href="#c.tty_port_put" title="tty_port_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_put()</span></code></a>) or directly if
refcounting is not used.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_destroy">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_destroy</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_destroy" title="Permalink to this definition">¶</a><br /></dt>
<dd><ul class="simple">
<li><p>destroy inited port</p></li>
</ul>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port to be destroyed</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>When a port was initialized using <a class="reference internal" href="#c.tty_port_init" title="tty_port_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_init()</span></code></a>, one has to destroy the
port by this function. Either indirectly by using <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_port</span></code></a> refcounting
(<a class="reference internal" href="#c.tty_port_put" title="tty_port_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_put()</span></code></a>) or directly if refcounting is not used.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_put">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_put</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_put" title="Permalink to this definition">¶</a><br /></dt>
<dd><ul class="simple">
<li><p>drop a reference to tty_port</p></li>
</ul>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>port to drop a reference of (can be NULL)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The final put will destroy and free up the <strong>port</strong> using
<strong>port-&gt;ops-&gt;destruct()</strong> hook, or using <a class="reference internal" href="../../core-api/mm-api.html#c.kfree" title="kfree"><code class="xref c c-func docutils literal notranslate"><span class="pre">kfree()</span></code></a> if not provided.</p>
</div>
</section>
<section id="open-close-hangup-helpers">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Open/Close/Hangup Helpers</a><a class="headerlink" href="#open-close-hangup-helpers" title="Permalink to this heading">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_shutdown">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_shutdown</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_shutdown" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>internal helper to shutdown the device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port to be shut down</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>the associated tty</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is used by <a class="reference internal" href="#c.tty_port_hangup" title="tty_port_hangup"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_hangup()</span></code></a> and <a class="reference internal" href="#c.tty_port_close" title="tty_port_close"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close()</span></code></a>. Its task is to
shutdown the device if it was initialized (note consoles remain
functioning). It lowers DTR/RTS (if <strong>tty</strong> has HUPCL set) and invokes
<strong>port-&gt;ops-&gt;shutdown()</strong>.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_hangup">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_hangup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_hangup" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>hangup helper</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform port level tty hangup flag and count changes. Drop the tty
reference.</p>
<p>Caller holds tty lock.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_block_til_ready">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_block_til_ready</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">file</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">filp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_block_til_ready" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Waiting logic for tty open</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>the tty port being opened</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>the tty device being bound</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt><dd><p>the file pointer of the opener or <code class="docutils literal notranslate"><span class="pre">NULL</span></code></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Implement the core POSIX/SuS tty behaviour when opening a tty device.
Handles:</p>
<blockquote>
<div><ul class="simple">
<li><p>hangup (both before and during)</p></li>
<li><p>non blocking open</p></li>
<li><p>rts/dtr/dcd</p></li>
<li><p>signals</p></li>
<li><p>port flags and counts</p></li>
</ul>
</div></blockquote>
<p>The passed <strong>port</strong> must implement the <strong>port-&gt;ops-&gt;carrier_raised</strong> method if it
can do carrier detect and the <strong>port-&gt;ops-&gt;dtr_rts</strong> method if it supports
software management of these lines. Note that the dtr/rts raise is done each
iteration as a hangup may have previously dropped them while we wait.</p>
<p>Caller holds tty lock.</p>
<p><strong>Note</strong></p>
<p>May drop and reacquire tty lock when blocking, so <strong>tty</strong> and <strong>port</strong> may
have changed state (eg., may have been hung up).</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_close_start">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_close_start</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">file</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">filp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_close_start" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>helper for tty-&gt;ops-&gt;close, part 1/2</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty_port of the device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty being closed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt><dd><p>passed file pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Decrements and checks open count. Flushes the port if this is the last
close. That means, dropping the data from the outpu buffer on the device and
waiting for sending logic to finish. The rest of close handling is performed
in <a class="reference internal" href="#c.tty_port_close_end" title="tty_port_close_end"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_end()</span></code></a>.</p>
<p>Locking: Caller holds tty lock.</p>
<p><strong>Return</strong></p>
<p>1 if this is the last close, otherwise 0</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_close_end">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_close_end</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_close_end" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>helper for tty-&gt;ops-&gt;close, part 2/2</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty_port of the device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty being closed</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a continuation of the first part: <a class="reference internal" href="#c.tty_port_close_start" title="tty_port_close_start"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_start()</span></code></a>. This
should be called after turning off the device. It flushes the data from the
line discipline and delays the close by <strong>port-&gt;close_delay</strong>.</p>
<p>Locking: Caller holds tty lock.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_close">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_close</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">file</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">filp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_close" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>generic tty-&gt;ops-&gt;close handler</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty_port of the device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty being closed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt><dd><p>passed file pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is a generic helper to be used in driver's <strong>tty-&gt;ops-&gt;close</strong>. It wraps a
sequence of <a class="reference internal" href="#c.tty_port_close_start" title="tty_port_close_start"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_start()</span></code></a>, <a class="reference internal" href="#c.tty_port_shutdown" title="tty_port_shutdown"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_shutdown()</span></code></a>, and
<a class="reference internal" href="#c.tty_port_close_end" title="tty_port_close_end"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_end()</span></code></a>. The latter two are called only if this is the last
close. See the respective functions for the details.</p>
<p>Locking: Caller holds tty lock</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_install">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_install</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><span class="n"><span class="pre">tty_driver</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">driver</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_install" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>generic tty-&gt;ops-&gt;install handler</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty_port of the device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt><dd><p>tty_driver for this device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty to be installed</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is the same as <a class="reference internal" href="tty_struct.html#c.tty_standard_install" title="tty_standard_install"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_standard_install()</span></code></a> except the provided <strong>port</strong> is linked
to a concrete tty specified by <strong>tty</strong>. Use this or <a class="reference internal" href="tty_driver.html#c.tty_port_register_device" title="tty_port_register_device"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_register_device()</span></code></a>
(or both). Call <a class="reference internal" href="tty_driver.html#c.tty_port_link_device" title="tty_port_link_device"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_link_device()</span></code></a> as a last resort.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_open">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_open</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">file</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">filp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_open" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>generic tty-&gt;ops-&gt;open handler</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty_port of the device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty to be opened</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt><dd><p>passed file pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is a generic helper to be used in driver's <strong>tty-&gt;ops-&gt;open</strong>. It activates
the devices using <strong>port-&gt;ops-&gt;activate</strong> if not active already. And waits for
the device to be ready using <a class="reference internal" href="#c.tty_port_block_til_ready" title="tty_port_block_til_ready"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_block_til_ready()</span></code></a> (e.g.  raises
DTR/CTS and waits for carrier).</p>
<p>Note that <strong>port-&gt;ops-&gt;shutdown</strong> is not called when <strong>port-&gt;ops-&gt;activate</strong>
returns an error (on the contrary, <strong>tty-&gt;ops-&gt;close</strong> is).</p>
<p>Locking: Caller holds tty lock.</p>
<p><strong>Note</strong></p>
<p>may drop and reacquire tty lock (in <a class="reference internal" href="#c.tty_port_block_til_ready" title="tty_port_block_til_ready"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_block_til_ready()</span></code></a>) so
<strong>tty</strong> and <strong>port</strong> may have changed state (eg., may be hung up now).</p>
</div>
</section>
<section id="tty-refcounting">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">TTY Refcounting</a><a class="headerlink" href="#tty-refcounting" title="Permalink to this heading">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_tty_get">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_tty_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_tty_get" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>get a tty reference</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Return a refcount protected tty instance or <code class="docutils literal notranslate"><span class="pre">NULL</span></code> if the port is not
associated with a tty (eg due to close or hangup).</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_tty_set">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_tty_set</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_tty_set" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>set the tty of a port</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>the tty</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Associate the port and tty pair. Manages any internal refcounts. Pass <code class="docutils literal notranslate"><span class="pre">NULL</span></code>
to deassociate a port.</p>
</div>
</section>
<section id="tty-helpers">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">TTY Helpers</a><a class="headerlink" href="#tty-helpers" title="Permalink to this heading">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_tty_hangup">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_tty_hangup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">check_clocal</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_tty_hangup" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>helper to hang up a tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">check_clocal</span></code></dt><dd><p>hang only ttys with <code class="docutils literal notranslate"><span class="pre">CLOCAL</span></code> unset?</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_tty_wakeup">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_tty_wakeup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_tty_wakeup" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>helper to wake up a tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port</p>
</dd>
</dl>
</div>
</section>
<section id="modem-signals">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Modem Signals</a><a class="headerlink" href="#modem-signals" title="Permalink to this heading">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_carrier_raised">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_carrier_raised</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_carrier_raised" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>carrier raised check</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Wrapper for the carrier detect logic. For the moment this is used
to hide some internal details. This will eventually become entirely
internal to the tty port.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_raise_dtr_rts">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_raise_dtr_rts</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_raise_dtr_rts" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Raise DTR/RTS</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Wrapper for the DTR/RTS raise logic. For the moment this is used to hide
some internal details. This will eventually become entirely internal to the
tty port.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.tty_port_lower_dtr_rts">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_lower_dtr_rts</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.tty_port" title="tty_port"><span class="n"><span class="pre">tty_port</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">port</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_lower_dtr_rts" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Lower DTR/RTS</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt><dd><p>tty port</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Wrapper for the DTR/RTS raise logic. For the moment this is used to hide
some internal details. This will eventually become entirely internal to the
tty port.</p>
</div>
</section>
</section>
<hr class="docutils" />
<section id="tty-port-reference">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">TTY Port Reference</a><a class="headerlink" href="#tty-port-reference" title="Permalink to this heading">¶</a></h2>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tty_port">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port</span></span></span><a class="headerlink" href="#c.tty_port" title="Permalink to this definition">¶</a><br /></dt>
<dd><ul class="simple">
<li><p>port level information</p></li>
</ul>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct tty_port {
    struct tty_bufhead      buf;
    struct tty_struct       *tty;
    struct tty_struct       *itty;
    const struct tty_port_operations *ops;
    const struct tty_port_client_operations *client_ops;
    spinlock_t lock;
    int blocked_open;
    int count;
    wait_queue_head_t open_wait;
    wait_queue_head_t delta_msr_wait;
    unsigned long           flags;
    unsigned long           iflags;
    unsigned char           console:1;
    struct mutex            mutex;
    struct mutex            buf_mutex;
    unsigned char           *xmit_buf;
    unsigned char *xmit_fifo;
    unsigned int            close_delay;
    unsigned int            closing_wait;
    int drain_delay;
    struct kref             kref;
    void *client_data;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">buf</span></code></dt><dd><p>buffer for this port, locked internally</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tty</span></code></dt><dd><p>back pointer to <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span></code></a>, valid only if the tty is open. Use
<a class="reference internal" href="#c.tty_port_tty_get" title="tty_port_tty_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_tty_get()</span></code></a> to obtain it (and <a class="reference internal" href="tty_struct.html#c.tty_kref_put" title="tty_kref_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_kref_put()</span></code></a> to release).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">itty</span></code></dt><dd><p>internal back pointer to <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span></code></a>. Avoid this. It should be
eliminated in the long term.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ops</span></code></dt><dd><p>tty port operations (like activate, shutdown), see <a class="reference internal" href="#c.tty_port_operations" title="tty_port_operations"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span>
<span class="pre">tty_port_operations</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">client_ops</span></code></dt><dd><p>tty port client operations (like receive_buf, write_wakeup).
By default, tty_port_default_client_ops is used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lock</span></code></dt><dd><p>lock protecting <strong>tty</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">blocked_open</span></code></dt><dd><p># of procs waiting for open in <a class="reference internal" href="#c.tty_port_block_til_ready" title="tty_port_block_til_ready"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_block_til_ready()</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt><dd><p>usage count</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">open_wait</span></code></dt><dd><p>open waiters queue (waiting e.g. for a carrier)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">delta_msr_wait</span></code></dt><dd><p>modem status change queue (waiting for MSR changes)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>user TTY flags (<code class="docutils literal notranslate"><span class="pre">ASYNC_</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">iflags</span></code></dt><dd><p>internal flags (<code class="docutils literal notranslate"><span class="pre">TTY_PORT_</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">console</span></code></dt><dd><p>when set, the port is a console</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mutex</span></code></dt><dd><p>locking, for open, shutdown and other port operations</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buf_mutex</span></code></dt><dd><p><strong>xmit_buf</strong> alloc lock</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xmit_buf</span></code></dt><dd><p>optional xmit buffer used by some drivers</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xmit_fifo</span></code></dt><dd><p>optional xmit buffer used by some drivers</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">close_delay</span></code></dt><dd><p>delay in jiffies to wait when closing the port</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">closing_wait</span></code></dt><dd><p>delay in jiffies for output to be sent before closing</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">drain_delay</span></code></dt><dd><p>set to zero if no pure time based drain is needed else set to
size of fifo</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kref</span></code></dt><dd><p>references counter. Reaching zero calls <strong>ops-&gt;destruct()</strong> if non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code>
or frees the port otherwise.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">client_data</span></code></dt><dd><p>pointer to private data, for <strong>client_ops</strong></p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Each device keeps its own port level information. <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a> was
introduced as a common structure for such information. As every TTY device
shall have a backing tty_port structure, every driver can use these members.</p>
<p>The tty port has a different lifetime to the tty so must be kept apart.
In addition be careful as tty -&gt; port mappings are valid for the life
of the tty object but in many cases port -&gt; tty mappings are valid only
until a hangup so don't use the wrong path.</p>
<p>Tty port shall be initialized by <a class="reference internal" href="#c.tty_port_init" title="tty_port_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_init()</span></code></a> and shut down either by
<a class="reference internal" href="#c.tty_port_destroy" title="tty_port_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_destroy()</span></code></a> (refcounting not used), or <a class="reference internal" href="#c.tty_port_put" title="tty_port_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_put()</span></code></a> (refcounting).</p>
<p>There is a lot of helpers around <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a> too. To name the most
significant ones: <a class="reference internal" href="#c.tty_port_open" title="tty_port_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_open()</span></code></a>, <a class="reference internal" href="#c.tty_port_close" title="tty_port_close"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close()</span></code></a> (or
<a class="reference internal" href="#c.tty_port_close_start" title="tty_port_close_start"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_start()</span></code></a> and <a class="reference internal" href="#c.tty_port_close_end" title="tty_port_close_end"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_end()</span></code></a> separately if need be), and
<a class="reference internal" href="#c.tty_port_hangup" title="tty_port_hangup"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_hangup()</span></code></a>. These call <strong>ops-&gt;activate()</strong> and <strong>ops-&gt;shutdown()</strong> as
needed.</p>
</section>
<hr class="docutils" />
<section id="tty-port-operations-reference">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">TTY Port Operations Reference</a><a class="headerlink" href="#tty-port-operations-reference" title="Permalink to this heading">¶</a></h2>
<dl class="c struct">
<dt class="sig sig-object c" id="c.tty_port_operations">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">tty_port_operations</span></span></span><a class="headerlink" href="#c.tty_port_operations" title="Permalink to this definition">¶</a><br /></dt>
<dd><ul class="simple">
<li><p>operations on tty_port</p></li>
</ul>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct tty_port_operations {
    bool (*carrier_raised)(struct tty_port *port);
    void (*dtr_rts)(struct tty_port *port, bool active);
    void (*shutdown)(struct tty_port *port);
    int (*activate)(struct tty_port *port, struct tty_struct *tty);
    void (*destruct)(struct tty_port *port);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">carrier_raised</span></code></dt><dd><p>return true if the carrier is raised on <strong>port</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dtr_rts</span></code></dt><dd><p>raise the DTR line if <strong>active</strong> is true, otherwise lower DTR</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">shutdown</span></code></dt><dd><p>called when the last close completes or a hangup finishes IFF the
port was initialized. Do not use to free resources. Turn off the device
only. Called under the port mutex to serialize against <strong>activate</strong> and
<strong>shutdown</strong>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">activate</span></code></dt><dd><p>called under the port mutex from <a class="reference internal" href="#c.tty_port_open" title="tty_port_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_open()</span></code></a>, serialized using
the port mutex. Supposed to turn on the device.</p>
<p>FIXME: long term getting the tty argument <em>out</em> of this would be good
for consoles.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">destruct</span></code></dt><dd><p>called on the final put of a port. Free resources, possibly incl.
the port itself.</p>
</dd>
</dl>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/tty/tty_port.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>