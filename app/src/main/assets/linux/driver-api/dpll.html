
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>The Linux kernel dpll subsystem &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="WBRF - Wifi Band RFI Mitigations" href="wbrf.html" />
    <link rel="prev" title="WMI Driver API" href="wmi.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.8.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Driver implementer's API guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="driver-model/index.html">Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html">Driver Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="infrastructure.html">Device drivers infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="ioctl.html">ioctl based interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="early-userspace/index.html">Early Userspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm/index.html">CPU and Device Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="clk.html">The Common Clk Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="device-io.html">Bus-Independent Device Accesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="dma-buf.html">Buffer Sharing and Synchronization (dma-buf)</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_link.html">Device links</a></li>
<li class="toctree-l2"><a class="reference internal" href="component.html">Component Helper for Aggregate Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="message-based.html">Message-based devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="aperture.html">Managing Ownership of the Framebuffer Aperture</a></li>
<li class="toctree-l2"><a class="reference internal" href="frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l2"><a class="reference internal" href="reset.html">Reset controller API</a></li>
<li class="toctree-l2"><a class="reference internal" href="iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="input.html">Input Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb/index.html">Linux USB API</a></li>
<li class="toctree-l2"><a class="reference internal" href="firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="pci/index.html">The Linux PCI driver implementer's API guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxl/index.html">Compute Express Link</a></li>
<li class="toctree-l2"><a class="reference internal" href="spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="devfreq.html">Device Frequency Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="libata.html">libATA Developer's Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="mailbox.html">The Common Mailbox Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l2"><a class="reference internal" href="nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="w1.html">W1: Dallas' 1-wire bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="rapidio/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="vme.html">VME Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="80211/index.html">Linux 802.11 Driver Developer's Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="uio-howto.html">The Userspace I/O HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l2"><a class="reference internal" href="pin-control.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="md/index.html">RAID</a></li>
<li class="toctree-l2"><a class="reference internal" href="media/index.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="thermal/index.html">Thermal</a></li>
<li class="toctree-l2"><a class="reference internal" href="fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="auxiliary_bus.html">Auxiliary Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l2"><a class="reference internal" href="connector.html">Kernel Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">Console Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="eisa.html">EISA bus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="isa.html">ISA Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="io-mapping.html">The io_mapping functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="io_ordering.html">Ordering I/O writes to memory-mapped addresses</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="ntb.html">NTB Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l2"><a class="reference internal" href="ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="pldmfw/index.html">PLDM Firmware Flash Update Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="pldmfw/index.html#overview-of-the-pldmfw-library">Overview of the <code class="docutils literal notranslate"><span class="pre">pldmfw</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l2"><a class="reference internal" href="serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="sm501.html">SM501 Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="surface_aggregator/index.html">Surface System Aggregator Module (SSAM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="tty/index.html">TTY</a></li>
<li class="toctree-l2"><a class="reference internal" href="vfio-mediated-device.html">VFIO Mediated devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="vfio.html">VFIO - &quot;Virtual Function I/O&quot; </a></li>
<li class="toctree-l2"><a class="reference internal" href="vfio-pci-device-specific-driver-acceptance.html">Acceptance criteria for vfio-pci device specific driver variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtio/index.html">Virtio</a></li>
<li class="toctree-l2"><a class="reference internal" href="xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="xillybus.html">Xillybus driver for generic FPGA interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorro.html">Writing Device Drivers for Zorro Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="hte/index.html">The Linux Hardware Timestamping Engine (HTE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="wmi.html">WMI Driver API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Linux kernel dpll subsystem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dpll">DPLL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subsystem">Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#device-object">Device object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pin-object">Pin object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pin-selection">Pin selection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shared-pins">Shared pins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mux-type-pins">MUX-type pins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pin-priority">Pin priority</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phase-offset-measurement-and-adjustment">Phase offset measurement and adjustment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-commands-group">Configuration commands group</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list-of-netlink-commands-with-possible-attributes">List of netlink commands with possible attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#netlink-dump-requests">Netlink dump requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-commands-format">SET commands format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-pre-defined-enums">Configuration pre-defined enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notifications">Notifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#device-driver-implementation">Device driver implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#synce-enablement">SyncE enablement</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="wbrf.html">WBRF - Wifi Band RFI Mitigations</a></li>
<li class="toctree-l2"><a class="reference internal" href="crypto/index.html">Crypto Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="tee.html">TEE (Trusted Execution Environment) driver API</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../subsystem-apis.html">Kernel subsystem documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../subsystem-apis.html#core-subsystems">Core subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Driver implementer's API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mm/index.html">Memory Management Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../timers/index.html">Timers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user's and administrator's guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RAS/ras.html">Reliability, Availability and Serviceability features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/driver-api/dpll.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="the-linux-kernel-dpll-subsystem">
<h1>The Linux kernel dpll subsystem<a class="headerlink" href="#the-linux-kernel-dpll-subsystem" title="Permalink to this heading">¶</a></h1>
<section id="dpll">
<h2>DPLL<a class="headerlink" href="#dpll" title="Permalink to this heading">¶</a></h2>
<p>PLL - Phase Locked Loop is an electronic circuit which syntonizes clock
signal of a device with an external clock signal. Effectively enabling
device to run on the same clock signal beat as provided on a PLL input.</p>
<p>DPLL - Digital Phase Locked Loop is an integrated circuit which in
addition to plain PLL behavior incorporates a digital phase detector
and may have digital divider in the loop. As a result, the frequency on
DPLL's input and output may be configurable.</p>
</section>
<section id="subsystem">
<h2>Subsystem<a class="headerlink" href="#subsystem" title="Permalink to this heading">¶</a></h2>
<p>The main purpose of dpll subsystem is to provide general interface
to configure devices that use any kind of Digital PLL and could use
different sources of input signal to synchronize to, as well as
different types of outputs.
The main interface is NETLINK_GENERIC based protocol with an event
monitoring multicast group defined.</p>
</section>
<section id="device-object">
<h2>Device object<a class="headerlink" href="#device-object" title="Permalink to this heading">¶</a></h2>
<p>Single dpll device object means single Digital PLL circuit and bunch of
connected pins.
It reports the supported modes of operation and current status to the
user in response to the <cite>do</cite> request of netlink command
<code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_GET</span></code> and list of dplls registered in the subsystem
with <cite>dump</cite> netlink request of the same command.
Changing the configuration of dpll device is done with <cite>do</cite> request of
netlink <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_SET</span></code> command.
A device handle is <code class="docutils literal notranslate"><span class="pre">DPLL_A_ID</span></code>, it shall be provided to get or set
configuration of particular device in the system. It can be obtained
with a <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_GET</span></code> <cite>dump</cite> request or
a <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_ID_GET</span></code> <cite>do</cite> request, where the one must provide
attributes that result in single device match.</p>
</section>
<section id="pin-object">
<h2>Pin object<a class="headerlink" href="#pin-object" title="Permalink to this heading">¶</a></h2>
<p>A pin is amorphic object which represents either input or output, it
could be internal component of the device, as well as externally
connected.
The number of pins per dpll vary, but usually multiple pins shall be
provided for a single dpll device.
Pin's properties, capabilities and status is provided to the user in
response to <cite>do</cite> request of netlink <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_GET</span></code> command.
It is also possible to list all the pins that were registered in the
system with <cite>dump</cite> request of <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_GET</span></code> command.
Configuration of a pin can be changed by <cite>do</cite> request of netlink
<code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_SET</span></code> command.
Pin handle is a <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ID</span></code>, it shall be provided to get or set
configuration of particular pin in the system. It can be obtained with
<code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_GET</span></code> <cite>dump</cite> request or <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_ID_GET</span></code> <cite>do</cite>
request, where user provides attributes that result in single pin match.</p>
</section>
<section id="pin-selection">
<h2>Pin selection<a class="headerlink" href="#pin-selection" title="Permalink to this heading">¶</a></h2>
<p>In general, selected pin (the one which signal is driving the dpll
device) can be obtained from <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code> attribute, and only
one pin shall be in <code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_CONNECTED</span></code> state for any dpll
device.</p>
<p>Pin selection can be done either manually or automatically, depending
on hardware capabilities and active dpll device work mode
(<code class="docutils literal notranslate"><span class="pre">DPLL_A_MODE</span></code> attribute). The consequence is that there are
differences for each mode in terms of available pin states, as well as
for the states the user can request for a dpll device.</p>
<p>In manual mode (<code class="docutils literal notranslate"><span class="pre">DPLL_MODE_MANUAL</span></code>) the user can request or receive
one of following pin states:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_CONNECTED</span></code> - the pin is used to drive dpll device</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_DISCONNECTED</span></code> - the pin is not used to drive dpll
device</p></li>
</ul>
<p>In automatic mode (<code class="docutils literal notranslate"><span class="pre">DPLL_MODE_AUTOMATIC</span></code>) the user can request or
receive one of following pin states:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_SELECTABLE</span></code> - the pin shall be considered as valid
input for automatic selection algorithm</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_DISCONNECTED</span></code> - the pin shall be not considered as
a valid input for automatic selection algorithm</p></li>
</ul>
<p>In automatic mode (<code class="docutils literal notranslate"><span class="pre">DPLL_MODE_AUTOMATIC</span></code>) the user can only receive
pin state <code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_CONNECTED</span></code> once automatic selection
algorithm locks a dpll device with one of the inputs.</p>
</section>
<section id="shared-pins">
<h2>Shared pins<a class="headerlink" href="#shared-pins" title="Permalink to this heading">¶</a></h2>
<p>A single pin object can be attached to multiple dpll devices.
Then there are two groups of configuration knobs:</p>
<ol class="arabic simple">
<li><p>Set on a pin - the configuration affects all dpll devices pin is
registered to (i.e., <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_FREQUENCY</span></code>),</p></li>
<li><p>Set on a pin-dpll tuple - the configuration affects only selected
dpll device (i.e., <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PRIO</span></code>, <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code>,
<code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_DIRECTION</span></code>).</p></li>
</ol>
</section>
<section id="mux-type-pins">
<h2>MUX-type pins<a class="headerlink" href="#mux-type-pins" title="Permalink to this heading">¶</a></h2>
<p>A pin can be MUX-type, it aggregates child pins and serves as a pin
multiplexer. One or more pins are registered with MUX-type instead of
being directly registered to a dpll device.
Pins registered with a MUX-type pin provide user with additional nested
attribute <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_PIN</span></code> for each parent they were registered
with.
If a pin was registered with multiple parent pins, they behave like a
multiple output multiplexer. In this case output of a
<code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_GET</span></code> would contain multiple pin-parent nested
attributes with current state related to each parent, like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;pin&#39;: [{{
  &#39;clock-id&#39;: 282574471561216,
  &#39;module-name&#39;: &#39;ice&#39;,
  &#39;capabilities&#39;: 4,
  &#39;id&#39;: 13,
  &#39;parent-pin&#39;: [
  {&#39;parent-id&#39;: 2, &#39;state&#39;: &#39;connected&#39;},
  {&#39;parent-id&#39;: 3, &#39;state&#39;: &#39;disconnected&#39;}
  ],
  &#39;type&#39;: &#39;synce-eth-port&#39;
  }}]
</pre></div>
</div>
<p>Only one child pin can provide its signal to the parent MUX-type pin at
a time, the selection is done by requesting change of a child pin state
on desired parent, with the use of <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT</span></code> nested
attribute. Example of netlink <cite>set state on parent pin</cite> message format:</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ID</span></code></p></td>
<td><p>child pin id</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_PIN</span></code></p></td>
<td><p>nested attribute for requesting configuration
related to parent pin</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code></p></td>
<td><p>parent pin id</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code></p></td>
<td><p>requested pin state on parent</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="pin-priority">
<h2>Pin priority<a class="headerlink" href="#pin-priority" title="Permalink to this heading">¶</a></h2>
<p>Some devices might offer a capability of automatic pin selection mode
(enum value <code class="docutils literal notranslate"><span class="pre">DPLL_MODE_AUTOMATIC</span></code> of <code class="docutils literal notranslate"><span class="pre">DPLL_A_MODE</span></code> attribute).
Usually, automatic selection is performed on the hardware level, which
means only pins directly connected to the dpll can be used for automatic
input pin selection.
In automatic selection mode, the user cannot manually select a input
pin for the device, instead the user shall provide all directly
connected pins with a priority <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PRIO</span></code>, the device would
pick a highest priority valid signal and use it to control the DPLL
device. Example of netlink <cite>set priority on parent pin</cite> message format:</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ID</span></code></p></td>
<td><p>configured pin id</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_DEVICE</span></code></p></td>
<td><p>nested attribute for requesting configuration
related to parent dpll device</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code></p></td>
<td><p>parent dpll device id</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PRIO</span></code></p></td>
<td><p>requested pin prio on parent dpll</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Child pin of MUX-type pin is not capable of automatic input pin selection,
in order to configure active input of a MUX-type pin, the user needs to
request desired pin state of the child pin on the parent pin,
as described in the <code class="docutils literal notranslate"><span class="pre">MUX-type</span> <span class="pre">pins</span></code> chapter.</p>
</section>
<section id="phase-offset-measurement-and-adjustment">
<h2>Phase offset measurement and adjustment<a class="headerlink" href="#phase-offset-measurement-and-adjustment" title="Permalink to this heading">¶</a></h2>
<p>Device may provide ability to measure a phase difference between signals
on a pin and its parent dpll device. If pin-dpll phase offset measurement
is supported, it shall be provided with <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_OFFSET</span></code>
attribute for each parent dpll device.</p>
<p>Device may also provide ability to adjust a signal phase on a pin.
If pin phase adjustment is supported, minimal and maximal values that pin
handle shall be provide to the user on <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_GET</span></code> respond
with <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST_MIN</span></code> and <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST_MAX</span></code>
attributes. Configured phase adjust value is provided with
<code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST</span></code> attribute of a pin, and value change can be
requested with the same attribute with <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_SET</span></code> command.</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ID</span></code></p></td>
<td><p>configured pin id</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST_MIN</span></code></p></td>
<td><p>attr minimum value of phase adjustment</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST_MAX</span></code></p></td>
<td><p>attr maximum value of phase adjustment</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST</span></code></p></td>
<td><p>attr configured value of phase
adjustment on parent dpll device</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_DEVICE</span></code></p></td>
<td><p>nested attribute for requesting
configuration on given parent dpll
device</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code></p></td>
<td><p>parent dpll device id</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_OFFSET</span></code></p></td>
<td><p>attr measured phase difference
between a pin and parent dpll device</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>All phase related values are provided in pico seconds, which represents
time difference between signals phase. The negative value means that
phase of signal on pin is earlier in time than dpll's signal. Positive
value means that phase of signal on pin is later in time than signal of
a dpll.</p>
<p>Phase adjust (also min and max) values are integers, but measured phase
offset values are fractional with 3-digit decimal places and shell be
divided with <code class="docutils literal notranslate"><span class="pre">DPLL_PIN_PHASE_OFFSET_DIVIDER</span></code> to get integer part and
modulo divided to get fractional part.</p>
</section>
<section id="configuration-commands-group">
<h2>Configuration commands group<a class="headerlink" href="#configuration-commands-group" title="Permalink to this heading">¶</a></h2>
<p>Configuration commands are used to get information about registered
dpll devices (and pins), as well as set configuration of device or pins.
As dpll devices must be abstracted and reflect real hardware,
there is no way to add new dpll device via netlink from user space and
each device should be registered by its driver.</p>
<p>All netlink commands require <code class="docutils literal notranslate"><span class="pre">GENL_ADMIN_PERM</span></code>. This is to prevent
any spamming/DoS from unauthorized userspace applications.</p>
</section>
<section id="list-of-netlink-commands-with-possible-attributes">
<h2>List of netlink commands with possible attributes<a class="headerlink" href="#list-of-netlink-commands-with-possible-attributes" title="Permalink to this heading">¶</a></h2>
<p>Constants identifying command types for dpll device uses a
<code class="docutils literal notranslate"><span class="pre">DPLL_CMD_</span></code> prefix and suffix according to command purpose.
The dpll device related attributes use a <code class="docutils literal notranslate"><span class="pre">DPLL_A_</span></code> prefix and
suffix according to attribute purpose.</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_ID_GET</span></code></p></td>
<td><p>command to get device ID</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_MODULE_NAME</span></code></p></td>
<td><p>attr module name of registerer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_CLOCK_ID</span></code></p></td>
<td><p>attr Unique Clock Identifier
(EUI-64), as defined by the
IEEE 1588 standard</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_TYPE</span></code></p></td>
<td><p>attr type of dpll device</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_GET</span></code></p></td>
<td><p>command to get device info or
dump list of available devices</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_ID</span></code></p></td>
<td><p>attr unique dpll device ID</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_MODULE_NAME</span></code></p></td>
<td><p>attr module name of registerer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_CLOCK_ID</span></code></p></td>
<td><p>attr Unique Clock Identifier
(EUI-64), as defined by the
IEEE 1588 standard</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_MODE</span></code></p></td>
<td><p>attr selection mode</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_MODE_SUPPORTED</span></code></p></td>
<td><p>attr available selection modes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_LOCK_STATUS</span></code></p></td>
<td><p>attr dpll device lock status</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_TEMP</span></code></p></td>
<td><p>attr device temperature info</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_TYPE</span></code></p></td>
<td><p>attr type of dpll device</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_SET</span></code></p></td>
<td><p>command to set dpll device config</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_ID</span></code></p></td>
<td><p>attr internal dpll device index</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_MODE</span></code></p></td>
<td><p>attr selection mode to configure</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Constants identifying command types for pins uses a
<code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_</span></code> prefix and suffix according to command purpose.
The pin related attributes use a <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_</span></code> prefix and suffix
according to attribute purpose.</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_ID_GET</span></code></p></td>
<td><p>command to get pin ID</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_MODULE_NAME</span></code></p></td>
<td><p>attr module name of registerer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_CLOCK_ID</span></code></p></td>
<td><p>attr Unique Clock Identifier
(EUI-64), as defined by the
IEEE 1588 standard</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_BOARD_LABEL</span></code></p></td>
<td><p>attr pin board label provided
by registerer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PANEL_LABEL</span></code></p></td>
<td><p>attr pin panel label provided
by registerer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PACKAGE_LABEL</span></code></p></td>
<td><p>attr pin package label provided
by registerer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_TYPE</span></code></p></td>
<td><p>attr type of a pin</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_GET</span></code></p></td>
<td><p>command to get pin info or dump
list of available pins</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ID</span></code></p></td>
<td><p>attr unique a pin ID</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_MODULE_NAME</span></code></p></td>
<td><p>attr module name of registerer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_CLOCK_ID</span></code></p></td>
<td><p>attr Unique Clock Identifier
(EUI-64), as defined by the
IEEE 1588 standard</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_BOARD_LABEL</span></code></p></td>
<td><p>attr pin board label provided
by registerer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PANEL_LABEL</span></code></p></td>
<td><p>attr pin panel label provided
by registerer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PACKAGE_LABEL</span></code></p></td>
<td><p>attr pin package label provided
by registerer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_TYPE</span></code></p></td>
<td><p>attr type of a pin</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_FREQUENCY</span></code></p></td>
<td><p>attr current frequency of a pin</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_FREQUENCY_SUPPORTED</span></code></p></td>
<td><p>nested attr provides supported
frequencies</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ANY_FREQUENCY_MIN</span></code></p></td>
<td><p>attr minimum value of frequency</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ANY_FREQUENCY_MAX</span></code></p></td>
<td><p>attr maximum value of frequency</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST_MIN</span></code></p></td>
<td><p>attr minimum value of phase
adjustment</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST_MAX</span></code></p></td>
<td><p>attr maximum value of phase
adjustment</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST</span></code></p></td>
<td><p>attr configured value of phase
adjustment on parent device</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_DEVICE</span></code></p></td>
<td><p>nested attr for each parent device
the pin is connected with</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code></p></td>
<td><p>attr parent dpll device id</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PRIO</span></code></p></td>
<td><p>attr priority of pin on the
dpll device</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code></p></td>
<td><p>attr state of pin on the parent
dpll device</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_DIRECTION</span></code></p></td>
<td><p>attr direction of a pin on the
parent dpll device</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_OFFSET</span></code></p></td>
<td><p>attr measured phase difference
between a pin and parent dpll</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_PIN</span></code></p></td>
<td><p>nested attr for each parent pin
the pin is connected with</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code></p></td>
<td><p>attr parent pin id</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code></p></td>
<td><p>attr state of pin on the parent
pin</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_CAPABILITIES</span></code></p></td>
<td><p>attr bitmask of pin capabilities</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_SET</span></code></p></td>
<td><p>command to set pins configuration</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ID</span></code></p></td>
<td><p>attr unique a pin ID</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_FREQUENCY</span></code></p></td>
<td><p>attr requested frequency of a pin</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PHASE_ADJUST</span></code></p></td>
<td><p>attr requested value of phase
adjustment on parent device</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_DEVICE</span></code></p></td>
<td><p>nested attr for each parent dpll
device configuration request</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code></p></td>
<td><p>attr parent dpll device id</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_DIRECTION</span></code></p></td>
<td><p>attr requested direction of a pin</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PRIO</span></code></p></td>
<td><p>attr requested priority of pin on
the dpll device</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code></p></td>
<td><p>attr requested state of pin on
the dpll device</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_PIN</span></code></p></td>
<td><p>nested attr for each parent pin
configuration request</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code></p></td>
<td><p>attr parent pin id</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code></p></td>
<td><p>attr requested state of pin on
parent pin</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="netlink-dump-requests">
<h2>Netlink dump requests<a class="headerlink" href="#netlink-dump-requests" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_GET</span></code> and <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_GET</span></code> commands are
capable of dump type netlink requests, in which case the response is in
the same format as for their <code class="docutils literal notranslate"><span class="pre">do</span></code> request, but every device or pin
registered in the system is returned.</p>
</section>
<section id="set-commands-format">
<h2>SET commands format<a class="headerlink" href="#set-commands-format" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_SET</span></code> - to target a dpll device, the user provides
<code class="docutils literal notranslate"><span class="pre">DPLL_A_ID</span></code>, which is unique identifier of dpll device in the system,
as well as parameter being configured (<code class="docutils literal notranslate"><span class="pre">DPLL_A_MODE</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_SET</span></code> - to target a pin user must provide a
<code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ID</span></code>, which is unique identifier of a pin in the system.
Also configured pin parameters must be added.
If <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_FREQUENCY</span></code> is configured, this affects all the dpll
devices that are connected with the pin, that is why frequency attribute
shall not be enclosed in <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_DEVICE</span></code>.
Other attributes: <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PRIO</span></code>, <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code> or
<code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_DIRECTION</span></code> must be enclosed in
<code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_DEVICE</span></code> as their configuration relates to only one
of parent dplls, targeted by <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code> attribute which is
also required inside that nest.
For MUX-type pins the <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_STATE</span></code> attribute is configured in
similar way, by enclosing required state in <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_PIN</span></code>
nested attribute and targeted parent pin id in <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_PARENT_ID</span></code>.</p>
<p>In general, it is possible to configure multiple parameters at once, but
internally each parameter change will be invoked separately, where order
of configuration is not guaranteed by any means.</p>
</section>
<section id="configuration-pre-defined-enums">
<h2>Configuration pre-defined enums<a class="headerlink" href="#configuration-pre-defined-enums" title="Permalink to this heading">¶</a></h2>
<dl class="c enum">
<dt class="sig sig-object c" id="c.dpll_mode">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dpll_mode</span></span></span><a class="headerlink" href="#c.dpll_mode" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>working modes a dpll can support, differentiates if and how dpll selects one of its inputs to syntonize with it, valid values for DPLL_A_MODE attribute</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_MODE_MANUAL</span></code></dt><dd><p>input can be only selected by sending a request to dpll</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_MODE_AUTOMATIC</span></code></dt><dd><p>highest prio input pin auto selected by dpll</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.dpll_lock_status">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dpll_lock_status</span></span></span><a class="headerlink" href="#c.dpll_lock_status" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>provides information of dpll device lock status, valid values for DPLL_A_LOCK_STATUS attribute</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_LOCK_STATUS_UNLOCKED</span></code></dt><dd><p>dpll was not yet locked to any valid input (or
forced by setting DPLL_A_MODE to DPLL_MODE_DETACHED)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_LOCK_STATUS_LOCKED</span></code></dt><dd><p>dpll is locked to a valid signal, but no holdover
available</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_LOCK_STATUS_LOCKED_HO_ACQ</span></code></dt><dd><p>dpll is locked and holdover acquired</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_LOCK_STATUS_HOLDOVER</span></code></dt><dd><p>dpll is in holdover state - lost a valid lock or
was forced by disconnecting all the pins (latter possible only when dpll
lock-state was already DPLL_LOCK_STATUS_LOCKED_HO_ACQ, if dpll lock-state
was not DPLL_LOCK_STATUS_LOCKED_HO_ACQ, the dpll's lock-state shall remain
DPLL_LOCK_STATUS_UNLOCKED)</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.dpll_type">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dpll_type</span></span></span><a class="headerlink" href="#c.dpll_type" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>type of dpll, valid values for DPLL_A_TYPE attribute</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_TYPE_PPS</span></code></dt><dd><p>dpll produces Pulse-Per-Second signal</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_TYPE_EEC</span></code></dt><dd><p>dpll drives the Ethernet Equipment Clock</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.dpll_pin_type">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dpll_pin_type</span></span></span><a class="headerlink" href="#c.dpll_pin_type" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>defines possible types of a pin, valid values for DPLL_A_PIN_TYPE attribute</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_TYPE_MUX</span></code></dt><dd><p>aggregates another layer of selectable pins</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_TYPE_EXT</span></code></dt><dd><p>external input</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_TYPE_SYNCE_ETH_PORT</span></code></dt><dd><p>ethernet port PHY's recovered clock</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_TYPE_INT_OSCILLATOR</span></code></dt><dd><p>device internal oscillator</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_TYPE_GNSS</span></code></dt><dd><p>GNSS recovered clock</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.dpll_pin_direction">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dpll_pin_direction</span></span></span><a class="headerlink" href="#c.dpll_pin_direction" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>defines possible direction of a pin, valid values for DPLL_A_PIN_DIRECTION attribute</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_DIRECTION_INPUT</span></code></dt><dd><p>pin used as a input of a signal</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_DIRECTION_OUTPUT</span></code></dt><dd><p>pin used to output the signal</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.dpll_pin_state">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dpll_pin_state</span></span></span><a class="headerlink" href="#c.dpll_pin_state" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>defines possible states of a pin, valid values for DPLL_A_PIN_STATE attribute</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_CONNECTED</span></code></dt><dd><p>pin connected, active input of phase locked loop</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_DISCONNECTED</span></code></dt><dd><p>pin disconnected, not considered as a valid
input</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_STATE_SELECTABLE</span></code></dt><dd><p>pin enabled for automatic input selection</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.dpll_pin_capabilities">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">dpll_pin_capabilities</span></span></span><a class="headerlink" href="#c.dpll_pin_capabilities" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>defines possible capabilities of a pin, valid flags on DPLL_A_PIN_CAPABILITIES attribute</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_CAPABILITIES_DIRECTION_CAN_CHANGE</span></code></dt><dd><p>pin direction can be changed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_CAPABILITIES_PRIORITY_CAN_CHANGE</span></code></dt><dd><p>pin priority can be changed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DPLL_PIN_CAPABILITIES_STATE_CAN_CHANGE</span></code></dt><dd><p>pin state can be changed</p>
</dd>
</dl>
</div>
</section>
<section id="notifications">
<h2>Notifications<a class="headerlink" href="#notifications" title="Permalink to this heading">¶</a></h2>
<p>dpll device can provide notifications regarding status changes of the
device, i.e. lock status changes, input/output changes or other alarms.
There is one multicast group that is used to notify user-space apps via
netlink socket: <code class="docutils literal notranslate"><span class="pre">DPLL_MCGRP_MONITOR</span></code></p>
<p>Notifications messages:</p>
<blockquote>
<div><table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_CREATE_NTF</span></code></p></td>
<td><p>dpll device was created</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_DELETE_NTF</span></code></p></td>
<td><p>dpll device was deleted</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_CHANGE_NTF</span></code></p></td>
<td><p>dpll device has changed</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_CREATE_NTF</span></code></p></td>
<td><p>dpll pin was created</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_DELETE_NTF</span></code></p></td>
<td><p>dpll pin was deleted</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_CHANGE_NTF</span></code></p></td>
<td><p>dpll pin has changed</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Events format is the same as for the corresponding get command.
Format of <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_</span></code> events is the same as response of
<code class="docutils literal notranslate"><span class="pre">DPLL_CMD_DEVICE_GET</span></code>.
Format of <code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_</span></code> events is same as response of
<code class="docutils literal notranslate"><span class="pre">DPLL_CMD_PIN_GET</span></code>.</p>
</section>
<section id="device-driver-implementation">
<h2>Device driver implementation<a class="headerlink" href="#device-driver-implementation" title="Permalink to this heading">¶</a></h2>
<p>Device is allocated by dpll_device_get() call. Second call with the
same arguments will not create new object but provides pointer to
previously created device for given arguments, it also increases
refcount of that object.
Device is deallocated by dpll_device_put() call, which first
decreases the refcount, once refcount is cleared the object is
destroyed.</p>
<p>Device should implement set of operations and register device via
dpll_device_register() at which point it becomes available to the
users. Multiple driver instances can obtain reference to it with
dpll_device_get(), as well as register dpll device with their own
ops and priv.</p>
<p>The pins are allocated separately with dpll_pin_get(), it works
similarly to dpll_device_get(). Function first creates object and then
for each call with the same arguments only the object refcount
increases. Also dpll_pin_put() works similarly to dpll_device_put().</p>
<p>A pin can be registered with parent dpll device or parent pin, depending
on hardware needs. Each registration requires registerer to provide set
of pin callbacks, and private data pointer for calling them:</p>
<ul class="simple">
<li><p>dpll_pin_register() - register pin with a dpll device,</p></li>
<li><p>dpll_pin_on_pin_register() - register pin with another MUX type pin.</p></li>
</ul>
<p>Notifications of adding or removing dpll devices are created within
subsystem itself.
Notifications about registering/deregistering pins are also invoked by
the subsystem.
Notifications about status changes either of dpll device or a pin are
invoked in two ways:</p>
<ul class="simple">
<li><p>after successful change was requested on dpll subsystem, the subsystem
calls corresponding notification,</p></li>
<li><p>requested by device driver with dpll_device_change_ntf() or
dpll_pin_change_ntf() when driver informs about the status change.</p></li>
</ul>
<p>The device driver using dpll interface is not required to implement all
the callback operation. Nevertheless, there are few required to be
implemented.
Required dpll device level callback operations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.mode_get</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.lock_status_get</span></code>.</p></li>
</ul>
<p>Required pin level callback operations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.state_on_dpll_get</span></code> (pins registered with dpll device),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.state_on_pin_get</span></code> (pins registered with parent pin),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.direction_get</span></code>.</p></li>
</ul>
<p>Every other operation handler is checked for existence and
<code class="docutils literal notranslate"><span class="pre">-EOPNOTSUPP</span></code> is returned in case of absence of specific handler.</p>
<p>The simplest implementation is in the OCP TimeCard driver. The ops
structures are defined like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">dpll_device_ops</span><span class="w"> </span><span class="n">dpll_ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">.</span><span class="n">lock_status_get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptp_ocp_dpll_lock_status_get</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">mode_get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptp_ocp_dpll_mode_get</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">mode_supported</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptp_ocp_dpll_mode_supported</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">dpll_pin_ops</span><span class="w"> </span><span class="n">dpll_pins_ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">.</span><span class="n">frequency_get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptp_ocp_dpll_frequency_get</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">frequency_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptp_ocp_dpll_frequency_set</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">direction_get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptp_ocp_dpll_direction_get</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">direction_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptp_ocp_dpll_direction_set</span><span class="p">,</span>
<span class="w">        </span><span class="p">.</span><span class="n">state_on_dpll_get</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptp_ocp_dpll_state_get</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The registration part is then looks like this part:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">clkid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pci_get_dsn</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>
<span class="n">bp</span><span class="o">-&gt;</span><span class="n">dpll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dpll_device_get</span><span class="p">(</span><span class="n">clkid</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">THIS_MODULE</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dpll</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PTR_ERR</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dpll</span><span class="p">);</span>
<span class="w">        </span><span class="n">dev_err</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dpll_device_alloc failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dpll_device_register</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dpll</span><span class="p">,</span><span class="w"> </span><span class="n">DPLL_TYPE_PPS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dpll_ops</span><span class="p">,</span><span class="w"> </span><span class="n">bp</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">out</span><span class="p">;</span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">OCP_SMA_NUM</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dpll_pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dpll_pin_get</span><span class="p">(</span><span class="n">clkid</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">THIS_MODULE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dpll_prop</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dpll_pin</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PTR_ERR</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dpll</span><span class="p">);</span>
<span class="w">                </span><span class="k">goto</span><span class="w"> </span><span class="n">out_dpll</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dpll_pin_register</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dpll</span><span class="p">,</span><span class="w"> </span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dpll_pin</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dpll_pins_ops</span><span class="p">,</span>
<span class="w">                                </span><span class="o">&amp;</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">dpll_pin_put</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dpll_pin</span><span class="p">);</span>
<span class="w">                </span><span class="k">goto</span><span class="w"> </span><span class="n">out_dpll</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the error path we have to rewind every allocation in the reverse order:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">--</span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="n">dpll_pin_unregister</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dpll</span><span class="p">,</span><span class="w"> </span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dpll_pin</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dpll_pins_ops</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">        </span><span class="n">dpll_pin_put</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">sma</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dpll_pin</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">dpll_device_put</span><span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dpll</span><span class="p">);</span>
</pre></div>
</div>
<p>More complex example can be found in Intel's ICE driver or nVidia's mlx5 driver.</p>
</section>
<section id="synce-enablement">
<h2>SyncE enablement<a class="headerlink" href="#synce-enablement" title="Permalink to this heading">¶</a></h2>
<p>For SyncE enablement it is required to allow control over dpll device
for a software application which monitors and configures the inputs of
dpll device in response to current state of a dpll device and its
inputs.
In such scenario, dpll device input signal shall be also configurable
to drive dpll with signal recovered from the PHY netdevice.
This is done by exposing a pin to the netdevice - attaching pin to the
netdevice itself with
<code class="docutils literal notranslate"><span class="pre">dpll_netdev_pin_set(struct</span> <span class="pre">net_device</span> <span class="pre">*dev,</span> <span class="pre">struct</span> <span class="pre">dpll_pin</span> <span class="pre">*dpll_pin)</span></code>.
Exposed pin id handle <code class="docutils literal notranslate"><span class="pre">DPLL_A_PIN_ID</span></code> is then identifiable by the user
as it is attached to rtnetlink respond to get <code class="docutils literal notranslate"><span class="pre">RTM_NEWLINK</span></code> command in
nested attribute <code class="docutils literal notranslate"><span class="pre">IFLA_DPLL_PIN</span></code>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/driver-api/dpll.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>