
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>2.21. V4L2 Memory to Memory functions and data structures &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.22. V4L2 async kAPI" href="v4l2-async.html" />
    <link rel="prev" title="2.20. V4L2 Media Bus functions and data structures" href="v4l2-mediabus.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.8.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Driver implementer's API guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../driver-model/index.html">Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics.html">Driver Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infrastructure.html">Device drivers infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ioctl.html">ioctl based interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../early-userspace/index.html">Early Userspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pm/index.html">CPU and Device Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../clk.html">The Common Clk Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-io.html">Bus-Independent Device Accesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dma-buf.html">Buffer Sharing and Synchronization (dma-buf)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_link.html">Device links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../component.html">Component Helper for Aggregate Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../message-based.html">Message-based devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aperture.html">Managing Ownership of the Framebuffer Aperture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reset.html">Reset controller API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input.html">Input Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usb/index.html">Linux USB API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pci/index.html">The Linux PCI driver implementer's API guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cxl/index.html">Compute Express Link</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devfreq.html">Device Frequency Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../libata.html">libATA Developer's Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mailbox.html">The Common Mailbox Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../w1.html">W1: Dallas' 1-wire bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapidio/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vme.html">VME Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../80211/index.html">Linux 802.11 Driver Developer's Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uio-howto.html">The Userspace I/O HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pin-control.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../md/index.html">RAID</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Media subsystem kernel internal API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="maintainer-entry-profile.html">1. Media Subsystem Profile</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="v4l2-core.html">2. Video4Linux devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="dtv-core.html">3. Digital TV (DVB) devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="rc-core.html">4. Remote Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="mc-core.html">5. Media Controller devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="cec-core.html">6. CEC Kernel Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="tx-rx.html">7. Pixel data transmitter and receiver drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="camera-sensor.html">8. Writing camera sensor drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="drivers/index.html">9. Media driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thermal/index.html">Thermal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auxiliary_bus.html">Auxiliary Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connector.html">Kernel Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console.html">Console Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../eisa.html">EISA bus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isa.html">ISA Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io-mapping.html">The io_mapping functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io_ordering.html">Ordering I/O writes to memory-mapped addresses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ntb.html">NTB Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pldmfw/index.html">PLDM Firmware Flash Update Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pldmfw/index.html#overview-of-the-pldmfw-library">Overview of the <code class="docutils literal notranslate"><span class="pre">pldmfw</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sm501.html">SM501 Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../surface_aggregator/index.html">Surface System Aggregator Module (SSAM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tty/index.html">TTY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio-mediated-device.html">VFIO Mediated devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio.html">VFIO - &quot;Virtual Function I/O&quot; </a></li>
<li class="toctree-l2"><a class="reference internal" href="../vfio-pci-device-specific-driver-acceptance.html">Acceptance criteria for vfio-pci device specific driver variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../virtio/index.html">Virtio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xillybus.html">Xillybus driver for generic FPGA interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zorro.html">Writing Device Drivers for Zorro Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hte/index.html">The Linux Hardware Timestamping Engine (HTE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wmi.html">WMI Driver API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dpll.html">The Linux kernel dpll subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wbrf.html">WBRF - Wifi Band RFI Mitigations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Crypto Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tee.html">TEE (Trusted Execution Environment) driver API</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../subsystem-apis.html">Kernel subsystem documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../subsystem-apis.html#core-subsystems">Core subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Driver implementer's API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mm/index.html">Memory Management Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../timers/index.html">Timers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user's and administrator's guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RAS/ras.html">Reliability, Availability and Serviceability features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/media/v4l2-mem2mem.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="v4l2-memory-to-memory-functions-and-data-structures">
<h1><span class="section-number">2.21. </span>V4L2 Memory to Memory functions and data structures<a class="headerlink" href="#v4l2-memory-to-memory-functions-and-data-structures" title="Permalink to this heading">¶</a></h1>
<dl class="c struct">
<dt class="sig sig-object c" id="c.v4l2_m2m_ops">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_ops</span></span></span><a class="headerlink" href="#c.v4l2_m2m_ops" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>mem-to-mem device driver callbacks</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_m2m_ops {
    void (*device_run)(void *priv);
    int (*job_ready)(void *priv);
    void (*job_abort)(void *priv);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">device_run</span></code></dt><dd><p>required. Begin the actual job (transaction) inside this
callback.
The job does NOT have to end before this callback returns
(and it will be the usual case). When the job finishes,
<a class="reference internal" href="#c.v4l2_m2m_job_finish" title="v4l2_m2m_job_finish"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_job_finish()</span></code></a> or <a class="reference internal" href="#c.v4l2_m2m_buf_done_and_job_finish" title="v4l2_m2m_buf_done_and_job_finish"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_buf_done_and_job_finish()</span></code></a>
has to be called.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">job_ready</span></code></dt><dd><p>optional. Should return 0 if the driver does not have a job
fully prepared to run yet (i.e. it will not be able to finish a
transaction without sleeping). If not provided, it will be
assumed that one source and one destination buffer are all
that is required for the driver to perform one full transaction.
This method may not sleep.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">job_abort</span></code></dt><dd><p>optional. Informs the driver that it has to abort the currently
running transaction as soon as possible (i.e. as soon as it can
stop the device safely; e.g. in the next interrupt handler),
even if the transaction would not have been finished by then.
After the driver performs the necessary steps, it has to call
<a class="reference internal" href="#c.v4l2_m2m_job_finish" title="v4l2_m2m_job_finish"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_job_finish()</span></code></a> or <a class="reference internal" href="#c.v4l2_m2m_buf_done_and_job_finish" title="v4l2_m2m_buf_done_and_job_finish"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_buf_done_and_job_finish()</span></code></a> as
if the transaction ended normally.
This function does not have to (and will usually not) wait
until the device enters a state when it can be stopped.</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.v4l2_m2m_queue_ctx">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_queue_ctx</span></span></span><a class="headerlink" href="#c.v4l2_m2m_queue_ctx" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>represents a queue for buffers ready to be processed</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_m2m_queue_ctx {
    struct vb2_queue        q;
    struct list_head        rdy_queue;
    spinlock_t rdy_spinlock;
    u8 num_rdy;
    bool buffered;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">q</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><code class="xref c c-type docutils literal notranslate"><span class="pre">vb2_queue</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rdy_queue</span></code></dt><dd><p>List of V4L2 mem-to-mem queues</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rdy_spinlock</span></code></dt><dd><p>spin lock to protect the struct usage</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_rdy</span></code></dt><dd><p>number of buffers ready to be processed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buffered</span></code></dt><dd><p>is the queue buffered?</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Queue for buffers ready to be processed as soon as this
instance receives access to the device.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.v4l2_m2m_ctx">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></span><a class="headerlink" href="#c.v4l2_m2m_ctx" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Memory to memory context structure</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_m2m_ctx {
    struct mutex                    *q_lock;
    bool new_frame;
    bool is_draining;
    struct vb2_v4l2_buffer          *last_src_buf;
    bool next_buf_last;
    bool has_stopped;
    bool ignore_cap_streaming;
    struct v4l2_m2m_dev             *m2m_dev;
    struct v4l2_m2m_queue_ctx       cap_q_ctx;
    struct v4l2_m2m_queue_ctx       out_q_ctx;
    struct list_head                queue;
    unsigned long                   job_flags;
    wait_queue_head_t finished;
    void *priv;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">q_lock</span></code></dt><dd><p>struct <code class="xref c c-type docutils literal notranslate"><span class="pre">mutex</span></code> lock</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">new_frame</span></code></dt><dd><p>valid in the device_run callback: if true, then this
starts a new frame; if false, then this is a new slice
for an existing frame. This is always true unless
V4L2_BUF_CAP_SUPPORTS_M2M_HOLD_CAPTURE_BUF is set, which
indicates slicing support.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_draining</span></code></dt><dd><p>indicates device is in draining phase</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">last_src_buf</span></code></dt><dd><p>indicate the last source buffer for draining</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">next_buf_last</span></code></dt><dd><p>next capture queud buffer will be tagged as last</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">has_stopped</span></code></dt><dd><p>indicate the device has been stopped</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ignore_cap_streaming</span></code></dt><dd><p>If true, job_ready can be called even if the CAPTURE
queue is not streaming. This allows firmware to
analyze the bitstream header which arrives on the
OUTPUT queue. The driver must implement the job_ready
callback correctly to make sure that the requirements
for actual decoding are met.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">m2m_dev</span></code></dt><dd><p>opaque pointer to the internal data to handle M2M context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cap_q_ctx</span></code></dt><dd><p>Capture (output to memory) queue context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">out_q_ctx</span></code></dt><dd><p>Output (input from memory) queue context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">queue</span></code></dt><dd><p>List of memory to memory contexts</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">job_flags</span></code></dt><dd><p>Job queue flags, used internally by v4l2-mem2mem.c:
<code class="docutils literal notranslate"><span class="pre">TRANS_QUEUED</span></code>, <code class="docutils literal notranslate"><span class="pre">TRANS_RUNNING</span></code> and <code class="docutils literal notranslate"><span class="pre">TRANS_ABORT</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">finished</span></code></dt><dd><p>Wait queue used to signalize when a job queue finished.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">priv</span></code></dt><dd><p>Instance private data</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The memory to memory context is specific to a file handle, NOT to e.g.
a device.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.v4l2_m2m_buffer">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_buffer</span></span></span><a class="headerlink" href="#c.v4l2_m2m_buffer" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Memory to memory buffer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_m2m_buffer {
    struct vb2_v4l2_buffer  vb;
    struct list_head        list;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vb</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">vb2_v4l2_buffer</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">list</span></code></dt><dd><p>list of m2m buffers</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_get_curr_priv">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_get_curr_priv</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_m2m_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_dev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_get_curr_priv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return driver private data for the currently running instance or NULL if no instance is running</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*m2m_dev</span></code></dt><dd><p>opaque pointer to the internal data to handle M2M context</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_get_vq">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><span class="n"><span class="pre">vb2_queue</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_get_vq</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_buf_type</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_get_vq" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return vb2_queue for the given type</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">v4l2_buf_type</span> <span class="pre">type</span></code></dt><dd><p>type of the V4L2 buffer, as defined by enum <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buf_type</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_try_schedule">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_try_schedule</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_try_schedule" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>check whether an instance is ready to be added to the pending job queue and add it if so.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>There are three basic requirements an instance has to meet to be able to run:
1) at least one source buffer has to be queued,
2) at least one destination buffer has to be queued,
3) streaming has to be on.</p>
<p>If a queue is buffered (for example a decoder hardware ringbuffer that has
to be drained before doing streamoff), allow scheduling without v4l2 buffers
on that queue.</p>
<p>There may also be additional, custom requirements. In such case the driver
should supply a custom callback (job_ready in v4l2_m2m_ops) that should
return 1 if the instance is ready.
An example of the above could be an instance that requires more than one
src/dst buffer per transaction.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_job_finish">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_job_finish</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_m2m_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_dev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_job_finish" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>inform the framework that a job has been finished and have it clean up</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*m2m_dev</span></code></dt><dd><p>opaque pointer to the internal data to handle M2M context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by a driver to yield back the device after it has finished with it.
Should be called as soon as possible after reaching a state which allows
other instances to take control of the device.</p>
<p>This function has to be called only after <a class="reference internal" href="#c.v4l2_m2m_ops" title="v4l2_m2m_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ops-&gt;device_run</span></code></a>
callback has been called on the driver. To prevent recursion, it should
not be called directly from the <a class="reference internal" href="#c.v4l2_m2m_ops" title="v4l2_m2m_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ops-&gt;device_run</span></code></a> callback though.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_buf_done_and_job_finish">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_buf_done_and_job_finish</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_m2m_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_dev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">enum</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_buffer_state" title="vb2_buffer_state"><span class="n"><span class="pre">vb2_buffer_state</span></span></a><span class="w"> </span><span class="n"><span class="pre">state</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_done_and_job_finish" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return source/destination buffers with state and inform the framework that a job has been finished and have it clean up</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*m2m_dev</span></code></dt><dd><p>opaque pointer to the internal data to handle M2M context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">vb2_buffer_state</span> <span class="pre">state</span></code></dt><dd><p>vb2 buffer state passed to v4l2_m2m_buf_done().</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Drivers that set V4L2_BUF_CAP_SUPPORTS_M2M_HOLD_CAPTURE_BUF must use this
function instead of job_finish() to take held buffers into account. It is
optional for other drivers.</p>
<p>This function removes the source buffer from the ready list and returns
it with the given state. The same is done for the destination buffer, unless
it is marked 'held'. In that case the buffer is kept on the ready list.</p>
<p>After that the job is finished (see job_finish()).</p>
<p>This allows for multiple output buffers to be used to fill in a single
capture buffer. This is typically used by stateless decoders where
multiple e.g. H.264 slices contribute to a single decoded frame.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_clear_state">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_clear_state</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_clear_state" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>clear encoding/decoding state</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_mark_stopped">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_mark_stopped</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_mark_stopped" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>set current encoding/decoding state as stopped</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_dst_buf_is_last">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_dst_buf_is_last</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_dst_buf_is_last" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return the current encoding/decoding session draining management state of next queued capture buffer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This last capture buffer should be tagged with V4L2_BUF_FLAG_LAST to notify
the end of the capture session.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_has_stopped">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_has_stopped</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_has_stopped" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return the current encoding/decoding session stopped state</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_is_last_draining_src_buf">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_is_last_draining_src_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vbuf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_is_last_draining_src_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return the output buffer draining state in the current encoding/decoding session</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*vbuf</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This will identify the last output buffer queued before a session stop
was required, leading to an actual encoding/decoding session stop state
in the encoding/decoding process after being processed.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_last_buffer_done">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_last_buffer_done</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vbuf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_last_buffer_done" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>marks the buffer with LAST flag and DONE</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*vbuf</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_suspend">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_suspend</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_m2m_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_dev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_suspend" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>stop new jobs from being run and wait for current job to finish</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*m2m_dev</span></code></dt><dd><p>opaque pointer to the internal data to handle M2M context</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by a driver in the suspend hook. Stop new jobs from being run, and
wait for current running job to finish.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_resume">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_resume</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_m2m_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_dev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_resume" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>resume job running and try to run a queued job</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*m2m_dev</span></code></dt><dd><p>opaque pointer to the internal data to handle M2M context</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by a driver in the resume hook. This reverts the operation of
<a class="reference internal" href="#c.v4l2_m2m_suspend" title="v4l2_m2m_suspend"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_suspend()</span></code></a> and allows job to be run. Also try to run a queued job if
there is any.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_reqbufs">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_reqbufs</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_reqbufs" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_requestbuffers</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">reqbufs</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_reqbufs" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>multi-queue-aware REQBUFS multiplexer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_requestbuffers</span> <span class="pre">*reqbufs</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_requestbuffers</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_querybuf">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_querybuf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_querybuf" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_buffer</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_querybuf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>multi-queue-aware QUERYBUF multiplexer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_buffer</span> <span class="pre">*buf</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>See <a class="reference internal" href="#c.v4l2_m2m_mmap" title="v4l2_m2m_mmap"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_m2m_mmap()</span></code></a> documentation for details.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_qbuf">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_qbuf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_qbuf" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_buffer</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_qbuf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>enqueue a source or destination buffer, depending on the type</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_buffer</span> <span class="pre">*buf</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_dqbuf">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_dqbuf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_dqbuf" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_buffer</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_dqbuf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>dequeue a source or destination buffer, depending on the type</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_buffer</span> <span class="pre">*buf</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_prepare_buf">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_prepare_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_prepare_buf" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_buffer</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_prepare_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>prepare a source or destination buffer, depending on the type</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_buffer</span> <span class="pre">*buf</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_create_bufs">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_create_bufs</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_create_bufs" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_create_buffers</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">create</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_create_bufs" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>create a source or destination buffer, depending on the type</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_create_buffers</span> <span class="pre">*create</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_create_buffers</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_expbuf">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_expbuf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_expbuf" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_exportbuffer</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">eb</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_expbuf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>export a source or destination buffer, depending on the type</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_exportbuffer</span> <span class="pre">*eb</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_exportbuffer</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_streamon">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_streamon</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_streamon" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_buf_type</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_streamon" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>turn on streaming for a video queue</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">v4l2_buf_type</span> <span class="pre">type</span></code></dt><dd><p>type of the V4L2 buffer, as defined by enum <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buf_type</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_streamoff">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_streamoff</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_streamoff" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_buf_type</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_streamoff" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>turn off streaming for a video queue</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">v4l2_buf_type</span> <span class="pre">type</span></code></dt><dd><p>type of the V4L2 buffer, as defined by enum <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buf_type</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_update_start_streaming_state">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_update_start_streaming_state</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><span class="n"><span class="pre">vb2_queue</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">q</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_update_start_streaming_state" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>update the encoding/decoding session state when a start of streaming of a video queue is requested</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_queue</span> <span class="pre">*q</span></code></dt><dd><p>queue</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_update_stop_streaming_state">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_update_stop_streaming_state</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><span class="n"><span class="pre">vb2_queue</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">q</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_update_stop_streaming_state" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>update the encoding/decoding session state when a stop of streaming of a video queue is requested</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_queue</span> <span class="pre">*q</span></code></dt><dd><p>queue</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_encoder_cmd">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_encoder_cmd</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_encoder_cmd" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_encoder_cmd</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ec</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_encoder_cmd" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>execute an encoder command</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_encoder_cmd</span> <span class="pre">*ec</span></code></dt><dd><p>pointer to the encoder command</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_decoder_cmd">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_decoder_cmd</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_decoder_cmd" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_decoder_cmd</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dc</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_decoder_cmd" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>execute a decoder command</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_decoder_cmd</span> <span class="pre">*dc</span></code></dt><dd><p>pointer to the decoder command</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_poll">
<span class="n"><span class="pre">__poll_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_poll</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_poll" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">poll_table_struct</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">wait</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_poll" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>poll replacement, for destination buffers only</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">poll_table_struct</span> <span class="pre">*wait</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">poll_table_struct</span></code></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Call from the driver's poll() function. Will poll both queues. If a buffer
is available to dequeue (with dqbuf) from the source queue, this will
indicate that a non-blocking write can be performed, while read will be
returned in case of the destination queue.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_mmap">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_mmap</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_mmap" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">vm_area_struct</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vma</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_mmap" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>source and destination queues-aware mmap multiplexer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">file</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vm_area_struct</span> <span class="pre">*vma</span></code></dt><dd><p>pointer to struct <code class="xref c c-type docutils literal notranslate"><span class="pre">vm_area_struct</span></code></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Call from driver's mmap() function. Will handle mmap() for both queues
seamlessly for the video buffer, which will receive normal per-queue offsets
and proper vb2 queue pointers. The differentiation is made outside
vb2 by adding a predefined offset to buffers from one of the queues
and subtracting it before passing it back to vb2. Only drivers (and
thus applications) receive modified offsets.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_init">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_m2m_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ops" title="v4l2_m2m_ops"><span class="n"><span class="pre">v4l2_m2m_ops</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ops</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>initialize per-driver m2m data</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">v4l2_m2m_ops</span> <span class="pre">*m2m_ops</span></code></dt><dd><p>pointer to <a class="reference internal" href="#c.v4l2_m2m_ops" title="v4l2_m2m_ops"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ops</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Usually called from driver's <code class="docutils literal notranslate"><span class="pre">probe()</span></code> function.</p>
<p><strong>Return</strong></p>
<p>returns an opaque pointer to the internal data to handle M2M context</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_release">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_release</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_m2m_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_dev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_release" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>cleans up and frees a m2m_dev structure</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*m2m_dev</span></code></dt><dd><p>opaque pointer to the internal data to handle M2M context</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Usually called from driver's <code class="docutils literal notranslate"><span class="pre">remove()</span></code> function.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_ctx_init">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_ctx_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">v4l2_m2m_dev</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_dev</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">drv_priv</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">queue_init</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">priv</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><span class="n"><span class="pre">vb2_queue</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">src_vq</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><span class="n"><span class="pre">vb2_queue</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dst_vq</span></span><span class="p"><span class="pre">)</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_ctx_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>allocate and initialize a m2m context</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_dev</span> <span class="pre">*m2m_dev</span></code></dt><dd><p>opaque pointer to the internal data to handle M2M context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*drv_priv</span></code></dt><dd><p>driver's instance private data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">(*queue_init)(void</span> <span class="pre">*priv,</span> <span class="pre">struct</span> <span class="pre">vb2_queue</span> <span class="pre">*src_vq,</span> <span class="pre">struct</span> <span class="pre">vb2_queue</span> <span class="pre">*dst_vq)</span></code></dt><dd><p>a callback for queue type-specific initialization function
to be used for initializing vb2_queues</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Usually called from driver's <code class="docutils literal notranslate"><span class="pre">open()</span></code> function.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_ctx_release">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_ctx_release</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_ctx_release" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>release m2m context</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Usually called from driver's release() function.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_buf_queue">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_buf_queue</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vbuf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_queue" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>add a buffer to the proper ready buffers list.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*vbuf</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">vb2_v4l2_buffer</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Call from vb2_queue_ops-&gt;ops-&gt;buf_queue, vb2_queue_ops callback.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_num_src_bufs_ready">
<span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_num_src_bufs_ready</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_num_src_bufs_ready" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return the number of source buffers ready for use</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_num_dst_bufs_ready">
<span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_num_dst_bufs_ready</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_num_dst_bufs_ready" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return the number of destination buffers ready for use</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_next_buf">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_next_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_queue_ctx" title="v4l2_m2m_queue_ctx"><span class="n"><span class="pre">v4l2_m2m_queue_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">q_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_next_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return next buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_queue_ctx</span> <span class="pre">*q_ctx</span></code></dt><dd><p>pointer to struct <strong>v4l2_m2m_queue_ctx</strong></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_next_src_buf">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_next_src_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_next_src_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return next source buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_next_dst_buf">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_next_dst_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_next_dst_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return next destination buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_last_buf">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_last_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_queue_ctx" title="v4l2_m2m_queue_ctx"><span class="n"><span class="pre">v4l2_m2m_queue_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">q_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_last_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return last buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_queue_ctx</span> <span class="pre">*q_ctx</span></code></dt><dd><p>pointer to struct <strong>v4l2_m2m_queue_ctx</strong></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_last_src_buf">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_last_src_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_last_src_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return last source buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_last_dst_buf">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_last_dst_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_last_dst_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return last destination buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c macro">
<dt class="sig sig-object c" id="c.v4l2_m2m_for_each_dst_buf">
<span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_for_each_dst_buf</span></span></span><a class="headerlink" href="#c.v4l2_m2m_for_each_dst_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">v4l2_m2m_for_each_dst_buf</span> <span class="pre">(m2m_ctx,</span> <span class="pre">b)</span></code></p>
<blockquote>
<div><p>iterate over a list of destination ready buffers</p>
</div></blockquote>
<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt><dd><p>current buffer of type <a class="reference internal" href="#c.v4l2_m2m_buffer" title="v4l2_m2m_buffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_buffer</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c macro">
<dt class="sig sig-object c" id="c.v4l2_m2m_for_each_src_buf">
<span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_for_each_src_buf</span></span></span><a class="headerlink" href="#c.v4l2_m2m_for_each_src_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">v4l2_m2m_for_each_src_buf</span> <span class="pre">(m2m_ctx,</span> <span class="pre">b)</span></code></p>
<blockquote>
<div><p>iterate over a list of source ready buffers</p>
</div></blockquote>
<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt><dd><p>current buffer of type <a class="reference internal" href="#c.v4l2_m2m_buffer" title="v4l2_m2m_buffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_buffer</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c macro">
<dt class="sig sig-object c" id="c.v4l2_m2m_for_each_dst_buf_safe">
<span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_for_each_dst_buf_safe</span></span></span><a class="headerlink" href="#c.v4l2_m2m_for_each_dst_buf_safe" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">v4l2_m2m_for_each_dst_buf_safe</span> <span class="pre">(m2m_ctx,</span> <span class="pre">b,</span> <span class="pre">n)</span></code></p>
<blockquote>
<div><p>iterate over a list of destination ready buffers safely</p>
</div></blockquote>
<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt><dd><p>current buffer of type <a class="reference internal" href="#c.v4l2_m2m_buffer" title="v4l2_m2m_buffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_buffer</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">n</span></code></dt><dd><p>used as temporary storage</p>
</dd>
</dl>
</div>
<dl class="c macro">
<dt class="sig sig-object c" id="c.v4l2_m2m_for_each_src_buf_safe">
<span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_for_each_src_buf_safe</span></span></span><a class="headerlink" href="#c.v4l2_m2m_for_each_src_buf_safe" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">v4l2_m2m_for_each_src_buf_safe</span> <span class="pre">(m2m_ctx,</span> <span class="pre">b,</span> <span class="pre">n)</span></code></p>
<blockquote>
<div><p>iterate over a list of source ready buffers safely</p>
</div></blockquote>
<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt><dd><p>current buffer of type <a class="reference internal" href="#c.v4l2_m2m_buffer" title="v4l2_m2m_buffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_buffer</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">n</span></code></dt><dd><p>used as temporary storage</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_get_src_vq">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><span class="n"><span class="pre">vb2_queue</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_get_src_vq</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_get_src_vq" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return vb2_queue for source buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_get_dst_vq">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_queue" title="vb2_queue"><span class="n"><span class="pre">vb2_queue</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_get_dst_vq</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_get_dst_vq" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>return vb2_queue for destination buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_buf_remove">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_buf_remove</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_queue_ctx" title="v4l2_m2m_queue_ctx"><span class="n"><span class="pre">v4l2_m2m_queue_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">q_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_remove" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>take off a buffer from the list of ready buffers and return it</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_queue_ctx</span> <span class="pre">*q_ctx</span></code></dt><dd><p>pointer to struct <strong>v4l2_m2m_queue_ctx</strong></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_src_buf_remove">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_src_buf_remove</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_src_buf_remove" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>take off a source buffer from the list of ready buffers and return it</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_dst_buf_remove">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_dst_buf_remove</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_dst_buf_remove" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>take off a destination buffer from the list of ready buffers and return it</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_buf_remove_by_buf">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_buf_remove_by_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_queue_ctx" title="v4l2_m2m_queue_ctx"><span class="n"><span class="pre">v4l2_m2m_queue_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">q_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vbuf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_remove_by_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>take off exact buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_queue_ctx</span> <span class="pre">*q_ctx</span></code></dt><dd><p>pointer to struct <strong>v4l2_m2m_queue_ctx</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*vbuf</span></code></dt><dd><p>the buffer to be removed</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_src_buf_remove_by_buf">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_src_buf_remove_by_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vbuf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_src_buf_remove_by_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>take off exact source buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*vbuf</span></code></dt><dd><p>the buffer to be removed</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_dst_buf_remove_by_buf">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_dst_buf_remove_by_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><span class="n"><span class="pre">v4l2_m2m_ctx</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">m2m_ctx</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vbuf</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_dst_buf_remove_by_buf" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>take off exact destination buffer from the list of ready buffers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_m2m_ctx</span> <span class="pre">*m2m_ctx</span></code></dt><dd><p>m2m context assigned to the instance given by struct <a class="reference internal" href="#c.v4l2_m2m_ctx" title="v4l2_m2m_ctx"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_m2m_ctx</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*vbuf</span></code></dt><dd><p>the buffer to be removed</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.v4l2_m2m_buf_copy_metadata">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">v4l2_m2m_buf_copy_metadata</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">out_vb</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="v4l2-videobuf2.html#c.vb2_v4l2_buffer" title="vb2_v4l2_buffer"><span class="n"><span class="pre">vb2_v4l2_buffer</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cap_vb</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">copy_frame_flags</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_m2m_buf_copy_metadata" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>copy buffer metadata from the output buffer to the capture buffer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*out_vb</span></code></dt><dd><p>the output buffer that is the source of the metadata.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vb2_v4l2_buffer</span> <span class="pre">*cap_vb</span></code></dt><dd><p>the capture buffer that will receive the metadata.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">copy_frame_flags</span></code></dt><dd><p>copy the KEY/B/PFRAME flags as well.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This helper function copies the timestamp, timecode (if the TIMECODE
buffer flag was set), field and the TIMECODE, KEYFRAME, BFRAME, PFRAME
and TSTAMP_SRC_MASK flags from <strong>out_vb</strong> to <strong>cap_vb</strong>.</p>
<p>If <strong>copy_frame_flags</strong> is false, then the KEYFRAME, BFRAME and PFRAME
flags are not copied. This is typically needed for encoders that
set this bits explicitly.</p>
</div>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/media/v4l2-mem2mem.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>