<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The Linux Hardware Timestamping Engine (HTE) &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=3918102e" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="HTE Kernel provider driver" href="tegra-hte.html" />
    <link rel="prev" title="The Linux Hardware Timestamping Engine (HTE)" href="index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo of The Linux Kernel"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.12.0</p>







<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Driver APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#general-information-for-driver-authors">General information for driver authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#useful-support-libraries">Useful support libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#bus-level-documentation">Bus-level documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#subsystem-specific-apis">Subsystem-specific APIs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../80211/index.html">Linux 802.11 Driver Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../clk.html">The Common Clk Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../console.html">Console Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crypto/index.html">Crypto Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dpll.html">The Linux kernel dpll subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aperture.html">Managing Ownership of the Framebuffer Aperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">The Linux Hardware Timestamping Engine (HTE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../input.html">Input Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../libata.html">libATA Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mailbox.html">The Common Mailbox Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../md/index.html">RAID</a></li>
<li class="toctree-l3"><a class="reference internal" href="../media/index.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../message-based.html">Message-based devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ntb.html">NTB Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pin-control.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pldmfw/index.html">PLDM Firmware Flash Update Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pldmfw/index.html#overview-of-the-pldmfw-library">Overview of the <code class="docutils literal notranslate"><span class="pre">pldmfw</span></code> library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pwrseq.html">Power Sequencing API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reset.html">Reset controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sm501.html">SM501 Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../surface_aggregator/index.html">Surface System Aggregator Module (SSAM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tee.html">TEE (Trusted Execution Environment) driver API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../thermal/index.html">Thermal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tty/index.html">TTY</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wbrf.html">WBRF - Wifi Band RFI Mitigations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wmi.html">WMI Driver API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zorro.html">Writing Device Drivers for Zorro Devices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/hte/hte.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="the-linux-hardware-timestamping-engine-hte">
<h1>The Linux Hardware Timestamping Engine (HTE)<a class="headerlink" href="#the-linux-hardware-timestamping-engine-hte" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dipen Patel</p>
</dd>
</dl>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>Certain devices have built in hardware timestamping engines which can
monitor sets of system signals, lines, buses etc... in realtime for state
change; upon detecting the change they can automatically store the timestamp at
the moment of occurrence. Such functionality may help achieve better accuracy
in obtaining timestamps than using software counterparts i.e. ktime and
friends.</p>
<p>This document describes the API that can be used by hardware timestamping
engine provider and consumer drivers that want to use the hardware timestamping
engine (HTE) framework. Both consumers and providers must include
<code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;linux/hte.h&gt;</span></code>.</p>
</section>
<section id="the-hte-framework-apis-for-the-providers">
<h2>The HTE framework APIs for the providers<a class="headerlink" href="#the-hte-framework-apis-for-the-providers" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.hte_push_ts_ns">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_push_ts_ns</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_chip" title="hte_chip"><span class="n"><span class="pre">hte_chip</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">chip</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">xlated_id</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_data" title="hte_ts_data"><span class="n"><span class="pre">hte_ts_data</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.hte_push_ts_ns" title="Link to this definition">¶</a><br /></dt>
<dd><p>Push timestamp data in nanoseconds.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">hte_chip</span> <span class="pre">*chip</span></code></dt><dd><p>The HTE chip, used during the registration.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">xlated_id</span></code></dt><dd><p>entity id understood by both subsystem and provider, this is
obtained from xlate callback during request API.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_data</span> <span class="pre">*data</span></code></dt><dd><p>timestamp data.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is used by the provider to push timestamp data.</p>
<p><strong>Return</strong></p>
<p>0 on success or a negative error code on failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.devm_hte_register_chip">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">devm_hte_register_chip</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_chip" title="hte_chip"><span class="n"><span class="pre">hte_chip</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">chip</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.devm_hte_register_chip" title="Link to this definition">¶</a><br /></dt>
<dd><p>Resource managed API to register HTE chip.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_chip</span> <span class="pre">*chip</span></code></dt><dd><p>the HTE chip to add to subsystem.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is used by the provider to register itself with the HTE subsystem.
The unregistration is done automatically when the provider exits.</p>
<p><strong>Return</strong></p>
<p>0 on success or a negative error code on failure.</p>
</div>
</section>
<section id="the-hte-framework-apis-for-the-consumers">
<h2>The HTE framework APIs for the consumers<a class="headerlink" href="#the-hte-framework-apis-for-the-consumers" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.hte_ts_put">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_ts_put</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_desc" title="hte_ts_desc"><span class="n"><span class="pre">hte_ts_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">desc</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.hte_ts_put" title="Link to this definition">¶</a><br /></dt>
<dd><p>Release and disable timestamp for the given desc.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_desc</span> <span class="pre">*desc</span></code></dt><dd><p>timestamp descriptor.</p>
</dd>
</dl>
<p><strong>Context</strong></p>
<p>debugfs_remove_recursive() function call may use sleeping locks,
not suitable from atomic context.</p>
<p><strong>Return</strong></p>
<p>0 on success or a negative error code on failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.hte_disable_ts">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_disable_ts</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_desc" title="hte_ts_desc"><span class="n"><span class="pre">hte_ts_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">desc</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.hte_disable_ts" title="Link to this definition">¶</a><br /></dt>
<dd><p>Disable timestamp on given descriptor.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_desc</span> <span class="pre">*desc</span></code></dt><dd><p>ts descriptor, this is the same as returned by the request API.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The API does not release any resources associated with desc.</p>
<p><strong>Context</strong></p>
<p>Holds mutex lock, not suitable from atomic context.</p>
<p><strong>Return</strong></p>
<p>0 on success or a negative error code on failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.hte_enable_ts">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_enable_ts</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_desc" title="hte_ts_desc"><span class="n"><span class="pre">hte_ts_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">desc</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.hte_enable_ts" title="Link to this definition">¶</a><br /></dt>
<dd><p>Enable timestamp on given descriptor.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_desc</span> <span class="pre">*desc</span></code></dt><dd><p>ts descriptor, this is the same as returned by the request API.</p>
</dd>
</dl>
<p><strong>Context</strong></p>
<p>Holds mutex lock, not suitable from atomic context.</p>
<p><strong>Return</strong></p>
<p>0 on success or a negative error code on failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.of_hte_req_count">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">of_hte_req_count</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.of_hte_req_count" title="Link to this definition">¶</a><br /></dt>
<dd><p>Return the number of entities to timestamp.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>The HTE consumer.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The function returns the total count of the requested entities to timestamp
by parsing device tree.</p>
<p><strong>Return</strong></p>
<p>Positive number on success, -ENOENT if no entries,
-EINVAL for other errors.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.hte_ts_get">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_ts_get</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_desc" title="hte_ts_desc"><span class="n"><span class="pre">hte_ts_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">desc</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">index</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.hte_ts_get" title="Link to this definition">¶</a><br /></dt>
<dd><p>The function to initialize and obtain HTE desc.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>HTE consumer/client device, used in case of parsing device tree node.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_desc</span> <span class="pre">*desc</span></code></dt><dd><p>Pre-allocated timestamp descriptor.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">index</span></code></dt><dd><p>The index will be used as an index to parse line_id from the
device tree node if node is present.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The function initializes the consumer provided HTE descriptor. If consumer
has device tree node, index is used to parse the line id and other details.
The function needs to be called before using any request APIs.</p>
<p><strong>Context</strong></p>
<p>Holds mutex lock.</p>
<p><strong>Return</strong></p>
<p>Returns 0 on success or negative error code on failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.hte_request_ts_ns">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_request_ts_ns</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_desc" title="hte_ts_desc"><span class="n"><span class="pre">hte_ts_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">desc</span></span>, <a class="reference internal" href="#c.hte_ts_cb_t" title="hte_ts_cb_t"><span class="n"><span class="pre">hte_ts_cb_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">cb</span></span>, <a class="reference internal" href="#c.hte_ts_sec_cb_t" title="hte_ts_sec_cb_t"><span class="n"><span class="pre">hte_ts_sec_cb_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">tcb</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.hte_request_ts_ns" title="Link to this definition">¶</a><br /></dt>
<dd><p>The API to request and enable hardware timestamp in nanoseconds.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_desc</span> <span class="pre">*desc</span></code></dt><dd><p>Pre-allocated and initialized timestamp descriptor.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hte_ts_cb_t</span> <span class="pre">cb</span></code></dt><dd><p>Callback to push the timestamp data to consumer.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hte_ts_sec_cb_t</span> <span class="pre">tcb</span></code></dt><dd><p>Optional callback. If its provided, subsystem initializes
workqueue. It is called when cb returns HTE_RUN_SECOND_CB.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>Client data, used during cb and tcb callbacks.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The entity is provider specific for example, GPIO lines, signals, buses
etc...The API allocates necessary resources and enables the timestamp.</p>
<p><strong>Context</strong></p>
<p>Holds mutex lock.</p>
<p><strong>Return</strong></p>
<p>Returns 0 on success or negative error code on failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.devm_hte_request_ts_ns">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">devm_hte_request_ts_ns</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dev</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_desc" title="hte_ts_desc"><span class="n"><span class="pre">hte_ts_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">desc</span></span>, <a class="reference internal" href="#c.hte_ts_cb_t" title="hte_ts_cb_t"><span class="n"><span class="pre">hte_ts_cb_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">cb</span></span>, <a class="reference internal" href="#c.hte_ts_sec_cb_t" title="hte_ts_sec_cb_t"><span class="n"><span class="pre">hte_ts_sec_cb_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">tcb</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.devm_hte_request_ts_ns" title="Link to this definition">¶</a><br /></dt>
<dd><p>Resource managed API to request and enable hardware timestamp in nanoseconds.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>HTE consumer/client device.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_desc</span> <span class="pre">*desc</span></code></dt><dd><p>Pre-allocated and initialized timestamp descriptor.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hte_ts_cb_t</span> <span class="pre">cb</span></code></dt><dd><p>Callback to push the timestamp data to consumer.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hte_ts_sec_cb_t</span> <span class="pre">tcb</span></code></dt><dd><p>Optional callback. If its provided, subsystem initializes
workqueue. It is called when cb returns HTE_RUN_SECOND_CB.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>Client data, used during cb and tcb callbacks.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The entity is provider specific for example, GPIO lines, signals, buses
etc...The API allocates necessary resources and enables the timestamp. It
deallocates and disables automatically when the consumer exits.</p>
<p><strong>Context</strong></p>
<p>Holds mutex lock.</p>
<p><strong>Return</strong></p>
<p>Returns 0 on success or negative error code on failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.hte_init_line_attr">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_init_line_attr</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_desc" title="hte_ts_desc"><span class="n"><span class="pre">hte_ts_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">desc</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">line_id</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="n"><span class="pre">edge_flags</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">name</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.hte_init_line_attr" title="Link to this definition">¶</a><br /></dt>
<dd><p>Initialize line attributes.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_desc</span> <span class="pre">*desc</span></code></dt><dd><p>Pre-allocated timestamp descriptor.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">line_id</span></code></dt><dd><p>line id.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">edge_flags</span></code></dt><dd><p>edge flags related to line_id.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name</span></code></dt><dd><p>name of the line.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>line data related to line_id.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Zeroes out line attributes and initializes with provided arguments.
The function needs to be called before calling any consumer facing
functions.</p>
<p><strong>Context</strong></p>
<p>Any.</p>
<p><strong>Return</strong></p>
<p>0 on success or negative error code for the failure.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.hte_get_clk_src_info">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_get_clk_src_info</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_ts_desc" title="hte_ts_desc"><span class="n"><span class="pre">hte_ts_desc</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">desc</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.hte_clk_info" title="hte_clk_info"><span class="n"><span class="pre">hte_clk_info</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ci</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.hte_get_clk_src_info" title="Link to this definition">¶</a><br /></dt>
<dd><p>Get the clock source information for a ts descriptor.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">hte_ts_desc</span> <span class="pre">*desc</span></code></dt><dd><p>ts descriptor, same as returned from request API.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_clk_info</span> <span class="pre">*ci</span></code></dt><dd><p>The API fills this structure with the clock information data.</p>
</dd>
</dl>
<p><strong>Context</strong></p>
<p>Any context.</p>
<p><strong>Return</strong></p>
<p>0 on success else negative error code on failure.</p>
</div>
</section>
<section id="the-hte-framework-public-structures">
<h2>The HTE framework public structures<a class="headerlink" href="#the-hte-framework-public-structures" title="Link to this heading">¶</a></h2>
<dl class="c enum">
<dt class="sig sig-object c" id="c.hte_edge">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_edge</span></span></span><a class="headerlink" href="#c.hte_edge" title="Link to this definition">¶</a><br /></dt>
<dd><p>HTE line edge flags.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">HTE_EDGE_NO_SETUP</span></code></dt><dd><p>No edge setup. In this case consumer will setup edges,
for example during request irq call.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">HTE_RISING_EDGE_TS</span></code></dt><dd><p>Rising edge.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">HTE_FALLING_EDGE_TS</span></code></dt><dd><p>Falling edge.</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.hte_return">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_return</span></span></span><a class="headerlink" href="#c.hte_return" title="Link to this definition">¶</a><br /></dt>
<dd><p>HTE subsystem return values used during callback.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">HTE_CB_HANDLED</span></code></dt><dd><p>The consumer handled the data.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">HTE_RUN_SECOND_CB</span></code></dt><dd><p>The consumer needs further processing, in that case
HTE subsystem calls secondary callback provided by the consumer where it
is allowed to sleep.</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.hte_ts_data">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_ts_data</span></span></span><a class="headerlink" href="#c.hte_ts_data" title="Link to this definition">¶</a><br /></dt>
<dd><p>HTE timestamp data.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct hte_ts_data {
    u64 tsc;
    u64 seq;
    int raw_level;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">tsc</span></code></dt><dd><p>Timestamp value.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">seq</span></code></dt><dd><p>Sequence counter of the timestamps.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">raw_level</span></code></dt><dd><p>Level of the line at the timestamp if provider supports it,
-1 otherwise.</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.hte_clk_info">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_clk_info</span></span></span><a class="headerlink" href="#c.hte_clk_info" title="Link to this definition">¶</a><br /></dt>
<dd><p>Clock source info that HTE provider uses to timestamp.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct hte_clk_info {
    u64 hz;
    clockid_t type;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">hz</span></code></dt><dd><p>Supported clock rate in HZ, for example 1KHz clock = 1000.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>Supported clock type.</p>
</dd>
</dl>
</div>
<dl class="c macro">
<dt class="sig sig-object c" id="c.hte_ts_cb_t">
<span class="sig-name descname"><span class="n"><span class="pre">hte_ts_cb_t</span></span></span><a class="headerlink" href="#c.hte_ts_cb_t" title="Link to this definition">¶</a><br /></dt>
<dd><p><strong>Typedef</strong>: HTE timestamp data processing primary callback.</p>
</dd></dl>

<p><strong>Syntax</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">hte_return</span> <span class="pre">hte_ts_cb_t</span> <span class="pre">(struct</span> <span class="pre">hte_ts_data</span> <span class="pre">*ts,</span> <span class="pre">void</span> <span class="pre">*data)</span></code></p>
</div></blockquote>
<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_data</span> <span class="pre">*ts</span></code></dt><dd><p>HW timestamp data.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>Client supplied data.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The callback is used to push timestamp data to the client and it is
not allowed to sleep.</p>
</div>
<dl class="c macro">
<dt class="sig sig-object c" id="c.hte_ts_sec_cb_t">
<span class="sig-name descname"><span class="n"><span class="pre">hte_ts_sec_cb_t</span></span></span><a class="headerlink" href="#c.hte_ts_sec_cb_t" title="Link to this definition">¶</a><br /></dt>
<dd><p><strong>Typedef</strong>: HTE timestamp data processing secondary callback.</p>
</dd></dl>

<p><strong>Syntax</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">hte_return</span> <span class="pre">hte_ts_sec_cb_t</span> <span class="pre">(void</span> <span class="pre">*data)</span></code></p>
</div></blockquote>
<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>Client supplied data.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is used when the client needs further processing where it is
allowed to sleep.</p>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.hte_line_attr">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_line_attr</span></span></span><a class="headerlink" href="#c.hte_line_attr" title="Link to this definition">¶</a><br /></dt>
<dd><p>Line attributes.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct hte_line_attr {
    u32 line_id;
    void *line_data;
    unsigned long edge_flags;
    const char *name;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">line_id</span></code></dt><dd><p>The logical ID understood by the consumers and providers.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">line_data</span></code></dt><dd><p>Line data related to line_id.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">edge_flags</span></code></dt><dd><p>Edge setup flags.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Descriptive name of the entity that is being monitored for the
hardware timestamping. If null, HTE core will construct the name.</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.hte_ts_desc">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_ts_desc</span></span></span><a class="headerlink" href="#c.hte_ts_desc" title="Link to this definition">¶</a><br /></dt>
<dd><p>HTE timestamp descriptor.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct hte_ts_desc {
    struct hte_line_attr attr;
    void *hte_data;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">attr</span></code></dt><dd><p>The line attributes.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hte_data</span></code></dt><dd><p>Subsystem’s private data, set by HTE subsystem.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This structure is a communication token between consumers to subsystem
and subsystem to providers.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.hte_ops">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_ops</span></span></span><a class="headerlink" href="#c.hte_ops" title="Link to this definition">¶</a><br /></dt>
<dd><p>HTE operations set by providers.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct hte_ops {
    int (*request)(struct hte_chip *chip, struct hte_ts_desc *desc, u32 xlated_id);
    int (*release)(struct hte_chip *chip, struct hte_ts_desc *desc, u32 xlated_id);
    int (*enable)(struct hte_chip *chip, u32 xlated_id);
    int (*disable)(struct hte_chip *chip, u32 xlated_id);
    int (*get_clk_src_info)(struct hte_chip *chip, struct hte_clk_info *ci);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">request</span></code></dt><dd><p>Hook for requesting a HTE timestamp. Returns 0 on success,
non-zero for failures.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">release</span></code></dt><dd><p>Hook for releasing a HTE timestamp. Returns 0 on success,
non-zero for failures.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enable</span></code></dt><dd><p>Hook to enable the specified timestamp. Returns 0 on success,
non-zero for failures.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">disable</span></code></dt><dd><p>Hook to disable specified timestamp. Returns 0 on success,
non-zero for failures.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">get_clk_src_info</span></code></dt><dd><p>Hook to get the clock information the provider uses
to timestamp. Returns 0 for success and negative error code for failure. On
success HTE subsystem fills up provided <a class="reference internal" href="#c.hte_clk_info" title="hte_clk_info"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_clk_info</span></code></a>.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>xlated_id parameter is used to communicate between HTE subsystem and the
providers and is translated by the provider.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.hte_chip">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">hte_chip</span></span></span><a class="headerlink" href="#c.hte_chip" title="Link to this definition">¶</a><br /></dt>
<dd><p>Abstract HTE chip.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct hte_chip {
    const char *name;
    struct device *dev;
    const struct hte_ops *ops;
    u32 nlines;
    int (*xlate_of)(struct hte_chip *gc,const struct of_phandle_args *args, struct hte_ts_desc *desc, u32 *xlated_id);
    int (*xlate_plat)(struct hte_chip *gc, struct hte_ts_desc *desc, u32 *xlated_id);
    bool (*match_from_linedata)(const struct hte_chip *chip, const struct hte_ts_desc *hdesc);
    u8 of_hte_n_cells;
    struct hte_device *gdev;
    void *data;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>functional name of the HTE IP block.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt><dd><p>device providing the HTE.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ops</span></code></dt><dd><p>callbacks for this HTE.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nlines</span></code></dt><dd><p>number of lines/signals supported by this chip.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xlate_of</span></code></dt><dd><p>Callback which translates consumer supplied logical ids to
physical ids, return 0 for the success and negative for the failures.
It stores (between 0 to <strong>nlines</strong>) in xlated_id parameter for the success.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xlate_plat</span></code></dt><dd><p>Same as above but for the consumers with no DT node.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">match_from_linedata</span></code></dt><dd><p>Match HTE device using the line_data.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">of_hte_n_cells</span></code></dt><dd><p>Number of cells used to form the HTE specifier.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gdev</span></code></dt><dd><p>HTE subsystem abstract device, internal to the HTE subsystem.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>chip specific private data.</p>
</dd>
</dl>
</div>
</section>
<section id="more-on-the-hte-timestamp-data">
<h2>More on the HTE timestamp data<a class="headerlink" href="#more-on-the-hte-timestamp-data" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">hte_ts_data</span></code> is used to pass timestamp details between the
consumers and the providers. It expresses timestamp data in nanoseconds in
u64. An example of the typical timestamp data life cycle, for the GPIO line is
as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- Monitors GPIO line change.
- Detects the state change on GPIO line.
- Converts timestamps in nanoseconds.
- Stores GPIO raw level in raw_level variable if the provider has that
hardware capability.
- Pushes this hte_ts_data object to HTE subsystem.
- HTE subsystem increments seq counter and invokes consumer provided callback.
Based on callback return value, the HTE core invokes secondary callback in
the thread context.
</pre></div>
</div>
</section>
<section id="hte-subsystem-debugfs-attributes">
<h2>HTE subsystem debugfs attributes<a class="headerlink" href="#hte-subsystem-debugfs-attributes" title="Link to this heading">¶</a></h2>
<p>HTE subsystem creates debugfs attributes at <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/hte/</span></code>.
It also creates line/signal-related debugfs attributes at
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/hte/&lt;provider&gt;/&lt;label</span> <span class="pre">or</span> <span class="pre">line</span> <span class="pre">id&gt;/</span></code>. Note that these
attributes are read-only.</p>
<dl class="simple">
<dt><cite>ts_requested</cite></dt><dd><p>The total number of entities requested from the given provider,
where entity is specified by the provider and could represent
lines, GPIO, chip signals, buses etc...
The attribute will be available at
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/hte/&lt;provider&gt;/</span></code>.</p>
</dd>
<dt><cite>total_ts</cite></dt><dd><p>The total number of entities supported by the provider.
The attribute will be available at
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/hte/&lt;provider&gt;/</span></code>.</p>
</dd>
<dt><cite>dropped_timestamps</cite></dt><dd><p>The dropped timestamps for a given line.
The attribute will be available at
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/hte/&lt;provider&gt;/&lt;label</span> <span class="pre">or</span> <span class="pre">line</span> <span class="pre">id&gt;/</span></code>.</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;The kernel development community.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/driver-api/hte/hte.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>