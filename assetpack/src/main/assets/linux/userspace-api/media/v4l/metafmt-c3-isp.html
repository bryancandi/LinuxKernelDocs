<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2.13.1. V4L2_META_FMT_C3ISP_STATS (‘C3ST’), V4L2_META_FMT_C3ISP_PARAMS (‘C3PM’) &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="2.13.2. V4L2_META_FMT_D4XX (‘D4XX’)" href="metafmt-d4xx.html" />
    <link rel="prev" title="2.13. Metadata Formats" href="meta-formats.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.16.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Userspace API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#system-calls">System calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#security-related-interfaces">Security-related interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#devices-and-i-o">Devices and I/O</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../accelerators/ocxl.html">OpenCAPI (Open Coherent Accelerator Processor Interface)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dma-buf-heaps.html">Allocating dma-buf using heaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dma-buf-alloc-exchange.html">Exchanging pixel buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fwctl/index.html">Firmware Control (FWCTL) Userspace API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gpio/index.html">GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../iommufd.html">IOMMUFD</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dcdbas.html">Dell Systems Management Base Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vduse.html">VDUSE - “vDPA Device in Userspace”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../isapnp.html">ISA Plug &amp; Play support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#everything-else">Everything else</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/userspace-api/media/v4l/metafmt-c3-isp.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="v4l2-meta-fmt-c3isp-stats-c3st-v4l2-meta-fmt-c3isp-params-c3pm">
<span id="v4l2-meta-fmt-c3isp-params"></span><span id="v4l2-meta-fmt-c3isp-stats"></span><h1><span class="section-number">2.13.1. </span>V4L2_META_FMT_C3ISP_STATS (‘C3ST’), V4L2_META_FMT_C3ISP_PARAMS (‘C3PM’)<a class="headerlink" href="#v4l2-meta-fmt-c3isp-stats-c3st-v4l2-meta-fmt-c3isp-params-c3pm" title="Link to this heading">¶</a></h1>
<section id="a-statistics">
<h2><span class="section-number">2.13.1.1. </span>3A Statistics<a class="headerlink" href="#a-statistics" title="Link to this heading">¶</a></h2>
<p>The C3 ISP can collect different statistics over an input Bayer frame.
Those statistics are obtained from the “c3-isp-stats” metadata capture video nodes,
using the <a class="reference internal" href="dev-meta.html#c.v4l2_meta_format" title="v4l2_meta_format"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_meta_format</span></code></a> interface.
They are formatted as described by the <a class="reference internal" href="#c.c3_isp_stats_info" title="c3_isp_stats_info"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_stats_info</span></code></a> structure.</p>
<p>The statistics collected are  Auto-white balance,
Auto-exposure and Auto-focus information.</p>
</section>
<section id="configuration-parameters">
<h2><span class="section-number">2.13.1.2. </span>Configuration Parameters<a class="headerlink" href="#configuration-parameters" title="Link to this heading">¶</a></h2>
<p>The configuration parameters are passed to the c3-isp-params metadata output video node,
using the <a class="reference internal" href="dev-meta.html#c.v4l2_meta_format" title="v4l2_meta_format"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_meta_format</span></code></a> interface. Rather than a single struct containing
sub-structs for each configurable area of the ISP, parameters for the C3-ISP
are defined as distinct structs or “blocks” which may be added to the data
member of <a class="reference internal" href="#c.c3_isp_params_cfg" title="c3_isp_params_cfg"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_cfg</span></code></a>. Userspace is responsible for
populating the data member with the blocks that need to be configured by the driver, but
need not populate it with <strong>all</strong> the blocks, or indeed with any at all if there
are no configuration changes to make. Populated blocks <strong>must</strong> be consecutive
in the buffer. To assist both userspace and the driver in identifying the
blocks each block-specific struct embeds
<a class="reference internal" href="#c.c3_isp_params_block_header" title="c3_isp_params_block_header"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_header</span></code></a> as its first member and userspace
must populate the type member with a value from
<a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a>. Once the blocks have been populated
into the data buffer, the combined size of all populated blocks shall be set in
the data_size member of <a class="reference internal" href="#c.c3_isp_params_cfg" title="c3_isp_params_cfg"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_cfg</span></code></a>. For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_cfg</span><span class="w"> </span><span class="o">*</span><span class="n">params</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_cfg</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">;</span>

<span class="n">params</span><span class="o">-&gt;</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C3_ISP_PARAM_BUFFER_V0</span><span class="p">;</span>
<span class="n">params</span><span class="o">-&gt;</span><span class="n">data_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_awb_gains</span><span class="w"> </span><span class="o">*</span><span class="n">gains</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_awb_gains</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>

<span class="n">gains</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C3_ISP_PARAMS_BLOCK_AWB_GAINS</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C3_ISP_PARAMS_BLOCK_FL_ENABLE</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_awb_gains</span><span class="p">);</span>

<span class="n">gains</span><span class="o">-&gt;</span><span class="n">gr_gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">r_gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">b_gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>
<span class="n">gains</span><span class="o">-&gt;</span><span class="n">gb_gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span>

<span class="n">data</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp__params_awb_gains</span><span class="p">);</span>
<span class="n">params</span><span class="o">-&gt;</span><span class="n">data_size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_awb_gains</span><span class="p">);</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_awb_config</span><span class="w"> </span><span class="o">*</span><span class="n">awb_cfg</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_awb_config</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>

<span class="n">awb_cfg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C3_ISP_PARAMS_BLOCK_AWB_CONFIG</span><span class="p">;</span>
<span class="n">awb_cfg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C3_ISP_PARAMS_BLOCK_FL_ENABLE</span><span class="p">;</span>
<span class="n">awb_cfg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_awb_config</span><span class="p">);</span>

<span class="n">awb_cfg</span><span class="o">-&gt;</span><span class="n">tap_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C3_ISP_AWB_STATS_TAP_BEFORE_WB</span><span class="p">;</span>
<span class="n">awb_cfg</span><span class="o">-&gt;</span><span class="n">satur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">awb_cfg</span><span class="o">-&gt;</span><span class="n">horiz_zones_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span>
<span class="n">awb_cfg</span><span class="o">-&gt;</span><span class="n">vert_zones_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span><span class="p">;</span>

<span class="n">params</span><span class="o">-&gt;</span><span class="n">data_size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_awb_config</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="amlogic-c3-isp-uapi-data-types">
<h2><span class="section-number">2.13.1.3. </span>Amlogic C3 ISP uAPI data types<a class="headerlink" href="#amlogic-c3-isp-uapi-data-types" title="Link to this heading">¶</a></h2>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_awb_zone_stats">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_awb_zone_stats</span></span></span><a class="headerlink" href="#c.c3_isp_awb_zone_stats" title="Link to this definition">¶</a><br /></dt>
<dd><p>AWB statistics of a zone</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_awb_zone_stats {
    __u16 rg;
    __u16 bg;
    __u32 pixel_sum;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">rg</span></code></dt><dd><p>the ratio of R / G in a zone</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bg</span></code></dt><dd><p>the ratio of B / G in a zone</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pixel_sum</span></code></dt><dd><p>the total number of pixels used in a zone</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>AWB zone stats is aligned with 8 bytes</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_awb_stats">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_awb_stats</span></span></span><a class="headerlink" href="#c.c3_isp_awb_stats" title="Link to this definition">¶</a><br /></dt>
<dd><p>Auto white balance statistics information.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_awb_stats {
    struct c3_isp_awb_zone_stats stats[C3_ISP_AWB_MAX_ZONES];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">stats</span></code></dt><dd><p>array of auto white balance statistics</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>AWB statistical information of all zones.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_ae_zone_stats">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_ae_zone_stats</span></span></span><a class="headerlink" href="#c.c3_isp_ae_zone_stats" title="Link to this definition">¶</a><br /></dt>
<dd><p>AE statistics of a zone</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_ae_zone_stats {
    __u16 hist0;
    __u16 hist1;
    __u16 hist3;
    __u16 hist4;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">hist0</span></code></dt><dd><p>the global normalized pixel count for bin 0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hist1</span></code></dt><dd><p>the global normalized pixel count for bin 1</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hist3</span></code></dt><dd><p>the global normalized pixel count for bin 3</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hist4</span></code></dt><dd><p>the global normalized pixel count for bin 4</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>AE zone stats is aligned with 8 bytes.
This is a 5-bin histogram and the total sum is normalized to 0xffff.
So hist2 = 0xffff - (hist0 + hist1 + hist3 + hist4)</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_ae_stats">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_ae_stats</span></span></span><a class="headerlink" href="#c.c3_isp_ae_stats" title="Link to this definition">¶</a><br /></dt>
<dd><p>Exposure statistics information</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_ae_stats {
    struct c3_isp_ae_zone_stats stats[C3_ISP_AE_MAX_ZONES];
    __u32 reserved[2];
    __u32 hist[1024];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">stats</span></code></dt><dd><p>array of auto exposure block statistics</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>undefined buffer space</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hist</span></code></dt><dd><p>a 1024-bin histogram for the entire image</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>AE statistical information consists of all blocks information and a 1024-bin
histogram.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_af_zone_stats">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_af_zone_stats</span></span></span><a class="headerlink" href="#c.c3_isp_af_zone_stats" title="Link to this definition">¶</a><br /></dt>
<dd><p>AF statistics of a zone</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_af_zone_stats {
    __u16 i2_mat;
    __u16 i4_mat;
    __u16 e4_mat;
    __u16 e4_exp : 5;
    __u16 i2_exp : 5;
    __u16 i4_exp : 6;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">i2_mat</span></code></dt><dd><p>the mantissa of zonal squared image pixel sum</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">i4_mat</span></code></dt><dd><p>the mantissa of zonal quartic image pixel sum</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">e4_mat</span></code></dt><dd><p>the mantissa of zonal multi-directional quartic edge sum</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">e4_exp</span></code></dt><dd><p>the exponent of zonal multi-directional quartic edge sum</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">i2_exp</span></code></dt><dd><p>the exponent of zonal squared image pixel sum</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">i4_exp</span></code></dt><dd><p>the exponent of zonal quartic image pixel sum</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>AF zone stats is aligned with 8 bytes.
The zonal accumulated contrast metrics are stored in floating point format
with 16 bits mantissa and 5 or 6 bits exponent. Apart from contrast metrics
we accumulate squared image and quartic image data over the zone.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_af_stats">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_af_stats</span></span></span><a class="headerlink" href="#c.c3_isp_af_stats" title="Link to this definition">¶</a><br /></dt>
<dd><p>Auto Focus statistics information</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_af_stats {
    struct c3_isp_af_zone_stats stats[C3_ISP_AF_MAX_ZONES];
    __u32 reserved[2];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">stats</span></code></dt><dd><p>array of auto focus block statistics</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>undefined buffer space</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>AF statistical information of each zone</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_stats_info">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_stats_info</span></span></span><a class="headerlink" href="#c.c3_isp_stats_info" title="Link to this definition">¶</a><br /></dt>
<dd><p>V4L2_META_FMT_C3ISP_STATS</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_stats_info {
    struct c3_isp_awb_stats awb;
    struct c3_isp_ae_stats ae;
    struct c3_isp_af_stats af;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">awb</span></code></dt><dd><p>auto white balance stats</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ae</span></code></dt><dd><p>auto exposure stats</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">af</span></code></dt><dd><p>auto focus stats</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Contains ISP statistics</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.c3_isp_params_buffer_version">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_buffer_version</span></span></span><a class="headerlink" href="#c.c3_isp_params_buffer_version" title="Link to this definition">¶</a><br /></dt>
<dd><p>C3 ISP parameters block versioning</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BUFFER_V0</span></code></dt><dd><p>First version of C3 ISP parameters block</p>
</dd>
</dl>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.c3_isp_params_block_type">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_block_type</span></span></span><a class="headerlink" href="#c.c3_isp_params_block_type" title="Link to this definition">¶</a><br /></dt>
<dd><p>Enumeration of C3 ISP parameter blocks</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_AWB_GAINS</span></code></dt><dd><p>White balance gains</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_AWB_CONFIG</span></code></dt><dd><p>AWB statistic format configuration for all
blocks that control how stats are generated</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_AE_CONFIG</span></code></dt><dd><p>AE statistic format configuration for all
blocks that control how stats are generated</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_AF_CONFIG</span></code></dt><dd><p>AF statistic format configuration for all
blocks that control how stats are generated</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_PST_GAMMA</span></code></dt><dd><p>post gamma parameters</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_CCM</span></code></dt><dd><p>Color correction matrix parameters</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_CSC</span></code></dt><dd><p>Color space conversion parameters</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_BLC</span></code></dt><dd><p>Black level correction parameters</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_BLOCK_SENTINEL</span></code></dt><dd><p>First non-valid block index</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Each block configures a specific processing block of the C3 ISP.
The block type allows the driver to correctly interpret the parameters block
data.</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_block_header">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_block_header</span></span></span><a class="headerlink" href="#c.c3_isp_params_block_header" title="Link to this definition">¶</a><br /></dt>
<dd><p>C3 ISP parameter block header</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_block_header {
    __u16 type;
    __u16 flags;
    __u32 size;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>The parameters block type from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>A bitmask of block flags</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>Size (in bytes) of the parameters block, including this header</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This structure represents the common part of all the ISP configuration
blocks. Each parameters block shall embed an instance of this structure type
as its first member, followed by the block-specific configuration data. The
driver inspects this common header to discern the block type and its size and
properly handle the block content by casting it to the correct block-specific
type.</p>
<p>The <strong>type</strong> field is one of the values enumerated by
<a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a> and specifies how the data should be
interpreted by the driver. The <strong>size</strong> field specifies the size of the
parameters block and is used by the driver for validation purposes. The
<strong>flags</strong> field is a bitmask of per-block flags C3_ISP_PARAMS_FL*.</p>
<p>When userspace wants to disable an ISP block the
C3_ISP_PARAMS_BLOCK_FL_DISABLED bit should be set in the <strong>flags</strong> field. In
this case userspace may optionally omit the remainder of the configuration
block, which will be ignored by the driver.</p>
<p>When a new configuration of an ISP block needs to be applied userspace
shall fully populate the ISP block and omit setting the
C3_ISP_PARAMS_BLOCK_FL_DISABLED bit in the <strong>flags</strong> field.</p>
<p>Userspace is responsible for correctly populating the parameters block header
fields (<strong>type</strong>, <strong>flags</strong> and <strong>size</strong>) and the block-specific parameters.</p>
<p>For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">populate_pst_gamma</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_block_header</span><span class="w"> </span><span class="o">*</span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_pst_gamma</span><span class="w"> </span><span class="o">*</span><span class="n">gamma</span><span class="w"> </span><span class="o">=</span>
<span class="w">                </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">c3_isp_params_pst_gamma</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">block</span><span class="p">;</span>

<span class="w">        </span><span class="n">gamma</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C3_ISP_PARAMS_BLOCK_PST_GAMMA</span><span class="p">;</span>
<span class="w">        </span><span class="n">gamma</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C3_ISP_PARAMS_BLOCK_FL_ENABLE</span><span class="p">;</span>
<span class="w">        </span><span class="n">gamma</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">gamma</span><span class="p">);</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">129</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">                </span><span class="n">gamma</span><span class="o">-&gt;</span><span class="n">pst_gamma_lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_awb_gains">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_awb_gains</span></span></span><a class="headerlink" href="#c.c3_isp_params_awb_gains" title="Link to this definition">¶</a><br /></dt>
<dd><p>Gains for auto-white balance</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_awb_gains {
    struct c3_isp_params_block_header header;
    __u16 gr_gain;
    __u16 r_gain;
    __u16 b_gain;
    __u16 gb_gain;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>The C3 ISP parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gr_gain</span></code></dt><dd><p>Multiplier for Gr channel (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">r_gain</span></code></dt><dd><p>Multiplier for R channel (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">b_gain</span></code></dt><dd><p>Multiplier for B channel (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gb_gain</span></code></dt><dd><p>Multiplier for Gb channel (Q4.8 format)</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct allows users to configure the gains for white balance.
There are four gain settings corresponding to each colour channel in
the bayer domain. All of the gains are stored in Q4.8 format.</p>
<p>header.type should be set to C3_ISP_PARAMS_BLOCK_AWB_GAINS
from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.c3_isp_params_awb_tap_points">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_awb_tap_points</span></span></span><a class="headerlink" href="#c.c3_isp_params_awb_tap_points" title="Link to this definition">¶</a><br /></dt>
<dd><p>Tap points for the AWB statistics</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_AWB_STATS_TAP_OFE</span></code></dt><dd><p>immediately after the optical frontend block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_AWB_STATS_TAP_GE</span></code></dt><dd><p>immediately after the green equal block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_AWB_STATS_TAP_BEFORE_WB</span></code></dt><dd><p>immediately before the white balance block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_AWB_STATS_TAP_AFTER_WB</span></code></dt><dd><p>immediately after the white balance block</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_awb_config">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_awb_config</span></span></span><a class="headerlink" href="#c.c3_isp_params_awb_config" title="Link to this definition">¶</a><br /></dt>
<dd><p>Stats settings for auto-white balance</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_awb_config {
    struct c3_isp_params_block_header header;
    __u8 tap_point;
    __u8 satur_vald;
    __u8 horiz_zones_num;
    __u8 vert_zones_num;
    __u16 rg_min;
    __u16 rg_max;
    __u16 bg_min;
    __u16 bg_max;
    __u16 rg_low;
    __u16 rg_high;
    __u16 bg_low;
    __u16 bg_high;
    __u8 zone_weight[C3_ISP_AWB_MAX_ZONES];
    __u16 horiz_coord[C3_ISP_AWB_MAX_PT_NUM];
    __u16 vert_coord[C3_ISP_AWB_MAX_PT_NUM];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>the C3 ISP parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tap_point</span></code></dt><dd><p>the tap point from enum c3_isp_params_awb_tap_point</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">satur_vald</span></code></dt><dd><p>AWB statistic over saturation control
value: 0: disable, 1: enable</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">horiz_zones_num</span></code></dt><dd><p>active number of hotizontal zones [0..32]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vert_zones_num</span></code></dt><dd><p>active number of vertical zones [0..24]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rg_min</span></code></dt><dd><p>minimum R/G ratio (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rg_max</span></code></dt><dd><p>maximum R/G ratio (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bg_min</span></code></dt><dd><p>minimum B/G ratio (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bg_max</span></code></dt><dd><p>maximum B/G ratio (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rg_low</span></code></dt><dd><p>R/G ratio trim low (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rg_high</span></code></dt><dd><p>R/G ratio trim hight (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bg_low</span></code></dt><dd><p>B/G ratio trim low (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bg_high</span></code></dt><dd><p>B/G ratio trim high (Q4.8 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">zone_weight</span></code></dt><dd><p>array of weights for AWB statistics zones [0..15]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">horiz_coord</span></code></dt><dd><p>the horizontal coordinate of points on the diagonal [0..2888]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vert_coord</span></code></dt><dd><p>the vertical coordinate of points on the diagonal [0..2240]</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct allows the configuration of the statistics generated for auto
white balance.</p>
<p>header.type should be set to C3_ISP_PARAMS_BLOCK_AWB_CONFIG
from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.c3_isp_params_ae_tap_points">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_ae_tap_points</span></span></span><a class="headerlink" href="#c.c3_isp_params_ae_tap_points" title="Link to this definition">¶</a><br /></dt>
<dd><p>Tap points for the AE statistics</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_AE_STATS_TAP_GE</span></code></dt><dd><p>immediately after the green equal block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_AE_STATS_TAP_MLS</span></code></dt><dd><p>immediately after the mesh lens shading block</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_ae_config">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_ae_config</span></span></span><a class="headerlink" href="#c.c3_isp_params_ae_config" title="Link to this definition">¶</a><br /></dt>
<dd><p>Stats settings for auto-exposure</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_ae_config {
    struct c3_isp_params_block_header header;
    __u8 tap_point;
    __u8 horiz_zones_num;
    __u8 vert_zones_num;
    __u8 zone_weight[C3_ISP_AE_MAX_ZONES];
    __u16 horiz_coord[C3_ISP_AE_MAX_PT_NUM];
    __u16 vert_coord[C3_ISP_AE_MAX_PT_NUM];
    __u16 reserved[3];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>the C3 ISP parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tap_point</span></code></dt><dd><p>the tap point from enum c3_isp_params_ae_tap_point</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">horiz_zones_num</span></code></dt><dd><p>active number of horizontal zones [0..17]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vert_zones_num</span></code></dt><dd><p>active number of vertical zones [0..15]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">zone_weight</span></code></dt><dd><p>array of weights for AE statistics zones [0..15]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">horiz_coord</span></code></dt><dd><p>the horizontal coordinate of points on the diagonal [0..2888]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vert_coord</span></code></dt><dd><p>the vertical coordinate of points on the diagonal [0..2240]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>applications must zero this array</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct allows the configuration of the statistics generated for
auto exposure.</p>
<p>header.type should be set to C3_ISP_PARAMS_BLOCK_AE_CONFIG
from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.c3_isp_params_af_tap_points">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_af_tap_points</span></span></span><a class="headerlink" href="#c.c3_isp_params_af_tap_points" title="Link to this definition">¶</a><br /></dt>
<dd><p>Tap points for the AF statistics</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_AF_STATS_TAP_SNR</span></code></dt><dd><p>immediately after the spatial noise reduce block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">C3_ISP_AF_STATS_TAP_DMS</span></code></dt><dd><p>immediately after the demosaic block</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_af_config">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_af_config</span></span></span><a class="headerlink" href="#c.c3_isp_params_af_config" title="Link to this definition">¶</a><br /></dt>
<dd><p>Stats settings for auto-focus</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_af_config {
    struct c3_isp_params_block_header header;
    __u8 tap_point;
    __u8 horiz_zones_num;
    __u8 vert_zones_num;
    __u8 reserved[5];
    __u16 horiz_coord[C3_ISP_AF_MAX_PT_NUM];
    __u16 vert_coord[C3_ISP_AF_MAX_PT_NUM];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>the C3 ISP parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tap_point</span></code></dt><dd><p>the tap point from enum c3_isp_params_af_tap_point</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">horiz_zones_num</span></code></dt><dd><p>active number of hotizontal zones [0..17]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vert_zones_num</span></code></dt><dd><p>active number of vertical zones [0..15]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>applications must zero this array</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">horiz_coord</span></code></dt><dd><p>the horizontal coordinate of points on the diagonal [0..2888]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vert_coord</span></code></dt><dd><p>the vertical coordinate of points on the diagonal [0..2240]</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct allows the configuration of the statistics generated for
auto focus.</p>
<p>header.type should be set to C3_ISP_PARAMS_BLOCK_AF_CONFIG
from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_pst_gamma">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_pst_gamma</span></span></span><a class="headerlink" href="#c.c3_isp_params_pst_gamma" title="Link to this definition">¶</a><br /></dt>
<dd><p>Post gamma configuration</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_pst_gamma {
    struct c3_isp_params_block_header header;
    __u16 lut[129];
    __u16 reserved[3];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>the C3 ISP parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lut</span></code></dt><dd><p>lookup table for P-Stitch gamma [0..1023]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>applications must zero this array</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct allows the configuration of the look up table for
post gamma. The gamma curve consists of 129 points, so need to
set lut[129].</p>
<p>header.type should be set to C3_ISP_PARAMS_BLOCK_PST_GAMMA
from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_ccm">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_ccm</span></span></span><a class="headerlink" href="#c.c3_isp_params_ccm" title="Link to this definition">¶</a><br /></dt>
<dd><p>ISP CCM configuration</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_ccm {
    struct c3_isp_params_block_header header;
    __s16 matrix[3][3];
    __u16 reserved[3];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>the C3 ISP parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">matrix</span></code></dt><dd><p>a 3 x 3 matrix used for color correction,
the value of matrix[x][y] is orig_value x 256. [-4096..4095]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>applications must zero this array</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct allows the configuration of the matrix for
color correction. The matrix consists of 3 x 3 points,
so need to set matrix[3][3].</p>
<p>header.type should be set to C3_ISP_PARAMS_BLOCK_CCM
from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_csc">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_csc</span></span></span><a class="headerlink" href="#c.c3_isp_params_csc" title="Link to this definition">¶</a><br /></dt>
<dd><p>ISP Color Space Conversion configuration</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_csc {
    struct c3_isp_params_block_header header;
    __s16 matrix[3][3];
    __u16 reserved[3];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>the C3 ISP parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">matrix</span></code></dt><dd><p>a 3x3 matrix used for the color space conversion,
the value of matrix[x][y] is orig_value x 256. [-4096..4095]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>applications must zero this array</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct allows the configuration of the matrix for color space
conversion. The matrix consists of 3 x 3 points, so need to set matrix[3][3].</p>
<p>header.type should be set to C3_ISP_PARAMS_BLOCK_CSC
from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_blc">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_blc</span></span></span><a class="headerlink" href="#c.c3_isp_params_blc" title="Link to this definition">¶</a><br /></dt>
<dd><p>ISP Black Level Correction configuration</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_blc {
    struct c3_isp_params_block_header header;
    __u16 gr_ofst;
    __u16 r_ofst;
    __u16 b_ofst;
    __u16 gb_ofst;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>the C3 ISP parameters block header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gr_ofst</span></code></dt><dd><p>Gr blc offset (Q4.12 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">r_ofst</span></code></dt><dd><p>R blc offset (Q4.12 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">b_ofst</span></code></dt><dd><p>B blc offset (Q4.12 format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gb_ofst</span></code></dt><dd><p>Gb blc offset(Q4.12 format)</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct allows the configuration of the block level offset for each
color channel.</p>
<p>header.type should be set to C3_ISP_PARAMS_BLOCK_BLC
from <a class="reference internal" href="#c.c3_isp_params_block_type" title="c3_isp_params_block_type"><code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_params_block_type</span></code></a></p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.C3_ISP_PARAMS_MAX_SIZE">
<span class="sig-name descname"><span class="n"><span class="pre">C3_ISP_PARAMS_MAX_SIZE</span></span></span><a class="headerlink" href="#c.C3_ISP_PARAMS_MAX_SIZE" title="Link to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">C3_ISP_PARAMS_MAX_SIZE</span></code></p>
<blockquote>
<div><blockquote>
<div><p>Maximum size of all C3 ISP Parameters</p>
</div></blockquote>
<p><strong>Description</strong></p>
<p>Though the parameters for the C3 ISP are passed as optional blocks, the
driver still needs to know the absolute maximum size so that it can allocate
a buffer sized appropriately to accommodate userspace attempting to set all
possible parameters in a single frame.</p>
</div></blockquote>
<dl class="c struct">
<dt class="sig sig-object c" id="c.c3_isp_params_cfg">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">c3_isp_params_cfg</span></span></span><a class="headerlink" href="#c.c3_isp_params_cfg" title="Link to this definition">¶</a><br /></dt>
<dd><p>C3 ISP configuration parameters</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c3_isp_params_cfg {
    __u32 version;
    __u32 data_size;
    __u8 data[C3_ISP_PARAMS_MAX_SIZE];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">version</span></code></dt><dd><p>The C3 ISP parameters buffer version</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data_size</span></code></dt><dd><p>The C3 ISP configuration data effective size, excluding this
header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>The C3 ISP configuration blocks data</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This struct contains the configuration parameters of the C3 ISP
algorithms, serialized by userspace into an opaque data buffer. Each
configuration parameter block is represented by a block-specific structure
which contains a <code class="xref c c-type docutils literal notranslate"><span class="pre">c3_isp_param_block_header</span></code> entry as first
member. Userspace populates the <strong>data</strong> buffer with configuration parameters
for the blocks that it intends to configure. As a consequence, the data
buffer effective size changes according to the number of ISP blocks that
userspace intends to configure.</p>
<p>The parameters buffer is versioned by the <strong>version</strong> field to allow modifying
and extending its definition. Userspace should populate the <strong>version</strong> field to
inform the driver about the version it intends to use. The driver will parse
and handle the <strong>data</strong> buffer according to the data layout specific to the
indicated revision and return an error if the desired revision is not
supported.</p>
<p>For each ISP block that userspace wants to configure, a block-specific
structure is appended to the <strong>data</strong> buffer, one after the other without gaps
in between nor overlaps. Userspace shall populate the <strong>total_size</strong> field with
the effective size, in bytes, of the <strong>data</strong> buffer.</p>
<p>The expected memory layout of the parameters buffer is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+-------------------- struct c3_isp_params_cfg ---- ------------------+
| version = C3_ISP_PARAM_BUFFER_V0;                                   |
| data_size = sizeof(struct c3_isp_params_awb_gains) +                |
|              sizeof(struct c3_isp_params_awb_config);       |
| +------------------------- data  ---------------------------------+ |
| | +------------ struct c3_isp_params_awb_gains) ------------------+ |
| | | +---------  struct c3_isp_params_block_header header -----+ | | |
| | | | type = C3_ISP_PARAMS_BLOCK_AWB_GAINS;                   | | | |
| | | | flags = C3_ISP_PARAMS_BLOCK_FL_NONE;                    | | | |
| | | | size = sizeof(struct c3_isp_params_awb_gains);          | | | |
| | | +---------------------------------------------------------+ | | |
| | | gr_gain = ...;                                              | | |
| | | r_gain = ...;                                               | | |
| | | b_gain = ...;                                               | | |
| | | gb_gain = ...;                                              | | |
| | +------------------ struct c3_isp_params_awb_config ----------+ | |
| | | +---------- struct c3_isp_param_block_header header ------+ | | |
| | | | type = C3_ISP_PARAMS_BLOCK_AWB_CONFIG;                  | | | |
| | | | flags = C3_ISP_PARAMS_BLOCK_FL_NONE;                    | | | |
| | | | size = sizeof(struct c3_isp_params_awb_config)          | | | |
| | | +---------------------------------------------------------+ | | |
| | | tap_point = ...;                                            | | |
| | | satur_vald = ...;                                           | | |
| | | horiz_zones_num = ...;                                      | | |
| | | vert_zones_num = ...;                                       | | |
| | +-------------------------------------------------------------+ | |
| +-----------------------------------------------------------------+ |
+---------------------------------------------------------------------+
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/userspace-api/media/v4l/metafmt-c3-isp.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>