<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.10. Extended Controls API &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="1.11. Camera Control Reference" href="ext-ctrls-camera.html" />
    <link rel="prev" title="1.9. User Controls" href="control.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.16.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Userspace API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#system-calls">System calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#security-related-interfaces">Security-related interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#devices-and-i-o">Devices and I/O</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../accelerators/ocxl.html">OpenCAPI (Open Coherent Accelerator Processor Interface)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dma-buf-heaps.html">Allocating dma-buf using heaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dma-buf-alloc-exchange.html">Exchanging pixel buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../fwctl/index.html">Firmware Control (FWCTL) Userspace API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gpio/index.html">GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../iommufd.html">IOMMUFD</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Linux Media Infrastructure userspace API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dcdbas.html">Dell Systems Management Base Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vduse.html">VDUSE - “vDPA Device in Userspace”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../isapnp.html">ISA Plug &amp; Play support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#everything-else">Everything else</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/userspace-api/media/v4l/extended-controls.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="extended-controls-api">
<span id="extended-controls"></span><h1><span class="section-number">1.10. </span>Extended Controls API<a class="headerlink" href="#extended-controls-api" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2><span class="section-number">1.10.1. </span>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>The control mechanism as originally designed was meant to be used for
user settings (brightness, saturation, etc). However, it turned out to
be a very useful model for implementing more complicated driver APIs
where each driver implements only a subset of a larger API.</p>
<p>The MPEG encoding API was the driving force behind designing and
implementing this extended control mechanism: the MPEG standard is quite
large and the currently supported hardware MPEG encoders each only
implement a subset of this standard. Further more, many parameters
relating to how the video is encoded into an MPEG stream are specific to
the MPEG encoding chip since the MPEG standard only defines the format
of the resulting MPEG stream, not how the video is actually encoded into
that format.</p>
<p>Unfortunately, the original control API lacked some features needed for
these new uses and so it was extended into the (not terribly originally
named) extended control API.</p>
<p>Even though the MPEG encoding API was the first effort to use the
Extended Control API, nowadays there are also other classes of Extended
Controls, such as Camera Controls and FM Transmitter Controls. The
Extended Controls API as well as all Extended Controls classes are
described in the following text.</p>
</section>
<section id="the-extended-control-api">
<h2><span class="section-number">1.10.2. </span>The Extended Control API<a class="headerlink" href="#the-extended-control-api" title="Link to this heading">¶</a></h2>
<p>Three new ioctls are available:
<a class="reference internal" href="vidioc-g-ext-ctrls.html#vidioc-g-ext-ctrls"><span class="std std-ref">VIDIOC_G_EXT_CTRLS</span></a>,
<a class="reference internal" href="vidioc-g-ext-ctrls.html#vidioc-g-ext-ctrls"><span class="std std-ref">VIDIOC_S_EXT_CTRLS</span></a> and
<a class="reference internal" href="vidioc-g-ext-ctrls.html#vidioc-g-ext-ctrls"><span class="std std-ref">VIDIOC_TRY_EXT_CTRLS</span></a>. These ioctls act
on arrays of controls (as opposed to the
<a class="reference internal" href="vidioc-g-ctrl.html#vidioc-g-ctrl"><span class="std std-ref">VIDIOC_G_CTRL</span></a> and
<a class="reference internal" href="vidioc-g-ctrl.html#vidioc-g-ctrl"><span class="std std-ref">VIDIOC_S_CTRL</span></a> ioctls that act on a single
control). This is needed since it is often required to atomically change
several controls at once.</p>
<p>Each of the new ioctls expects a pointer to a struct
<code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ext_controls</span></code>. This structure
contains a pointer to the control array, a count of the number of
controls in that array and a control class. Control classes are used to
group similar controls into a single class. For example, control class
<code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_CLASS_USER</span></code> contains all user controls (i. e. all controls
that can also be set using the old <a class="reference internal" href="vidioc-g-ctrl.html#vidioc-g-ctrl"><span class="std std-ref">VIDIOC_S_CTRL</span></a>
ioctl). Control class <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_CLASS_CODEC</span></code> contains controls
relating to codecs.</p>
<p>All controls in the control array must belong to the specified control
class. An error is returned if this is not the case.</p>
<p>It is also possible to use an empty control array (<code class="docutils literal notranslate"><span class="pre">count</span></code> == 0) to check
whether the specified control class is supported.</p>
<p>The control array is a struct
<code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ext_control</span></code> array. The
struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ext_control</span></code> is very similar to
struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_control</span></code>, except for the fact that
it also allows for 64-bit values and pointers to be passed.</p>
<p>Since the struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_ext_control</span></code> supports
pointers it is now also possible to have controls with compound types
such as N-dimensional arrays and/or structures. You need to specify the
<code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_FLAG_NEXT_COMPOUND</span></code> when enumerating controls to actually
be able to see such compound controls. In other words, these controls
with compound types should only be used programmatically.</p>
<p>Since such compound controls need to expose more information about
themselves than is possible with <a class="reference internal" href="vidioc-queryctrl.html#vidioc-queryctrl"><span class="std std-ref">VIDIOC_QUERYCTRL</span></a>
the <a class="reference internal" href="vidioc-queryctrl.html#vidioc-queryctrl"><span class="std std-ref">VIDIOC_QUERY_EXT_CTRL</span></a> ioctl was added. In
particular, this ioctl gives the dimensions of the N-dimensional array if
this control consists of more than one element.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>It is important to realize that due to the flexibility of controls it is
necessary to check whether the control you want to set actually is
supported in the driver and what the valid range of values is. So use
<a class="reference internal" href="vidioc-queryctrl.html#vidioc-queryctrl"><span class="std std-ref">ioctls VIDIOC_QUERYCTRL, VIDIOC_QUERY_EXT_CTRL and VIDIOC_QUERYMENU</span></a> to check this.</p></li>
<li><p>It is possible that some of the menu indices in a control of
type <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_TYPE_MENU</span></code> may not be supported (<code class="docutils literal notranslate"><span class="pre">VIDIOC_QUERYMENU</span></code>
will return an error). A good example is the list of supported MPEG
audio bitrates. Some drivers only support one or two bitrates, others
support a wider range.</p></li>
</ol>
</div>
<p>All controls use machine endianness.</p>
</section>
<section id="enumerating-extended-controls">
<h2><span class="section-number">1.10.3. </span>Enumerating Extended Controls<a class="headerlink" href="#enumerating-extended-controls" title="Link to this heading">¶</a></h2>
<p>The recommended way to enumerate over the extended controls is by using
<a class="reference internal" href="vidioc-queryctrl.html#vidioc-queryctrl"><span class="std std-ref">ioctls VIDIOC_QUERYCTRL, VIDIOC_QUERY_EXT_CTRL and VIDIOC_QUERYMENU</span></a> in combination with the
<code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_FLAG_NEXT_CTRL</span></code> flag:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">v4l2_queryctrl</span><span class="w"> </span><span class="n">qctrl</span><span class="p">;</span>

<span class="n">qctrl</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V4L2_CTRL_FLAG_NEXT_CTRL</span><span class="p">;</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ioctl</span><span class="w"> </span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">VIDIOC_QUERYCTRL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">qctrl</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* ... */</span>
<span class="w">    </span><span class="n">qctrl</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">V4L2_CTRL_FLAG_NEXT_CTRL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The initial control ID is set to 0 ORed with the
<code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_FLAG_NEXT_CTRL</span></code> flag. The <code class="docutils literal notranslate"><span class="pre">VIDIOC_QUERYCTRL</span></code> ioctl will
return the first control with a higher ID than the specified one. When
no such controls are found an error is returned.</p>
<p>If you want to get all controls within a specific control class, then
you can set the initial <code class="docutils literal notranslate"><span class="pre">qctrl.id</span></code> value to the control class and add
an extra check to break out of the loop when a control of another
control class is found:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">qctrl</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V4L2_CTRL_CLASS_CODEC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">V4L2_CTRL_FLAG_NEXT_CTRL</span><span class="p">;</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">VIDIOC_QUERYCTRL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">qctrl</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">V4L2_CTRL_ID2CLASS</span><span class="p">(</span><span class="n">qctrl</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">V4L2_CTRL_CLASS_CODEC</span><span class="p">)</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* ... */</span>
<span class="w">    </span><span class="n">qctrl</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">V4L2_CTRL_FLAG_NEXT_CTRL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The 32-bit <code class="docutils literal notranslate"><span class="pre">qctrl.id</span></code> value is subdivided into three bit ranges: the
top 4 bits are reserved for flags (e. g. <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_FLAG_NEXT_CTRL</span></code>)
and are not actually part of the ID. The remaining 28 bits form the
control ID, of which the most significant 12 bits define the control
class and the least significant 16 bits identify the control within the
control class. It is guaranteed that these last 16 bits are always
non-zero for controls. The range of 0x1000 and up are reserved for
driver-specific controls. The macro <code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_ID2CLASS(id)</span></code> returns
the control class ID based on a control ID.</p>
<p>If the driver does not support extended controls, then
<code class="docutils literal notranslate"><span class="pre">VIDIOC_QUERYCTRL</span></code> will fail when used in combination with
<code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_FLAG_NEXT_CTRL</span></code>. In that case the old method of enumerating
control should be used (see <a class="reference internal" href="control.html#enum-all-controls"><span class="std std-ref">Example: Enumerating all controls</span></a>). But if it is
supported, then it is guaranteed to enumerate over all controls,
including driver-private controls.</p>
</section>
<section id="creating-control-panels">
<h2><span class="section-number">1.10.4. </span>Creating Control Panels<a class="headerlink" href="#creating-control-panels" title="Link to this heading">¶</a></h2>
<p>It is possible to create control panels for a graphical user interface
where the user can select the various controls. Basically you will have
to iterate over all controls using the method described above. Each
control class starts with a control of type
<code class="docutils literal notranslate"><span class="pre">V4L2_CTRL_TYPE_CTRL_CLASS</span></code>. <code class="docutils literal notranslate"><span class="pre">VIDIOC_QUERYCTRL</span></code> will return the name
of this control class which can be used as the title of a tab page
within a control panel.</p>
<p>The flags field of struct <a class="reference internal" href="vidioc-queryctrl.html#v4l2-queryctrl"><span class="std std-ref">v4l2_queryctrl</span></a> also
contains hints on the behavior of the control. See the
<a class="reference internal" href="vidioc-queryctrl.html#vidioc-queryctrl"><span class="std std-ref">ioctls VIDIOC_QUERYCTRL, VIDIOC_QUERY_EXT_CTRL and VIDIOC_QUERYMENU</span></a> documentation for more
details.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/userspace-api/media/v4l/extended-controls.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>