<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Integrity Policy Enforcement (IPE) &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Landlock: system-wide management" href="landlock.html" />
    <link rel="prev" title="SafeSetID" href="SafeSetID.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.15.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Administration</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#general-guides-to-kernel-administration">General guides to kernel administration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../README.html">Linux kernel release 6.x &lt;http://kernel.org/&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devices.html">Linux allocated devices (4.x+ version)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../features.html">Feature status on all architectures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sysfs-rules.html">Rules on how to access information in sysfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sysctl/index.html">Documentation for /proc/sys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cputopology.html">How CPU topology info is exported via sysfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abi.html">Linux ABI description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hw-vuln/index.html">Hardware vulnerabilities</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Linux Security Module Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../perf-security.html">Perf events and tool security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#booting-the-kernel">Booting the kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tracking-down-and-identifying-problems">Tracking down and identifying problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#core-kernel-subsystems">Core-kernel subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#block-layer-and-filesystem-administration">Block-layer and filesystem administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#device-specific-guides">Device-specific guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#workload-analysis">Workload analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#everything-else">Everything else</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/LSM/ipe.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="integrity-policy-enforcement-ipe">
<h1>Integrity Policy Enforcement (IPE)<a class="headerlink" href="#integrity-policy-enforcement-ipe" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the documentation for admins, system builders, or individuals
attempting to use IPE. If you’re looking for more developer-focused
documentation about IPE please see <a class="reference internal" href="../../security/ipe.html"><span class="doc">the design docs</span></a>.</p>
</div>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Integrity Policy Enforcement (IPE) is a Linux Security Module that takes a
complementary approach to access control. Unlike traditional access control
mechanisms that rely on labels and paths for decision-making, IPE focuses
on the immutable security properties inherent to system components. These
properties are fundamental attributes or features of a system component
that cannot be altered, ensuring a consistent and reliable basis for
security decisions.</p>
<p>To elaborate, in the context of IPE, system components primarily refer to
files or the devices these files reside on. However, this is just a
starting point. The concept of system components is flexible and can be
extended to include new elements as the system evolves. The immutable
properties include the origin of a file, which remains constant and
unchangeable over time. For example, IPE policies can be crafted to trust
files originating from the initramfs. Since initramfs is typically verified
by the bootloader, its files are deemed trustworthy; “file is from
initramfs” becomes an immutable property under IPE’s consideration.</p>
<p>The immutable property concept extends to the security features enabled on
a file’s origin, such as dm-verity or fs-verity, which provide a layer of
integrity and trust. For example, IPE allows the definition of policies
that trust files from a dm-verity protected device. dm-verity ensures the
integrity of an entire device by providing a verifiable and immutable state
of its contents. Similarly, fs-verity offers filesystem-level integrity
checks, allowing IPE to enforce policies that trust files protected by
fs-verity. These two features cannot be turned off once established, so
they are considered immutable properties. These examples demonstrate how
IPE leverages immutable properties, such as a file’s origin and its
integrity protection mechanisms, to make access control decisions.</p>
<p>For the IPE policy, specifically, it grants the ability to enforce
stringent access controls by assessing security properties against
reference values defined within the policy. This assessment can be based on
the existence of a security property (e.g., verifying if a file originates
from initramfs) or evaluating the internal state of an immutable security
property. The latter includes checking the roothash of a dm-verity
protected device, determining whether dm-verity possesses a valid
signature, assessing the digest of a fs-verity protected file, or
determining whether fs-verity possesses a valid built-in signature. This
nuanced approach to policy enforcement enables a highly secure and
customizable system defense mechanism, tailored to specific security
requirements and trust models.</p>
<p>To enable IPE, ensure that <code class="docutils literal notranslate"><span class="pre">CONFIG_SECURITY_IPE</span></code> (under
<span class="menuselection">Security -&gt; Integrity Policy Enforcement (IPE)</span>) config
option is enabled.</p>
</section>
<section id="use-cases">
<h2>Use Cases<a class="headerlink" href="#use-cases" title="Link to this heading">¶</a></h2>
<p>IPE works best in fixed-function devices: devices in which their purpose
is clearly defined and not supposed to be changed (e.g. network firewall
device in a data center, an IoT device, etcetera), where all software and
configuration is built and provisioned by the system owner.</p>
<p>IPE is a long-way off for use in general-purpose computing: the Linux
community as a whole tends to follow a decentralized trust model (known as
the web of trust), which IPE has no support for it yet. Instead, IPE
supports PKI (public key infrastructure), which generally designates a
set of trusted entities that provide a measure of absolute trust.</p>
<p>Additionally, while most packages are signed today, the files inside
the packages (for instance, the executables), tend to be unsigned. This
makes it difficult to utilize IPE in systems where a package manager is
expected to be functional, without major changes to the package manager
and ecosystem behind it.</p>
<p>The digest_cache LSM <a class="footnote-reference brackets" href="#digest-cache-lsm" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> is a system that when combined with IPE,
could be used to enable and support general-purpose computing use cases.</p>
</section>
<section id="known-limitations">
<h2>Known Limitations<a class="headerlink" href="#known-limitations" title="Link to this heading">¶</a></h2>
<p>IPE cannot verify the integrity of anonymous executable memory, such as
the trampolines created by gcc closures and libffi (&lt;3.4.2), or JIT’d code.
Unfortunately, as this is dynamically generated code, there is no way
for IPE to ensure the integrity of this code to form a trust basis.</p>
<p>IPE cannot verify the integrity of programs written in interpreted
languages when these scripts are invoked by passing these program files
to the interpreter. This is because the way interpreters execute these
files; the scripts themselves are not evaluated as executable code
through one of IPE’s hooks, but they are merely text files that are read
(as opposed to compiled executables) <a class="footnote-reference brackets" href="#interpreters" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="threat-model">
<h2>Threat Model<a class="headerlink" href="#threat-model" title="Link to this heading">¶</a></h2>
<p>IPE specifically targets the risk of tampering with user-space executable
code after the kernel has initially booted, including the kernel modules
loaded from userspace via <code class="docutils literal notranslate"><span class="pre">modprobe</span></code> or <code class="docutils literal notranslate"><span class="pre">insmod</span></code>.</p>
<p>To illustrate, consider a scenario where an untrusted binary, possibly
malicious, is downloaded along with all necessary dependencies, including a
loader and libc. The primary function of IPE in this context is to prevent
the execution of such binaries and their dependencies.</p>
<p>IPE achieves this by verifying the integrity and authenticity of all
executable code before allowing them to run. It conducts a thorough
check to ensure that the code’s integrity is intact and that they match an
authorized reference value (digest, signature, etc) as per the defined
policy. If a binary does not pass this verification process, either
because its integrity has been compromised or it does not meet the
authorization criteria, IPE will deny its execution. Additionally, IPE
generates audit logs which may be utilized to detect and analyze failures
resulting from policy violation.</p>
<p>Tampering threat scenarios include modification or replacement of
executable code by a range of actors including:</p>
<ul class="simple">
<li><p>Actors with physical access to the hardware</p></li>
<li><p>Actors with local network access to the system</p></li>
<li><p>Actors with access to the deployment system</p></li>
<li><p>Compromised internal systems under external control</p></li>
<li><p>Malicious end users of the system</p></li>
<li><p>Compromised end users of the system</p></li>
<li><p>Remote (external) compromise of the system</p></li>
</ul>
<p>IPE does not mitigate threats arising from malicious but authorized
developers (with access to a signing certificate), or compromised
developer tools used by them (i.e. return-oriented programming attacks).
Additionally, IPE draws hard security boundary between userspace and
kernelspace. As a result, kernel-level exploits are considered outside
the scope of IPE and mitigation is left to other mechanisms.</p>
</section>
<section id="policy">
<h2>Policy<a class="headerlink" href="#policy" title="Link to this heading">¶</a></h2>
<p>IPE policy is a plain-text <a class="footnote-reference brackets" href="#devdoc" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> policy composed of multiple statements
over several lines. There is one required line, at the top of the
policy, indicating the policy name, and the policy version, for
instance:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policy_name=Ex_Policy policy_version=0.0.0
</pre></div>
</div>
<p>The policy name is a unique key identifying this policy in a human
readable name. This is used to create nodes under securityfs as well as
uniquely identify policies to deploy new policies vs update existing
policies.</p>
<p>The policy version indicates the current version of the policy (NOT the
policy syntax version). This is used to prevent rollback of policy to
potentially insecure previous versions of the policy.</p>
<p>The next portion of IPE policy are rules. Rules are formed by key=value
pairs, known as properties. IPE rules require two properties: <code class="docutils literal notranslate"><span class="pre">action</span></code>,
which determines what IPE does when it encounters a match against the
rule, and <code class="docutils literal notranslate"><span class="pre">op</span></code>, which determines when the rule should be evaluated.
The ordering is significant, a rule must start with <code class="docutils literal notranslate"><span class="pre">op</span></code>, and end with
<code class="docutils literal notranslate"><span class="pre">action</span></code>. Thus, a minimal rule is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>op=EXECUTE action=ALLOW
</pre></div>
</div>
<p>This example will allow any execution. Additional properties are used to
assess immutable security properties about the files being evaluated.
These properties are intended to be descriptions of systems within the
kernel that can provide a measure of integrity verification, such that IPE
can determine the trust of the resource based on the value of the property.</p>
<p>Rules are evaluated top-to-bottom. As a result, any revocation rules,
or denies should be placed early in the file to ensure that these rules
are evaluated before a rule with <code class="docutils literal notranslate"><span class="pre">action=ALLOW</span></code>.</p>
<p>IPE policy supports comments. The character ‘#’ will function as a
comment, ignoring all characters to the right of ‘#’ until the newline.</p>
<p>The default behavior of IPE evaluations can also be expressed in policy,
through the <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> statement. This can be done at a global level,
or a per-operation level:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Global
DEFAULT action=ALLOW

# Operation Specific
DEFAULT op=EXECUTE action=ALLOW
</pre></div>
</div>
<p>A default must be set for all known operations in IPE. If you want to
preserve older policies being compatible with newer kernels that can introduce
new operations, set a global default of <code class="docutils literal notranslate"><span class="pre">ALLOW</span></code>, then override the
defaults on a per-operation basis (as above).</p>
<p>With configurable policy-based LSMs, there’s several issues with
enforcing the configurable policies at startup, around reading and
parsing the policy:</p>
<ol class="arabic simple">
<li><p>The kernel <em>should</em> not read files from userspace, so directly reading
the policy file is prohibited.</p></li>
<li><p>The kernel command line has a character limit, and one kernel module
should not reserve the entire character limit for its own
configuration.</p></li>
<li><p>There are various boot loaders in the kernel ecosystem, so handing
off a memory block would be costly to maintain.</p></li>
</ol>
<p>As a result, IPE has addressed this problem through a concept of a “boot
policy”. A boot policy is a minimal policy which is compiled into the
kernel. This policy is intended to get the system to a state where
userspace is set up and ready to receive commands, at which point a more
complex policy can be deployed via securityfs. The boot policy can be
specified via <code class="docutils literal notranslate"><span class="pre">SECURITY_IPE_BOOT_POLICY</span></code> config option, which accepts
a path to a plain-text version of the IPE policy to apply. This policy
will be compiled into the kernel. If not specified, IPE will be disabled
until a policy is deployed and activated through securityfs.</p>
<section id="deploying-policies">
<h3>Deploying Policies<a class="headerlink" href="#deploying-policies" title="Link to this heading">¶</a></h3>
<p>Policies can be deployed from userspace through securityfs. These policies
are signed through the PKCS#7 message format to enforce some level of
authorization of the policies (prohibiting an attacker from gaining
unconstrained root, and deploying an “allow all” policy). These
policies must be signed by a certificate that chains to the
<code class="docutils literal notranslate"><span class="pre">SYSTEM_TRUSTED_KEYRING</span></code>, or to the secondary and/or platform keyrings if
<code class="docutils literal notranslate"><span class="pre">CONFIG_IPE_POLICY_SIG_SECONDARY_KEYRING</span></code> and/or
<code class="docutils literal notranslate"><span class="pre">CONFIG_IPE_POLICY_SIG_PLATFORM_KEYRING</span></code> are enabled, respectively.
With openssl, the policy can be signed by:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl smime -sign \
   -in &quot;$MY_POLICY&quot; \
   -signer &quot;$MY_CERTIFICATE&quot; \
   -inkey &quot;$MY_PRIVATE_KEY&quot; \
   -noattr \
   -nodetach \
   -nosmimecap \
   -outform der \
   -out &quot;$MY_POLICY.p7b&quot;
</pre></div>
</div>
<p>Deploying the policies is done through securityfs, through the
<code class="docutils literal notranslate"><span class="pre">new_policy</span></code> node. To deploy a policy, simply cat the file into the
securityfs node:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &quot;$MY_POLICY.p7b&quot; &gt; /sys/kernel/security/ipe/new_policy
</pre></div>
</div>
<p>Upon success, this will create one subdirectory under
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/security/ipe/policies/</span></code>. The subdirectory will be the
<code class="docutils literal notranslate"><span class="pre">policy_name</span></code> field of the policy deployed, so for the example above,
the directory will be <code class="docutils literal notranslate"><span class="pre">/sys/kernel/security/ipe/policies/Ex_Policy</span></code>.
Within this directory, there will be seven files: <code class="docutils literal notranslate"><span class="pre">pkcs7</span></code>, <code class="docutils literal notranslate"><span class="pre">policy</span></code>,
<code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">version</span></code>, <code class="docutils literal notranslate"><span class="pre">active</span></code>, <code class="docutils literal notranslate"><span class="pre">update</span></code>, and <code class="docutils literal notranslate"><span class="pre">delete</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pkcs7</span></code> file is read-only. Reading it returns the raw PKCS#7 data
that was provided to the kernel, representing the policy. If the policy being
read is the boot policy, this will return <code class="docutils literal notranslate"><span class="pre">ENOENT</span></code>, as it is not signed.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">policy</span></code> file is read only. Reading it returns the PKCS#7 inner
content of the policy, which will be the plain text policy.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">active</span></code> file is used to set a policy as the currently active policy.
This file is rw, and accepts a value of <code class="docutils literal notranslate"><span class="pre">&quot;1&quot;</span></code> to set the policy as active.
Since only a single policy can be active at one time, all other policies
will be marked inactive. The policy being marked active must have a policy
version greater or equal to the currently-running version.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">update</span></code> file is used to update a policy that is already present
in the kernel. This file is write-only and accepts a PKCS#7 signed
policy. Two checks will always be performed on this policy: First, the
<code class="docutils literal notranslate"><span class="pre">policy_names</span></code> must match with the updated version and the existing
version. Second the updated policy must have a policy version greater than
the currently-running version. This is to prevent rollback attacks.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">delete</span></code> file is used to remove a policy that is no longer needed.
This file is write-only and accepts a value of <code class="docutils literal notranslate"><span class="pre">1</span></code> to delete the policy.
On deletion, the securityfs node representing the policy will be removed.
However, delete the current active policy is not allowed and will return
an operation not permitted error.</p>
<p>Similarly, writing to both <code class="docutils literal notranslate"><span class="pre">update</span></code> and <code class="docutils literal notranslate"><span class="pre">new_policy</span></code> could result in
bad message(policy syntax error) or file exists error. The latter error happens
when trying to deploy a policy with a <code class="docutils literal notranslate"><span class="pre">policy_name</span></code> while the kernel already
has a deployed policy with the same <code class="docutils literal notranslate"><span class="pre">policy_name</span></code>.</p>
<p>Deploying a policy will <em>not</em> cause IPE to start enforcing the policy. IPE will
only enforce the policy marked active. Note that only one policy can be active
at a time.</p>
<p>Once deployment is successful, the policy can be activated, by writing file
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/security/ipe/policies/$policy_name/active</span></code>.
For example, the <code class="docutils literal notranslate"><span class="pre">Ex_Policy</span></code> can be activated by:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 1 &gt; &quot;/sys/kernel/security/ipe/policies/Ex_Policy/active&quot;
</pre></div>
</div>
<p>From above point on, <code class="docutils literal notranslate"><span class="pre">Ex_Policy</span></code> is now the enforced policy on the
system.</p>
<p>IPE also provides a way to delete policies. This can be done via the
<code class="docutils literal notranslate"><span class="pre">delete</span></code> securityfs node,
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/security/ipe/policies/$policy_name/delete</span></code>.
Writing <code class="docutils literal notranslate"><span class="pre">1</span></code> to that file deletes the policy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 1 &gt; &quot;/sys/kernel/security/ipe/policies/$policy_name/delete&quot;
</pre></div>
</div>
<p>There is only one requirement to delete a policy: the policy being deleted
must be inactive.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a traditional MAC system is enabled (SELinux, apparmor, smack), all
writes to ipe’s securityfs nodes require <code class="docutils literal notranslate"><span class="pre">CAP_MAC_ADMIN</span></code>.</p>
</div>
</section>
<section id="modes">
<h3>Modes<a class="headerlink" href="#modes" title="Link to this heading">¶</a></h3>
<p>IPE supports two modes of operation: permissive (similar to SELinux’s
permissive mode) and enforced. In permissive mode, all events are
checked and policy violations are logged, but the policy is not really
enforced. This allows users to test policies before enforcing them.</p>
<p>The default mode is enforce, and can be changed via the kernel command
line parameter <code class="docutils literal notranslate"><span class="pre">ipe.enforce=(0|1)</span></code>, or the securityfs node
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/security/ipe/enforce</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a traditional MAC system is enabled (SELinux, apparmor, smack, etcetera),
all writes to ipe’s securityfs nodes require <code class="docutils literal notranslate"><span class="pre">CAP_MAC_ADMIN</span></code>.</p>
</div>
</section>
<section id="audit-events">
<h3>Audit Events<a class="headerlink" href="#audit-events" title="Link to this heading">¶</a></h3>
<section id="audit-ipe-access">
<h4>1420 AUDIT_IPE_ACCESS<a class="headerlink" href="#audit-ipe-access" title="Link to this heading">¶</a></h4>
<p>Event Examples:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type=1420 audit(1653364370.067:61): ipe_op=EXECUTE ipe_hook=MMAP enforcing=1 pid=2241 comm=&quot;ld-linux.so&quot; path=&quot;/deny/lib/libc.so.6&quot; dev=&quot;sda2&quot; ino=14549020 rule=&quot;DEFAULT action=DENY&quot;
type=1300 audit(1653364370.067:61): SYSCALL arch=c000003e syscall=9 success=no exit=-13 a0=7f1105a28000 a1=195000 a2=5 a3=812 items=0 ppid=2219 pid=2241 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=2 comm=&quot;ld-linux.so&quot; exe=&quot;/tmp/ipe-test/lib/ld-linux.so&quot; subj=unconfined key=(null)
type=1327 audit(1653364370.067:61): 707974686F6E3300746573742F6D61696E2E7079002D6E00

type=1420 audit(1653364735.161:64): ipe_op=EXECUTE ipe_hook=MMAP enforcing=1 pid=2472 comm=&quot;mmap_test&quot; path=? dev=? ino=? rule=&quot;DEFAULT action=DENY&quot;
type=1300 audit(1653364735.161:64): SYSCALL arch=c000003e syscall=9 success=no exit=-13 a0=0 a1=1000 a2=4 a3=21 items=0 ppid=2219 pid=2472 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=2 comm=&quot;mmap_test&quot; exe=&quot;/root/overlake_test/upstream_test/vol_fsverity/bin/mmap_test&quot; subj=unconfined key=(null)
type=1327 audit(1653364735.161:64): 707974686F6E3300746573742F6D61696E2E7079002D6E00
</pre></div>
</div>
<p>This event indicates that IPE made an access control decision; the IPE
specific record (1420) is always emitted in conjunction with a
<code class="docutils literal notranslate"><span class="pre">AUDITSYSCALL</span></code> record.</p>
<p>Determining whether IPE is in permissive or enforced mode can be derived
from <code class="docutils literal notranslate"><span class="pre">success</span></code> property and exit code of the <code class="docutils literal notranslate"><span class="pre">AUDITSYSCALL</span></code> record.</p>
<p>Field descriptions:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value Type</p></th>
<th class="head"><p>Optional?</p></th>
<th class="head"><p>Description of Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ipe_op</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The IPE operation name associated with the log</p></td>
</tr>
<tr class="row-odd"><td><p>ipe_hook</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The name of the LSM hook that triggered the IPE event</p></td>
</tr>
<tr class="row-even"><td><p>enforcing</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The current IPE enforcing state 1 is in enforcing mode, 0 is in permissive mode</p></td>
</tr>
<tr class="row-odd"><td><p>pid</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The pid of the process that triggered the IPE event.</p></td>
</tr>
<tr class="row-even"><td><p>comm</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The command line program name of the process that triggered the IPE event</p></td>
</tr>
<tr class="row-odd"><td><p>path</p></td>
<td><p>string</p></td>
<td><p>Yes</p></td>
<td><p>The absolute path to the evaluated file</p></td>
</tr>
<tr class="row-even"><td><p>ino</p></td>
<td><p>integer</p></td>
<td><p>Yes</p></td>
<td><p>The inode number of the evaluated file</p></td>
</tr>
<tr class="row-odd"><td><p>dev</p></td>
<td><p>string</p></td>
<td><p>Yes</p></td>
<td><p>The device name of the evaluated file, e.g. vda</p></td>
</tr>
<tr class="row-even"><td><p>rule</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The matched policy rule</p></td>
</tr>
</tbody>
</table>
</section>
<section id="audit-ipe-config-change">
<h4>1421 AUDIT_IPE_CONFIG_CHANGE<a class="headerlink" href="#audit-ipe-config-change" title="Link to this heading">¶</a></h4>
<p>Event Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type=1421 audit(1653425583.136:54): old_active_pol_name=&quot;Allow_All&quot; old_active_pol_version=0.0.0 old_policy_digest=sha256:E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855 new_active_pol_name=&quot;boot_verified&quot; new_active_pol_version=0.0.0 new_policy_digest=sha256:820EEA5B40CA42B51F68962354BA083122A20BB846F26765076DD8EED7B8F4DB auid=4294967295 ses=4294967295 lsm=ipe res=1
type=1300 audit(1653425583.136:54): SYSCALL arch=c000003e syscall=1 success=yes exit=2 a0=3 a1=5596fcae1fb0 a2=2 a3=2 items=0 ppid=184 pid=229 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=4294967295 comm=&quot;python3&quot; exe=&quot;/usr/bin/python3.10&quot; key=(null)
type=1327 audit(1653425583.136:54): PROCTITLE proctitle=707974686F6E3300746573742F6D61696E2E7079002D66002E2
</pre></div>
</div>
<p>This event indicates that IPE switched the active poliy from one to another
along with the version and the hash digest of the two policies.
Note IPE can only have one policy active at a time, all access decision
evaluation is based on the current active policy.
The normal procedure to deploy a new policy is loading the policy to deploy
into the kernel first, then switch the active policy to it.</p>
<p>This record will always be emitted in conjunction with a <code class="docutils literal notranslate"><span class="pre">AUDITSYSCALL</span></code> record for the <code class="docutils literal notranslate"><span class="pre">write</span></code> syscall.</p>
<p>Field descriptions:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value Type</p></th>
<th class="head"><p>Optional?</p></th>
<th class="head"><p>Description of Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>old_active_pol_name</p></td>
<td><p>string</p></td>
<td><p>Yes</p></td>
<td><p>The name of previous active policy</p></td>
</tr>
<tr class="row-odd"><td><p>old_active_pol_version</p></td>
<td><p>string</p></td>
<td><p>Yes</p></td>
<td><p>The version of previous active policy</p></td>
</tr>
<tr class="row-even"><td><p>old_policy_digest</p></td>
<td><p>string</p></td>
<td><p>Yes</p></td>
<td><p>The hash of previous active policy</p></td>
</tr>
<tr class="row-odd"><td><p>new_active_pol_name</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The name of current active policy</p></td>
</tr>
<tr class="row-even"><td><p>new_active_pol_version</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The version of current active policy</p></td>
</tr>
<tr class="row-odd"><td><p>new_policy_digest</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The hash of current active policy</p></td>
</tr>
<tr class="row-even"><td><p>auid</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The login user ID</p></td>
</tr>
<tr class="row-odd"><td><p>ses</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The login session ID</p></td>
</tr>
<tr class="row-even"><td><p>lsm</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The lsm name associated with the event</p></td>
</tr>
<tr class="row-odd"><td><p>res</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The result of the audited operation(success/fail)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="audit-ipe-policy-load">
<h4>1422 AUDIT_IPE_POLICY_LOAD<a class="headerlink" href="#audit-ipe-policy-load" title="Link to this heading">¶</a></h4>
<p>Event Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type=1422 audit(1653425529.927:53): policy_name=&quot;boot_verified&quot; policy_version=0.0.0 policy_digest=sha256:820EEA5B40CA42B51F68962354BA083122A20BB846F26765076DD8EED7B8F4DB auid=4294967295 ses=4294967295 lsm=ipe res=1
type=1300 audit(1653425529.927:53): arch=c000003e syscall=1 success=yes exit=2567 a0=3 a1=5596fcae1fb0 a2=a07 a3=2 items=0 ppid=184 pid=229 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts0 ses=4294967295 comm=&quot;python3&quot; exe=&quot;/usr/bin/python3.10&quot; key=(null)
type=1327 audit(1653425529.927:53): PROCTITLE proctitle=707974686F6E3300746573742F6D61696E2E7079002D66002E2E
</pre></div>
</div>
<p>This record indicates a new policy has been loaded into the kernel with the policy name, policy version and policy hash.</p>
<p>This record will always be emitted in conjunction with a <code class="docutils literal notranslate"><span class="pre">AUDITSYSCALL</span></code> record for the <code class="docutils literal notranslate"><span class="pre">write</span></code> syscall.</p>
<p>Field descriptions:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value Type</p></th>
<th class="head"><p>Optional?</p></th>
<th class="head"><p>Description of Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>policy_name</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The policy_name</p></td>
</tr>
<tr class="row-odd"><td><p>policy_version</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The policy_version</p></td>
</tr>
<tr class="row-even"><td><p>policy_digest</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The policy hash</p></td>
</tr>
<tr class="row-odd"><td><p>auid</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The login user ID</p></td>
</tr>
<tr class="row-even"><td><p>ses</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The login session ID</p></td>
</tr>
<tr class="row-odd"><td><p>lsm</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The lsm name associated with the event</p></td>
</tr>
<tr class="row-even"><td><p>res</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The result of the audited operation(success/fail)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="audit-mac-status">
<h4>1404 AUDIT_MAC_STATUS<a class="headerlink" href="#audit-mac-status" title="Link to this heading">¶</a></h4>
<p>Event Examples:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type=1404 audit(1653425689.008:55): enforcing=0 old_enforcing=1 auid=4294967295 ses=4294967295 enabled=1 old-enabled=1 lsm=ipe res=1
type=1300 audit(1653425689.008:55): arch=c000003e syscall=1 success=yes exit=2 a0=1 a1=55c1065e5c60 a2=2 a3=0 items=0 ppid=405 pid=441 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=)
type=1327 audit(1653425689.008:55): proctitle=&quot;-bash&quot;

type=1404 audit(1653425689.008:55): enforcing=1 old_enforcing=0 auid=4294967295 ses=4294967295 enabled=1 old-enabled=1 lsm=ipe res=1
type=1300 audit(1653425689.008:55): arch=c000003e syscall=1 success=yes exit=2 a0=1 a1=55c1065e5c60 a2=2 a3=0 items=0 ppid=405 pid=441 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=)
type=1327 audit(1653425689.008:55): proctitle=&quot;-bash&quot;
</pre></div>
</div>
<p>This record will always be emitted in conjunction with a <code class="docutils literal notranslate"><span class="pre">AUDITSYSCALL</span></code> record for the <code class="docutils literal notranslate"><span class="pre">write</span></code> syscall.</p>
<p>Field descriptions:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value Type</p></th>
<th class="head"><p>Optional?</p></th>
<th class="head"><p>Description of Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enforcing</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The enforcing state IPE is being switched to, 1 is in enforcing mode, 0 is in permissive mode</p></td>
</tr>
<tr class="row-odd"><td><p>old_enforcing</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The enforcing state IPE is being switched from, 1 is in enforcing mode, 0 is in permissive mode</p></td>
</tr>
<tr class="row-even"><td><p>auid</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The login user ID</p></td>
</tr>
<tr class="row-odd"><td><p>ses</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The login session ID</p></td>
</tr>
<tr class="row-even"><td><p>enabled</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The new TTY audit enabled setting</p></td>
</tr>
<tr class="row-odd"><td><p>old-enabled</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The old TTY audit enabled setting</p></td>
</tr>
<tr class="row-even"><td><p>lsm</p></td>
<td><p>string</p></td>
<td><p>No</p></td>
<td><p>The lsm name associated with the event</p></td>
</tr>
<tr class="row-odd"><td><p>res</p></td>
<td><p>integer</p></td>
<td><p>No</p></td>
<td><p>The result of the audited operation(success/fail)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="success-auditing">
<h4>Success Auditing<a class="headerlink" href="#success-auditing" title="Link to this heading">¶</a></h4>
<p>IPE supports success auditing. When enabled, all events that pass IPE
policy and are not blocked will emit an audit event. This is disabled by
default, and can be enabled via the kernel command line
<code class="docutils literal notranslate"><span class="pre">ipe.success_audit=(0|1)</span></code> or
<code class="docutils literal notranslate"><span class="pre">/sys/kernel/security/ipe/success_audit</span></code> securityfs file.</p>
<p>This is <em>very</em> noisy, as IPE will check every userspace binary on the
system, but is useful for debugging policies.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a traditional MAC system is enabled (SELinux, apparmor, smack, etcetera),
all writes to ipe’s securityfs nodes require <code class="docutils literal notranslate"><span class="pre">CAP_MAC_ADMIN</span></code>.</p>
</div>
</section>
</section>
</section>
<section id="properties">
<h2>Properties<a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<p>As explained above, IPE properties are <code class="docutils literal notranslate"><span class="pre">key=value</span></code> pairs expressed in IPE
policy. Two properties are built-into the policy parser: ‘op’ and ‘action’.
The other properties are used to restrict immutable security properties
about the files being evaluated. Currently those properties are:
‘<code class="docutils literal notranslate"><span class="pre">boot_verified</span></code>’, ‘<code class="docutils literal notranslate"><span class="pre">dmverity_signature</span></code>’, ‘<code class="docutils literal notranslate"><span class="pre">dmverity_roothash</span></code>’,
‘<code class="docutils literal notranslate"><span class="pre">fsverity_signature</span></code>’, ‘<code class="docutils literal notranslate"><span class="pre">fsverity_digest</span></code>’. A description of all
properties supported by IPE are listed below:</p>
<section id="op">
<h3>op<a class="headerlink" href="#op" title="Link to this heading">¶</a></h3>
<p>Indicates the operation for a rule to apply to. Must be in every rule,
as the first token. IPE supports the following operations:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">EXECUTE</span></code></p>
<blockquote>
<div><p>Pertains to any file attempting to be executed, or loaded as an
executable.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">FIRMWARE</span></code>:</p>
<blockquote>
<div><p>Pertains to firmware being loaded via the firmware_class interface.
This covers both the preallocated buffer and the firmware file
itself.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">KMODULE</span></code>:</p>
<blockquote>
<div><p>Pertains to loading kernel modules via <code class="docutils literal notranslate"><span class="pre">modprobe</span></code> or <code class="docutils literal notranslate"><span class="pre">insmod</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">KEXEC_IMAGE</span></code>:</p>
<blockquote>
<div><p>Pertains to kernel images loading via <code class="docutils literal notranslate"><span class="pre">kexec</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">KEXEC_INITRAMFS</span></code></p>
<blockquote>
<div><p>Pertains to initrd images loading via <code class="docutils literal notranslate"><span class="pre">kexec</span> <span class="pre">--initrd</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">POLICY</span></code>:</p>
<blockquote>
<div><p>Controls loading policies via reading a kernel-space initiated read.</p>
<p>An example of such is loading IMA policies by writing the path
to the policy file to <code class="docutils literal notranslate"><span class="pre">$securityfs/ima/policy</span></code></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">X509_CERT</span></code>:</p>
<blockquote>
<div><p>Controls loading IMA certificates through the Kconfigs,
<code class="docutils literal notranslate"><span class="pre">CONFIG_IMA_X509_PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">CONFIG_EVM_X509_PATH</span></code>.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="action">
<h3>action<a class="headerlink" href="#action" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>Determines what IPE should do when a rule matches. Must be in every
rule, as the final clause. Can be one of:</p>
<p><code class="docutils literal notranslate"><span class="pre">ALLOW</span></code>:</p>
<blockquote>
<div><p>If the rule matches, explicitly allow access to the resource to proceed
without executing any more rules.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DENY</span></code>:</p>
<blockquote>
<div><p>If the rule matches, explicitly prohibit access to the resource to
proceed without executing any more rules.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="boot-verified">
<h3>boot_verified<a class="headerlink" href="#boot-verified" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>This property can be utilized for authorization of files from initramfs.
The format of this property is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>boot_verified=(TRUE|FALSE)
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This property will trust files from initramfs(rootfs). It should
only be used during early booting stage. Before mounting the real
rootfs on top of the initramfs, initramfs script will recursively
remove all files and directories on the initramfs. This is typically
implemented by using switch_root(8) <a class="footnote-reference brackets" href="#switch-root" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. Therefore the
initramfs will be empty and not accessible after the real
rootfs takes over. It is advised to switch to a different policy
that doesn’t rely on the property after this point.
This ensures that the trust policies remain relevant and effective
throughout the system’s operation.</p>
</div>
</div></blockquote>
</section>
<section id="dmverity-roothash">
<h3>dmverity_roothash<a class="headerlink" href="#dmverity-roothash" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>This property can be utilized for authorization or revocation of
specific dm-verity volumes, identified via their root hashes. It has a
dependency on the DM_VERITY module. This property is controlled by
the <code class="docutils literal notranslate"><span class="pre">IPE_PROP_DM_VERITY</span></code> config option, it will be automatically
selected when <code class="docutils literal notranslate"><span class="pre">SECURITY_IPE</span></code> and <code class="docutils literal notranslate"><span class="pre">DM_VERITY</span></code> are all enabled.
The format of this property is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dmverity_roothash=DigestName:HexadecimalString
</pre></div>
</div>
<p>The supported DigestNames for dmverity_roothash are <a class="footnote-reference brackets" href="#dmveritydigests" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p>
<blockquote>
<div><ul class="simple">
<li><p>blake2b-512</p></li>
<li><p>blake2s-256</p></li>
<li><p>sha256</p></li>
<li><p>sha384</p></li>
<li><p>sha512</p></li>
<li><p>sha3-224</p></li>
<li><p>sha3-256</p></li>
<li><p>sha3-384</p></li>
<li><p>sha3-512</p></li>
<li><p>sm3</p></li>
<li><p>rmd160</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="dmverity-signature">
<h3>dmverity_signature<a class="headerlink" href="#dmverity-signature" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>This property can be utilized for authorization of all dm-verity
volumes that have a signed roothash that validated by a keyring
specified by dm-verity’s configuration, either the system trusted
keyring, or the secondary keyring. It depends on
<code class="docutils literal notranslate"><span class="pre">DM_VERITY_VERIFY_ROOTHASH_SIG</span></code> config option and is controlled by
the <code class="docutils literal notranslate"><span class="pre">IPE_PROP_DM_VERITY_SIGNATURE</span></code> config option, it will be automatically
selected when <code class="docutils literal notranslate"><span class="pre">SECURITY_IPE</span></code>, <code class="docutils literal notranslate"><span class="pre">DM_VERITY</span></code> and
<code class="docutils literal notranslate"><span class="pre">DM_VERITY_VERIFY_ROOTHASH_SIG</span></code> are all enabled.
The format of this property is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dmverity_signature=(TRUE|FALSE)
</pre></div>
</div>
</div></blockquote>
</section>
<section id="fsverity-digest">
<h3>fsverity_digest<a class="headerlink" href="#fsverity-digest" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>This property can be utilized for authorization of specific fsverity
enabled files, identified via their fsverity digests.
It depends on <code class="docutils literal notranslate"><span class="pre">FS_VERITY</span></code> config option and is controlled by
the <code class="docutils literal notranslate"><span class="pre">IPE_PROP_FS_VERITY</span></code> config option, it will be automatically
selected when <code class="docutils literal notranslate"><span class="pre">SECURITY_IPE</span></code> and <code class="docutils literal notranslate"><span class="pre">FS_VERITY</span></code> are all enabled.
The format of this property is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fsverity_digest=DigestName:HexadecimalString
</pre></div>
</div>
<p>The supported DigestNames for fsverity_digest are <a class="footnote-reference brackets" href="#fsveritydigest" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a></p>
<blockquote>
<div><ul class="simple">
<li><p>sha256</p></li>
<li><p>sha512</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="fsverity-signature">
<h3>fsverity_signature<a class="headerlink" href="#fsverity-signature" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>This property is used to authorize all fs-verity enabled files that have
been verified by fs-verity’s built-in signature mechanism. The signature
verification relies on a key stored within the “.fs-verity” keyring. It
depends on <code class="docutils literal notranslate"><span class="pre">FS_VERITY_BUILTIN_SIGNATURES</span></code> config option and
it is controlled by the <code class="docutils literal notranslate"><span class="pre">IPE_PROP_FS_VERITY</span></code> config option,
it will be automatically selected when <code class="docutils literal notranslate"><span class="pre">SECURITY_IPE</span></code>, <code class="docutils literal notranslate"><span class="pre">FS_VERITY</span></code>
and <code class="docutils literal notranslate"><span class="pre">FS_VERITY_BUILTIN_SIGNATURES</span></code> are all enabled.
The format of this property is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fsverity_signature=(TRUE|FALSE)
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="policy-examples">
<h2>Policy Examples<a class="headerlink" href="#policy-examples" title="Link to this heading">¶</a></h2>
<section id="allow-all">
<h3>Allow all<a class="headerlink" href="#allow-all" title="Link to this heading">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policy_name=Allow_All policy_version=0.0.0
DEFAULT action=ALLOW
</pre></div>
</div>
</section>
<section id="allow-only-initramfs">
<h3>Allow only initramfs<a class="headerlink" href="#allow-only-initramfs" title="Link to this heading">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policy_name=Allow_Initramfs policy_version=0.0.0
DEFAULT action=DENY

op=EXECUTE boot_verified=TRUE action=ALLOW
</pre></div>
</div>
</section>
<section id="allow-any-signed-and-validated-dm-verity-volume-and-the-initramfs">
<h3>Allow any signed and validated dm-verity volume and the initramfs<a class="headerlink" href="#allow-any-signed-and-validated-dm-verity-volume-and-the-initramfs" title="Link to this heading">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policy_name=Allow_Signed_DMV_And_Initramfs policy_version=0.0.0
DEFAULT action=DENY

op=EXECUTE boot_verified=TRUE action=ALLOW
op=EXECUTE dmverity_signature=TRUE action=ALLOW
</pre></div>
</div>
</section>
<section id="prohibit-execution-from-a-specific-dm-verity-volume">
<h3>Prohibit execution from a specific dm-verity volume<a class="headerlink" href="#prohibit-execution-from-a-specific-dm-verity-volume" title="Link to this heading">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policy_name=Deny_DMV_By_Roothash policy_version=0.0.0
DEFAULT action=DENY

op=EXECUTE dmverity_roothash=sha256:cd2c5bae7c6c579edaae4353049d58eb5f2e8be0244bf05345bc8e5ed257baff action=DENY

op=EXECUTE boot_verified=TRUE action=ALLOW
op=EXECUTE dmverity_signature=TRUE action=ALLOW
</pre></div>
</div>
</section>
<section id="allow-only-a-specific-dm-verity-volume">
<h3>Allow only a specific dm-verity volume<a class="headerlink" href="#allow-only-a-specific-dm-verity-volume" title="Link to this heading">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policy_name=Allow_DMV_By_Roothash policy_version=0.0.0
DEFAULT action=DENY

op=EXECUTE dmverity_roothash=sha256:401fcec5944823ae12f62726e8184407a5fa9599783f030dec146938 action=ALLOW
</pre></div>
</div>
</section>
<section id="allow-any-fs-verity-file-with-a-valid-built-in-signature">
<h3>Allow any fs-verity file with a valid built-in signature<a class="headerlink" href="#allow-any-fs-verity-file-with-a-valid-built-in-signature" title="Link to this heading">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policy_name=Allow_Signed_And_Validated_FSVerity policy_version=0.0.0
DEFAULT action=DENY

op=EXECUTE fsverity_signature=TRUE action=ALLOW
</pre></div>
</div>
</section>
<section id="allow-execution-of-a-specific-fs-verity-file">
<h3>Allow execution of a specific fs-verity file<a class="headerlink" href="#allow-execution-of-a-specific-fs-verity-file" title="Link to this heading">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>policy_name=ALLOW_FSV_By_Digest policy_version=0.0.0
DEFAULT action=DENY

op=EXECUTE fsverity_digest=sha256:fd88f2b8824e197f850bf4c5109bea5cf0ee38104f710843bb72da796ba5af9e action=ALLOW
</pre></div>
</div>
</section>
</section>
<section id="additional-information">
<h2>Additional Information<a class="headerlink" href="#additional-information" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/microsoft/ipe">Github Repository</a></p></li>
<li><p><a class="reference internal" href="../../security/ipe.html"><span class="doc">Developer and design docs for IPE</span></a></p></li>
</ul>
</section>
<section id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>Q:</dt><dd><p>What’s the difference between other LSMs which provide a measure of
trust-based access control?</p>
</dd>
</dl>
<p>A:</p>
<blockquote>
<div><p>In general, there’s two other LSMs that can provide similar functionality:
IMA, and Loadpin.</p>
<p>IMA and IPE are functionally very similar. The significant difference between
the two is the policy. <a class="footnote-reference brackets" href="#devdoc" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
<p>Loadpin and IPE differ fairly dramatically, as Loadpin only covers the IPE’s
kernel read operations, whereas IPE is capable of controlling execution
on top of kernel read. The trust model is also different; Loadpin roots its
trust in the initial super-block, whereas trust in IPE is stemmed from kernel
itself (via <code class="docutils literal notranslate"><span class="pre">SYSTEM_TRUSTED_KEYS</span></code>).</p>
</div></blockquote>
<hr class="docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="digest-cache-lsm" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://lore.kernel.org/lkml/20240415142436.2545003-1-roberto.sassu&#64;huaweicloud.com/">https://lore.kernel.org/lkml/20240415142436.2545003-1-roberto.sassu&#64;huaweicloud.com/</a></p>
</aside>
<aside class="footnote brackets" id="interpreters" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>There is <a class="reference external" href="https://lore.kernel.org/lkml/20220321161557.495388-1-mic&#64;digikod.net/">some interest in solving this issue</a>.</p>
</aside>
<aside class="footnote brackets" id="devdoc" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id3">1</a>,<a role="doc-backlink" href="#id7">2</a>)</span>
<p>Please see <a class="reference internal" href="../../security/ipe.html"><span class="doc">the design docs</span></a> for more on
this topic.</p>
</aside>
<aside class="footnote brackets" id="switch-root" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://man7.org/linux/man-pages/man8/switch_root.8.html">https://man7.org/linux/man-pages/man8/switch_root.8.html</a></p>
</aside>
<aside class="footnote brackets" id="dmveritydigests" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>These hash algorithms are based on values accepted by
the Linux crypto API; IPE does not impose any
restrictions on the digest algorithm itself;
thus, this list may be out of date.</p>
</aside>
<aside class="footnote brackets" id="fsveritydigest" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>These hash algorithms are based on values accepted by the
kernel’s fsverity support; IPE does not impose any
restrictions on the digest algorithm itself;
thus, this list may be out of date.</p>
</aside>
</aside>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/LSM/ipe.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>