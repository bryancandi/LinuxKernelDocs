<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>General Information &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=a152c8ac" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Coding Guidelines" href="coding-guidelines.html" />
    <link rel="prev" title="Quick Start" href="quick-start.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.16.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Rust</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#the-rust-experiment">The Rust experiment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#code-documentation">Code documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="quick-start.html">Quick Start</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">General Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="coding-guidelines.html">Coding Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="arch-support.html">Arch Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/rust/general-information.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->



<div class="language-selection">
English

<ul>

<li><a href="../translations/zh_CN/rust/general-information.html">Chinese (Simplified)</a></li>

</ul>
</div>
<section id="general-information">
<h1>General Information<a class="headerlink" href="#general-information" title="Link to this heading">¶</a></h1>
<p>This document contains useful information to know when working with
the Rust support in the kernel.</p>
<section id="no-std">
<h2><code class="docutils literal notranslate"><span class="pre">no_std</span></code><a class="headerlink" href="#no-std" title="Link to this heading">¶</a></h2>
<p>The Rust support in the kernel can link only <a class="reference external" href="https://doc.rust-lang.org/core/">core</a>,
but not <a class="reference external" href="https://doc.rust-lang.org/std/">std</a>. Crates for use in the
kernel must opt into this behavior using the <code class="docutils literal notranslate"><span class="pre">#![no_std]</span></code> attribute.</p>
</section>
<section id="code-documentation">
<span id="rust-code-documentation"></span><h2>Code documentation<a class="headerlink" href="#code-documentation" title="Link to this heading">¶</a></h2>
<p>Rust kernel code is documented using <code class="docutils literal notranslate"><span class="pre">rustdoc</span></code>, its built-in documentation
generator.</p>
<p>The generated HTML docs include integrated search, linked items (e.g. types,
functions, constants), source code, etc. They may be read at:</p>
<blockquote>
<div><p><a class="reference external" href="https://rust.docs.kernel.org">https://rust.docs.kernel.org</a></p>
</div></blockquote>
<p>For linux-next, please see:</p>
<blockquote>
<div><p><a class="reference external" href="https://rust.docs.kernel.org/next/">https://rust.docs.kernel.org/next/</a></p>
</div></blockquote>
<p>There are also tags for each main release, e.g.:</p>
<blockquote>
<div><p><a class="reference external" href="https://rust.docs.kernel.org/6.10/">https://rust.docs.kernel.org/6.10/</a></p>
</div></blockquote>
<p>The docs can also be easily generated and read locally. This is quite fast
(same order as compiling the code itself) and no special tools or environment
are needed. This has the added advantage that they will be tailored to
the particular kernel configuration used. To generate them, use the <code class="docutils literal notranslate"><span class="pre">rustdoc</span></code>
target with the same invocation used for compilation, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make LLVM=1 rustdoc
</pre></div>
</div>
<p>To read the docs locally in your web browser, run e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>xdg-open Documentation/output/rust/rustdoc/kernel/index.html
</pre></div>
</div>
<p>To learn about how to write the documentation, please see <a class="reference internal" href="coding-guidelines.html"><span class="doc">Coding Guidelines</span></a>.</p>
</section>
<section id="extra-lints">
<h2>Extra lints<a class="headerlink" href="#extra-lints" title="Link to this heading">¶</a></h2>
<p>While <code class="docutils literal notranslate"><span class="pre">rustc</span></code> is a very helpful compiler, some extra lints and analyses are
available via <code class="docutils literal notranslate"><span class="pre">clippy</span></code>, a Rust linter. To enable it, pass <code class="docutils literal notranslate"><span class="pre">CLIPPY=1</span></code> to
the same invocation used for compilation, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make LLVM=1 CLIPPY=1
</pre></div>
</div>
<p>Please note that Clippy may change code generation, thus it should not be
enabled while building a production kernel.</p>
</section>
<section id="abstractions-vs-bindings">
<h2>Abstractions vs. bindings<a class="headerlink" href="#abstractions-vs-bindings" title="Link to this heading">¶</a></h2>
<p>Abstractions are Rust code wrapping kernel functionality from the C side.</p>
<p>In order to use functions and types from the C side, bindings are created.
Bindings are the declarations for Rust of those functions and types from
the C side.</p>
<p>For instance, one may write a <code class="docutils literal notranslate"><span class="pre">Mutex</span></code> abstraction in Rust which wraps
a <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mutex</span></code> from the C side and calls its functions through the bindings.</p>
<p>Abstractions are not available for all the kernel internal APIs and concepts,
but it is intended that coverage is expanded as time goes on. “Leaf” modules
(e.g. drivers) should not use the C bindings directly. Instead, subsystems
should provide as-safe-as-possible abstractions as needed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                                                rust/bindings/
                                               (rust/helpers/)

                                                   include/ -----+ &lt;-+
                                                                 |   |
  drivers/              rust/kernel/              +----------+ &lt;-+   |
    fs/                                           | bindgen  |       |
   .../            +-------------------+          +----------+ --+   |
                   |    Abstractions   |                         |   |
+---------+        | +------+ +------+ |          +----------+   |   |
| my_foo  | -----&gt; | | foo  | | bar  | | -------&gt; | Bindings | &lt;-+   |
| driver  |  Safe  | | sub- | | sub- | |  Unsafe  |          |       |
+---------+        | |system| |system| |          | bindings | &lt;-----+
     |             | +------+ +------+ |          |  crate   |       |
     |             |   kernel crate    |          +----------+       |
     |             +-------------------+                             |
     |                                                               |
     +------------------# FORBIDDEN #--------------------------------+
</pre></div>
</div>
<p>The main idea is to encapsulate all direct interaction with the kernel’s C APIs
into carefully reviewed and documented abstractions. Then users of these
abstractions cannot introduce undefined behavior (UB) as long as:</p>
<ol class="arabic simple">
<li><p>The abstractions are correct (“sound”).</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">unsafe</span></code> blocks respect the safety contract necessary to call the
operations inside the block. Similarly, any <code class="docutils literal notranslate"><span class="pre">unsafe</span> <span class="pre">impl</span></code>s respect the
safety contract necessary to implement the trait.</p></li>
</ol>
<section id="bindings">
<h3>Bindings<a class="headerlink" href="#bindings" title="Link to this heading">¶</a></h3>
<p>By including a C header from <code class="docutils literal notranslate"><span class="pre">include/</span></code> into
<code class="docutils literal notranslate"><span class="pre">rust/bindings/bindings_helper.h</span></code>, the <code class="docutils literal notranslate"><span class="pre">bindgen</span></code> tool will auto-generate the
bindings for the included subsystem. After building, see the <code class="docutils literal notranslate"><span class="pre">*_generated.rs</span></code>
output files in the <code class="docutils literal notranslate"><span class="pre">rust/bindings/</span></code> directory.</p>
<p>For parts of the C header that <code class="docutils literal notranslate"><span class="pre">bindgen</span></code> does not auto generate, e.g. C
<code class="docutils literal notranslate"><span class="pre">inline</span></code> functions or non-trivial macros, it is acceptable to add a small
wrapper function to <code class="docutils literal notranslate"><span class="pre">rust/helpers/</span></code> to make it available for the Rust side as
well.</p>
</section>
<section id="abstractions">
<h3>Abstractions<a class="headerlink" href="#abstractions" title="Link to this heading">¶</a></h3>
<p>Abstractions are the layer between the bindings and the in-kernel users. They
are located in <code class="docutils literal notranslate"><span class="pre">rust/kernel/</span></code> and their role is to encapsulate the unsafe
access to the bindings into an as-safe-as-possible API that they expose to their
users. Users of the abstractions include things like drivers or file systems
written in Rust.</p>
<p>Besides the safety aspect, the abstractions are supposed to be “ergonomic”, in
the sense that they turn the C interfaces into “idiomatic” Rust code. Basic
examples are to turn the C resource acquisition and release into Rust
constructors and destructors or C integer error codes into Rust’s <code class="docutils literal notranslate"><span class="pre">Result</span></code>s.</p>
</section>
</section>
<section id="conditional-compilation">
<h2>Conditional compilation<a class="headerlink" href="#conditional-compilation" title="Link to this heading">¶</a></h2>
<p>Rust code has access to conditional compilation based on the kernel
configuration:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="cp">#[cfg(CONFIG_X)]</span><span class="w">       </span><span class="c1">// Enabled               (`y` or `m`)</span>
<span class="cp">#[cfg(CONFIG_X=</span><span class="s">&quot;y&quot;</span><span class="cp">)]</span><span class="w">   </span><span class="c1">// Enabled as a built-in (`y`)</span>
<span class="cp">#[cfg(CONFIG_X=</span><span class="s">&quot;m&quot;</span><span class="cp">)]</span><span class="w">   </span><span class="c1">// Enabled as a module   (`m`)</span>
<span class="cp">#[cfg(not(CONFIG_X))]</span><span class="w">  </span><span class="c1">// Disabled</span>
</pre></div>
</div>
<p>For other predicates that Rust’s <code class="docutils literal notranslate"><span class="pre">cfg</span></code> does not support, e.g. expressions with
numerical comparisons, one may define a new Kconfig symbol:</p>
<div class="highlight-kconfig notranslate"><div class="highlight"><pre><span></span><span class="k">config</span><span class="w"> </span>RUSTC_VERSION_MIN_107900
<span class="w">        </span>def_bool<span class="w"> </span>y<span class="w"> </span><span class="k">if</span><span class="w"> </span>RUSTC_VERSION<span class="w"> </span>&gt;=<span class="w"> </span><span class="mi">107900</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/rust/general-information.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>