<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>target and iSCSI Interfaces Guide &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=a152c8ac" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TEE (Trusted Execution Environment) driver API" href="tee.html" />
    <link rel="prev" title="Sync File API Guide" href="sync_file.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.15.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Driver APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#general-information-for-driver-authors">General information for driver authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#useful-support-libraries">Useful support libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#bus-level-documentation">Bus-level documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#subsystem-specific-apis">Subsystem-specific APIs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="80211/index.html">Linux 802.11 Driver Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="acpi/index.html">ACPI Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l3"><a class="reference internal" href="clk.html">The Common Clk Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="console.html">Console Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="crypto/index.html">Crypto Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="dpll.html">The Linux kernel dpll subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="extcon.html">Extcon Device Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l3"><a class="reference internal" href="fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="aperture.html">Managing Ownership of the Framebuffer Aperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l3"><a class="reference internal" href="hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="hte/index.html">The Linux Hardware Timestamping Engine (HTE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="iio/index.html">Industrial I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="input.html">Input Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="libata.html">libATA Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="mailbox.html">The Common Mailbox Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="md/index.html">RAID</a></li>
<li class="toctree-l3"><a class="reference internal" href="media/index.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l3"><a class="reference internal" href="mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="message-based.html">Message-based devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l3"><a class="reference internal" href="mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l3"><a class="reference internal" href="mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="ntb.html">NTB Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="pin-control.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="pldmfw/index.html">PLDM Firmware Flash Update Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="pldmfw/index.html#overview-of-the-pldmfw-library">Overview of the <code class="docutils literal notranslate"><span class="pre">pldmfw</span></code> library</a></li>
<li class="toctree-l3"><a class="reference internal" href="pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l3"><a class="reference internal" href="ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="pwrseq.html">Power Sequencing API</a></li>
<li class="toctree-l3"><a class="reference internal" href="regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l3"><a class="reference internal" href="reset.html">Reset controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l3"><a class="reference internal" href="s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="sm501.html">SM501 Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="surface_aggregator/index.html">Surface System Aggregator Module (SSAM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="tee.html">TEE (Trusted Execution Environment) driver API</a></li>
<li class="toctree-l3"><a class="reference internal" href="thermal/index.html">Thermal</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty/index.html">TTY</a></li>
<li class="toctree-l3"><a class="reference internal" href="wbrf.html">WBRF - Wifi Band RFI Mitigations</a></li>
<li class="toctree-l3"><a class="reference internal" href="wmi.html">WMI Driver API</a></li>
<li class="toctree-l3"><a class="reference internal" href="xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l3"><a class="reference internal" href="zorro.html">Writing Device Drivers for Zorro Devices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/driver-api/target.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="target-and-iscsi-interfaces-guide">
<h1>target and iSCSI Interfaces Guide<a class="headerlink" href="#target-and-iscsi-interfaces-guide" title="Link to this heading">¶</a></h1>
<section id="introduction-and-overview">
<h2>Introduction and Overview<a class="headerlink" href="#introduction-and-overview" title="Link to this heading">¶</a></h2>
<p>TBD</p>
</section>
<section id="target-core-device-interfaces">
<h2>Target core device interfaces<a class="headerlink" href="#target-core-device-interfaces" title="Link to this heading">¶</a></h2>
<p>This section is blank because no kerneldoc comments have been added to
drivers/target/target_core_device.c.</p>
</section>
<section id="target-core-transport-interfaces">
<h2>Target core transport interfaces<a class="headerlink" href="#target-core-transport-interfaces" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.transport_init_session">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">transport_init_session</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_sess</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.transport_init_session" title="Link to this definition">¶</a><br /></dt>
<dd><p>initialize a session object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_session</span> <span class="pre">*se_sess</span></code></dt><dd><p>Session object pointer.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The caller must have zero-initialized <strong>se_sess</strong> before calling this function.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.transport_alloc_session">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">transport_alloc_session</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="n"><span class="pre">target_prot_op</span></span><span class="w"> </span><span class="n"><span class="pre">sup_prot_ops</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.transport_alloc_session" title="Link to this definition">¶</a><br /></dt>
<dd><p>allocate a session object and initialize it</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">target_prot_op</span> <span class="pre">sup_prot_ops</span></code></dt><dd><p>bitmask that defines which T10-PI modes are supported.</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.transport_alloc_session_tags">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">transport_alloc_session_tags</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_sess</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">tag_num</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">tag_size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.transport_alloc_session_tags" title="Link to this definition">¶</a><br /></dt>
<dd><p>allocate target driver private data</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_session</span> <span class="pre">*se_sess</span></code></dt><dd><p>Session pointer.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">tag_num</span></code></dt><dd><p>Maximum number of in-flight commands between initiator and target.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">tag_size</span></code></dt><dd><p>Size in bytes of the private data a target driver associates with
each command.</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_init_cmd">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_init_cmd</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.target_init_cmd" title="se_cmd"><span class="n"><span class="pre">se_cmd</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_cmd</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_sess</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sense</span></span>, <span class="n"><span class="pre">u64</span></span><span class="w"> </span><span class="n"><span class="pre">unpacked_lun</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">data_length</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">task_attr</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">data_dir</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">flags</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_init_cmd" title="Link to this definition">¶</a><br /></dt>
<dd><p>initialize se_cmd</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*se_cmd</span></code></dt><dd><p>command descriptor to init</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_session</span> <span class="pre">*se_sess</span></code></dt><dd><p>associated se_sess for endpoint</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*sense</span></code></dt><dd><p>pointer to SCSI sense buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">unpacked_lun</span></code></dt><dd><p>unpacked LUN to reference for struct se_lun</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">data_length</span></code></dt><dd><p>fabric expected data transfer length</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">task_attr</span></code></dt><dd><p>SAM task attribute</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">data_dir</span></code></dt><dd><p>DMA data direction</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">flags</span></code></dt><dd><p>flags for command submission from target_sc_flags_tables</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Task tags are supported if the caller has set <strong>se_cmd-&gt;tag</strong>.</p>
<p>If the fabric driver calls target_stop_session, then it must check the
return code and handle failures. This will never fail for other drivers,
and the return code can be ignored.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>less than zero to signal active I/O shutdown failure.</p></li>
<li><p>zero on success.</p></li>
</ul>
</div></blockquote>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_submit_prep">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_submit_prep</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.target_submit_prep" title="se_cmd"><span class="n"><span class="pre">se_cmd</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_cmd</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cdb</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">scatterlist</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sgl</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">sgl_count</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">scatterlist</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sgl_bidi</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">sgl_bidi_count</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">scatterlist</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sgl_prot</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">sgl_prot_count</span></span>, <span class="n"><span class="pre">gfp_t</span></span><span class="w"> </span><span class="n"><span class="pre">gfp</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_submit_prep" title="Link to this definition">¶</a><br /></dt>
<dd><p>prepare cmd for submission</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*se_cmd</span></code></dt><dd><p>command descriptor to prep</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*cdb</span></code></dt><dd><p>pointer to SCSI CDB</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">scatterlist</span> <span class="pre">*sgl</span></code></dt><dd><p>struct scatterlist memory for unidirectional mapping</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">sgl_count</span></code></dt><dd><p>scatterlist count for unidirectional mapping</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">scatterlist</span> <span class="pre">*sgl_bidi</span></code></dt><dd><p>struct scatterlist memory for bidirectional READ mapping</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">sgl_bidi_count</span></code></dt><dd><p>scatterlist count for bidirectional READ mapping</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">scatterlist</span> <span class="pre">*sgl_prot</span></code></dt><dd><p>struct scatterlist memory protection information</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">sgl_prot_count</span></code></dt><dd><p>scatterlist count for protection information</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gfp_t</span> <span class="pre">gfp</span></code></dt><dd><p>gfp allocation type</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>less than zero to signal failure.</p></li>
<li><p>zero on success.</p></li>
</ul>
</div></blockquote>
<p><strong>Description</strong></p>
<p>If failure is returned, lio will the callers queue_status to complete
the cmd.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_submit_cmd">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_submit_cmd</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.target_submit_cmd" title="se_cmd"><span class="n"><span class="pre">se_cmd</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_cmd</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_sess</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cdb</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sense</span></span>, <span class="n"><span class="pre">u64</span></span><span class="w"> </span><span class="n"><span class="pre">unpacked_lun</span></span>, <span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="n"><span class="pre">data_length</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">task_attr</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">data_dir</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">flags</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_submit_cmd" title="Link to this definition">¶</a><br /></dt>
<dd><p>lookup unpacked lun and submit uninitialized se_cmd</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*se_cmd</span></code></dt><dd><p>command descriptor to submit</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_session</span> <span class="pre">*se_sess</span></code></dt><dd><p>associated se_sess for endpoint</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*cdb</span></code></dt><dd><p>pointer to SCSI CDB</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*sense</span></code></dt><dd><p>pointer to SCSI sense buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">unpacked_lun</span></code></dt><dd><p>unpacked LUN to reference for struct se_lun</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">data_length</span></code></dt><dd><p>fabric expected data transfer length</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">task_attr</span></code></dt><dd><p>SAM task attribute</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">data_dir</span></code></dt><dd><p>DMA data direction</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">flags</span></code></dt><dd><p>flags for command submission from target_sc_flags_tables</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Task tags are supported if the caller has set <strong>se_cmd-&gt;tag</strong>.</p>
<p>This may only be called from process context, and also currently
assumes internal allocation of fabric payload buffer by target-core.</p>
<p>It also assumes interal target core SGL memory allocation.</p>
<p>This function must only be used by drivers that do their own
sync during shutdown and does not use target_stop_session. If there
is a failure this function will call into the fabric driver’s
queue_status with a CHECK_CONDITION.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_submit">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_submit</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.target_submit" title="se_cmd"><span class="n"><span class="pre">se_cmd</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_cmd</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_submit" title="Link to this definition">¶</a><br /></dt>
<dd><p>perform final initialization and submit cmd to LIO core</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*se_cmd</span></code></dt><dd><p>command descriptor to submit</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>target_submit_prep or something similar must have been called on the cmd,
and this must be called from process context.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_submit_tmr">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_submit_tmr</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.target_submit_tmr" title="se_cmd"><span class="n"><span class="pre">se_cmd</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_cmd</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_sess</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sense</span></span>, <span class="n"><span class="pre">u64</span></span><span class="w"> </span><span class="n"><span class="pre">unpacked_lun</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fabric_tmr_ptr</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="n"><span class="pre">tm_type</span></span>, <span class="n"><span class="pre">gfp_t</span></span><span class="w"> </span><span class="n"><span class="pre">gfp</span></span>, <span class="n"><span class="pre">u64</span></span><span class="w"> </span><span class="n"><span class="pre">tag</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">flags</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_submit_tmr" title="Link to this definition">¶</a><br /></dt>
<dd><p>lookup unpacked lun and submit uninitialized se_cmd for TMR CDBs</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*se_cmd</span></code></dt><dd><p>command descriptor to submit</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_session</span> <span class="pre">*se_sess</span></code></dt><dd><p>associated se_sess for endpoint</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*sense</span></code></dt><dd><p>pointer to SCSI sense buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">unpacked_lun</span></code></dt><dd><p>unpacked LUN to reference for struct se_lun</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*fabric_tmr_ptr</span></code></dt><dd><p>fabric context for TMR req</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">tm_type</span></code></dt><dd><p>Type of TM request</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gfp_t</span> <span class="pre">gfp</span></code></dt><dd><p>gfp type for caller</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">tag</span></code></dt><dd><p>referenced task tag for TMR_ABORT_TASK</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">flags</span></code></dt><dd><p>submit cmd flags</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Callable from all contexts.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_get_sess_cmd">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_get_sess_cmd</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.target_get_sess_cmd" title="se_cmd"><span class="n"><span class="pre">se_cmd</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_cmd</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">ack_kref</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_get_sess_cmd" title="Link to this definition">¶</a><br /></dt>
<dd><p>Verify the session is accepting cmds and take ref</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*se_cmd</span></code></dt><dd><p>command descriptor to add</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">ack_kref</span></code></dt><dd><p>Signal that fabric will perform an ack <a class="reference internal" href="#c.target_put_sess_cmd" title="target_put_sess_cmd"><code class="xref c c-func docutils literal notranslate"><span class="pre">target_put_sess_cmd()</span></code></a></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_put_sess_cmd">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_put_sess_cmd</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.target_put_sess_cmd" title="se_cmd"><span class="n"><span class="pre">se_cmd</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_cmd</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_put_sess_cmd" title="Link to this definition">¶</a><br /></dt>
<dd><p>decrease the command reference count</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*se_cmd</span></code></dt><dd><p>command to drop a reference from</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns 1 if and only if this <a class="reference internal" href="#c.target_put_sess_cmd" title="target_put_sess_cmd"><code class="xref c c-func docutils literal notranslate"><span class="pre">target_put_sess_cmd()</span></code></a> call caused the
refcount to drop to zero. Returns zero otherwise.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_stop_cmd_counter">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_stop_cmd_counter</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">target_cmd_counter</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cmd_cnt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_stop_cmd_counter" title="Link to this definition">¶</a><br /></dt>
<dd><p>Stop new IO from being added to the counter.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">target_cmd_counter</span> <span class="pre">*cmd_cnt</span></code></dt><dd><p>counter to stop</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_stop_session">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_stop_session</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_sess</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_stop_session" title="Link to this definition">¶</a><br /></dt>
<dd><p>Stop new IO from being queued on the session.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_session</span> <span class="pre">*se_sess</span></code></dt><dd><p>session to stop</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_wait_for_cmds">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_wait_for_cmds</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">target_cmd_counter</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cmd_cnt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_wait_for_cmds" title="Link to this definition">¶</a><br /></dt>
<dd><p>Wait for outstanding cmds.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">target_cmd_counter</span> <span class="pre">*cmd_cnt</span></code></dt><dd><p>counter to wait for active I/O for.</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_wait_for_sess_cmds">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_wait_for_sess_cmds</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">se_sess</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_wait_for_sess_cmds" title="Link to this definition">¶</a><br /></dt>
<dd><p>Wait for outstanding commands</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_session</span> <span class="pre">*se_sess</span></code></dt><dd><p>session to wait for active I/O</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.transport_wait_for_tasks">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">transport_wait_for_tasks</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_cmd</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cmd</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.transport_wait_for_tasks" title="Link to this definition">¶</a><br /></dt>
<dd><p>set CMD_T_STOP and wait for t_transport_stop_comp</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*cmd</span></code></dt><dd><p>command to wait on</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.target_send_busy">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">target_send_busy</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">se_cmd</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cmd</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.target_send_busy" title="Link to this definition">¶</a><br /></dt>
<dd><p>Send SCSI BUSY status back to the initiator</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">se_cmd</span> <span class="pre">*cmd</span></code></dt><dd><p>SCSI command for which to send a BUSY reply.</p>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>Only call this function if target_submit_cmd*() failed.</p>
</div>
</section>
<section id="target-supported-userspace-i-o">
<h2>Target-supported userspace I/O<a class="headerlink" href="#target-supported-userspace-i-o" title="Link to this heading">¶</a></h2>
<section id="userspace-i-o">
<h3>Userspace I/O<a class="headerlink" href="#userspace-i-o" title="Link to this heading">¶</a></h3>
<p>Define a shared-memory interface for LIO to pass SCSI commands and
data to userspace for processing. This is to allow backends that
are too complex for in-kernel support to be possible.</p>
<p>It uses the UIO framework to do a lot of the device-creation and
introspection work for us.</p>
<p>See the .h file for how the ring is laid out. Note that while the
command ring is defined, the particulars of the data area are
not. Offset values in the command entry point to other locations
internal to the mmap-ed area. There is separate space outside the
command ring for data buffers. This leaves maximum flexibility for
moving buffer allocations, or even page flipping or other
allocation techniques, without altering the command ring layout.</p>
<p>SECURITY:
The user process must be assumed to be malicious. There’s no way to
prevent it breaking the command ring protocol if it wants, but in
order to prevent other issues we must only ever read <em>data</em> from
the shared memory area, not offsets or sizes. This applies to
command ring entries as well as the mailbox. Extra code needed for
this may have a ‘UAM’ comment.</p>
</section>
<section id="ring-design">
<h3>Ring Design<a class="headerlink" href="#ring-design" title="Link to this heading">¶</a></h3>
<p>The mmaped area is divided into three parts:
1) The mailbox (struct tcmu_mailbox, below);
2) The command ring;
3) Everything beyond the command ring (data).</p>
<p>The mailbox tells userspace the offset of the command ring from the
start of the shared memory region, and how big the command ring is.</p>
<p>The kernel passes SCSI commands to userspace by putting a struct
tcmu_cmd_entry in the ring, updating mailbox-&gt;cmd_head, and poking
userspace via UIO’s interrupt mechanism.</p>
<p>tcmu_cmd_entry contains a header. If the header type is PAD,
userspace should skip hdr-&gt;length bytes (mod cmdr_size) to find the
next cmd_entry.</p>
<p>Otherwise, the entry will contain offsets into the mmaped area that
contain the cdb and data buffers -- the latter accessible via the
iov array. iov addresses are also offsets into the shared area.</p>
<p>When userspace is completed handling the command, set
entry-&gt;rsp.scsi_status, fill in rsp.sense_buffer if appropriate,
and also set mailbox-&gt;cmd_tail equal to the old cmd_tail plus
hdr-&gt;length, mod cmdr_size. If cmd_tail doesn’t equal cmd_head, it
should process the next packet the same way, and so on.</p>
</section>
</section>
<section id="iscsi-helper-functions">
<h2>iSCSI helper functions<a class="headerlink" href="#iscsi-helper-functions" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_prep_data_out_pdu">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_prep_data_out_pdu</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">task</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_r2t_info</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">r2t</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hdr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_prep_data_out_pdu" title="Link to this definition">¶</a><br /></dt>
<dd><p>initialize Data-Out</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_task</span> <span class="pre">*task</span></code></dt><dd><p>scsi command task</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_r2t_info</span> <span class="pre">*r2t</span></code></dt><dd><p>R2T info</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_data</span> <span class="pre">*hdr</span></code></dt><dd><p>iscsi data in pdu</p>
</dd>
</dl>
<p><strong>Notes</strong></p>
<blockquote>
<div><p>Initialize Data-Out within this R2T sequence and finds
proper data_offset within this SCSI command.</p>
<p>This function is called with connection lock taken.</p>
</div></blockquote>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.__iscsi_put_task">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">__iscsi_put_task</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">task</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.__iscsi_put_task" title="Link to this definition">¶</a><br /></dt>
<dd><p>drop the refcount on a task</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_task</span> <span class="pre">*task</span></code></dt><dd><p>iscsi_task to drop the refcount on</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The back_lock must be held when calling in case it frees the task.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_complete_scsi_task">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_complete_scsi_task</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">task</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">exp_cmdsn</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_cmdsn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_complete_scsi_task" title="Link to this definition">¶</a><br /></dt>
<dd><p>finish scsi task normally</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_task</span> <span class="pre">*task</span></code></dt><dd><p>iscsi task for scsi cmd</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">exp_cmdsn</span></code></dt><dd><p>expected cmd sn in cpu format</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">max_cmdsn</span></code></dt><dd><p>max cmd sn in cpu format</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is used when drivers do not need or cannot perform
lower level pdu processing.</p>
<p>Called with session back_lock</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_itt_to_task">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_itt_to_task</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span>, <span class="n"><span class="pre">itt_t</span></span><span class="w"> </span><span class="n"><span class="pre">itt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_itt_to_task" title="Link to this definition">¶</a><br /></dt>
<dd><p>look up task by itt</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi connection</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">itt_t</span> <span class="pre">itt</span></code></dt><dd><p>itt</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This should be used for mgmt tasks like login and nops, or if
the LDD’s itt space does not include the session age.</p>
<p>The session back_lock must be held.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.__iscsi_complete_pdu">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">__iscsi_complete_pdu</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_hdr</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hdr</span></span>, <span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">datalen</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.__iscsi_complete_pdu" title="Link to this definition">¶</a><br /></dt>
<dd><p>complete pdu</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi conn</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_hdr</span> <span class="pre">*hdr</span></code></dt><dd><p>iscsi header</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*data</span></code></dt><dd><p>data buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">datalen</span></code></dt><dd><p>len of data buffer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Completes pdu processing by freeing any resources allocated at
queuecommand or send generic. session back_lock must be held and verify
itt must have been called.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_itt_to_ctask">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_itt_to_ctask</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span>, <span class="n"><span class="pre">itt_t</span></span><span class="w"> </span><span class="n"><span class="pre">itt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_itt_to_ctask" title="Link to this definition">¶</a><br /></dt>
<dd><p>look up ctask by itt</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi connection</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">itt_t</span> <span class="pre">itt</span></code></dt><dd><p>itt</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This should be used for cmd tasks.</p>
<p>The session back_lock must be held.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_requeue_task">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_requeue_task</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">task</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_requeue_task" title="Link to this definition">¶</a><br /></dt>
<dd><p>requeue task to run from session workqueue</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_task</span> <span class="pre">*task</span></code></dt><dd><p>task to requeue</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Callers must have taken a ref to the task that is going to be requeued.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_suspend_queue">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_suspend_queue</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_suspend_queue" title="Link to this definition">¶</a><br /></dt>
<dd><p>suspend iscsi_queuecommand</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi conn to stop queueing IO on</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This grabs the session frwd_lock to make sure no one is in
xmit_task/queuecommand, and then sets suspend to prevent
new commands from being queued. This only needs to be called
by offload drivers that need to sync a path like ep disconnect
with the iscsi_queuecommand/xmit_task. To start IO again libiscsi
will call iscsi_start_tx and iscsi_unblock_session when in FFP.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_suspend_tx">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_suspend_tx</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_suspend_tx" title="Link to this definition">¶</a><br /></dt>
<dd><p>suspend iscsi_data_xmit</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi conn to stop processing IO on.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function sets the suspend bit to prevent iscsi_data_xmit
from sending new IO, and if work is queued on the xmit thread
it will wait for it to be completed.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_suspend_rx">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_suspend_rx</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_suspend_rx" title="Link to this definition">¶</a><br /></dt>
<dd><p>Prevent recvwork from running again.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi conn to stop.</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_conn_unbind">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_conn_unbind</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_cls_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cls_conn</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">is_active</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_conn_unbind" title="Link to this definition">¶</a><br /></dt>
<dd><p>prevent queueing to conn.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_cls_conn</span> <span class="pre">*cls_conn</span></code></dt><dd><p>iscsi conn ep is bound to.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">is_active</span></code></dt><dd><p>is the conn in use for boot or is this for EH/termination</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This must be called by drivers implementing the ep_disconnect callout.
It disables queueing to the connection from libiscsi in preparation for
an ep_disconnect call.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_eh_session_reset">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_eh_session_reset</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">scsi_cmnd</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sc</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_eh_session_reset" title="Link to this definition">¶</a><br /></dt>
<dd><p>drop session and attempt relogin</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">scsi_cmnd</span> <span class="pre">*sc</span></code></dt><dd><p>scsi command</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function will wait for a relogin, session termination from
userspace, or a recovery/replacement timeout.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_eh_recover_target">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_eh_recover_target</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">scsi_cmnd</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sc</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_eh_recover_target" title="Link to this definition">¶</a><br /></dt>
<dd><p>reset target and possibly the session</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">scsi_cmnd</span> <span class="pre">*sc</span></code></dt><dd><p>scsi command</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This will attempt to send a warm target reset. If that fails,
we will escalate to ERL0 session recovery.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_host_add">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_host_add</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">Scsi_Host</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">shost</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="infrastructure.html#c.device" title="device"><span class="n"><span class="pre">device</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">pdev</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_host_add" title="Link to this definition">¶</a><br /></dt>
<dd><p>add host to system</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">Scsi_Host</span> <span class="pre">*shost</span></code></dt><dd><p>scsi host</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*pdev</span></code></dt><dd><p>parent device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This should be called by partial offload and software iscsi drivers
to add a host to the system.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_host_alloc">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">Scsi_Host</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_host_alloc</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">scsi_host_template</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sht</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">dd_data_size</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">xmit_can_sleep</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_host_alloc" title="Link to this definition">¶</a><br /></dt>
<dd><p>allocate a host and driver data</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">scsi_host_template</span> <span class="pre">*sht</span></code></dt><dd><p>scsi host template</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">dd_data_size</span></code></dt><dd><p>driver host data size</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">xmit_can_sleep</span></code></dt><dd><p>bool indicating if LLD will queue IO from a work queue</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This should be called by partial offload and software iscsi drivers.
To access the driver specific memory use the iscsi_host_priv() macro.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_host_remove">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_host_remove</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">Scsi_Host</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">shost</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">is_shutdown</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_host_remove" title="Link to this definition">¶</a><br /></dt>
<dd><p>remove host and sessions</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">Scsi_Host</span> <span class="pre">*shost</span></code></dt><dd><p>scsi host</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">is_shutdown</span></code></dt><dd><p>true if called from a driver shutdown callout</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>If there are any sessions left, this will initiate the removal and wait
for the completion.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_session_setup">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_cls_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_session_setup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_transport</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">iscsit</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">Scsi_Host</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">shost</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">cmds_max</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">dd_size</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">cmd_task_size</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">initial_cmdsn</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_session_setup" title="Link to this definition">¶</a><br /></dt>
<dd><p>create iscsi cls session and host and session</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_transport</span> <span class="pre">*iscsit</span></code></dt><dd><p>iscsi transport template</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">Scsi_Host</span> <span class="pre">*shost</span></code></dt><dd><p>scsi host</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">cmds_max</span></code></dt><dd><p>session can queue</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">dd_size</span></code></dt><dd><p>private driver data size, added to session allocation size</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">cmd_task_size</span></code></dt><dd><p>LLD task private data size</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">initial_cmdsn</span></code></dt><dd><p>initial CmdSN</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">id</span></code></dt><dd><p>target ID to add to this session</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This can be used by software iscsi_transports that allocate
a session per scsi host.</p>
<p>Callers should set cmds_max to the largest total numer (mgmt + scsi) of
tasks they support. The iscsi layer reserves ISCSI_MGMT_CMDS_MAX tasks
for nop handling and login/logout requests.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_session_free">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_session_free</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_cls_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cls_session</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_session_free" title="Link to this definition">¶</a><br /></dt>
<dd><p>Free iscsi session and it’s resources</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_cls_session</span> <span class="pre">*cls_session</span></code></dt><dd><p>iscsi session</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_session_teardown">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_session_teardown</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_cls_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cls_session</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_session_teardown" title="Link to this definition">¶</a><br /></dt>
<dd><p>destroy session and cls_session</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_cls_session</span> <span class="pre">*cls_session</span></code></dt><dd><p>iscsi session</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_conn_setup">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_cls_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_conn_setup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_cls_session</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cls_session</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">dd_size</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">conn_idx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_conn_setup" title="Link to this definition">¶</a><br /></dt>
<dd><p>create iscsi_cls_conn and iscsi_conn</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_cls_session</span> <span class="pre">*cls_session</span></code></dt><dd><p>iscsi_cls_session</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">dd_size</span></code></dt><dd><p>private driver data size</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">conn_idx</span></code></dt><dd><p>cid</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_conn_teardown">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_conn_teardown</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_cls_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cls_conn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_conn_teardown" title="Link to this definition">¶</a><br /></dt>
<dd><p>teardown iscsi connection</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_cls_conn</span> <span class="pre">*cls_conn</span></code></dt><dd><p>iscsi class connection</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>TODO: we may need to make this into a two step process
like scsi-mls remove + put host</p>
</div>
</section>
<section id="iscsi-boot-information">
<h2>iSCSI boot information<a class="headerlink" href="#iscsi-boot-information" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_boot_create_target">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kobj</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_boot_create_target</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kset</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">boot_kset</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">index</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">show</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span><span class="p"><span class="pre">)</span></span>, <span class="n"><span class="pre">umode_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">is_visible</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">)</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">release</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">)</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_boot_create_target" title="Link to this definition">¶</a><br /></dt>
<dd><p>create boot target sysfs dir</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_boot_kset</span> <span class="pre">*boot_kset</span></code></dt><dd><p>boot kset</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">index</span></code></dt><dd><p>the target id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>driver specific data for target</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssize_t</span> <span class="pre">(*show)</span> <span class="pre">(void</span> <span class="pre">*data,</span> <span class="pre">int</span> <span class="pre">type,</span> <span class="pre">char</span> <span class="pre">*buf)</span></code></dt><dd><p>attr show function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">umode_t</span> <span class="pre">(*is_visible)</span> <span class="pre">(void</span> <span class="pre">*data,</span> <span class="pre">int</span> <span class="pre">type)</span></code></dt><dd><p>attr visibility function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">(*release)</span> <span class="pre">(void</span> <span class="pre">*data)</span></code></dt><dd><p>release function</p>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>The boot sysfs lib will free the data passed in for the caller
when all refs to the target kobject have been released.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_boot_create_initiator">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kobj</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_boot_create_initiator</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kset</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">boot_kset</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">index</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">show</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span><span class="p"><span class="pre">)</span></span>, <span class="n"><span class="pre">umode_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">is_visible</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">)</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">release</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">)</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_boot_create_initiator" title="Link to this definition">¶</a><br /></dt>
<dd><p>create boot initiator sysfs dir</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_boot_kset</span> <span class="pre">*boot_kset</span></code></dt><dd><p>boot kset</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">index</span></code></dt><dd><p>the initiator id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>driver specific data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssize_t</span> <span class="pre">(*show)</span> <span class="pre">(void</span> <span class="pre">*data,</span> <span class="pre">int</span> <span class="pre">type,</span> <span class="pre">char</span> <span class="pre">*buf)</span></code></dt><dd><p>attr show function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">umode_t</span> <span class="pre">(*is_visible)</span> <span class="pre">(void</span> <span class="pre">*data,</span> <span class="pre">int</span> <span class="pre">type)</span></code></dt><dd><p>attr visibility function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">(*release)</span> <span class="pre">(void</span> <span class="pre">*data)</span></code></dt><dd><p>release function</p>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>The boot sysfs lib will free the data passed in for the caller
when all refs to the initiator kobject have been released.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_boot_create_ethernet">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kobj</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_boot_create_ethernet</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kset</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">boot_kset</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">index</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">show</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span><span class="p"><span class="pre">)</span></span>, <span class="n"><span class="pre">umode_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">is_visible</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">)</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">release</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">)</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_boot_create_ethernet" title="Link to this definition">¶</a><br /></dt>
<dd><p>create boot ethernet sysfs dir</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_boot_kset</span> <span class="pre">*boot_kset</span></code></dt><dd><p>boot kset</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">index</span></code></dt><dd><p>the ethernet device id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>driver specific data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssize_t</span> <span class="pre">(*show)</span> <span class="pre">(void</span> <span class="pre">*data,</span> <span class="pre">int</span> <span class="pre">type,</span> <span class="pre">char</span> <span class="pre">*buf)</span></code></dt><dd><p>attr show function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">umode_t</span> <span class="pre">(*is_visible)</span> <span class="pre">(void</span> <span class="pre">*data,</span> <span class="pre">int</span> <span class="pre">type)</span></code></dt><dd><p>attr visibility function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">(*release)</span> <span class="pre">(void</span> <span class="pre">*data)</span></code></dt><dd><p>release function</p>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>The boot sysfs lib will free the data passed in for the caller
when all refs to the ethernet kobject have been released.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_boot_create_acpitbl">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kobj</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_boot_create_acpitbl</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kset</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">boot_kset</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">index</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">show</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span><span class="p"><span class="pre">)</span></span>, <span class="n"><span class="pre">umode_t</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">is_visible</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">)</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">release</span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">)</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_boot_create_acpitbl" title="Link to this definition">¶</a><br /></dt>
<dd><p>create boot acpi table sysfs dir</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_boot_kset</span> <span class="pre">*boot_kset</span></code></dt><dd><p>boot kset</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">index</span></code></dt><dd><p>not used</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>driver specific data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssize_t</span> <span class="pre">(*show)(void</span> <span class="pre">*data,</span> <span class="pre">int</span> <span class="pre">type,</span> <span class="pre">char</span> <span class="pre">*buf)</span></code></dt><dd><p>attr show function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">umode_t</span> <span class="pre">(*is_visible)(void</span> <span class="pre">*data,</span> <span class="pre">int</span> <span class="pre">type)</span></code></dt><dd><p>attr visibility function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">(*release)(void</span> <span class="pre">*data)</span></code></dt><dd><p>release function</p>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>The boot sysfs lib will free the data passed in for the caller
when all refs to the acpitbl kobject have been released.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_boot_create_kset">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kset</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_boot_create_kset</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">set_name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_boot_create_kset" title="Link to this definition">¶</a><br /></dt>
<dd><p>creates root sysfs tree</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*set_name</span></code></dt><dd><p>name of root dir</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_boot_create_host_kset">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kset</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_boot_create_host_kset</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">hostno</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_boot_create_host_kset" title="Link to this definition">¶</a><br /></dt>
<dd><p>creates root sysfs tree for a scsi host</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">hostno</span></code></dt><dd><p>host number of scsi host</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_boot_destroy_kset">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_boot_destroy_kset</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_boot_kset</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">boot_kset</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_boot_destroy_kset" title="Link to this definition">¶</a><br /></dt>
<dd><p>destroy kset and kobjects under it</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_boot_kset</span> <span class="pre">*boot_kset</span></code></dt><dd><p>boot kset</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This will remove the kset and kobjects and attrs under it.</p>
</div>
</section>
<section id="iscsi-tcp-interfaces">
<h2>iSCSI TCP interfaces<a class="headerlink" href="#iscsi-tcp-interfaces" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_sw_tcp_recv">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_sw_tcp_recv</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">read_descriptor_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rd_desc</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../networking/kapi.html#c.sk_buff" title="sk_buff"><span class="n"><span class="pre">sk_buff</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">skb</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">offset</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_sw_tcp_recv" title="Link to this definition">¶</a><br /></dt>
<dd><p>TCP receive in sendfile fashion</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">read_descriptor_t</span> <span class="pre">*rd_desc</span></code></dt><dd><p>read descriptor</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sk_buff</span> <span class="pre">*skb</span></code></dt><dd><p>socket buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">offset</span></code></dt><dd><p>offset in skb</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">len</span></code></dt><dd><p>skb-&gt;len - offset</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_sw_sk_state_check">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_sw_sk_state_check</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../networking/kapi.html#c.sock" title="sock"><span class="n"><span class="pre">sock</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sk</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_sw_sk_state_check" title="Link to this definition">¶</a><br /></dt>
<dd><p>check socket state</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sock</span> <span class="pre">*sk</span></code></dt><dd><p>socket</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>If the socket is in CLOSE or CLOSE_WAIT we should
not close the connection if there is still some
data pending.</p>
<p>Must be called with sk_callback_lock.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_sw_tcp_write_space">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_sw_tcp_write_space</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../networking/kapi.html#c.sock" title="sock"><span class="n"><span class="pre">sock</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sk</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_sw_tcp_write_space" title="Link to this definition">¶</a><br /></dt>
<dd><p>Called when more output buffer space is available</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sock</span> <span class="pre">*sk</span></code></dt><dd><p>socket space is available for</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_sw_tcp_xmit_segment">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_sw_tcp_xmit_segment</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_tcp_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tcp_conn</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_segment</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">segment</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_sw_tcp_xmit_segment" title="Link to this definition">¶</a><br /></dt>
<dd><p>transmit segment</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_tcp_conn</span> <span class="pre">*tcp_conn</span></code></dt><dd><p>the iSCSI TCP connection</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_segment</span> <span class="pre">*segment</span></code></dt><dd><p>the buffer to transmnit</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function transmits as much of the buffer as
the network layer will accept, and returns the number of
bytes transmitted.</p>
<p>If CRC hashing is enabled, the function will compute the
hash as it goes. When the entire segment has been transmitted,
it will retrieve the hash value and send it as well.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_sw_tcp_xmit">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_sw_tcp_xmit</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_sw_tcp_xmit" title="Link to this definition">¶</a><br /></dt>
<dd><p>TCP transmit</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi connection</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_sw_tcp_xmit_qlen">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_sw_tcp_xmit_qlen</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_sw_tcp_xmit_qlen" title="Link to this definition">¶</a><br /></dt>
<dd><p>return the number of bytes queued for xmit</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi connection</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_tcp_segment_done">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_tcp_segment_done</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_tcp_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tcp_conn</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_segment</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">segment</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">recv</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="n"><span class="pre">copied</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_tcp_segment_done" title="Link to this definition">¶</a><br /></dt>
<dd><p>check whether the segment is complete</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_tcp_conn</span> <span class="pre">*tcp_conn</span></code></dt><dd><p>iscsi tcp connection</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_segment</span> <span class="pre">*segment</span></code></dt><dd><p>iscsi segment to check</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">recv</span></code></dt><dd><p>set to one of this is called from the recv path</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">copied</span></code></dt><dd><p>number of bytes copied</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Check if we’re done receiving this segment. If the receive
buffer is full but we expect more data, move on to the
next entry in the scatterlist.</p>
<p>If the amount of data we received isn’t a multiple of 4,
we will transparently receive the pad bytes, too.</p>
<p>This function must be re-entrant.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_tcp_hdr_recv_prep">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_tcp_hdr_recv_prep</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_tcp_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tcp_conn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_tcp_hdr_recv_prep" title="Link to this definition">¶</a><br /></dt>
<dd><p>prep segment for hdr reception</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_tcp_conn</span> <span class="pre">*tcp_conn</span></code></dt><dd><p>iscsi connection to prep for</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function always passes NULL for the crcp argument, because when this
function is called we do not yet know the final size of the header and want
to delay the digest processing until we know that.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_tcp_cleanup_task">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_tcp_cleanup_task</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">task</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_tcp_cleanup_task" title="Link to this definition">¶</a><br /></dt>
<dd><p>free tcp_task resources</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_task</span> <span class="pre">*task</span></code></dt><dd><p>iscsi task</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>must be called with session back_lock</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_tcp_recv_segment_is_hdr">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_tcp_recv_segment_is_hdr</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_tcp_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tcp_conn</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_tcp_recv_segment_is_hdr" title="Link to this definition">¶</a><br /></dt>
<dd><p>tests if we are reading in a header</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_tcp_conn</span> <span class="pre">*tcp_conn</span></code></dt><dd><p>iscsi tcp conn</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>returns non zero if we are currently processing or setup to process
a header.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_tcp_recv_skb">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_tcp_recv_skb</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_conn</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">conn</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="../networking/kapi.html#c.sk_buff" title="sk_buff"><span class="n"><span class="pre">sk_buff</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">skb</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">offset</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">offloaded</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">status</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_tcp_recv_skb" title="Link to this definition">¶</a><br /></dt>
<dd><p>Process skb</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_conn</span> <span class="pre">*conn</span></code></dt><dd><p>iscsi connection</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sk_buff</span> <span class="pre">*skb</span></code></dt><dd><p>network buffer with header and/or data segment</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">offset</span></code></dt><dd><p>offset in skb</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">offloaded</span></code></dt><dd><p>bool indicating if transfer was offloaded</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*status</span></code></dt><dd><p>iscsi TCP status result</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Will return status of transfer in <strong>status</strong>. And will return
number of bytes copied.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_tcp_task_init">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_tcp_task_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">task</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_tcp_task_init" title="Link to this definition">¶</a><br /></dt>
<dd><p>Initialize iSCSI SCSI_READ or SCSI_WRITE commands</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_task</span> <span class="pre">*task</span></code></dt><dd><p>scsi command task</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.iscsi_tcp_task_xmit">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">iscsi_tcp_task_xmit</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">iscsi_task</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">task</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.iscsi_tcp_task_xmit" title="Link to this definition">¶</a><br /></dt>
<dd><p>xmit normal PDU task</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iscsi_task</span> <span class="pre">*task</span></code></dt><dd><p>iscsi command task</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>We’re expected to return 0 when everything was transmitted successfully,
-EAGAIN if there’s still data in the queue, or != 0 for any other kind
of error.</p>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/driver-api/target.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>