<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Devices and Protocols &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="BIOS/EFI Configuration" href="../platform/bios-and-efi.html" />
    <link rel="prev" title="Compute Express Link Subsystem Maturity Map" href="../maturity-map.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.16.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Driver APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#general-information-for-driver-authors">General information for driver authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#useful-support-libraries">Useful support libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#bus-level-documentation">Bus-level documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../auxiliary_bus.html">Auxiliary Bus</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Compute Express Link</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eisa.html">EISA bus support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../isa.html">ISA Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../pci/index.html">The Linux PCI driver implementer’s API guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rapidio/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usb/index.html">Linux USB API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../virtio/index.html">Virtio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vme.html">VME Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../w1.html">W1: Dallas’ 1-wire bus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xillybus.html">Xillybus driver for generic FPGA interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#subsystem-specific-apis">Subsystem-specific APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/driver-api/cxl/devices/device-types.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="devices-and-protocols">
<h1>Devices and Protocols<a class="headerlink" href="#devices-and-protocols" title="Link to this heading">¶</a></h1>
<p>The type of CXL device (Memory, Accelerator, etc) dictates many configuration steps. This section
covers some basic background on device types and on-device resources used by the platform and OS
which impact configuration.</p>
<section id="protocols">
<h2>Protocols<a class="headerlink" href="#protocols" title="Link to this heading">¶</a></h2>
<p>There are three core protocols to CXL.  For the purpose of this documentation,
we will only discuss very high level definitions as the specific hardware
details are largely abstracted away from Linux.  See the CXL specification
for more details.</p>
<section id="cxl-io">
<h3>CXL.io<a class="headerlink" href="#cxl-io" title="Link to this heading">¶</a></h3>
<p>The basic interaction protocol, similar to PCIe configuration mechanisms.
Typically used for initialization, configuration, and I/O access for anything
other than memory (CXL.mem) or cache (CXL.cache) operations.</p>
<p>The Linux CXL driver exposes access to .io functionalty via the various sysfs
interfaces and /dev/cxl/ devices (which exposes direct access to device
mailboxes).</p>
</section>
<section id="cxl-cache">
<h3>CXL.cache<a class="headerlink" href="#cxl-cache" title="Link to this heading">¶</a></h3>
<p>The mechanism by which a device may coherently access and cache host memory.</p>
<p>Largely transparent to Linux once configured.</p>
</section>
<section id="cxl-mem">
<h3>CXL.mem<a class="headerlink" href="#cxl-mem" title="Link to this heading">¶</a></h3>
<p>The mechanism by which the CPU may coherently access and cache device memory.</p>
<p>Largely transparent to Linux once configured.</p>
</section>
</section>
<section id="device-types">
<h2>Device Types<a class="headerlink" href="#device-types" title="Link to this heading">¶</a></h2>
<section id="type-1">
<h3>Type-1<a class="headerlink" href="#type-1" title="Link to this heading">¶</a></h3>
<p>A Type-1 CXL device:</p>
<ul class="simple">
<li><p>Supports cxl.io and cxl.cache protocols</p></li>
<li><p>Implements a fully coherent cache</p></li>
<li><p>Allows Device-to-Host coherence and Host-to-Device snoops.</p></li>
<li><p>Does NOT have host-managed device memory (HDM)</p></li>
</ul>
<p>Typical examples of type-1 devices is a Smart NIC - which may want to
directly operate on host-memory (DMA) to store incoming packets. These
devices largely rely on CPU-attached memory.</p>
</section>
<section id="type-2">
<h3>Type-2<a class="headerlink" href="#type-2" title="Link to this heading">¶</a></h3>
<p>A Type-2 CXL Device:</p>
<ul class="simple">
<li><p>Supports cxl.io, cxl.cache, and cxl.mem protocols</p></li>
<li><p>Optionally implements coherent cache and Host-Managed Device Memory</p></li>
<li><p>Is typically an accelerator device w/ high bandwidth memory.</p></li>
</ul>
<p>The primary difference between a type-1 and type-2 device is the presence
of host-managed device memory, which allows the device to operate on a
local memory bank - while the CPU sill has coherent DMA to the same memory.</p>
<p>The allows things like GPUs to expose their memory via DAX devices or file
descriptors, allows drivers and programs direct access to device memory
rather than use block-transfer semantics.</p>
</section>
<section id="type-3">
<h3>Type-3<a class="headerlink" href="#type-3" title="Link to this heading">¶</a></h3>
<p>A Type-3 CXL Device</p>
<ul class="simple">
<li><p>Supports cxl.io and cxl.mem</p></li>
<li><p>Implements Host-Managed Device Memory</p></li>
<li><p>May provide either Volatile or Persistent memory capacity (or both).</p></li>
</ul>
<p>A basic example of a type-3 device is a simple memory expander, whose
local memory capacity is exposed to the CPU for access directly via
basic coherent DMA.</p>
</section>
<section id="switch">
<h3>Switch<a class="headerlink" href="#switch" title="Link to this heading">¶</a></h3>
<p>A CXL switch is a device capacity of routing any CXL (and by extension, PCIe)
protocol between an upstream, downstream, or peer devices.  Many devices, such
as Multi-Logical Devices, imply the presence of switching in some manner.</p>
</section>
<section id="logical-devices-and-heads">
<h3>Logical Devices and Heads<a class="headerlink" href="#logical-devices-and-heads" title="Link to this heading">¶</a></h3>
<p>A CXL device may present one or more “Logical Devices” to one or more hosts
(via physical “Heads”).</p>
<p>A Single-Logical Device (SLD) is a device which presents a single device to
one or more heads.</p>
<p>A Multi-Logical Device (MLD) is a device which may present multiple devices
to one or more devices.</p>
<p>A Single-Headed Device exposes only a single physical connection.</p>
<p>A Multi-Headed Device exposes multiple physical connections.</p>
<section id="mhsld">
<h4>MHSLD<a class="headerlink" href="#mhsld" title="Link to this heading">¶</a></h4>
<p>A Multi-Headed Single-Logical Device (MHSLD) exposes a single logical
device to multiple heads which may be connected to one or more discrete
hosts.  An example of this would be a simple memory-pool which may be
statically configured (prior to boot) to expose portions of its memory
to Linux via <a class="reference internal" href="../platform/acpi/cedt.html"><span class="doc">CEDT</span></a>.</p>
</section>
<section id="mhmld">
<h4>MHMLD<a class="headerlink" href="#mhmld" title="Link to this heading">¶</a></h4>
<p>A Multi-Headed Multi-Logical Device (MHMLD) exposes multiple logical
devices to multiple heads which may be connected to one or more discrete
hosts.  An example of this would be a Dynamic Capacity Device or which
may be configured at runtime to expose portions of its memory to Linux.</p>
</section>
</section>
</section>
<section id="example-devices">
<h2>Example Devices<a class="headerlink" href="#example-devices" title="Link to this heading">¶</a></h2>
<section id="memory-expander">
<h3>Memory Expander<a class="headerlink" href="#memory-expander" title="Link to this heading">¶</a></h3>
<p>The simplest form of Type-3 device is a memory expander.  A memory expander
exposes Host-Managed Device Memory (HDM) to Linux.  This memory may be
Volatile or Non-Volatile (Persistent).</p>
<p>Memory Expanders will typically be considered a form of Single-Headed,
Single-Logical Device - as its form factor will typically be an add-in-card
(AIC) or some other similar form-factor.</p>
<p>The Linux CXL driver provides support for static or dynamic configuration of
basic memory expanders.  The platform may program decoders prior to OS init
(e.g. auto-decoders), or the user may program the fabric if the platform
defers these operations to the OS.</p>
<p>Multiple Memory Expanders may be added to an external chassis and exposed to
a host via a head attached to a CXL switch.  This is a “memory pool”, and
would be considered an MHSLD or MHMLD depending on the management capabilities
provided by the switch platform.</p>
<p>As of v6.14, Linux does not provide a formalized interface to manage non-DCD
MHSLD or MHMLD devices.</p>
</section>
<section id="dynamic-capacity-device-dcd">
<h3>Dynamic Capacity Device (DCD)<a class="headerlink" href="#dynamic-capacity-device-dcd" title="Link to this heading">¶</a></h3>
<p>A Dynamic Capacity Device is a Type-3 device which provides dynamic management
of memory capacity. The basic premise of a DCD to provide an allocator-like
interface for physical memory capacity to a “Fabric Manager” (an external,
privileged host with privileges to change configurations for other hosts).</p>
<p>A DCD manages “Memory Extents”, which may be volatile or persistent. Extents
may also be exclusive to a single host or shared across multiple hosts.</p>
<p>As of v6.14, Linux does not provide a formalized interface to manage DCD
devices, however there is active work on LKML targeting future release.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/driver-api/cxl/devices/device-types.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>