<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Console &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MOXA Smartio/Industio Family Device Driver Installation Guide" href="moxa-smartio.html" />
    <link rel="prev" title="TTY Internals" href="tty_internals.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.15.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Driver APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#general-information-for-driver-authors">General information for driver authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#useful-support-libraries">Useful support libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#bus-level-documentation">Bus-level documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#subsystem-specific-apis">Subsystem-specific APIs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../80211/index.html">Linux 802.11 Driver Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../clk.html">The Common Clk Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../console.html">Console Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crypto/index.html">Crypto Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dpll.html">The Linux kernel dpll subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extcon.html">Extcon Device Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aperture.html">Managing Ownership of the Framebuffer Aperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hte/index.html">The Linux Hardware Timestamping Engine (HTE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../input.html">Input Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../libata.html">libATA Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mailbox.html">The Common Mailbox Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../md/index.html">RAID</a></li>
<li class="toctree-l3"><a class="reference internal" href="../media/index.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../message-based.html">Message-based devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ntb.html">NTB Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pin-control.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pldmfw/index.html">PLDM Firmware Flash Update Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pldmfw/index.html#overview-of-the-pldmfw-library">Overview of the <code class="docutils literal notranslate"><span class="pre">pldmfw</span></code> library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pwrseq.html">Power Sequencing API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reset.html">Reset controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sm501.html">SM501 Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../surface_aggregator/index.html">Surface System Aggregator Module (SSAM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tee.html">TEE (Trusted Execution Environment) driver API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../thermal/index.html">Thermal</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">TTY</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wbrf.html">WBRF - Wifi Band RFI Mitigations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wmi.html">WMI Driver API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zorro.html">Writing Device Drivers for Zorro Devices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/tty/console.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="console">
<h1>Console<a class="headerlink" href="#console" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#struct-console" id="id2">Struct Console</a></p>
<ul>
<li><p><a class="reference internal" href="#internals" id="id3">Internals</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#struct-consw" id="id4">Struct Consw</a></p></li>
<li><p><a class="reference internal" href="#console-functions" id="id5">Console functions</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id6">Internals</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="struct-console">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Struct Console</a><a class="headerlink" href="#struct-console" title="Link to this heading">¶</a></h2>
<dl class="c enum">
<dt class="sig sig-object c" id="c.cons_flags">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cons_flags</span></span></span><a class="headerlink" href="#c.cons_flags" title="Link to this definition">¶</a><br /></dt>
<dd><p>General console flags</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CON_PRINTBUFFER</span></code></dt><dd><p>Used by newly registered consoles to avoid duplicate
output of messages that were already shown by boot
consoles or read by userspace via syslog() syscall.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CON_CONSDEV</span></code></dt><dd><p>Indicates that the console driver is backing
/dev/console.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CON_ENABLED</span></code></dt><dd><p>Indicates if a console is allowed to print records. If
false, the console also will not advance to later
records.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CON_BOOT</span></code></dt><dd><p>Marks the console driver as early console driver which
is used during boot before the real driver becomes
available. It will be automatically unregistered
when the real console driver is registered unless
“keep_bootcon” parameter is used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CON_ANYTIME</span></code></dt><dd><p>A misnomed historical flag which tells the core code
that the legacy <strong>console</strong>::write callback can be invoked
on a CPU which is marked OFFLINE. That is misleading as
it suggests that there is no contextual limit for
invoking the callback. The original motivation was
readiness of the per-CPU areas.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CON_BRL</span></code></dt><dd><p>Indicates a braille device which is exempt from
receiving the printk spam for obvious reasons.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CON_EXTENDED</span></code></dt><dd><p>The console supports the extended output format of
/dev/kmesg which requires a larger output buffer.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CON_SUSPENDED</span></code></dt><dd><p>Indicates if a console is suspended. If true, the
printing callbacks must not be called.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CON_NBCON</span></code></dt><dd><p>Console can operate outside of the legacy style console_lock
constraints.</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.console">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">console</span></span></span><a class="headerlink" href="#c.console" title="Link to this definition">¶</a><br /></dt>
<dd><p>The console descriptor structure</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct console {
    char name[16];
    void (*write)(struct console *co, const char *s, unsigned int count);
    int (*read)(struct console *co, char *s, unsigned int count);
    struct tty_driver       *(*device)(struct console *co, int *index);
    void (*unblank)(void);
    int (*setup)(struct console *co, char *options);
    int (*exit)(struct console *co);
    int (*match)(struct console *co, char *name, int idx, char *options);
    short flags;
    short index;
    int cflag;
    uint ispeed;
    uint ospeed;
    u64 seq;
    unsigned long           dropped;
    void *data;
    struct hlist_node       node;
    void (*write_atomic)(struct console *con, struct nbcon_write_context *wctxt);
    void (*write_thread)(struct console *con, struct nbcon_write_context *wctxt);
    void (*device_lock)(struct console *con, unsigned long *flags);
    void (*device_unlock)(struct console *con, unsigned long flags);
    atomic_t __private nbcon_state;
    atomic_long_t __private nbcon_seq;
    struct nbcon_context    __private nbcon_device_ctxt;
    atomic_long_t __private nbcon_prev_seq;
    struct printk_buffers   *pbufs;
    struct task_struct      *kthread;
    struct rcuwait          rcuwait;
    struct irq_work         irq_work;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>The name of the console driver</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write</span></code></dt><dd><p>Legacy write callback to output messages (Optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">read</span></code></dt><dd><p>Read callback for console input (Optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device</span></code></dt><dd><p>The underlying TTY device driver (Optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unblank</span></code></dt><dd><p>Callback to unblank the console (Optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">setup</span></code></dt><dd><p>Callback for initializing the console (Optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">exit</span></code></dt><dd><p>Callback for teardown of the console (Optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">match</span></code></dt><dd><p>Callback for matching a console (Optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>Console flags. See <a class="reference internal" href="#c.cons_flags" title="cons_flags"><code class="xref c c-enum docutils literal notranslate"><span class="pre">enum</span> <span class="pre">cons_flags</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">index</span></code></dt><dd><p>Console index, e.g. port number</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cflag</span></code></dt><dd><p>TTY control mode flags</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ispeed</span></code></dt><dd><p>TTY input speed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ospeed</span></code></dt><dd><p>TTY output speed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">seq</span></code></dt><dd><p>Sequence number of the next ringbuffer record to print</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dropped</span></code></dt><dd><p>Number of unreported dropped ringbuffer records</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>Driver private data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">node</span></code></dt><dd><p>hlist node for the console list</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_atomic</span></code></dt><dd><p>NBCON callback to write out text in any context. (Optional)</p>
<p>This callback is called with the console already acquired. However,
a higher priority context is allowed to take it over by default.</p>
<p>The callback must call nbcon_enter_unsafe() and nbcon_exit_unsafe()
around any code where the takeover is not safe, for example, when
manipulating the serial port registers.</p>
<p>nbcon_enter_unsafe() will fail if the context has lost the console
ownership in the meantime. In this case, the callback is no longer
allowed to go forward. It must back out immediately and carefully.
The buffer content is also no longer trusted since it no longer
belongs to the context.</p>
<p>The callback should allow the takeover whenever it is safe. It
increases the chance to see messages when the system is in trouble.
If the driver must reacquire ownership in order to finalize or
revert hardware changes, nbcon_reacquire_nobuf() can be used.
However, on reacquire the buffer content is no longer available. A
reacquire cannot be used to resume printing.</p>
<p>The callback can be called from any context (including NMI).
Therefore it must avoid usage of any locking and instead rely
on the console ownership for synchronization.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_thread</span></code></dt><dd><p>NBCON callback to write out text in task context.</p>
<p>This callback must be called only in task context with both
device_lock() and the nbcon console acquired with
NBCON_PRIO_NORMAL.</p>
<p>The same rules for console ownership verification and unsafe
sections handling applies as with write_atomic().</p>
<p>The console ownership handling is necessary for synchronization
against write_atomic() which is synchronized only via the context.</p>
<p>The device_lock() provides the primary serialization for operations
on the device. It might be as relaxed (mutex)[*] or as tight
(disabled preemption and interrupts) as needed. It allows
the kthread to operate in the least restrictive mode[**].</p>
<dl class="simple">
<dt>[*] Standalone nbcon_context_try_acquire() is not safe with</dt><dd><p>the preemption enabled, see nbcon_owner_matches(). But it
can be safe when always called in the preemptive context
under the device_lock().</p>
</dd>
<dt>[**] The device_lock() makes sure that nbcon_context_try_acquire()</dt><dd><p>would never need to spin which is important especially with
PREEMPT_RT.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device_lock</span></code></dt><dd><p>NBCON callback to begin synchronization with driver code.</p>
<p>Console drivers typically must deal with access to the hardware
via user input/output (such as an interactive login shell) and
output of kernel messages via <a class="reference internal" href="../../core-api/printk-basics.html#c.printk" title="printk"><code class="xref c c-func docutils literal notranslate"><span class="pre">printk()</span></code></a> calls. This callback is
called by the printk-subsystem whenever it needs to synchronize
with hardware access by the driver. It should be implemented to
use whatever synchronization mechanism the driver is using for
itself (for example, the port lock for uart serial consoles).</p>
<p>The callback is always called from task context. It may use any
synchronization method required by the driver.</p>
<dl class="simple">
<dt>IMPORTANT: The callback MUST disable migration. The console driver</dt><dd><p>may be using a synchronization mechanism that already takes
care of this (such as spinlocks). Otherwise this function must
explicitly call migrate_disable().</p>
</dd>
</dl>
<p>The flags argument is provided as a convenience to the driver. It
will be passed again to device_unlock(). It can be ignored if the
driver does not need it.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device_unlock</span></code></dt><dd><p>NBCON callback to finish synchronization with driver code.</p>
<p>It is the counterpart to device_lock().</p>
<p>This callback is always called from task context. It must
appropriately re-enable migration (depending on how device_lock()
disabled migration).</p>
<p>The flags argument is the value of the same variable that was
passed to device_lock().</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nbcon_state</span></code></dt><dd><p>State for nbcon consoles</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nbcon_seq</span></code></dt><dd><p>Sequence number of the next record for nbcon to print</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nbcon_device_ctxt</span></code></dt><dd><p>Context available for non-printing operations</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nbcon_prev_seq</span></code></dt><dd><p>Seq num the previous nbcon owner was assigned to print</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pbufs</span></code></dt><dd><p>Pointer to nbcon private buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kthread</span></code></dt><dd><p>Printer kthread for this console</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rcuwait</span></code></dt><dd><p>RCU-safe wait object for <strong>kthread</strong> waking</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">irq_work</span></code></dt><dd><p>Defer <strong>kthread</strong> waking to IRQ work context</p>
</dd>
</dl>
</div>
<section id="internals">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Internals</a><a class="headerlink" href="#internals" title="Link to this heading">¶</a></h3>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nbcon_state">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nbcon_state</span></span></span><a class="headerlink" href="#c.nbcon_state" title="Link to this definition">¶</a><br /></dt>
<dd><p>console state for nbcon consoles</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct nbcon_state {
    union {
        unsigned int    atom;
        struct {
            unsigned int prio               :  2;
            unsigned int req_prio           :  2;
            unsigned int unsafe             :  1;
            unsigned int unsafe_takeover    :  1;
            unsigned int cpu                : 24;
        };
    };
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">{unnamed_union}</span></code></dt><dd><p>anonymous</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">atom</span></code></dt><dd><p>Compound of the state fields for atomic operations</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">{unnamed_struct}</span></code></dt><dd><p>anonymous</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">prio</span></code></dt><dd><p>The priority of the current owner</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req_prio</span></code></dt><dd><p>The priority of a handover request</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsafe</span></code></dt><dd><p>Console is busy in a non takeover region</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsafe_takeover</span></code></dt><dd><p>A hostile takeover in an unsafe state happened in the
past. The console cannot be safe until re-initialized.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cpu</span></code></dt><dd><p>The CPU on which the owner runs</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>To be used for reading and preparing of the value stored in the nbcon
state variable <strong>console</strong>::nbcon_state.</p>
<p>The <strong>prio</strong> and <strong>req_prio</strong> fields are particularly important to allow
spin-waiting to timeout and give up without the risk of a waiter being
assigned the lock after giving up.</p>
<dl class="c enum">
<dt class="sig sig-object c" id="c.nbcon_prio">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nbcon_prio</span></span></span><a class="headerlink" href="#c.nbcon_prio" title="Link to this definition">¶</a><br /></dt>
<dd><p>console owner priority for nbcon consoles</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">NBCON_PRIO_NONE</span></code></dt><dd><p>Unused</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">NBCON_PRIO_NORMAL</span></code></dt><dd><p>Normal (non-emergency) usage</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">NBCON_PRIO_EMERGENCY</span></code></dt><dd><p>Emergency output (WARN/OOPS...)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">NBCON_PRIO_PANIC</span></code></dt><dd><p>Panic output</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">NBCON_PRIO_MAX</span></code></dt><dd><p>The number of priority levels</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>A higher priority context can takeover the console when it is
in the safe state. The final attempt to flush consoles in <a class="reference internal" href="../basics.html#c.panic" title="panic"><code class="xref c c-func docutils literal notranslate"><span class="pre">panic()</span></code></a>
can be allowed to do so even in an unsafe state (Hope and pray).</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nbcon_context">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nbcon_context</span></span></span><a class="headerlink" href="#c.nbcon_context" title="Link to this definition">¶</a><br /></dt>
<dd><p>Context for console acquire/release</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct nbcon_context {
    struct console          *console;
    unsigned int            spinwait_max_us;
    enum nbcon_prio         prio;
    unsigned int            allow_unsafe_takeover   : 1;
    unsigned int            backlog                 : 1;
    struct printk_buffers   *pbufs;
    u64 seq;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">console</span></code></dt><dd><p>The associated console</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">spinwait_max_us</span></code></dt><dd><p>Limit for spin-wait acquire</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">prio</span></code></dt><dd><p>Priority of the context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">allow_unsafe_takeover</span></code></dt><dd><p>Allow performing takeover even if unsafe. Can
be used only with NBCON_PRIO_PANIC <strong>prio</strong>. It
might cause a system freeze when the console
is used later.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">backlog</span></code></dt><dd><p>Ringbuffer has pending records</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pbufs</span></code></dt><dd><p>Pointer to the text buffer for this context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">seq</span></code></dt><dd><p>The sequence number to print for this context</p>
</dd>
</dl>
</div>
<dl class="c struct">
<dt class="sig sig-object c" id="c.nbcon_write_context">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">nbcon_write_context</span></span></span><a class="headerlink" href="#c.nbcon_write_context" title="Link to this definition">¶</a><br /></dt>
<dd><p>Context handed to the nbcon write callbacks</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct nbcon_write_context {
    struct nbcon_context    __private ctxt;
    char *outbuf;
    unsigned int            len;
    bool unsafe_takeover;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ctxt</span></code></dt><dd><p>The core console context</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">outbuf</span></code></dt><dd><p>Pointer to the text buffer for output</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">len</span></code></dt><dd><p>Length to write</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsafe_takeover</span></code></dt><dd><p>If a hostile takeover in an unsafe state has occurred</p>
</dd>
</dl>
</div>
</section>
</section>
<section id="struct-consw">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Struct Consw</a><a class="headerlink" href="#struct-consw" title="Link to this heading">¶</a></h2>
<dl class="c struct">
<dt class="sig sig-object c" id="c.consw">
<span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">consw</span></span></span><a class="headerlink" href="#c.consw" title="Link to this definition">¶</a><br /></dt>
<dd><p>callbacks for consoles</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct consw {
    struct module *owner;
    const char *(*con_startup)(void);
    void (*con_init)(struct vc_data *vc, bool init);
    void (*con_deinit)(struct vc_data *vc);
    void (*con_clear)(struct vc_data *vc, unsigned int y, unsigned int x, unsigned int count);
    void (*con_putc)(struct vc_data *vc, u16 ca, unsigned int y, unsigned int x);
    void (*con_putcs)(struct vc_data *vc, const u16 *s,unsigned int count, unsigned int ypos, unsigned int xpos);
    void (*con_cursor)(struct vc_data *vc, bool enable);
    bool (*con_scroll)(struct vc_data *vc, unsigned int top,unsigned int bottom, enum con_scroll dir, unsigned int lines);
    bool (*con_switch)(struct vc_data *vc);
    bool (*con_blank)(struct vc_data *vc, enum vesa_blank_mode blank, bool mode_switch);
    int (*con_font_set)(struct vc_data *vc,const struct console_font *font, unsigned int vpitch, unsigned int flags);
    int (*con_font_get)(struct vc_data *vc, struct console_font *font, unsigned int vpitch);
    int (*con_font_default)(struct vc_data *vc, struct console_font *font, const char *name);
    int (*con_resize)(struct vc_data *vc, unsigned int width, unsigned int height, bool from_user);
    void (*con_set_palette)(struct vc_data *vc, const unsigned char *table);
    void (*con_scrolldelta)(struct vc_data *vc, int lines);
    bool (*con_set_origin)(struct vc_data *vc);
    void (*con_save_screen)(struct vc_data *vc);
    u8 (*con_build_attr)(struct vc_data *vc, u8 color,enum vc_intensity intensity, bool blink, bool underline, bool reverse, bool italic);
    void (*con_invert_region)(struct vc_data *vc, u16 *p, int count);
    void (*con_debug_enter)(struct vc_data *vc);
    void (*con_debug_leave)(struct vc_data *vc);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">owner</span></code></dt><dd><p>the module to get references of when this console is used</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_startup</span></code></dt><dd><p>set up the console and return its name (like VGA, EGA, ...)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_init</span></code></dt><dd><p>initialize the console on <strong>vc</strong>. <strong>init</strong> is true for the very first
call on this <strong>vc</strong>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_deinit</span></code></dt><dd><p>deinitialize the console from <strong>vc</strong>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_clear</span></code></dt><dd><p>erase <strong>count</strong> characters at [<strong>x</strong>, <strong>y</strong>] on <strong>vc</strong>. <strong>count</strong> &gt;= 1.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_putc</span></code></dt><dd><p>emit one character with attributes <strong>ca</strong> to [<strong>x</strong>, <strong>y</strong>] on <strong>vc</strong>.
(optional -- <strong>con_putcs</strong> would be called instead)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_putcs</span></code></dt><dd><p>emit <strong>count</strong> characters with attributes <strong>s</strong> to [<strong>x</strong>, <strong>y</strong>] on <strong>vc</strong>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_cursor</span></code></dt><dd><p>enable/disable cursor depending on <strong>enable</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_scroll</span></code></dt><dd><p>move lines from <strong>top</strong> to <strong>bottom</strong> in direction <strong>dir</strong> by <strong>lines</strong>.
Return true if no generic handling should be done.
Invoked by csi_M and printing to the console.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_switch</span></code></dt><dd><p>notifier about the console switch; it is supposed to return
true if a redraw is needed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_blank</span></code></dt><dd><p>blank/unblank the console. The target mode is passed in <strong>blank</strong>.
<strong>mode_switch</strong> is set if changing from/to text/graphics. The hook
is supposed to return true if a redraw is needed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_font_set</span></code></dt><dd><p>set console <strong>vc</strong> font to <strong>font</strong> with height <strong>vpitch</strong>. <strong>flags</strong> can
be <code class="docutils literal notranslate"><span class="pre">KD_FONT_FLAG_DONT_RECALC</span></code>. (optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_font_get</span></code></dt><dd><p>fetch the current font on <strong>vc</strong> of height <strong>vpitch</strong> into <strong>font</strong>.
(optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_font_default</span></code></dt><dd><p>set default font on <strong>vc</strong>. <strong>name</strong> can be <code class="docutils literal notranslate"><span class="pre">NULL</span></code> or font name
to search for. <strong>font</strong> can be filled back. (optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_resize</span></code></dt><dd><p>resize the <strong>vc</strong> console to <strong>width</strong> x <strong>height</strong>. <strong>from_user</strong> is true
when this change comes from the user space.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_set_palette</span></code></dt><dd><p>sets the palette of the console <strong>vc</strong> to <strong>table</strong> (optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_scrolldelta</span></code></dt><dd><p>the contents of the console should be scrolled by <strong>lines</strong>.
Invoked by user. (optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_set_origin</span></code></dt><dd><p>set origin (see <code class="xref c c-type docutils literal notranslate"><span class="pre">vc_data</span></code>::vc_origin) of the <strong>vc</strong>. If not
provided or returns false, the origin is set to
<strong>vc-&gt;vc_screenbuf</strong>. (optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_save_screen</span></code></dt><dd><p>save screen content into <strong>vc-&gt;vc_screenbuf</strong>. Called e.g.
upon entering graphics. (optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_build_attr</span></code></dt><dd><p>build attributes based on <strong>color</strong>, <strong>intensity</strong> and other
parameters. The result is used for both normal and erase
characters. (optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_invert_region</span></code></dt><dd><p>invert a region of length <strong>count</strong> on <strong>vc</strong> starting at <strong>p</strong>.
(optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_debug_enter</span></code></dt><dd><p>prepare the console for the debugger. This includes, but
is not limited to, unblanking the console, loading an
appropriate palette, and allowing debugger generated output.
(optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">con_debug_leave</span></code></dt><dd><p>restore the console to its pre-debug state as closely as
possible. (optional)</p>
</dd>
</dl>
</div>
</section>
<section id="console-functions">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Console functions</a><a class="headerlink" href="#console-functions" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.console_srcu_read_flags">
<span class="kt"><span class="pre">short</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">console_srcu_read_flags</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.console" title="console"><span class="n"><span class="pre">console</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">con</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.console_srcu_read_flags" title="Link to this definition">¶</a><br /></dt>
<dd><p>Locklessly read flags of a possibly registered console</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">console</span> <span class="pre">*con</span></code></dt><dd><p><a class="reference internal" href="#c.console" title="console"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">console</span></code></a> pointer of console to read flags from</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Locklessly reading <strong>con-&gt;flags</strong> provides a consistent read value because
there is at most one CPU modifying <strong>con-&gt;flags</strong> and that CPU is using only
read-modify-write operations to do so.</p>
<p>Requires console_srcu_read_lock to be held, which implies that <strong>con</strong> might
be a registered console. The purpose of holding console_srcu_read_lock is
to guarantee that the console state is valid (CON_SUSPENDED/CON_ENABLED)
and that no exit/cleanup routines will run if the console is currently
undergoing unregistration.</p>
<p>If the caller is holding the console_list_lock or it is _certain_ that
<strong>con</strong> is not and will not become registered, the caller may read
<strong>con-&gt;flags</strong> directly instead.</p>
<p><strong>Context</strong></p>
<p>Any context.</p>
<p><strong>Return</strong></p>
<p>The current value of the <strong>con-&gt;flags</strong> field.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.console_srcu_write_flags">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">console_srcu_write_flags</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.console" title="console"><span class="n"><span class="pre">console</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">con</span></span>, <span class="kt"><span class="pre">short</span></span><span class="w"> </span><span class="n"><span class="pre">flags</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.console_srcu_write_flags" title="Link to this definition">¶</a><br /></dt>
<dd><p>Write flags for a registered console</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">console</span> <span class="pre">*con</span></code></dt><dd><p><a class="reference internal" href="#c.console" title="console"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">console</span></code></a> pointer of console to write flags to</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">short</span> <span class="pre">flags</span></code></dt><dd><p>new flags value to write</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Only use this function to write flags for registered consoles. It
requires holding the console_list_lock.</p>
<p><strong>Context</strong></p>
<p>Any context.</p>
</div>
<dl class="c macro">
<dt class="sig sig-object c" id="c.for_each_console_srcu">
<span class="sig-name descname"><span class="n"><span class="pre">for_each_console_srcu</span></span></span><a class="headerlink" href="#c.for_each_console_srcu" title="Link to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">for_each_console_srcu</span> <span class="pre">(con)</span></code></p>
<blockquote>
<div><p>Iterator over registered consoles</p>
</div></blockquote>
<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">con</span></code></dt><dd><p><a class="reference internal" href="#c.console" title="console"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">console</span></code></a> pointer used as loop cursor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Although SRCU guarantees the console list will be consistent, the
<a class="reference internal" href="#c.console" title="console"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">console</span></code></a> fields may be updated by other CPUs while iterating.</p>
<p>Requires console_srcu_read_lock to be held. Can be invoked from
any context.</p>
</div>
<dl class="c macro">
<dt class="sig sig-object c" id="c.for_each_console">
<span class="sig-name descname"><span class="n"><span class="pre">for_each_console</span></span></span><a class="headerlink" href="#c.for_each_console" title="Link to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">for_each_console</span> <span class="pre">(con)</span></code></p>
<blockquote>
<div><p>Iterator over registered consoles</p>
</div></blockquote>
<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">con</span></code></dt><dd><p><a class="reference internal" href="#c.console" title="console"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">console</span></code></a> pointer used as loop cursor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The console list and the <a class="reference internal" href="#c.console" title="console"><code class="xref c c-type docutils literal notranslate"><span class="pre">console.flags</span></code></a> are immutable while iterating.</p>
<p>Requires console_list_lock to be held.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.clear_selection">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">clear_selection</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.clear_selection" title="Link to this definition">¶</a><br /></dt>
<dd><p>remove current selection</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span></code></dt><dd><p>no arguments</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Remove the current selection highlight, if any from the console holding the
selection.</p>
<p>Locking: The caller must hold the console lock.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.__vc_resize">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">__vc_resize</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">vc_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vc</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">cols</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">rows</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">from_user</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.__vc_resize" title="Link to this definition">¶</a><br /></dt>
<dd><p>resize a VT</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vc_data</span> <span class="pre">*vc</span></code></dt><dd><p>virtual console</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">cols</span></code></dt><dd><p>columns</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">rows</span></code></dt><dd><p>rows</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">from_user</span></code></dt><dd><p>invoked by a user?</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Resize a virtual console as seen from the console end of things. We use the
common <a class="reference internal" href="#c.vc_do_resize" title="vc_do_resize"><code class="xref c c-func docutils literal notranslate"><span class="pre">vc_do_resize()</span></code></a> method to update the structures.</p>
<p>Locking: The caller must hold the console sem to protect console internals
and <strong>vc-&gt;port.tty</strong>.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.con_is_bound">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">con_is_bound</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.consw" title="consw"><span class="n"><span class="pre">consw</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">csw</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.con_is_bound" title="Link to this definition">¶</a><br /></dt>
<dd><p>checks if driver is bound to the console</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">consw</span> <span class="pre">*csw</span></code></dt><dd><p>console driver</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>zero if unbound, nonzero if bound</p>
<p><strong>Description</strong></p>
<p>Drivers can call this and if zero, they should release
all resources allocated on <a class="reference internal" href="#c.consw" title="consw"><code class="xref c c-type docutils literal notranslate"><span class="pre">consw.con_startup()</span></code></a></p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.con_is_visible">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">con_is_visible</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">vc_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vc</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.con_is_visible" title="Link to this definition">¶</a><br /></dt>
<dd><p>checks whether the current console is visible</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">vc_data</span> <span class="pre">*vc</span></code></dt><dd><p>virtual console</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>zero if not visible, nonzero if visible</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.con_debug_enter">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">con_debug_enter</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">vc_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vc</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.con_debug_enter" title="Link to this definition">¶</a><br /></dt>
<dd><p>prepare the console for the kernel debugger</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vc_data</span> <span class="pre">*vc</span></code></dt><dd><p>virtual console</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when the console is taken over by the kernel debugger, this
function needs to save the current console state, then put the console
into a state suitable for the kernel debugger.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.con_debug_leave">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">con_debug_leave</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.con_debug_leave" title="Link to this definition">¶</a><br /></dt>
<dd><p>restore console state</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">void</span></code></dt><dd><p>no arguments</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Restore the console state to what it was before the kernel debugger
was invoked.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.do_unregister_con_driver">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">do_unregister_con_driver</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.consw" title="consw"><span class="n"><span class="pre">consw</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">csw</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.do_unregister_con_driver" title="Link to this definition">¶</a><br /></dt>
<dd><p>unregister console driver from console layer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">consw</span> <span class="pre">*csw</span></code></dt><dd><p>console driver</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>All drivers that registers to the console layer must
call this function upon exit, or if the console driver is in a state
where it won’t be able to handle console services, such as the
framebuffer console without loaded framebuffer drivers.</p>
<p>The driver must unbind first prior to unregistration.</p>
</div>
<section id="id1">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Internals</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.sel_loadlut">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">sel_loadlut</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u32</span></span><span class="w"> </span><span class="pre">__user</span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">lut</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.sel_loadlut" title="Link to this definition">¶</a><br /></dt>
<dd><p>load the LUT table</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">__user</span> <span class="pre">*lut</span></code></dt><dd><p>user table</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Load the LUT table from user space. Make a temporary copy so a partial
update doesn’t make a mess.</p>
<p>Locking: The console lock is acquired.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.set_selection_user">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_selection_user</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">tiocl_selection</span></span><span class="w"> </span><span class="pre">__user</span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">sel</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.set_selection_user" title="Link to this definition">¶</a><br /></dt>
<dd><p>set the current selection.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tiocl_selection</span> <span class="pre">__user</span> <span class="pre">*sel</span></code></dt><dd><p>user selection info</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>the console tty</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Invoked by the ioctl handle for the vt layer.</p>
<p>Locking: The entire selection process is managed under the console_lock.
It’s a lot under the lock but its hardly a performance path.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.vc_do_resize">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">vc_do_resize</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">vc_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vc</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">cols</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">lines</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">from_user</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.vc_do_resize" title="Link to this definition">¶</a><br /></dt>
<dd><p>resizing method for the tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty being resized</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vc_data</span> <span class="pre">*vc</span></code></dt><dd><p>virtual console private data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">cols</span></code></dt><dd><p>columns</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">lines</span></code></dt><dd><p>lines</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">from_user</span></code></dt><dd><p>invoked by a user?</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Resize a virtual console, clipping according to the actual constraints. If
the caller passes a tty structure then update the termios winsize
information and perform any necessary signal handling.</p>
<p>Locking: Caller must hold the console semaphore. Takes the termios rwsem and
ctrl.lock of the tty IFF a tty is passed.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.vt_resize">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">vt_resize</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">winsize</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ws</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.vt_resize" title="Link to this definition">¶</a><br /></dt>
<dd><p>resize a VT</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty to resize</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">winsize</span> <span class="pre">*ws</span></code></dt><dd><p>winsize attributes</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Resize a virtual terminal. This is called by the tty layer as we register
our own handler for resizing. The mutual helper does all the actual work.</p>
<p>Locking: Takes the console sem and the called methods then take the tty
termios_rwsem and the tty ctrl.lock in that order.</p>
</div>
<dl class="c enum">
<dt class="sig sig-object c" id="c.vc_ctl_state">
<span class="k"><span class="pre">enum</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">vc_ctl_state</span></span></span><a class="headerlink" href="#c.vc_ctl_state" title="Link to this definition">¶</a><br /></dt>
<dd><p>control characters state of a vt</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ESnormal</span></code></dt><dd><p>initial state, no control characters parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESesc</span></code></dt><dd><p>ESC parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESsquare</span></code></dt><dd><p>CSI parsed -- modifiers/parameters/ctrl chars expected</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESgetpars</span></code></dt><dd><p>CSI parsed -- parameters/ctrl chars expected</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESfunckey</span></code></dt><dd><p>CSI [ parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">EShash</span></code></dt><dd><p>ESC # parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESsetG0</span></code></dt><dd><p>ESC ( parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESsetG1</span></code></dt><dd><p>ESC ) parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESpercent</span></code></dt><dd><p>ESC % parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">EScsiignore</span></code></dt><dd><p>CSI [0x20-0x3f] parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESnonstd</span></code></dt><dd><p>OSC parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESpalette</span></code></dt><dd><p>OSC P parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESosc</span></code></dt><dd><p>OSC [0-9] parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESANSI_first</span></code></dt><dd><p>first state for ignoring ansi control sequences</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESapc</span></code></dt><dd><p>ESC _ parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESpm</span></code></dt><dd><p>ESC ^ parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESdcs</span></code></dt><dd><p>ESC P parsed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ESANSI_last</span></code></dt><dd><p>last state for ignoring ansi control sequences</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.vc_sanitize_unicode">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">vc_sanitize_unicode</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.vc_sanitize_unicode" title="Link to this definition">¶</a><br /></dt>
<dd><p>Replace invalid Unicode code points with <code class="docutils literal notranslate"><span class="pre">U+FFFD</span></code></p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">int</span> <span class="pre">c</span></code></dt><dd><p>the received code point</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.vc_translate_unicode">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">vc_translate_unicode</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">vc_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">vc</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rescan</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.vc_translate_unicode" title="Link to this definition">¶</a><br /></dt>
<dd><p>Combine UTF-8 into Unicode in <code class="xref c c-type docutils literal notranslate"><span class="pre">vc_data.vc_utf_char</span></code></p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vc_data</span> <span class="pre">*vc</span></code></dt><dd><p>virtual console</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">c</span></code></dt><dd><p>UTF-8 byte to translate</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">*rescan</span></code></dt><dd><p>set to true iff <strong>c</strong> wasn’t consumed here and needs to be re-processed</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<ul class="simple">
<li><p><code class="xref c c-type docutils literal notranslate"><span class="pre">vc_data.vc_utf_char</span></code> is the being-constructed Unicode code point.</p></li>
<li><p><code class="xref c c-type docutils literal notranslate"><span class="pre">vc_data.vc_utf_count</span></code> is the number of continuation bytes still expected to
arrive.</p></li>
<li><p><code class="xref c c-type docutils literal notranslate"><span class="pre">vc_data.vc_npar</span></code> is the number of continuation bytes arrived so far.</p></li>
</ul>
<p><strong>Return</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> - Input OK so far, <strong>c</strong> consumed, further bytes expected.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">0xFFFD</span></code> - Possibility 1: input invalid, <strong>c</strong> may have been consumed (see</dt><dd><p>desc. of <strong>rescan</strong>). Possibility 2: input OK, <strong>c</strong> consumed,
<code class="docutils literal notranslate"><span class="pre">U+FFFD</span></code> is the resulting code point. <code class="docutils literal notranslate"><span class="pre">U+FFFD</span></code> is valid,
<code class="docutils literal notranslate"><span class="pre">REPLACEMENT</span> <span class="pre">CHARACTER</span></code>.</p>
</dd>
</dl>
</li>
<li><p>otherwise - Input OK, <strong>c</strong> consumed, resulting code point returned.</p></li>
</ul>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.vt_kmsg_redirect">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">vt_kmsg_redirect</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">new</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.vt_kmsg_redirect" title="Link to this definition">¶</a><br /></dt>
<dd><p>sets/gets the kernel message console</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">new</span></code></dt><dd><p>the new virtual terminal number or -1 if the console should stay
unchanged</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>By default, the kernel messages are always printed on the current virtual
console. However, the user may modify that default with the
<code class="docutils literal notranslate"><span class="pre">TIOCL_SETKMSGREDIRECT</span></code> ioctl call.</p>
<p>This function sets the kernel message console to be <strong>new</strong>. It returns the old
virtual console number. The virtual terminal number <code class="docutils literal notranslate"><span class="pre">0</span></code> (both as parameter and
return value) means no redirection (i.e. always printed on the currently
active console).</p>
<p>The parameter -1 means that only the current console is returned, but the
value is not modified. You may use the macro vt_get_kmsg_redirect() in that
case to make the code more understandable.</p>
<p>When the kernel is compiled without <code class="docutils literal notranslate"><span class="pre">CONFIG_VT_CONSOLE</span></code>, this function ignores
the parameter and always returns <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/tty/console.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>