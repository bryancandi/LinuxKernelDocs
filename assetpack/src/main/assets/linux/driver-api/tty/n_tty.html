<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>N_TTY &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="WBRF - Wifi Band RFI Mitigations" href="../wbrf.html" />
    <link rel="prev" title="GSM 0710 tty multiplexor HOWTO" href="n_gsm.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.15.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Driver APIs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#general-information-for-driver-authors">General information for driver authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#useful-support-libraries">Useful support libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#bus-level-documentation">Bus-level documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#subsystem-specific-apis">Subsystem-specific APIs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../80211/index.html">Linux 802.11 Driver Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../clk.html">The Common Clk Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../console.html">Console Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crypto/index.html">Crypto Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dpll.html">The Linux kernel dpll subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extcon.html">Extcon Device Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aperture.html">Managing Ownership of the Framebuffer Aperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hte/index.html">The Linux Hardware Timestamping Engine (HTE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../input.html">Input Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../libata.html">libATA Developer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mailbox.html">The Common Mailbox Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../md/index.html">RAID</a></li>
<li class="toctree-l3"><a class="reference internal" href="../media/index.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../message-based.html">Message-based devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ntb.html">NTB Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pin-control.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pldmfw/index.html">PLDM Firmware Flash Update Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pldmfw/index.html#overview-of-the-pldmfw-library">Overview of the <code class="docutils literal notranslate"><span class="pre">pldmfw</span></code> library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pwrseq.html">Power Sequencing API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reset.html">Reset controller API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sm501.html">SM501 Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../surface_aggregator/index.html">Surface System Aggregator Module (SSAM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tee.html">TEE (Trusted Execution Environment) driver API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../thermal/index.html">Thermal</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">TTY</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wbrf.html">WBRF - Wifi Band RFI Mitigations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wmi.html">WMI Driver API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zorro.html">Writing Device Drivers for Zorro Devices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystem-apis.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/tty/n_tty.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="n-tty">
<h1>N_TTY<a class="headerlink" href="#n-tty" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#external-functions" id="id1">External Functions</a></p></li>
<li><p><a class="reference internal" href="#internal-functions" id="id2">Internal Functions</a></p></li>
</ul>
</nav>
<p>The default (and fallback) <a class="reference internal" href="tty_ldisc.html"><span class="doc">TTY line discipline</span></a>. It tries to
handle characters as per POSIX.</p>
<section id="external-functions">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">External Functions</a><a class="headerlink" href="#external-functions" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_inherit_ops">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_inherit_ops</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_ldisc.html#c.tty_ldisc_ops" title="tty_ldisc_ops"><span class="n"><span class="pre">tty_ldisc_ops</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ops</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_inherit_ops" title="Link to this definition">¶</a><br /></dt>
<dd><p>inherit N_TTY methods</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_ldisc_ops</span> <span class="pre">*ops</span></code></dt><dd><p><a class="reference internal" href="tty_ldisc.html#c.tty_ldisc_ops" title="tty_ldisc_ops"><code class="xref c c-struct docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_ldisc_ops</span></code></a> where to save N_TTY methods</p>
<p>Enables a ‘subclass’ line discipline to ‘inherit’ N_TTY methods.</p>
</dd>
</dl>
</div>
</section>
<section id="internal-functions">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Internal Functions</a><a class="headerlink" href="#internal-functions" title="Link to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_kick_worker">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_kick_worker</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_kick_worker" title="Link to this definition">¶</a><br /></dt>
<dd><p>start input worker (if required)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Re-schedules the flip buffer work if it may have stopped.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>Caller holds exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>, or</p></li>
<li><dl class="simple">
<dt>n_tty_read()/consumer path:</dt><dd><p>holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_write_wakeup">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_write_wakeup</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_write_wakeup" title="Link to this definition">¶</a><br /></dt>
<dd><p>asynchronous I/O notifier</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Required for the ptys, serial driver etc. since processes that attach
themselves to the master and rely on ASYNC IO must be woken up.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.put_tty_queue">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">put_tty_queue</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">n_tty_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ldata</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.put_tty_queue" title="Link to this definition">¶</a><br /></dt>
<dd><p>add character to tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>character</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a character to the tty read_buf queue.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.reset_buffer_flags">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">reset_buffer_flags</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">n_tty_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ldata</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.reset_buffer_flags" title="Link to this definition">¶</a><br /></dt>
<dd><p>reset buffer state</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>line disc data to reset</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Reset the read buffer counters and clear the flags. Called from
<a class="reference internal" href="#c.n_tty_open" title="n_tty_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_open()</span></code></a> and <a class="reference internal" href="#c.n_tty_flush_buffer" title="n_tty_flush_buffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_flush_buffer()</span></code></a>.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>caller holds exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>, or</p></li>
<li><p>(locking is not required)</p></li>
</ul>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_flush_buffer">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_flush_buffer</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_flush_buffer" title="Link to this definition">¶</a><br /></dt>
<dd><p>clean input queue</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Flush the input buffer. Called when the tty layer wants the buffer flushed
(eg at hangup) or when the <code class="docutils literal notranslate"><span class="pre">N_TTY</span></code> line discipline internally has to clean
the pending queue (for example some signals).</p>
<p>Holds <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code> to exclude producer/consumer while buffer indices are
reset.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">ctrl</span></code>.lock, exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.is_utf8_continuation">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">is_utf8_continuation</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.is_utf8_continuation" title="Link to this definition">¶</a><br /></dt>
<dd><p>utf8 multibyte check</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>byte to check</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if the utf8 character <strong>c</strong> is a multibyte continuation
character. We use this to correctly compute the on-screen size of the
character when printing.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.is_continuation">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">is_continuation</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.is_continuation" title="Link to this definition">¶</a><br /></dt>
<dd><p>multibyte check</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>byte to check</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if the utf8 character <strong>c</strong> is a multibyte continuation character
and the terminal is in unicode mode.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.do_output_char">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">do_output_char</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">space</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.do_output_char" title="Link to this definition">¶</a><br /></dt>
<dd><p>output one character</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>character (or partial unicode symbol)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">space</span></code></dt><dd><p>space available in tty driver write buffer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a helper function that handles one output character (including
special characters like TAB, CR, LF, etc.), doing OPOST processing and
putting the results in the tty driver’s write buffer.</p>
<p>Note that Linux currently ignores TABDLY, CRDLY, VTDLY, FFDLY and NLDLY.
They simply aren’t relevant in the world today. If you ever need them, add
them here.</p>
<p>Locking: should be called under the <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect the column state
and space left in the buffer.</p>
<p><strong>Return</strong></p>
<p>the number of bytes of buffer space used or -1 if no space left.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.process_output">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">process_output</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.process_output" title="Link to this definition">¶</a><br /></dt>
<dd><p>output post processor</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>character (or partial unicode symbol)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Output one character with OPOST processing.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect column state and space left (also, this is
called from <a class="reference internal" href="#c.n_tty_write" title="n_tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_write()</span></code></a> under the tty layer write lock).</p>
<p><strong>Return</strong></p>
<p>-1 when the output device is full and the character must be
retried.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.process_output_block">
<span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">process_output_block</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">nr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.process_output_block" title="Link to this definition">¶</a><br /></dt>
<dd><p>block post processor</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">u8</span> <span class="pre">*buf</span></code></dt><dd><p>character buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">nr</span></code></dt><dd><p>number of bytes to output</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Output a block of characters with OPOST processing.</p>
<p>This path is used to speed up block console writes, among other things when
processing blocks of output data. It handles only the simple cases normally
found and helps to generate blocks of symbols for the console driver and
thus improve performance.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect column state and space left (also, this is
called from <a class="reference internal" href="#c.n_tty_write" title="n_tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_write()</span></code></a> under the tty layer write lock).</p>
<p><strong>Return</strong></p>
<p>the number of characters output.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.__process_echoes">
<span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">__process_echoes</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.__process_echoes" title="Link to this definition">¶</a><br /></dt>
<dd><p>write pending echo characters</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write previously buffered echo (and other ldisc-generated) characters to the
tty.</p>
<p>Characters generated by the ldisc (including echoes) need to be buffered
because the driver’s write buffer can fill during heavy program output.
Echoing straight to the driver will often fail under these conditions,
causing lost characters and resulting mismatches of ldisc state information.</p>
<p>Since the ldisc state must represent the characters actually sent to the
driver at the time of the write, operations like certain changes in column
state are also saved in the buffer and executed here.</p>
<p>A circular fifo buffer is used so that the most recent characters are
prioritized. Also, when control characters are echoed with a prefixed “^”,
the pair is treated atomically and thus not separated.</p>
<p>Locking: callers must hold <code class="docutils literal notranslate"><span class="pre">output_lock</span></code>.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.add_echo_byte">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">add_echo_byte</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">n_tty_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ldata</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.add_echo_byte" title="Link to this definition">¶</a><br /></dt>
<dd><p>add a byte to the echo buffer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>unicode byte to echo</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a character or operation byte to the echo buffer.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.echo_move_back_col">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">echo_move_back_col</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">n_tty_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ldata</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_move_back_col" title="Link to this definition">¶</a><br /></dt>
<dd><p>add operation to move back a column</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to move back one column.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.echo_set_canon_col">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">echo_set_canon_col</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">n_tty_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ldata</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_set_canon_col" title="Link to this definition">¶</a><br /></dt>
<dd><p>add operation to set the canon column</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to set the canon column to the current
column.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.echo_erase_tab">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">echo_erase_tab</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">num_chars</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">after_tab</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">n_tty_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ldata</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_erase_tab" title="Link to this definition">¶</a><br /></dt>
<dd><p>add operation to erase a tab</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">num_chars</span></code></dt><dd><p>number of character columns already used</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">after_tab</span></code></dt><dd><p>true if num_chars starts after a previous tab</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to erase a tab.</p>
<p>Called by the eraser function, which knows how many character columns have
been used since either a previous tab or the start of input. This
information will be used later, along with canon column (if applicable), to
go back the correct number of columns.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.echo_char_raw">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">echo_char_raw</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">n_tty_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ldata</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_char_raw" title="Link to this definition">¶</a><br /></dt>
<dd><p>echo a character raw</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>unicode byte to echo</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>line disc data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Echo user input back onto the screen. This must be called only when
L_ECHO(tty) is true. Called from the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path.</p>
<p>This variant does not treat control characters specially.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.echo_char">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">echo_char</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_char" title="Link to this definition">¶</a><br /></dt>
<dd><p>echo a character</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>unicode byte to echo</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Echo user input back onto the screen. This must be called only when
L_ECHO(tty) is true. Called from the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path.</p>
<p>This variant tags control characters to be echoed as “^X” (where X is the
letter representing the control char).</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.finish_erasing">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">finish_erasing</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">n_tty_data</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ldata</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.finish_erasing" title="Link to this definition">¶</a><br /></dt>
<dd><p>complete erase</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.eraser">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">eraser</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.eraser" title="Link to this definition">¶</a><br /></dt>
<dd><p>handle erase function</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>character input</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform erase and necessary output when an erase character is present in the
stream from the driver layer. Handles the complexities of UTF-8 multibyte
symbols.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.isig">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">isig</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">sig</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.isig" title="Link to this definition">¶</a><br /></dt>
<dd><p>handle the ISIG optio</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">sig</span></code></dt><dd><p>signal</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when a signal is being sent due to terminal input. Called from the
<a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path, so serialized.</p>
<p>Performs input and output flush if !NOFLSH. In this context, the echo
buffer is ‘output’. The signal is processed first to alert any current
readers or writers to discontinue and exit their i/o loops.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">ctrl</span></code>.lock</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_receive_break">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_receive_break</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_break" title="Link to this definition">¶</a><br /></dt>
<dd><p>handle break</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>An RS232 break event has been hit in the incoming bitstream. This can cause
a variety of events depending upon the termios settings.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive termios_rwsem</p>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>may get exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code> if flushing input buffer</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_receive_overrun">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_receive_overrun</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_overrun" title="Link to this definition">¶</a><br /></dt>
<dd><p>handle overrun reporting</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Data arrived faster than we could process it. While the tty driver has
flagged this the bits that were missed are gone forever.</p>
<p>Called from the receive_buf path so single threaded. Does not need locking
as num_overrun and overrun_time are function private.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_receive_parity_error">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_receive_parity_error</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_parity_error" title="Link to this definition">¶</a><br /></dt>
<dd><p>error notifier</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>character</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Process a parity error and queue the right data to indicate the error case
if necessary.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_receive_char_flow_ctrl">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_receive_char_flow_ctrl</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">lookahead_done</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_char_flow_ctrl" title="Link to this definition">¶</a><br /></dt>
<dd><p>receive flow control chars</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>character</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">lookahead_done</span></code></dt><dd><p>lookahead has processed this character already</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Receive and process flow control character actions.</p>
<p>In case lookahead for flow control chars already handled the character in
advance to the normal receive, the actions are skipped during normal
receive.</p>
<p>Returns true if <strong>c</strong> is consumed as flow-control character, the character
must not be treated as normal character.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_receive_char">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_receive_char</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="n"><span class="pre">c</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_char" title="Link to this definition">¶</a><br /></dt>
<dd><p>perform processing</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">c</span></code></dt><dd><p>character</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Process an individual character of input received from the driver.  This is
serialized with respect to itself by the rules for the driver above.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>
publishes canon_head if canonical mode is active</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_receive_buf_common">
<span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_receive_buf_common</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cp</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">fp</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">count</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n"><span class="pre">flow</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_buf_common" title="Link to this definition">¶</a><br /></dt>
<dd><p>process input</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>device to receive input</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">u8</span> <span class="pre">*cp</span></code></dt><dd><p>input chars</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">u8</span> <span class="pre">*fp</span></code></dt><dd><p>flags for each char (if <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, all chars are <code class="docutils literal notranslate"><span class="pre">TTY_NORMAL</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">count</span></code></dt><dd><p>number of input chars in <strong>cp</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">flow</span></code></dt><dd><p>enable flow control</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by the terminal driver when a block of characters has been received.
This function must be called from soft contexts not from interrupt context.
The driver is responsible for making calls one at a time and in order (or
using <a class="reference internal" href="tty_buffer.html#c.flush_to_ldisc" title="flush_to_ldisc"><code class="xref c c-func docutils literal notranslate"><span class="pre">flush_to_ldisc()</span></code></a>).</p>
<p>In canonical mode, the maximum line length is 4096 chars (including the line
termination char); lines longer than 4096 chars are truncated. After 4095
chars, input data is still processed but not stored. Overflow processing
ensures the tty can always receive more input until at least one line can be
read.</p>
<p>In non-canonical mode, the read buffer will only accept 4095 chars; this
provides the necessary space for a newline char if the input mode is
switched to canonical.</p>
<p>Note it is possible for the read buffer to _contain_ 4096 chars in
non-canonical mode: the read buffer could already contain the maximum canon
line of 4096 chars when the mode is switched to non-canonical.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>claims non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>
publishes commit_head or canon_head</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>the # of input chars from <strong>cp</strong> which were processed.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_set_termios">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_set_termios</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">ktermios</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">old</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_set_termios" title="Link to this definition">¶</a><br /></dt>
<dd><p>termios data changed</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">ktermios</span> <span class="pre">*old</span></code></dt><dd><p>previous data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by the tty layer when the user changes termios flags so that the line
discipline can plan ahead. This function cannot sleep and is protected from
re-entry by the tty layer. The user is guaranteed that this function will
not be re-entered or in progress when the ldisc is closed.</p>
<p>Locking: Caller holds <strong>tty-&gt;termios_rwsem</strong></p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_close">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_close</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_close" title="Link to this definition">¶</a><br /></dt>
<dd><p>close the ldisc for this tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called from the terminal layer when this line discipline is being shut down,
either because of a close or becsuse of a discipline change. The function
will not be called while other ldisc methods are in progress.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_open">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_open</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_open" title="Link to this definition">¶</a><br /></dt>
<dd><p>open an ldisc</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal to open</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when this line discipline is being attached to the terminal device.
Can sleep. Called serialized so that no other events will occur in parallel.
No further open will occur until a close.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.copy_from_read_buf">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">copy_from_read_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">kbp</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">nr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.copy_from_read_buf" title="Link to this definition">¶</a><br /></dt>
<dd><p>copy read data directly</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">**kbp</span></code></dt><dd><p>data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">*nr</span></code></dt><dd><p>size of data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Helper function to speed up <a class="reference internal" href="#c.n_tty_read" title="n_tty_read"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_read()</span></code></a>. It is only called when <code class="docutils literal notranslate"><span class="pre">ICANON</span></code> is
off; it copies characters straight from the tty queue.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>called under the <strong>ldata-&gt;atomic_read_lock</strong> sem</p></li>
<li><dl class="simple">
<dt>n_tty_read()/consumer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>;
read_tail published</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if it successfully copied data, but there is still more data
to be had.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.canon_copy_from_read_buf">
<span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">canon_copy_from_read_buf</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">kbp</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">nr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.canon_copy_from_read_buf" title="Link to this definition">¶</a><br /></dt>
<dd><p>copy read data in canonical mode</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">**kbp</span></code></dt><dd><p>data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">*nr</span></code></dt><dd><p>size of data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Helper function for <a class="reference internal" href="#c.n_tty_read" title="n_tty_read"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_read()</span></code></a>. It is only called when <code class="docutils literal notranslate"><span class="pre">ICANON</span></code> is on; it
copies one line of input up to and including the line-delimiting character
into the result buffer.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>called under the <code class="docutils literal notranslate"><span class="pre">atomic_read_lock</span></code> mutex</p></li>
<li><dl class="simple">
<dt>n_tty_read()/consumer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>;
read_tail published</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>When termios is changed from non-canonical to canonical mode and the
read buffer contains data, <a class="reference internal" href="#c.n_tty_set_termios" title="n_tty_set_termios"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_set_termios()</span></code></a> simulates an EOF push (as if
C-d were input) _without_ the <code class="docutils literal notranslate"><span class="pre">DISABLED_CHAR</span></code> in the buffer. This causes data
already processed as input to be immediately available as input although a
newline has not been received.</p>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.job_control">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">job_control</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.job_control" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.job_control" title="Link to this definition">¶</a><br /></dt>
<dd><p>check job control</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>file handle</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform job control management checks on this <strong>file</strong>/<strong>tty</strong> descriptor and if
appropriate send any needed signals and return a negative error code if
action should be taken.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>redirected write test is safe</p></li>
<li><p>current-&gt;signal-&gt;tty check is safe</p></li>
<li><p>ctrl.lock to safely reference <strong>tty-&gt;ctrl.pgrp</strong></p></li>
</ul>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_read">
<span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_read</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.n_tty_read" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">kbuf</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nr</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cookie</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="n"><span class="pre">offset</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_read" title="Link to this definition">¶</a><br /></dt>
<dd><p>read function for tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>file object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*kbuf</span></code></dt><dd><p>kernelspace buffer pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">nr</span></code></dt><dd><p>size of I/O</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**cookie</span></code></dt><dd><p>if non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code>, this is a continuation read</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">offset</span></code></dt><dd><p>where to continue reading from (unused in n_tty)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform reads for the line discipline. We are guaranteed that the line
discipline will not be closed under us but we may get multiple parallel
readers and must handle this ourselves. We may also get a hangup. Always
called in user context, may sleep.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<dl class="simple">
<dt>Locking: n_tty_read()/consumer path:</dt><dd><p>claims non-exclusive termios_rwsem;
publishes read_tail</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_write">
<span class="n"><span class="pre">ssize_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_write</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.n_tty_write" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">u8</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nr</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_write" title="Link to this definition">¶</a><br /></dt>
<dd><p>write function for tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>file object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">u8</span> <span class="pre">*buf</span></code></dt><dd><p>userspace buffer pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">nr</span></code></dt><dd><p>size of I/O</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write function of the terminal device. This is serialized with respect to
other write callers but not to termios changes, reads and other such events.
Since the receive code will echo characters, thus calling driver write
methods, the <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> is used in the output processing functions called
here as well as in the echo processing function to protect the column state
and space left in the buffer.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<dl class="simple">
<dt>Locking: output_lock to protect column state and space left</dt><dd><p>(note that the process_output*() functions take this lock themselves)</p>
</dd>
</dl>
</div>
<dl class="c function">
<dt class="sig sig-object c" id="c.n_tty_poll">
<span class="n"><span class="pre">__poll_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">n_tty_poll</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><span class="n"><span class="pre">tty_struct</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tty</span></span>, <span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.n_tty_poll" title="file"><span class="n"><span class="pre">file</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">file</span></span>, <span class="n"><span class="pre">poll_table</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">wait</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_poll" title="Link to this definition">¶</a><br /></dt>
<dd><p>poll method for N_TTY</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>file accessing it</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">poll_table</span> <span class="pre">*wait</span></code></dt><dd><p>poll table</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when the line discipline is asked to poll() for data or for special
events. This code is not serialized with respect to other events save
open/close.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<p>Locking: called without the kernel lock held -- fine.</p>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/tty/n_tty.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>