<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Linux kernel driver for Huawei Ethernet Device Driver (hinic3) family &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=a152c8ac" />
    <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Linux Base Driver for the Intel(R) PRO/100 Family of Adapters" href="../intel/e100.html" />
    <link rel="prev" title="Linux Kernel Driver for Huawei Intelligent NIC(HiNIC) family" href="hinic.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.16.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../subsystem-apis.html">Subsystems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../subsystem-apis.html#networking-interfaces">Networking interfaces</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../../index.html">Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../isdn/index.html">ISDN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../mhi/index.html">MHI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../subsystem-apis.html#other-subsystems">Other subsystems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/networking/device_drivers/ethernet/huawei/hinic3.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="linux-kernel-driver-for-huawei-ethernet-device-driver-hinic3-family">
<h1>Linux kernel driver for Huawei Ethernet Device Driver (hinic3) family<a class="headerlink" href="#linux-kernel-driver-for-huawei-ethernet-device-driver-hinic3-family" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>The hinic3 is a network interface card (NIC) for Data Center. It supports
a range of link-speed devices (10GE, 25GE, 100GE, etc.). The hinic3
devices can have multiple physical forms: LOM (Lan on Motherboard) NIC,
PCIe standard NIC, OCP (Open Compute Project) NIC, etc.</p>
<p>The hinic3 driver supports the following features:
- IPv4/IPv6 TCP/UDP checksum offload
- TSO (TCP Segmentation Offload), LRO (Large Receive Offload)
- RSS (Receive Side Scaling)
- MSI-X interrupt aggregation configuration and interrupt adaptation.
- SR-IOV (Single Root I/O Virtualization).</p>
</section>
<section id="content">
<h2>Content<a class="headerlink" href="#content" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Supported PCI vendor ID/device IDs</p></li>
<li><p>Source Code Structure of Hinic3 Driver</p></li>
<li><p>Management Interface</p></li>
</ul>
</section>
<section id="supported-pci-vendor-id-device-ids">
<h2>Supported PCI vendor ID/device IDs<a class="headerlink" href="#supported-pci-vendor-id-device-ids" title="Link to this heading">¶</a></h2>
<p>19e5:0222 - hinic3 PF/PPF
19e5:375F - hinic3 VF</p>
<p>Prime Physical Function (PPF) is responsible for the management of the
whole NIC card. For example, clock synchronization between the NIC and
the host. Any PF may serve as a PPF. The PPF is selected dynamically.</p>
</section>
<section id="source-code-structure-of-hinic3-driver">
<h2>Source Code Structure of Hinic3 Driver<a class="headerlink" href="#source-code-structure-of-hinic3-driver" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>hinic3_pci_id_tbl.h</p></td>
<td><p>Supported device IDs</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_hw_intf.h</p></td>
<td><p>Interface between HW and driver</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_queue_common.[ch]</p></td>
<td><p>Common structures and methods for NIC queues</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_common.[ch]</p></td>
<td><p>Encapsulation of memory operations in Linux</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_csr.h</p></td>
<td><p>Register definitions in the BAR</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_hwif.[ch]</p></td>
<td><p>Interface for BAR</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_eqs.[ch]</p></td>
<td><p>Interface for AEQs and CEQs</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_mbox.[ch]</p></td>
<td><p>Interface for mailbox</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_mgmt.[ch]</p></td>
<td><p>Management interface based on mailbox and AEQ</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_wq.[ch]</p></td>
<td><p>Work queue data structures and interface</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_cmdq.[ch]</p></td>
<td><p>Command queue is used to post command to HW</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_hwdev.[ch]</p></td>
<td><p>HW structures and methods abstractions</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_lld.[ch]</p></td>
<td><p>Auxiliary driver adaptation layer</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_hw_comm.[ch]</p></td>
<td><p>Interface for common HW operations</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_mgmt_interface.h</p></td>
<td><p>Interface between firmware and driver</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_hw_cfg.[ch]</p></td>
<td><p>Interface for HW configuration</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_irq.c</p></td>
<td><p>Interrupt request</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_netdev_ops.c</p></td>
<td><p>Operations registered to Linux kernel stack</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_nic_dev.h</p></td>
<td><p>NIC structures and methods abstractions</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_main.c</p></td>
<td><p>Main Linux kernel driver</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_nic_cfg.[ch]</p></td>
<td><p>NIC service configuration</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_nic_io.[ch]</p></td>
<td><p>Management plane interface for TX and RX</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_rss.[ch]</p></td>
<td><p>Interface for Receive Side Scaling (RSS)</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_rx.[ch]</p></td>
<td><p>Interface for transmit</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_tx.[ch]</p></td>
<td><p>Interface for receive</p></td>
</tr>
<tr class="row-even"><td><p>hinic3_ethtool.c</p></td>
<td><p>Interface for ethtool operations (ops)</p></td>
</tr>
<tr class="row-odd"><td><p>hinic3_filter.c</p></td>
<td><p>Interface for MAC address</p></td>
</tr>
</tbody>
</table>
</section>
<section id="management-interface">
<h2>Management Interface<a class="headerlink" href="#management-interface" title="Link to this heading">¶</a></h2>
<section id="asynchronous-event-queue-aeq">
<h3>Asynchronous Event Queue (AEQ)<a class="headerlink" href="#asynchronous-event-queue-aeq" title="Link to this heading">¶</a></h3>
<p>AEQ receives high priority events from the HW over a descriptor queue.
Every descriptor is a fixed size of 64 bytes. AEQ can receive solicited or
unsolicited events. Every device, VF or PF, can have up to 4 AEQs.
Every AEQ is associated to a dedicated IRQ. AEQ can receive multiple types
of events, but in practice the hinic3 driver ignores all events except for
2 mailbox related events.</p>
</section>
<section id="mailbox">
<h3>Mailbox<a class="headerlink" href="#mailbox" title="Link to this heading">¶</a></h3>
<p>Mailbox is a communication mechanism between the hinic3 driver and the HW.
Each device has an independent mailbox. Driver can use the mailbox to send
requests to management. Driver receives mailbox messages, such as responses
to requests, over the AEQ (using event HINIC3_AEQ_FOR_MBOX). Due to the
limited size of mailbox data register, mailbox messages are sent
segment-by-segment.</p>
<p>Every device can use its mailbox to post request to firmware. The mailbox
can also be used to post requests and responses between the PF and its VFs.</p>
</section>
<section id="completion-event-queue-ceq">
<h3>Completion Event Queue (CEQ)<a class="headerlink" href="#completion-event-queue-ceq" title="Link to this heading">¶</a></h3>
<p>The implementation of CEQ is the same as AEQ. It receives completion events
from HW over a fixed size descriptor of 32 bits. Every device can have up
to 32 CEQs. Every CEQ has a dedicated IRQ. CEQ only receives solicited
events that are responses to requests from the driver. CEQ can receive
multiple types of events, but in practice the hinic3 driver ignores all
events except for HINIC3_CMDQ that represents completion of previously
posted commands on a cmdq.</p>
</section>
<section id="command-queue-cmdq">
<h3>Command Queue (cmdq)<a class="headerlink" href="#command-queue-cmdq" title="Link to this heading">¶</a></h3>
<p>Every cmdq has a dedicated work queue on which commands are posted.
Commands on the work queue are fixed size descriptor of size 64 bytes.
Completion of a command will be indicated using ctrl bits in the
descriptor that carried the command. Notification of command completions
will also be provided via event on CEQ. Every device has 4 command queues
that are initialized as a set (called cmdqs), each with its own type.
Hinic3 driver only uses type HINIC3_CMDQ_SYNC.</p>
</section>
<section id="work-queues-wq">
<h3>Work Queues(WQ)<a class="headerlink" href="#work-queues-wq" title="Link to this heading">¶</a></h3>
<p>Work queues are logical arrays of fixed size WQEs. The array may be spread
over multiple non-contiguous pages using indirection table. Work queues are
used by I/O queues and command queues.</p>
</section>
<section id="global-function-id">
<h3>Global function ID<a class="headerlink" href="#global-function-id" title="Link to this heading">¶</a></h3>
<p>Every function, PF or VF, has a unique ordinal identification within the device.
Many management commands (mbox or cmdq) contain this ID so HW can apply the
command effect to the right function.</p>
<p>PF is allowed to post management commands to a subordinate VF by specifying the
VFs ID. A VF must provide its own ID. Anti-spoofing in the HW will cause
command from a VF to fail if it contains the wrong ID.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../../_sources/networking/device_drivers/ethernet/huawei/hinic3.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>