<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Kernel driver smsc47b397 &#8212; The Linux Kernel  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=a152c8ac" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kernel driver smsc47m192" href="smsc47m192.html" />
    <link rel="prev" title="Kernel driver Ampere(R)’s Altra(R) SMpro hwmon" href="smpro-hwmon.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.14.0</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">Development process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Maintainer handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver APIs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../subsystem-apis.html">Subsystems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#core-subsystems">Core subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#human-interfaces">Human interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#networking-interfaces">Networking interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subsystem-apis.html#storage-interfaces">Storage interfaces</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../subsystem-apis.html#other-subsystems">Other subsystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpu-freq/index.html">CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fpga/index.html">FPGA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pcmcia/index.html">PCMCIA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../watchdog/index.html">Watchdog Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../virt/index.html">Virtualization Support</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Hardware Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../accel/index.html">Compute Accelerators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../crypto/index.html">Crypto API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../PCI/index.html">PCI Bus Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../peci/index.html">PECI Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wmi/index.html">WMI Subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tee/index.html">TEE Subsystem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Testing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Hacking guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">Fault injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Userspace tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">Userspace API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  if (currents.length) {
    sbar.scrollTop = currents[currents.length - 1].offsetTop;
  }
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/hwmon/smsc47b397.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <!-- SPDX-License-Identifier: GPL-2.0 -->
<!-- Copyright © 2023, Oracle and/or its affiliates. -->


<section id="kernel-driver-smsc47b397">
<h1>Kernel driver smsc47b397<a class="headerlink" href="#kernel-driver-smsc47b397" title="Link to this heading">¶</a></h1>
<p>Supported chips:</p>
<blockquote>
<div><ul>
<li><p>SMSC LPC47B397-NC</p></li>
<li><p>SMSC SCH5307-NS</p></li>
<li><p>SMSC SCH5317</p>
<p>Prefix: ‘smsc47b397’</p>
<p>Addresses scanned: none, address read from Super I/O config space</p>
<p>Datasheet: In this file</p>
</li>
</ul>
</div></blockquote>
<p>Authors:</p>
<blockquote>
<div><ul class="simple">
<li><p>Mark M. Hoffman &lt;<a class="reference external" href="mailto:mhoffman&#37;&#52;&#48;lightlink&#46;com">mhoffman<span>&#64;</span>lightlink<span>&#46;</span>com</a>&gt;</p></li>
<li><p>Utilitek Systems, Inc.</p></li>
</ul>
</div></blockquote>
<p>November 23, 2004</p>
<p>The following specification describes the SMSC LPC47B397-NC <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> sensor chip
(for which there is no public datasheet available). This document was
provided by Craig Kelly (In-Store Broadcast Network) and edited/corrected
by Mark M. Hoffman &lt;<a class="reference external" href="mailto:mhoffman&#37;&#52;&#48;lightlink&#46;com">mhoffman<span>&#64;</span>lightlink<span>&#46;</span>com</a>&gt;.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>And SMSC SCH5307-NS and SCH5317, which have different device IDs but are
otherwise compatible.</p>
</aside>
</aside>
<hr class="docutils" />
<section id="methods-for-detecting-the-hp-sio-and-reading-the-thermal-data-on-a-dc7100">
<h2>Methods for detecting the HP SIO and reading the thermal data on a dc7100<a class="headerlink" href="#methods-for-detecting-the-hp-sio-and-reading-the-thermal-data-on-a-dc7100" title="Link to this heading">¶</a></h2>
<p>The thermal information on the dc7100 is contained in the SIO Hardware Monitor
(HWM). The information is accessed through an index/data pair. The index/data
pair is located at the HWM Base Address + 0 and the HWM Base Address + 1. The
HWM Base address can be obtained from Logical Device 8, registers 0x60 (MSB)
and 0x61 (LSB). Currently we are using 0x480 for the HWM Base Address and
0x480 and 0x481 for the index/data pair.</p>
<p>Reading temperature information.
The temperature information is located in the following registers:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Temp1</p></td>
<td><p>0x25</p></td>
<td><p>(Currently, this reflects the CPU temp on all systems).</p></td>
</tr>
<tr class="row-even"><td><p>Temp2</p></td>
<td><p>0x26</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Temp3</p></td>
<td><p>0x27</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Temp4</p></td>
<td><p>0x80</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>Programming Example
The following is an example of how to read the HWM temperature registers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MOV     DX,480H
MOV     AX,25H
OUT     DX,AL
MOV     DX,481H
IN      AL,DX
</pre></div>
</div>
<p>AL contains the data in hex, the temperature in Celsius is the decimal
equivalent.</p>
<p>Ex: If AL contains 0x2A, the temperature is 42 degrees C.</p>
<p>Reading tach information.
The fan speed information is located in the following registers:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Tach1</p></td>
<td><p>0x28</p></td>
<td><p>0x29</p></td>
<td><p>(Currently, this reflects the CPU
fan speed on all systems).</p></td>
</tr>
<tr class="row-even"><td><p>Tach2</p></td>
<td><p>0x2A</p></td>
<td><p>0x2B</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Tach3</p></td>
<td><p>0x2C</p></td>
<td><p>0x2D</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Tach4</p></td>
<td><p>0x2E</p></td>
<td><p>0x2F</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Reading the tach LSB locks the tach MSB.
The LSB Must be read first.</p>
</div>
</section>
<section id="how-to-convert-the-tach-reading-to-rpm">
<h2>How to convert the tach reading to RPM<a class="headerlink" href="#how-to-convert-the-tach-reading-to-rpm" title="Link to this heading">¶</a></h2>
<p>The tach reading (TCount) is given by: (Tach MSB * 256) + (Tach LSB)
The SIO counts the number of 90kHz (11.111us) pulses per revolution.
RPM = 60/(TCount * 11.111us)</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Reg 0x28 = 0x9B
Reg 0x29 = 0x08
</pre></div>
</div>
<p>TCount = 0x89B = 2203</p>
<p>RPM = 60 / (2203 * 11.11111 E-6) = 2451 RPM</p>
<p>Obtaining the SIO version.</p>
</section>
<section id="configuration-sequence">
<h2>Configuration Sequence<a class="headerlink" href="#configuration-sequence" title="Link to this heading">¶</a></h2>
<p>To program the configuration registers, the following sequence must be followed:
1. Enter Configuration Mode
2. Configure the Configuration Registers
3. Exit Configuration Mode.</p>
<section id="enter-configuration-mode">
<h3>Enter Configuration Mode<a class="headerlink" href="#enter-configuration-mode" title="Link to this heading">¶</a></h3>
<p>To place the chip into the Configuration State The config key (0x55) is written
to the CONFIG PORT (0x2E).</p>
</section>
<section id="configuration-mode">
<h3>Configuration Mode<a class="headerlink" href="#configuration-mode" title="Link to this heading">¶</a></h3>
<p>In configuration mode, the INDEX PORT is located at the CONFIG PORT address and
the DATA PORT is at INDEX PORT address + 1.</p>
<p>The desired configuration registers are accessed in two steps:</p>
<ol class="loweralpha simple">
<li><p>Write the index of the Logical Device Number Configuration Register
(i.e., 0x07) to the INDEX PORT and then write the number of the
desired logical device to the DATA PORT.</p></li>
<li><p>Write the address of the desired configuration register within the
logical device to the INDEX PORT and then write or read the config-
uration register through the DATA PORT.</p></li>
</ol>
<dl class="simple">
<dt>Note:</dt><dd><p>If accessing the Global Configuration Registers, step (a) is not required.</p>
</dd>
</dl>
</section>
<section id="exit-configuration-mode">
<h3>Exit Configuration Mode<a class="headerlink" href="#exit-configuration-mode" title="Link to this heading">¶</a></h3>
<p>To exit the Configuration State the write 0xAA to the CONFIG PORT (0x2E).
The chip returns to the RUN State.  (This is important).</p>
</section>
<section id="programming-example">
<h3>Programming Example<a class="headerlink" href="#programming-example" title="Link to this heading">¶</a></h3>
<p>The following is an example of how to read the SIO Device ID located at 0x20:</p>
<blockquote>
<div><p>; ENTER CONFIGURATION MODE
MOV     DX,02EH
MOV     AX,055H
OUT     DX,AL
; GLOBAL CONFIGURATION  REGISTER
MOV     DX,02EH
MOV     AL,20H
OUT     DX,AL
; READ THE DATA
MOV     DX,02FH
IN      AL,DX
; EXIT CONFIGURATION MODE
MOV     DX,02EH
MOV     AX,0AAH
OUT     DX,AL</p>
</div></blockquote>
<p>The registers of interest for identifying the SIO on the dc7100 are Device ID
(0x20) and Device Rev  (0x21).</p>
<p>The Device ID will read 0x6F (0x81 for SCH5307-NS, and 0x85 for SCH5317)
The Device Rev currently reads 0x01</p>
</section>
</section>
<section id="obtaining-the-hwm-base-address">
<h2>Obtaining the HWM Base Address<a class="headerlink" href="#obtaining-the-hwm-base-address" title="Link to this heading">¶</a></h2>
<p>The following is an example of how to read the HWM Base Address located in
Logical Device 8:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; ENTER CONFIGURATION MODE
MOV     DX,02EH
MOV     AX,055H
OUT     DX,AL
; CONFIGURE REGISTER CRE0,
; LOGICAL DEVICE 8
MOV     DX,02EH
MOV     AL,07H
OUT     DX,AL ;Point to LD# Config Reg
MOV     DX,02FH
MOV     AL, 08H
OUT     DX,AL;Point to Logical Device 8
;
MOV     DX,02EH
MOV     AL,60H
OUT     DX,AL   ; Point to HWM Base Addr MSB
MOV     DX,02FH
IN      AL,DX   ; Get MSB of HWM Base Addr
; EXIT CONFIGURATION MODE
MOV     DX,02EH
MOV     AX,0AAH
OUT     DX,AL
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/hwmon/smsc47b397.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>